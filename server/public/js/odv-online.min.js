"use strict";class PatchSpec{constructor(t,e){this.name=t;this.xmlStr=e}}class ViewHistory{static maxEntryCount=20;constructor(){this.clear()}autoSave(){if(this.currIdx<1)return;let t=this.saveName(),e=Ui.rsrc.keys[0]+t;this.undoArr[0].name=t;localStorage.setItem(e,JSON.stringify(this.undoArr[0]));if(this.currIdx>0){this.undoArr[this.currIdx].name=t;localStorage.setItem(e+"~",JSON.stringify(this.undoArr[this.currIdx]))}Fct.setLastLocalStorageChangeTime()}clear(){this.undoArr=[];this.currIdx=-1}current(){return this.currIdx>-1?this.undoArr[this.currIdx]:new ViewSpec}currentName(){return this.current().name}currentPureName(){return ViewSpec.pureName(this.currentName())}isModified(){return this.currIdx>0}push(e){if(this.size()>=ViewHistory.maxEntryCount){this.undoArr.splice(1,1);if(this.currIdx>0)--this.currIdx}if(this.size()-this.currIdx>1)this.undoArr.splice(this.currIdx+1);if(e.elapsedSecs==-1){let t=this.current();if(t.name==e.name&&t.elapsedSecs!=-1)e.elapsedSecs=t.elapsedSecs}this.undoArr.push(e);this.currIdx=this.size()-1}reset(t,e=true){if(e)this.autoSave();t.descr="Initial View";this.clear();this.push(t);this.currIdx=0}saveName(){let t=viewHistory.current(),e=t.name;if(coll.name!=undefined&&!(e==undefined||t.elapsedSecs>App.maxLastViewElapsedSecs)){e=ViewSpec.pureName(e);localStorage.setItem(coll.name+"/lastViewName",e)}return e}setCurrentIndex(t){t=Math.max(0,t);if(t<this.size()&&t!=this.currIdx){this.currIdx=t;return true}else return false}size(){return this.undoArr.length}}class ViewSpec{constructor(t,e,i="",s=-1){this.descr=i;this.name=ViewSpec.validatedName(t);this.xmlStr=e;this.elapsedSecs=s}static pureName(t){let e=t,i=e.lastIndexOf("/");if(i>-1)e=e.substring(i+1);return e}static validatedName(t){if(t==undefined)return t;return t.startsWith("$")&&t.endsWith("$")?t.substring(1,t.length-1):t}}class ViewInfo{constructor(){}getGObjInfo(e,i){return this.gObjInfoArr.find(t=>t.win_id==e&&t.index==i)}getGObjInfoIndex(e,i){return this.gObjInfoArr.findIndex(t=>t.win_id==e&&t.index==i)}setContent(t){this.dataWinCount=t.rects.length-1;this.valStationCount=t.selected_station_count;this.valDataCountsByVar=t.data_counts_by_var;this.valTotalSampleCount=t.sample_count;this.dataCountsByWin=t.data_counts_by_win;this.xDecimals=t.x_decimal_counts;this.yDecimals=t.y_decimal_counts;this.zDecimals=t.z_decimal_counts;this.zVarIdents=t.zvar_identifiers;this.contourBlocks=t.contour_blocks;this.autoContours=t.auto_contours;this.autoColorMappingPrms=t.auto_color_mapping_prms;this.gObjInfoArr=t.gobject_info;this.isGeoMap=t.is_geographic_map;this.drvdVarNames=t.drvdvar_names;this.drvdVarUNames=t.drvdvar_unames;this.drvdVarUnits=t.drvdvar_units;this.drvdVarUUnits=t.drvdvar_uunits;this.drvdVarIds=t.drvdvar_ids}zMatchingWinId(t,e){return Fct.indexOf2(this.zVarIdents,"var_id",e,"var_group",View.varGroupId(t))}}class View{constructor(t){let e,i,s,a;a=t.documentElement.attributes;this.xViewVersion=Fct.xmlStr(a,"xview","0.23");this.axisSync="T";i=$$(t,"General");if(i.length>0){a=i[0].attributes;this.axisSync=Fct.xmlStr(a,"axis_syncing","T")}this.mapWin=new MapWindow(t);this.section=new Section(t);i=$$(t,"DataWindow");this.dataWinArr=[];for(e=0;e<i.length;++e)this.dataWinArr.push(new DataWindow(i[e]));this.drvdVarSet=new DrvdVarSet(t);this.isoVarSet=new IsoVarSet(t);i=$$(t,"PickedStations");this.pickedStatArr=[];if(i.length>0){s=$$(i[0],"Station");for(e=0;e<s.length;++e)this.pickedStatArr.push(new PickedStat(s[e]))}i=$$(t,"Canvas");if(i.length>0)this.gObjSet=new GObjectSet(i[0]);else this.gObjSet=new GObjectSet;this.statFilter=new StatFilter(t);i=$$(t,"BasicVariables");this.rangesVarIdArr=[];this.rangesMinValArr=[];this.rangesMaxValArr=[];if(i.length>0){s=$$(i[0],"Variable");for(e=0;e<s.length;++e){a=s[e].attributes;this.rangesVarIdArr.push(Fct.xmlNum(a,"var_id",-1));this.rangesMinValArr.push(Fct.xmlNum(a,"min_value",App.missDOUBLE));this.rangesMaxValArr.push(Fct.xmlNum(a,"max_value",App.largeDOUBLE))}}i=$$(t,"VariableDisplayOrder");if(i.length>0)this.varDispOrder=Fct.toNumericArray(i[0].innerHTML);else this.varDispOrder=[]}appendGObjFromXml(t,e,i){let s=view.getGObjSet(t);let a=new GObjectSet;a.fromXGobStr(e);let l,r=a.gObjArr.length;if(r>0){for(l=0;l<r;++l)s.gObjArr.unshift(a.gObjArr[l]);app.sendUpdateGobjMsg(t,-1,s,i)}}copyGObj(t){let e=viewInfo.gObjInfoArr[t];let i=this.getGObjSet(e.win_id),s=i.gObjArr,a=e.type;if(a==15||a==30||GObject.isTemplate(a))return;s.unshift(new GObject(s[e.non_template_index],true));app.sendUpdateGobjMsg(e.win_id,a,i,"Copy Graphics Object")}createGObj(t){if(!t)return;let e;switch(ui.currMiOption){case"miAddAnnotation":e=new GObject(1,ui.ptgCnvsX,ui.ptgCnvsY);break;case"miAddSymbol":e=new GObject(5,ui.ptgCnvsX,ui.ptgCnvsY);break;case"miAddLine":case"miAddPolyline":e=new GObject(11,ui.ptgCnvsX,ui.ptgCnvsY);break;case"miAddPolygon":e=new GObject(12,ui.ptgCnvsX,ui.ptgCnvsY);break;case"miAddEllipse":case"miAddRectangle":e=new GObject(12,ui.ptgCnvsX,ui.ptgCnvsY);break}DlgGObjProps.show(e,ui.rclickWinId,false,false,true)}static derivedVarType(t,e=view.drvdVarSet.drvdVarArr){let i=View.indexOfDrvdVar(t,e);return i>-1?e[i].type:-1}getGObj(t){let e=viewInfo.gObjInfoArr[t],i=e.win_id,s=e.type,a;if(e.non_template_index>-1)a=this.getGObjArr(i)[e.non_template_index];else if(s==40)a=this.legendGobj(i);else if(s==41)a=this.udotGobj(i);else if(s==42)a=this.uarrowGobj(i);return a}getGObjArr(t){return this.getGObjSet(t).gObjArr}getGObjSet(t){if(t==0)return this.mapWin.gObjSet;else if(t>0)return this.dataWinArr[t-1].gObjSet;else return this.gObjSet}gObjMoveTo(t){let e=viewInfo.gObjInfoArr[ui.rclickGObjIdx],i=e.win_id;let s=e.non_template_index,a=this.getGObjSet(i);let l=a.gObjArr,r=l.length,n=false;let o="Change Graphics Object Order";switch(t){case"miGObjMoveTop":if(s>0){Fct.moveElem(l,s,0);n=true}break;case"miGObjMoveUp":if(s>0){Fct.moveElem(l,s,s-1);n=true}break;case"miGObjMoveDwn":if(s<r-1){Fct.moveElem(l,s,s+1);n=true}break;case"miGObjMoveBot":if(s<r-1){Fct.moveElem(l,s,r-1);n=true}break;case"miGObjDelete":o="Delete Graphics Object";l.splice(s,1);n=true;break;case"miGObjDeleteAll":o="Delete All Graphics Objects";a=new GObjectSet;n=true;break}if(n)app.sendUpdateGobjMsg(i,e.type,a,o)}static indexOfDrvdVar(t,e=view.drvdVarSet.drvdVarArr){return Fct.indexOf(e,"varId",t)}legendGobj(t){if(t==0)return this.mapWin.legend;else if(t>0)return this.dataWinArr[t-1].legend}static nextDrvdVarId(t){let e=App.VID_FIRSTDRVD;while(View.indexOfDrvdVar(e,t)>-1){++e}return e}paletteName(t){if(t==-1)return"Odv";else if(t==0)return this.mapWin.palName;else if(t>0)return this.dataWinArr[t-1].palName}pickId(e){return this.pickedStatArr.findIndex(t=>t.statId==e)}static retrieveView(s,a){let l,r,n,o=s,d="Load View";if(s==null||s.length==0)return{name:n,spec:o,descr:d};if(s.startsWith("private:")){let t=coll.name==undefined?a:coll.name;n=ViewSpec.validatedName(s.slice(8));r=Ui.rsrc.keys[0]+n;let e=localStorage.getItem(r+"~");let i=localStorage.getItem(r);o=i;if(e!=null){l=JSON.parse(i);viewHistory.reset(new ViewSpec(l.name,l.xmlStr,"",l.elapsedSecs));o=e;d="Unsaved Changes";localStorage.removeItem(r+"~")}if(o.startsWith("{")){l=JSON.parse(o);o=l.xmlStr}}else{if(!o.endsWith(".xview"))o+=".xview";let t=o.lastIndexOf("/"),e=o.lastIndexOf(".xview");n=ViewSpec.validatedName(o.slice(0,e))}return{name:n,spec:o,descr:d}}setDataWinDispStyleGridded(t,e,i,s,a,l,r,n,o){let d,c=t-1,m=c;if(t==-1){c=0;m=this.dataWinArr.length-1}for(d=c;d<=m;++d){let t=this.dataWinArr[d];t.plotMode=e;t.autoScale=i;t.xScale=s;t.yScale=a;t.isopycnicGridding=l;t.drawShaded=r;t.hideBad=n;t.hideDistance=o}}setDataWinDispStyleOrig(t,e,i,s,a){let l,r=t-1,n=r;if(t==-1){r=0;n=this.dataWinArr.length-1}for(l=r;l<=n;++l){let t=this.dataWinArr[l];t.plotMode=e;t.symbSize=i;t.symbColor=s;t.lineWidth=a}}setDataWinGeneralProps(t,e,i,s,a,l,r,n){let o,d=t-1,c=d;if(t==-1){d=0;c=this.dataWinArr.length-1}for(o=d;o<=c;++o){let t=this.dataWinArr[o];t.palName=e;t.fontSizeFac=i;t.bckColor=s;t.gridColor=a;t.drawGrid=l;t.autoCreateLabels=r;if(n!=undefined)t.highlightStyle=n}}setDataWinMarkProps(t,e,i,s){let a,l=t-1,r=l;if(t==-1){l=0;r=this.dataWinArr.length-1}for(a=l;a<=r;++a){let t=this.dataWinArr[a];t.drawMarks=e;t.markSize=i;t.markColor=s}}setDataWinVars(t,e,i,s,a,l,r,n){let o=View.varGroupId(e);let d,c=t-1,m=c;if(t==-1){c=0;m=this.dataWinArr.length-1}for(d=c;d<=m;++d){let t=this.dataWinArr[d];t.scope=e;if(i!=t.xvId){t.xLeft=App.missDOUBLE;t.xRight=App.largeDOUBLE}if(s!=t.yvId){t.yBottom=App.missDOUBLE;t.yTop=App.largeDOUBLE}if(a!=t.zvId){t.zBottom=App.missDOUBLE;t.zTop=App.largeDOUBLE}t.xvId=i;t.yvId=s;t.zvId=a;t.xvLst=o;t.yvLst=o;t.zvLst=o;t.xRev=l;t.yRev=r;t.zRev=n}}toXml(){let t=App.xmlHeader+"<View collection='"+coll.name+"' xview='"+this.xViewVersion+"'>";t+=this.toXmlGeneral();t+=this.mapWin.toXmlGeogrMap();t+=this.mapWin.toXml();t+=this.section.toXml();if(this.pickedStatArr.length>0)t+=this.toXmlPickedStatSet();let e,i=this.dataWinArr.length;for(e=0;e<i;++e)t+=this.dataWinArr[e].toXml(e+1);if(this.gObjSet.gObjArr.length>0)t+=" <Canvas>"+this.gObjSet.toXml()+" </Canvas>";if(this.varDispOrder.length>0)t+=" <VariableDisplayOrder>"+this.varDispOrder.join(",")+" </VariableDisplayOrder>";if(this.drvdVarSet.drvdVarArr.length>0)t+=this.drvdVarSet.toXml();if(this.isoVarSet.isoVarArr.length>0)t+=this.isoVarSet.toXml();t+=this.statFilter.toXml();let s=this.rangesVarIdArr,a=this.rangesMinValArr;let l=this.rangesMaxValArr;i=s.length;t+=" <BasicVariables>";for(e=0;e<i;++e)t+=" <Variable max_value='"+l[e]+"' min_value='"+a[e]+"' var_id='"+s[e]+"'/>";t+="</BasicVariables>";return t+" </View>"}toXmlGeneral(){return"<General axis_syncing='"+this.axisSync+"'/>"}toXmlPickedStatSet(){let e=" <PickedStations> ";for(let t=0;t<this.pickedStatArr.length;++t)e+=this.pickedStatArr[t].toXml();return e+" </PickedStations>"}uarrowGobj(t){if(t==0)return this.mapWin.uarrow;else if(t>0)return this.dataWinArr[t-1].uarrow}udotGobj(t){if(t==0)return this.mapWin.udot;else if(t>0)return this.dataWinArr[t-1].udot}static varGroupId(t){return t==3?2:1}winIdsWithVar(e){let i=[],s=0,t=this.dataWinArr.length;for(s=0;s<t;++s){let t=this.dataWinArr[s];if(t.scope!=3&&(t.xvId==e||t.yvId==e||t.zvId==e))i.push(s+1)}return i}}class Contour{constructor(e,t,i,s,a,l,r,n){if(arguments.length==1){let t=e.attributes;this.zVal=Fct.xmlNum(t,"z_value",0);this.fntSiz=Fct.xmlNum(t,"font_size",10);this.lblCol=Fct.xmlNum(t,"label_color",0);this.lblCount=Fct.xmlNum(t,"label_count",1);this.lCol=Fct.xmlNum(t,"line_color",0);this.lWidth=Fct.xmlNum(t,"line_width",1);this.lStyle=Fct.xmlNum(t,"line_style",0);this.fCol=Fct.xmlNum(t,"fill_color",-1)}else{this.zVal=e;this.fntSiz=t;this.lblCol=i;this.lblCount=s;this.lCol=a;this.lWidth=l;this.lStyle=r;this.fCol=n}}toXml(){return" <Contour z_value='"+this.zVal+"' font_size='"+this.fntSiz+"' label_color='"+this.lblCol+"' label_count='"+this.lblCount+"' line_color='"+this.lCol+"' line_width='"+this.lWidth+"' line_style='"+this.lStyle+"' fill_color='"+this.fCol+"'/>"}}class GObjectSet{constructor(e){this.gObjArr=[];if(e==undefined)return;if(typeof e=="string")this.fromXGobStr(e);else{let t=$$(e,"GraphicsObjects");if(t.length>0){let e=$$(t[0],"GObject");for(let t=0;t<e.length;++t)this.gObjArr.push(new GObject(e[t]))}}}fromGob(e){let i=2,t=e.length-1,s=0;let a=e[0].indexOf("GOB1.");if(a<0)return 0;let l=Fct.numFromStr(e[0].substring(a+5,a+7),-1);while(i>-1&&i<t){let t=GObject.fromGobS(l,e,i);i=t.ci;if(t.go.type!=-1){this.gObjArr.push(t.go);++s}}return s}fromXGob(t){return fromXGobStr(t.join(" "))}fromXGobStr(t){let e=new DOMParser;let i=new GObjectSet(e.parseFromString(t,"text/xml"));let s,a=i.gObjArr.length;for(s=0;s<a;++s)this.gObjArr.push(i.gObjArr[s]);return a}setNames(e){for(let t=0;t<this.gObjArr.length;++t)this.gObjArr[t].setName(e)}toXml(){let e=" <GraphicsObjects>";for(let t=0;t<this.gObjArr.length;++t)e+=this.gObjArr[t].toXml();return e+" </GraphicsObjects>"}}class GObject{constructor(){let t=arguments.length,e=arguments[0],i=t==2?true:false;if(t==0){this.setDefaults(-1);return}else if(t==3){this.fromPixCoords(arguments[0],arguments[1],arguments[2]);return}let s=1,a=1,l,r=i?null:e.attributes;this.type=i?e.type:Fct.xmlNum(r,"type",1);if(e.tagName=="Legend")this.type=40;else if(e.tagName=="UnitDot")this.type=41;else if(e.tagName=="UnitArrow")this.type=42;this.name=i?e.name:Fct.xmlStr(r,"name","");this.postData=i?e.postData:Fct.xmlStr(r,"post_data","T");this.dragging=i?"T":Fct.xmlStr(r,"dragging","T");this.clipping=i?e.clipping:Fct.xmlStr(r,"clipping","F");this.ownCoords=i?e.ownCoords:Fct.xmlStr(r,"own_coordinates","T");this.isAuto=i?"F":Fct.xmlStr(r,"is_automatic","F");switch(this.type){case 1:case 40:case 42:if(!i&&this.type!=40&&this.type!=42){l=$$(e,"Annotation")[0];r=l.attributes}this.xCoord=i?e.xCoord+s:Fct.xmlNum(r,"x_coordinate",0);this.yCoord=i?e.yCoord+a:Fct.xmlNum(r,"y_coordinate",0);this.text=i?e.text:Fct.xmlStr(r,"text","");this.txtColor=i?e.txtColor:Fct.xmlNum(r,"text_color",0);this.ptSize=i?e.ptSize:Fct.xmlNum(r,"font_size",-1);this.angle=i?e.angle:Fct.xmlNum(r,"angle",0);this.align=i?e.align:Fct.xmlNum(r,"text_alignment",0);this.fColor=i?e.fColor:Fct.xmlNum(r,"background_color",-1);this.bColor=i?e.bColor:Fct.xmlNum(r,"frame_color",-1);this.bWidth=i?e.bWidth:Fct.xmlNum(r,"frame_width",-1);this.bStyle=i?e.bStyle:Fct.xmlNum(r,"frame_type",0);this.arrLen=i?e.arrLen:Fct.xmlNum(r,"arrow_length",1);this.arrColor=i?e.arrColor:Fct.xmlNum(r,"arrow_color",0);break;case 5:if(!i){l=$$(e,"Symbol")[0];r=l.attributes}this.xCoord=i?e.xCoord+s:Fct.xmlNum(r,"x_coordinate",0);this.yCoord=i?e.yCoord+a:Fct.xmlNum(r,"y_coordinate",0);this.symbTyp=i?e.symbTyp:Fct.xmlNum(r,"symbol_type",0);this.symbSize=i?e.symbSize:Fct.xmlNum(r,"symbol_size",2);this.fColor=i?e.fColor:Fct.xmlNum(r,"fill_color",-1);this.bWidth=i?e.bWidth:Fct.xmlNum(r,"border_width",0);this.bColor=i?e.bColor:Fct.xmlNum(r,"border_color",0);this.bStyle=i?e.bStyle:Fct.xmlNum(r,"border_type",0);break;case 11:case 12:if(!i){l=$$(e,"Path")[0];r=l.attributes}this.doSmooth=i?e.doSmooth:Fct.xmlStr(r,"smoothing","F");this.fColor=i?e.fColor:Fct.xmlNum(r,"fill_color",-1);this.lColor=i?e.lColor:Fct.xmlNum(r,"line_color",0);this.lWidth=i?e.lWidth:Fct.xmlNum(r,"line_width",3);this.lStyle=i?e.lStyle:Fct.xmlNum(r,"line_type",0);this.startSymbType=i?e.startSymbType:Fct.xmlNum(r,"symbol_type_at_start",-1);this.endSymbType=i?e.endSymbType:Fct.xmlNum(r,"symbol_type_at_end",-1);this.startSymbSize=i?e.startSymbSize:Fct.xmlNum(r,"symbol_size_at_start",3);this.endSymbSize=i?e.endSymbSize:Fct.xmlNum(r,"symbol_size_at_end",3);if(!i)l=$$(e,"xValues")[0];this.xCoords=i?[...e.xCoords]:Fct.toNumericArray(l.textContent);if(!i)l=$$(e,"yValues")[0];this.yCoords=i?[...e.yCoords]:Fct.toNumericArray(l.textContent);if(i){let t,e=this.xCoords.length;for(t=0;t<e;++t){this.xCoords[t]+=s;this.yCoords[t]+=a}}break;case 15:if(!i){l=$$(e,"CdtFile")[0];r=l.attributes}this.fileName=Fct.xmlStr(r,"file_name","");this.fColor=Fct.xmlNum(r,"fill_color",-1);this.lColor=Fct.xmlNum(r,"line_color",0);this.lWidth=Fct.xmlNum(r,"line_width",1);this.lStyle=Fct.xmlNum(r,"line_style",0);this.symbTyp=Fct.xmlNum(r,"symbol_type",-1);this.symbSize=Fct.xmlNum(r,"symbol_size",0);this.bWidth=Fct.xmlNum(r,"border_width",-1);this.bColor=Fct.xmlNum(r,"border_color",0);this.bStyle=Fct.xmlNum(r,"border_style",0);break;case 30:if(!i){l=$$(e,"SymbolSet")[0];r=l.attributes}this.text=Fct.xmlStr(r,"legend_text","");this.addLgd=Fct.xmlStr(r,"add_to_legend","F");this.lColor=Fct.xmlNum(r,"line_color",-1);this.lWidth=Fct.xmlNum(r,"line_width",-1);this.lStyle=Fct.xmlNum(r,"line_type",0);this.symbTyp=Fct.xmlNum(r,"symbol_type",0);this.symbSize=Fct.xmlNum(r,"symbol_size",2);this.fColor=Fct.xmlNum(r,"fill_color",-1);this.bWidth=Fct.xmlNum(r,"border_width",0);this.bColor=Fct.xmlNum(r,"border_color",0);this.bStyle=Fct.xmlNum(r,"border_style",0);l=$$(e,"xValues")[0];this.xCoords=Fct.toNumericArray(l.textContent);l=$$(e,"yValues")[0];this.yCoords=Fct.toNumericArray(l.textContent);break}}canBeCopied(){return!GObject.isTemplate(this.type)&&this.type!=30&&this.dragging=="T"}canBeDeleted(){return!this.isAutomatic()}canBeEdited(){return!this.isAutomatic()&&this.type!=40&&this.type!=42}canBeExported(){return!GObject.isTemplate(this.type)}static fromGobS(t,e,i){let s=e[i].split(":"),a=new GObject,l=-1;++i;if(s.length<2)return{go:a,eci:l};let r=s[1],n,o;a.xCoords=[];a.yCoords=[];if(r=="CDT-FILE"||r=="ANNOTATION"||r=="SINGLESYMBOL"||r=="SYMBOLSET")return{go:a,eci:l};if(r=="POLYLINE"||r=="POLYGON"){if(t>=3){a.ownCoords=Fct.numFromRhs(e[i],1)>0?"T":"F";++i}a.clipping=Fct.numFromRhs(e[i],0)>0?"T":"F";++i;a.postData=Fct.numFromRhs(e[i],1)>0?"T":"F";++i;a.dragging=Fct.numFromRhs(e[i],1)>0?"F":"T";++i;a.doSmooth=Fct.numFromRhs(e[i])>0?"T":"F";++i;a.lColor=Fct.numFromRhs(e[i],0);++i;a.lStyle=Fct.numFromRhs(e[i],0);++i;a.lWidth=Fct.numFromRhs(e[i],3);++i;a.fColor=Fct.numFromRhs(e[i],-1);++i;if(t>=4){a.startSymbType=Fct.numFromRhs(e[i],-1);++i;a.startSymbSize=Fct.numFromRhs(e[i],3);++i;a.endSymbType=Fct.numFromRhs(e[i],-1);++i;a.endSymbSize=Fct.numFromRhs(e[i],3);++i}o=Fct.numFromRhs(e[i],0);i+=2;a.type=r=="POLYGON"?12:11;for(n=0;n<o;++n){s=e[i].split(" ");++i;a.xCoords.push(Fct.numFromStr(s[0],App.missDOUBLE));a.yCoords.push(Fct.numFromStr(s[1],App.missDOUBLE))}}return{go:a,ci:i}}fromPixCoords(t,e,i){let s,a=e.length,l=a-1;if(t!=30){for(s=0;s<a;++s){e[s]=ui.toOdvCanvasX(e[s]);i[s]=ui.toOdvCanvasY(i[s])}}this.setDefaults(t);switch(t){case 1:this.pxCoord=e[0];this.pyCoord=i[0];this.text="";this.txtColor=0;this.ptSize=12;this.angle=0;this.align=0;this.fColor=-1;this.bColor=-1;this.bWidth=-1;this.bStyle=0;break;case 5:this.pxCoord=e[0];this.pyCoord=i[0];this.symbTyp=0;this.symbSize=2;this.fColor=-1;this.bWidth=0;this.bColor=0;this.bStyle=0;break;case 11:case 12:if(t==12&&(e[0]!=e[l]||i[0]!=i[l])){e.push(e[0]);i.push(i[0])}this.doSmooth="F";this.fColor=-1;this.lColor=0;this.lWidth=3;this.lStyle=0;this.startSymbType=-1;this.endSymbType=-1;this.startSymbSize=3;this.endSymbSize=3;this.pxCoords=[...e];this.pyCoords=[...i];break;case 30:this.text="";this.addLgd="F";this.lColor=-1;this.lWidth=-1;this.lStyle=0;this.symbTyp=0;this.symbSize=2;this.fColor=-1;this.bWidth=0;this.bColor=0;this.bStyle=0;this.xCoords=[...e];this.yCoords=[...i];this.dragging="F";this.clipping="T";break}}getName(){return this.name.length>0?this.name:"unnamed graphics object"}isAutomatic(){return this.isAuto=="T"}static isTemplate(t){return t==40||t==41||t==42}setDefaults(t){this.name="";this.type=t;this.postData="T";this.dragging="T";this.clipping="F";this.ownCoords="T";this.isAuto="F"}setName(t){this.name=t}toXml(){if(GObject.isTemplate(this.type))return"";let t=" <GObject type='"+this.type+"'"+this.toXmlGen()+">";switch(this.type){case 1:t+="<Annotation"+this.toXmlXy()+this.toXmlText()+" background_color='"+this.fColor+"' text_alignment='"+this.align+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"' angle='"+this.angle+"' frame_type='"+this.bStyle+"'/>";break;case 5:t+="<Symbol"+this.toXmlXy()+this.toXmlSymb()+" fill_color='"+this.fColor+"' border_width='"+this.bWidth+"' border_type='"+this.bStyle+"' border_color='"+this.bColor+"'/>";break;case 11:case 12:t+="<Path fill_color='"+this.fColor+"' smoothing='"+this.doSmooth+"' line_type='"+this.lStyle+"' line_color='"+this.lColor+"' line_width='"+this.lWidth+"' symbol_type_at_start='"+this.startSymbType+"' symbol_type_at_end='"+this.endSymbType+"' symbol_size_at_start='"+this.startSymbSize+"' symbol_size_at_end='"+this.endSymbSize+"'/>";if(this.xCoords!=undefined){t+="<xValues>"+this.xCoords.join()+"</xValues>";t+="<yValues>"+this.yCoords.join()+"</yValues>"}else if(this.pxCoords!=undefined){t+="<pxValues>"+this.pxCoords.join()+"</pxValues>";t+="<pyValues>"+this.pyCoords.join()+"</pyValues>"}break;case 15:t+="<CdtFile"+this.toXmlSymb()+" fill_color='"+this.fColor+"' file_name='"+this.fileName+"' border_width='"+this.bWidth+"' line_style='"+this.lStyle+"' line_color='"+this.lColor+"' border_color='"+this.bColor+"' border_style='"+this.bStyle+"' line_width='"+this.lWidth+"'/>";break;case 30:t+="<SymbolSet"+this.toXmlSymb()+" fill_color='"+this.fColor+"' border_width='"+this.bWidth+"' legend_text='"+this.text+"' line_type='"+this.lStyle+"' line_color='"+this.lColor+"' border_color='"+this.bColor+"' border_style='"+this.bStyle+"' add_to_legend='"+this.addLgd+"' line_width='"+this.lWidth+"'/>";t+="<xValues>"+this.xCoords.join()+"</xValues>";t+="<yValues>"+this.yCoords.join()+"</yValues>";break}return t+" </GObject>"}toXmlGen(){return" name='"+this.name+"' dragging='"+this.dragging+"' clipping='"+this.clipping+"' own_coordinates='"+this.ownCoords+"' post_data='"+this.postData+"' is_automatic='"+this.isAuto+"'"}toXmlLegend(){return" <Legend"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlSymb(){return" symbol_type='"+this.symbTyp+"' symbol_size='"+this.symbSize+"'"}toXmlText(){return" text='"+this.text+"' text_color='"+this.txtColor+"' font_size='"+this.ptSize+"'"}toXmlUArrow(){return" <UnitArrow"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" arrow_length='"+this.arrLen+"' arrow_color='"+this.arrColor+"' background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlUDot(){return" <UnitDot"+this.toXmlGen()+this.toXmlXy()+this.toXmlText()+" arrow_length='"+this.arrLen+"' arrow_color='"+this.arrColor+"' background_color='"+this.fColor+"' frame_width='"+this.bWidth+"' frame_color='"+this.bColor+"'/>"}toXmlXy(){return this.xCoord!=undefined?" x_coordinate='"+this.xCoord+"' y_coordinate='"+this.yCoord+"'":" px_coordinate='"+this.pxCoord+"' py_coordinate='"+this.pyCoord+"'"}static typeName(t){switch(t){case 1:return"Annotation";case 5:return"Symbol";case 11:case 12:return"Path Object";case 15:return"Cdt File";case 30:return"Symbol Set";case 40:return"Legends";case 41:return"Unit Dot";case 42:return"Unit Arrow";default:return""}}}class Window{constructor(t,e){this.setWinDefaults(e);if(t instanceof DataWindow)this.fromWinParent(t);else if(t!=null)this.fromWinXml(t,e)}fromWinParent(t){let e=t;this.highlightStyle=e.highlightStyle;this.fontSizeFac=e.fontSizeFac;this.palName=e.palName;this.bckColor=e.bckColor;this.drawGrid=e.drawGrid;this.gridColor=e.gridColor;this.drawLabels=e.drawLabels;this.buddyAxisSync=e.buddyAxisSync;this.autoCreateLabels=e.autoCreateLabels;this.xAlign=e.xAlign;this.yAlign=e.yAlign;this.colBarAlign=e.colBarAlign;this.xTic=e.xTic;this.yTic=e.yTic;this.zTic=e.zTic;this.xLTic=e.xLTic;this.yLTic=e.yLTic;this.zLTic=e.zLTic;this.symbType=e.symbType;this.symbSmSize=e.symbSmSize;this.symbColor=e.symbColor;this.symbSize=e.symbSize;this.nonLinStart=e.nonLinStart;this.nonLinEnd=e.nonLinEnd;this.nonLinAutoAdjust=e.nonLinAutoAdjust;this.xBbOff=e.xBbOff;this.xBbLen=e.xBbLen;this.yBbOff=e.yBbOff;this.yBbLen=e.yBbLen;this.xLeft=e.xLeft;this.xRight=e.xRight;this.xProj=e.xProj;this.yBottom=e.yBottom;this.yTop=e.yTop;this.yProj=e.yProj;this.zBottom=e.zBottom;this.zTop=e.zTop}fromWinXml(t,e){this.highlightStyle=Fct.xmlNum(t.attributes,"highlight_style",2);this.bckColor=Fct.xmlNum(t.attributes,"background_color",App.missINT);let i,s=$$(t,"Axis");if(s.length>0){i=s[0].attributes;this.drawGrid=Fct.xmlStr(i,"draw_grid","T");this.drawLabels=Fct.xmlStr(i,"create_labels","T");this.autoCreateLabels=Fct.xmlStr(i,"auto_label","T");this.buddyAxisSync=Fct.xmlStr(i,"buddy_axis_sync","T");this.gridColor=Fct.xmlNum(i,"color",0)}s=$$(t,"Symbol");if(s.length>0){i=s[0].attributes;this.symbColor=Fct.xmlNum(i,"color",e?0:1);this.symbType=Fct.xmlNum(i,"type",0);this.symbSize=Fct.xmlNum(i,"size",e?1.8:.7);this.symbSmSize=Fct.xmlNum(i,"small_size",.2)}s=$$(t,"Annotation");if(s.length>0){i=s[0].attributes;this.annotationStyle=Fct.xmlNum(i,"style",0);this.annotationFontSize=Fct.xmlNum(i,"font_size",10)}let a=$$(t,"Window")[0];this.fontSizeFac=Fct.xmlNum(a.attributes,"font_size_factor",1)*100;s=$$(a,"Geometry");i=s[0].attributes;this.xBbOff=Fct.xmlNum(i,"x_offset_bb",1);this.xBbLen=Fct.xmlNum(i,"x_length_bb",1);this.xLeft=Fct.xmlNum(i,"x_left",App.missDOUBLE);this.xRight=Fct.xmlNum(i,"x_right",App.largeDOUBLE);this.xProj=Fct.xmlNum(i,"x_projection",0);this.yBbOff=Fct.xmlNum(i,"y_offset_bb",1);this.yBbLen=Fct.xmlNum(i,"y_length_bb",1);this.yBottom=Fct.xmlNum(i,"y_bottom",App.missDOUBLE);this.yTop=Fct.xmlNum(i,"y_top",App.largeDOUBLE);this.yProj=Fct.xmlNum(i,"y_projection",0);s=$$(a,"ColorScale");if(s.length>0){i=s[0].attributes;this.palName=Fct.xmlStr(i,"palette_file_name","Odv");this.nonLinStart=Fct.xmlNum(i,"non_linearity_start",-.1);this.nonLinEnd=Fct.xmlNum(i,"non_linearity_end",.1);this.nonLinAutoAdjust=Fct.xmlStr(i,"auto_adjust_non_linearity","F");this.zBottom=Fct.xmlNum(i,"z_range_start",App.missDOUBLE);this.zTop=Fct.xmlNum(i,"z_range_end",App.largeDOUBLE)}s=$$(a,"Legend");if(s.length>0)this.legend=new GObject(s[0]);s=$$(a,"UnitDot");if(s.length>0)this.udot=new GObject(s[0]);s=$$(a,"UnitArrow");if(s.length>0)this.uarrow=new GObject(s[0]);s=$$(a,"Axis");if(s.length>0){i=s[0].attributes;this.xTic=Fct.xmlNum(i,"x_tic",App.largeDOUBLE);this.yTic=Fct.xmlNum(i,"y_tic",App.largeDOUBLE);this.zTic=Fct.xmlNum(i,"cb_tic",App.largeDOUBLE);this.xLTic=Fct.xmlNum(i,"x_tic_long",App.largeDOUBLE);this.yLTic=Fct.xmlNum(i,"y_tic_long",App.largeDOUBLE);this.zLTic=Fct.xmlNum(i,"cb_tic_long",App.largeDOUBLE);this.xAlign=Fct.xmlNum(i,"x_align",1);this.yAlign=Fct.xmlNum(i,"y_align",1);this.colBarAlign=Fct.xmlNum(i,"cb_align",e?1:0)}this.gObjSet=new GObjectSet(a)}setWinDefaults(t){this.highlightStyle=2;this.fontSizeFac=100;this.palName="Odv";this.bckColor=App.missINT;this.drawGrid="T";this.gridColor=0;this.drawLabels="T";this.buddyAxisSync="T";this.autoCreateLabels=t?"T":"F";this.xAlign=1;this.yAlign=1;this.colBarAlign=t?1:0;this.xTic=App.largeDOUBLE;this.yTic=App.largeDOUBLE;this.zTic=App.largeDOUBLE;this.xLTic=App.largeDOUBLE;this.yLTic=App.largeDOUBLE;this.zLTic=App.largeDOUBLE;this.symbType=0;this.symbSmSize=.2;this.symbColor=t?0:1;this.symbSize=t?1.8:.7;this.annotationStyle=0;this.annotationFontSize=10;this.nonLinStart=-.1;this.nonLinEnd=.1;this.nonLinAutoAdjust="F";this.xBbOff=10;this.xBbLen=10;this.yBbOff=6;this.yBbLen=10;this.xLeft=App.missDOUBLE;this.xRight=App.largeDOUBLE;this.xProj=0;this.yBottom=App.missDOUBLE;this.yTop=App.largeDOUBLE;this.yProj=0;this.zBottom=App.missDOUBLE;this.zTop=App.largeDOUBLE;this.gObjSet=new GObjectSet}toXmlColorScale(t){let e=" <ColorScale";if(t)e+=" auto_adjust_non_linearity='"+this.nonLinAutoAdjust+"' non_linearity_start='"+this.nonLinStart+"' non_linearity_end='"+this.nonLinEnd+"' z_range_start='"+this.zBottom+"' z_range_end='"+this.zTop+"'";return e+" palette_file_name='"+this.palName+"'/>"}toXmlGeometry(){return" <Geometry x_left='"+this.xLeft+"' x_right='"+this.xRight+"' y_bottom='"+this.yBottom+"' y_top='"+this.yTop+"' x_length_bb='"+this.xBbLen+"' x_offset_bb='"+this.xBbOff+"' y_length_bb='"+this.yBbLen+"' y_offset_bb='"+this.yBbOff+"' x_projection='"+this.xProj+"' y_projection='"+this.yProj+"'/>"}toXmlWinAxis(t){let e=" <Axis";if(t)e+=" x_tic='"+this.xTic+"' x_tic_long='"+this.xLTic+"' y_tic='"+this.yTic+"' y_tic_long='"+this.yLTic+"' cb_tic='"+this.zTic+"' cb_tic_long='"+this.zLTic+"' x_align='"+this.xAlign+"' y_align='"+this.yAlign+"'";return e+" cb_align='"+this.colBarAlign+"'/>"}toXmlWindow(t){let e=this.toXmlWindowOpen()+this.toXmlWinAxis(t)+this.toXmlGeometry()+this.toXmlColorScale(t)+this.gObjSet.toXml();if(this.legend!=undefined)e+=this.legend.toXml();if(this.udot!=undefined)e+=this.udot.toXml();if(this.uarrow!=undefined)e+=this.uarrow.toXml();return e+this.toXmlWindowClose()}toXmlWindowClose(){return" </Window>"}toXmlWindowOpen(){return" <Window font_size_factor='"+Fct.roundedVal(this.fontSizeFac*.01,2)+"'>"}toXmlWinGen(t){return this.toXmlWindowOpen()+this.toXmlWinAxis(t)+this.toXmlGeometry()+this.toXmlColorScale(t)+this.toXmlWindowClose()}}class DataWindow extends Window{constructor(t){super(t,true);this.setDefaults();if(t instanceof DataWindow)this.fromParent(t);else if(t!=null)this.fromXml(t)}axisLabel(t){let e=t=="X"?this.xvId:t=="Y"?this.yvId:this.zvId;if(e==App.VID_NONE)return"";if(this.scope==3)return ui.dockIsoVarLabels[e];else return coll.dataVarNameLabelEx(e)}axisFullLabel(t){let e=t=="X"?this.xvId:t=="Y"?this.yvId:this.zvId;if(e==App.VID_NONE)return"";if(this.scope==3)return ui.dockIsoVarLabels[e];else return coll.dataVarFullLabel(e)}fromParent(t){let e=t;this.xvId=e.xvId;this.yvId=e.yvId;this.zvId=e.zvId;this.xvLst=e.xvLst;this.yvLst=e.yvLst;this.zvLst=e.zvLst;this.xRev=e.xRev;this.yRev=e.yRev;this.zRev=e.zRev;this.plotMode=e.plotMode;this.scope=e.scope;this.winType=e.winType;this.lineColor=e.lineColor;this.lineWidth=e.lineWidth;this.lineStyle=e.lineStyle;this.autoScale=e.autoScale;this.xScale=e.xScale;this.yScale=e.yScale;this.isopycnicGridding=e.isopycnicGridding;this.drawShaded=e.drawShaded;this.drawContours=e.drawContours;this.contours=e.contours;this.DivaNonNegativity=e.DivaNonNegativity;this.DivaSnr=e.DivaSnr;this.DivaUseSecPoly=e.DivaUseSecPoly;this.DivaBathyFile=e.DivaBathyFile;this.DivaBathyVal=e.DivaBathyVal;this.drawMarks=e.drawMarks;this.markColor=e.markColor;this.markSize=e.markSize;this.hideBad=e.hideBad;this.hideDistance=e.hideDistance;this.drawIsop=e.drawIsop;this.isopLWidth=e.isopLWidth;this.isopColor=e.isopColor;this.isopLStyle=e.isopLStyle;this.isopRefPress=e.isopRefPress;this.arrXvId=e.arrXvId;this.arrYvId=e.arrYvId;this.arrColor=e.arrColor;this.arrLineStyle=e.arrLineStyle;this.arrLineWidth=e.arrLineWidth;this.arrScale=e.arrScale;this.smplFilter=new SmplFilter}fromXml(t){let e=$$(t,"Modes")[0].attributes;this.plotMode=Fct.xmlNum(e,"plot_mode",0);this.scope=Fct.xmlNum(e,"window_mode",0);this.winType=Fct.xmlNum(e,"window_type",0);let i=$$(t,"AxisVariables"),s;if(i.length>0){let t=i[0];s=$$(t,"xAxis");if(s.length>0){e=s[0].attributes;this.xvId=Fct.xmlNum(e,"var_id",1);this.xvLst=Fct.xmlNum(e,"var_list",1);this.xRev=Fct.xmlStr(e,"is_reversed","F")}s=$$(t,"yAxis");if(s.length>0){e=s[0].attributes;this.yvId=Fct.xmlNum(e,"var_id",1);this.yvLst=Fct.xmlNum(e,"var_list",1);this.yRev=Fct.xmlStr(e,"is_reversed","F")}s=$$(t,"zAxis");if(s.length>0){e=s[0].attributes;this.zvId=Fct.xmlNum(e,"var_id",1);this.zvLst=Fct.xmlNum(e,"var_list",1);this.zRev=Fct.xmlStr(e,"is_reversed","F")}}i=$$(t,"Arrows");if(i.length>0){e=i[0].attributes;this.arrXvId=Fct.xmlNum(e,"x_var_id",1);this.arrYvId=Fct.xmlNum(e,"y_var_id",2);this.arrColor=Fct.xmlNum(e,"arrow_color",0);this.arrLineStyle=Fct.xmlNum(e,"line_style",0);this.arrLineWidth=Fct.xmlNum(e,"line_width",1);this.arrScale=Fct.xmlNum(e,"scale",1)}i=$$(t,"Gridding");if(i.length>0){e=i[0].attributes;this.xScale=Fct.xmlNum(e,"x_scale_length",2);this.yScale=Fct.xmlNum(e,"y_scale_length",2);this.isopycnicGridding=Fct.xmlStr(e,"isopycnic_gridding","F");this.drawShaded=Fct.xmlStr(e,"draw_shaded","T");this.autoScale=Fct.xmlStr(e,"auto_scale_lengths","T");this.DivaUseSecPoly=Fct.xmlStr(e,"DIVA_use_section_polygon","F");this.DivaNonNegativity=Fct.xmlStr(e,"DIVA_non_negativity","F");this.DivaSnr=Fct.xmlNum(e,"DIVA_signal_to_noise_ratio",50);this.DivaBathyFile=Fct.xmlStr(e,"DIVA_bathymetry_file_name","");this.DivaBathyVal=Fct.xmlNum(e,"DIVA_bathymetry_value",App.missDOUBLE)}i=$$(t,"DataMark");if(i.length>0){e=i[0].attributes;this.drawMarks=Fct.xmlStr(e,"draw","T");this.markColor=Fct.xmlNum(e,"color",17);this.markSize=Fct.xmlNum(e,"size",.2)}i=$$(t,"BadEstimateHiding");if(i.length>0){e=i[0].attributes;this.hideBad=Fct.xmlStr(e,"hide","T");this.hideDistance=Fct.xmlNum(e,"max_distance",3)}i=$$(t,"Line");if(i.length>0){e=i[0].attributes;this.lineColor=Fct.xmlNum(e,"color",0);this.lineWidth=Fct.xmlNum(e,"width",1);this.lineStyle=Fct.xmlNum(e,"style",0)}i=$$(t,"Contours");if(i.length>0){let t=i[0];e=t.attributes;this.drawContours=Fct.xmlStr(e,"draw","F");s=$$(t,"Contour");for(let t=0;t<s.length;++t)this.contours.push(new Contour(s[t]))}i=$$(t,"Isopycnal");if(i.length>0){e=i[0].attributes;this.drawIsop="T";this.isopLWidth=Fct.xmlNum(e,"line_width",1);this.isopColor=Fct.xmlNum(e,"isopycnal_color",8);this.isopLStyle=Fct.xmlNum(e,"line_style",0);this.isopRefPress=Fct.xmlNum(e,"ref_pressure",0)}this.smplFilter=new SmplFilter(t)}isGridding(){return this.plotMode==2||this.plotMode==7}setDefaults(){this.xvId=1;this.yvId=0;this.zvId=App.VID_NONE;this.xvLst=1;this.yvLst=1;this.zvLst=1;this.xRev="F";this.yRev="T";this.zRev="F";this.plotMode=0;this.scope=0;this.winType=0;this.lineColor=0;this.lineWidth=1;this.lineStyle=0;this.autoScale="T";this.xScale=2;this.yScale=2;this.isopycnicGridding="F";this.drawShaded="T";this.drawContours="F";this.autoContours="F";this.contours=[];this.DivaNonNegativity="F";this.DivaSnr=50;this.DivaUseSecPoly="F";this.DivaBathyFile="";this.DivaBathyVal=App.missDOUBLE;this.drawMarks="F";this.markColor=17;this.markSize=.2;this.hideBad="T";this.hideDistance=3;this.drawIsop="F";this.isopLWidth=1;this.isopColor=8;this.isopLStyle=0;this.isopRefPress=0;this.arrXvId=-1;this.arrYvId=-1;this.arrColor=0;this.arrLineStyle=0;this.arrLineWidth=1;this.arrScale=1;this.smplFilter=new SmplFilter}toXml(t){let e=this.toXmlDataWindowOpen(t)+this.toXmlAxisProps()+this.toXmlAxisVars()+this.toXmlModes()+this.toXmlArrows()+this.toXmlIsopycnal()+this.toXmlLineStyle()+this.toXmlSymbol()+this.toXmlContours()+this.toXmlGridding()+this.toXmlHideBad()+this.toXmlMarkData()+this.smplFilter.toXml()+this.toXmlWindow(true);return e+this.toXmlDataWindowClose()}toXmlArrows(){return this.plotMode!=6||this.arrXvId==-1?"":" <Arrows line_style='"+this.arrLineStyle+"' x_var_id='"+this.arrXvId+"' arrow_color='"+this.arrColor+"' line_width='"+this.arrLineWidth+"' y_var_id='"+this.arrYvId+"' scale='"+this.arrScale+"'/>"}toXmlAxisProps(){return" <Axis auto_label='"+this.autoCreateLabels+"' axis_color='"+this.gridColor+"' buddy_axis_sync='"+this.buddyAxisSync+"' draw_grid='"+this.drawGrid+"'/>"}toXmlAxisVars(){let t=" <AxisVariables> <xAxis var_id='"+this.xvId+"' var_list='"+this.xvLst+"' is_reversed='"+this.xRev+"'/> <yAxis var_id='"+this.yvId+"' var_list='"+this.yvLst+"' is_reversed='"+this.yRev+"'/>";t+="<zAxis var_id='"+this.zvId+"' var_list='"+this.yvLst+"' is_reversed='"+this.zRev+"'/>";t+=" </AxisVariables>";return t}toXmlContours(){let e=" <Contours draw='"+this.drawContours+"' auto_create='"+this.autoContours+"'> ";for(let t=0;t<this.contours.length;++t){e+=this.contours[t].toXml()}e+=" </Contours>";return e}toXmlDataWindowClose(){return" </DataWindow>"}toXmlDataWindowOpen(t){return" <DataWindow window_id='"+t+"' background_color='"+this.bckColor+"' highlight_style='"+this.highlightStyle+"'>"}toXmlGridding(){return" <Gridding draw_shaded='"+this.drawShaded+"' auto_scale_lengths='"+this.autoScale+"' y_scale_length='"+Fct.roundedVal(this.yScale,2)+"' x_scale_length='"+Fct.roundedVal(this.xScale,2)+"' isopycnic_gridding='"+this.isopycnicGridding+"' DIVA_signal_to_noise_ratio='"+this.DivaSnr+"' DIVA_non_negativity='"+this.DivaNonNegativity+"' DIVA_use_section_polygon='"+this.DivaUseSecPoly+"' DIVA_bathymetry_file_name='"+this.DivaBathyFile+"' DIVA_bathymetry_value='"+this.DivaBathyVal+"'/>"}toXmlHideBad(){return" <BadEstimateHiding hide='"+this.hideBad+"' max_distance='"+this.hideDistance+"'/>"}toXmlIsopycnal(t){return" <Isopycnal draw_isopycnal='"+this.drawIsop+"' line_width='"+this.isopLWidth+"' isopycnal_color='"+this.isopColor+"' line_style='"+this.isopLStyle+"' ref_pressure='"+this.isopRefPress+"'/>"}toXmlLineStyle(){return" <Line width='"+this.lineWidth+"' style='"+this.lineStyle+"' color='"+this.lineColor+"'/>"}toXmlMarkData(){return" <DataMark draw='"+this.drawMarks+"' color='"+this.markColor+"' size='"+Fct.roundedVal(this.markSize,3)+"'/>"}toXmlModes(){return" <Modes window_mode='"+this.scope+"' window_type='"+this.winType+"' plot_mode='"+this.plotMode+"'/>"}toXmlProps(t){return this.toXmlDataWindowOpen(t)+this.toXmlAxisProps()+this.toXmlAxisVars()+this.toXmlModes()+this.toXmlArrows()+this.toXmlLineStyle()+this.toXmlSymbol()+this.toXmlGridding()+this.toXmlHideBad()+this.toXmlMarkData()+this.toXmlContours()+this.toXmlWinGen(true)+this.toXmlDataWindowClose()}toXmlSymbol(){return" <Symbol size='"+this.symbSize+"' small_size='"+this.symbSmSize+"' type='"+this.symbType+"' color='"+this.symbColor+"'/>"}}class MapWindow extends Window{constructor(t){super($$(t,"MapWindow")[0],false);this.setDefaults();let e=$$(t,"GeographicMap");let i=e[0],s=i.attributes;this.prjType=Fct.xmlNum(s,"projection_type",0);e=$$(i,"AutoMapLayerSettings");if(e.length>0){s=e[0].attributes;this.doBathy=Fct.xmlStr(s,"ocean_bathymetry","T");this.doCoast=Fct.xmlStr(s,"coastlines","T");this.fillCoast=Fct.xmlStr(s,"coastline_fill","T");this.doTopo=Fct.xmlStr(s,"land_topography","F");this.doRivers=Fct.xmlStr(s,"lakes_and_rivers","F");this.doBorders=Fct.xmlStr(s,"borders","F")}e=$$(i,"MapDomain");s=e[0].attributes;this.wLon=Fct.xmlNum(s,"lon_min",-180);this.eLon=Fct.xmlNum(s,"lon_max",180);this.sLat=Fct.xmlNum(s,"lat_min",-90);this.nLat=Fct.xmlNum(s,"lat_max",90);let a=.5*(this.wLon+this.eLon);let l=.5*(this.sLat+this.nLat);this.prjCntrLon=a;this.prjCntrLat=l;e=$$(i,"ProjectionPole");if(e.length>0){s=e[0].attributes;this.prjCntrLon=Fct.xmlNum(s,"lon_center",a);this.prjCntrLat=Fct.xmlNum(s,"lat_center",l)}}setDefaults(){this.wLon=-180;this.eLon=180;this.sLat=-90;this.nLat=90;this.prjType=0;this.prjCntrLon=0;this.prjCntrLat=0;this.doBathy="T";this.doCoast="T";this.fillCoast="T";this.doTopo="F";this.doRivers="F";this.doBorders="F"}setDomain(t,e,i,s){this.wLon=t;this.eLon=e;this.sLat=i;this.nLat=s}toXml(){return this.toXmlMapWindowOpen()+this.toXmlAxisProps()+this.toXmlSymbol()+this.toXmlAnnotation()+this.toXmlWindow(false)+this.toXmlMapWindowClose()}toXmlAnnotation(){return" <Annotation style='"+this.annotationStyle+"' font_size='"+this.annotationFontSize+"'/>"}toXmlAutoLayers(){return" <AutoMapLayerSettings borders='"+this.doBorders+"' lakes_and_rivers='"+this.doRivers+"' coastline_fill='"+this.fillCoast+"' coastlines='"+this.doCoast+"' ocean_bathymetry='"+this.doBathy+"' land_topography='"+this.doTopo+"'/>"}toXmlAxisProps(){return" <Axis create_labels='"+this.drawLabels+"' color='"+this.gridColor+"' buddy_axis_sync='"+this.buddyAxisSync+"' draw_grid='"+this.drawGrid+"'/>"}toXmlDomain(){return" <MapDomain lon_min='"+this.wLon+"' lon_max='"+this.eLon+"' lat_min='"+this.sLat+"' lat_max='"+this.nLat+"'/>"}toXmlGeogrMap(){return" <GeographicMap projection_type='"+this.prjType+"'>"+this.toXmlPrj()+this.toXmlDomain()+this.toXmlAutoLayers()+" </GeographicMap>"}toXmlMapWindowClose(){return" </MapWindow>"}toXmlMapWindowOpen(){return" <MapWindow background_color='"+this.bckColor+"'>"}toXmlPrj(){return" <ProjectionPole lon_center='"+this.prjCntrLon+"' lat_center='"+this.prjCntrLat+"'/>"}toXmlProps(){return this.toXmlMapWindowOpen()+this.toXmlAxisProps()+this.toXmlSymbol()+this.toXmlAnnotation()+this.toXmlWindowOpen()+this.toXmlWinAxis(false)+this.toXmlColorScale(false)+this.toXmlWindowClose()+this.toXmlMapWindowClose()}toXmlSymbol(){return" <Symbol size='"+this.symbSize+"' color='"+this.symbColor+"'/>"}}class DrvdVarSet{constructor(t){this.drvdVarArr=[];let i=$$(t,"DerivedVariables");if(i.length>0){let e=$$(i[0],"Variable");for(let t=0;t<e.length;++t)this.drvdVarArr.push(new DrvdVar(e[t]))}}toXml(){let e=" <DerivedVariables> ";for(let t=0;t<this.drvdVarArr.length;++t)e+=this.drvdVarArr[t].toXml();return e+" </DerivedVariables>"}}class DrvdVar{constructor(a,t,e,i,s,l,r,n,o,d,c,m,u,p,g){this.setDefaults();if(arguments.length==1){let t=a.attributes,e;this.name=Fct.xmlStr(t,"label","");this.name=this.name.replace("date&time","date/time");this.units=Fct.xmlStr(t,"unit","");this.uname=Fct.xmlStr(t,"ulabel","");this.uname=this.uname.replace("date&time","date/time");this.uunits=Fct.xmlStr(t,"uunit","");this.varId=Fct.xmlNum(t,"var_id",-1);this.type=Fct.xmlNum(t,"type",-1);this.digitsCount=Fct.xmlNum(t,"digits_count",2);this.minVal=Fct.xmlNum(t,"min_value",App.missDOUBLE);this.maxVal=Fct.xmlNum(t,"max_value",App.largeDOUBLE);e=$$(a,"Input");if(e.length>0)this.inpVarIds=Fct.toNumericArray(e[0].textContent);e=$$(a,"iParameter");if(e.length>0)this.iPrms=Fct.toNumericArray(e[0].textContent);e=$$(a,"fParameter");if(e.length>0)this.fPrms=Fct.toNumericArray(e[0].textContent);e=$$(a,"MacroFile");if(e.length>0)this.mcrFile=e[0].textContent;e=$$(a,"Expression");if(e.length>0)this.expr=e[0].textContent;e=$$(a,"Patch");let i,s=e.length;for(i=0;i<s;++i)this.patches.push(new Patch(e[i]))}else{this.name=a;this.units=t;this.uname=e;this.uunits=i;this.varId=s;this.type=l;this.digitsCount=r;this.inpVarIds=n;this.iPrms=o;this.fPrms=d;this.macroFile=c;this.expr=m;this.patches=u;this.minVal=p;this.maxVal=g}}setDefaults(){this.name="";this.units="";this.uname="";this.uunits="";this.varId=-1;this.type=-1;this.digitsCount=2;this.inpVarIds=[];this.iPrms=[];this.fPrms=[];this.macroFile="";this.expr="1";this.patches=[];this.minVal=App.missDOUBLE;this.maxVal=App.largeDOUBLE}toXml(){let i=" <Variable label='"+this.name+"' unit='"+this.units+"' type='"+this.type+"' var_id='"+this.varId+"' digits_count='"+this.digitsCount+"' min_value='"+this.minVal+"' max_value='"+this.maxVal+"'>";if(this.inpVarIds.length>0)i+=" <Input>"+this.inpVarIds.join()+"</Input>";if(this.iPrms.length>0)i+=" <iParameter>"+this.iPrms.join()+"</iParameter>";if(this.fPrms.length>0)i+=" <fParameter>"+this.fPrms.join()+"</fParameter>";if(this.type==12||this.type==45){if(this.macroFile.length>0)i+=" <MacroFile>"+this.macroFile+"</MacroFile>";i+=" <Expression>"+this.expr+"</Expression>"}if(this.type==17){let t,e=this.patches.length;for(t=0;t<e;++t)i+=this.patches[t].toXml()}i+=" </Variable>";return i}}class Patch{constructor(i,t,e,s,a,l,r){this.setDefaults();if(arguments.length==1){let t=i.attributes,e;this.name=Fct.xmlStr(t,"name","");this.cmt=Fct.xmlStr(t,"comment","");this.xLabel=Fct.xmlStr(t,"x_label","");this.yLabel=Fct.xmlStr(t,"y_label","");this.xVarId=Fct.xmlNum(t,"input_x",-1);this.yVarId=Fct.xmlNum(t,"input_y",-1);e=$$(i,"xValues");if(e.length>0)this.xPoly=Fct.toNumericArray(e[0].textContent);e=$$(i,"yValues");if(e.length>0)this.yPoly=Fct.toNumericArray(e[0].textContent)}else if(arguments.length==2){this.name=i.name;this.cmt=i.cmt;this.xLabel=i.xLabel;this.yLabel=i.yLabel;this.xVarId=i.xVarId;this.yVarId=i.yVarId;this.xPolyPix=[...i.xPolyPix];this.yPolyPix=[...i.yPolyPix];this.xPoly=[...i.xPoly];this.yPoly=[...i.yPoly]}else if(arguments.length>2){this.name=i;this.xVarId=t;this.xLabel=e;this.yVarId=s;this.yLabel=a;this.xPolyPix=[...l];this.yPolyPix=[...r]}}clear(){this.setDefaults()}isDefined(){return this.xVarId>-1&&this.yVarId>-1&&(this.xPoly.length>0||this.xPolyPix.length>0)}setDefaults(){this.name="";this.cmt="";this.xLabel="";this.yLabel="";this.xVarId=-1;this.yVarId=-1;this.xPolyPix=[];this.yPolyPix=[];this.xPoly=[];this.yPoly=[]}toXml(t=-1){if(!this.isDefined())return"";let e=" <Patch name='"+this.name+"' comment='"+this.cmt+"' x_label='"+this.xLabel+"' y_label='"+this.yLabel+"' input_x='"+this.xVarId+"' input_y='"+this.yVarId;if(t>-1)e+="' window_id='"+t;e+="'>";if(this.xPoly.length>0)e+=" <xValues>"+this.xPoly.join()+"</xValues> <yValues>"+this.yPoly.join()+"</yValues>";else if(this.xPolyPix.length>0)e+=" <xPixValues>"+this.xPolyPix.join()+"</xPixValues> <yPixValues>"+this.yPolyPix.join()+"</yPixValues>";e+=" </Patch>";return e}}class IsoVarSet{constructor(t){this.isoVarArr=[];this.isoVarSmplFilter=new SmplFilter;let i=$$(t,"IsoSurfaceVariables");if(i.length>0){let e=$$(i[0],"IsoVariable");for(let t=0;t<e.length;++t)this.isoVarArr.push(new IsoVar(e[t]));this.isoVarSmplFilter=new SmplFilter(i[0])}}toXml(){let t=" <IsoSurfaceVariables>";t+=this.toXmlVarSet();t+=this.isoVarSmplFilter.toXml();return t+" </IsoSurfaceVariables>"}toXmlVarSet(){let e=" ";for(let t=0;t<this.isoVarArr.length;++t)e+=this.isoVarArr[t].toXml();return e}}class IsoVar{constructor(e,t,i){this.setDefaults();if(arguments.length==1){let t=e.attributes;this.varId=Fct.xmlNum(t,"var_id",-1);this.surfVarId=Fct.xmlNum(t,"surface_var_id",-1);this.surfVal=Fct.xmlStr(t,"surface_value","first")}else{this.varId=e;this.surfVarId=t;this.surfVal=i}}setDefaults(){this.varId=-1;this.surfVarId=-1;this.surfVal="first"}toXml(){return" <IsoVariable var_id='"+this.varId+"' surface_var_id='"+this.surfVarId+"' surface_value='"+this.surfVal+"'/>"}}class MetaVarQualityFilter{constructor(t,e,i){this.setDefaults();if(arguments.length==1){this.schemaId=Fct.xmlNum(t.attributes,"schema_id",0);this.varIds=Fct.toNumericArray(Fct.xmlStr(t.attributes,"var_ids",""));this.exclFlags=Fct.toNumericArray(t.textContent)}else if(arguments.length==3){this.schemaId=t;this.varIds=[e];this.exclFlags=[...i]}}setDefaults(){this.schemaId=0;this.varIds=[];this.exclFlags=[]}toXml(){return" <MetaVarQualityFilter schema_id='"+this.schemaId+"' var_ids='"+this.varIds.join()+"'>"+this.exclFlags.join()+"</MetaVarQualityFilter>"}}class PickedStat{constructor(e){this.setDefaults();if(typeof e==="number"){this.statId=e}else{let t=e.attributes;this.statId=Fct.xmlNum(t,"sequence_id",-1);this.symbType=Fct.xmlNum(t,"symbol_type",-1);this.fillCol=Fct.xmlNum(t,"fill_color",-1);this.frameCol=Fct.xmlNum(t,"frame_color",-1);this.frameWidth=Fct.xmlNum(t,"frame_width",-1);this.lineCol=Fct.xmlNum(t,"line_color",-1);this.lineStyle=Fct.xmlNum(t,"line_style",-1);this.align=Fct.xmlNum(t,"text_alignment",-1)}}setDefaults(){this.statId=-1;this.symbType=-1;this.fillCol=-1;this.frameCol=-1;this.frameWidth=-1;this.lineCol=-1;this.lineStyle=-1;this.align=-1}toXml(){let t=" <Station sequence_id='"+this.statId+"'";if(this.symbType>-1)t+=" symbol_type='"+this.symbType+"' text_alignment='"+this.align+"' line_style='"+this.lineStyle+"' fill_color='"+this.fillCol+"' frame_color='"+this.frameCol+"' line_color='"+this.lineCol+"' frame_width='"+this.frameWidth+"'";t+="/>";return t}}class SmplFilter{constructor(t){this.itemArr=[];if(t==undefined)return;let e=$$(t,"SampleSelectionEntry");for(let t=0;t<e.length;++t)this.itemArr.push(new SmplFilterItem(e[t]))}getPatchFilter(){let t,e=this.itemArr.length,i;for(t=0;t<e;++t){i=this.itemArr[t];if(i.type==2)return new Patch(i.patch,1)}return new Patch}getQualityFilters(){let t,e=this.itemArr.length,i,s=[],a=[],l=[];for(t=0;t<e;++t){i=this.itemArr[t];if(i.type==0)i.varIds.map(t=>{s.push(t);a.push(i.schemaId);l.push(i.exclFlags)})}return{varIds:s,schemaIds:a,exclQfArrs:l}}getRangeFilters(){let t,e=this.itemArr.length,i;let s=[],a=[],l=[],r=[];for(t=0;t<e;++t){i=this.itemArr[t];if(i.type==1){s.push(i.varIds[0]);r.push(i.wildCards);a.push(i.minVal);l.push(i.maxVal)}}return{varIds:s,minVals:a,maxVals:l,wildCards:r}}toXml(){if(this.itemArr.length==0)return"";let e=" <SampleSelectionCriteria> ";for(let t=0;t<this.itemArr.length;++t)e+=this.itemArr[t].toXml();return e+" </SampleSelectionCriteria>"}static toXmlS(t,e,i,s,a,l,r,n,o){let d=" <SampleSelectionCriteria>",c,m=t.length,u=a.length;for(c=0;c<m;++c){d+=" <SampleSelectionEntry var_ids='"+t[c]+"'>";if(coll.isNumericDataVar(t[c]))d+=" <RangeFilter max_value='"+i[c]+"' min_value='"+e[c]+"'/>";else d+=" <RangeFilter wildcard_expression='"+s[c]+"'/>";d+=" </SampleSelectionEntry>"}for(c=0;c<u;++c){d+=" <SampleSelectionEntry var_ids='"+a[c]+"'> <QualityFilter schema_id='"+l[c]+"'>"+r[c].join()+"</QualityFilter></SampleSelectionEntry>"}let p=[];p.push(n.xVarId.toString());p.push(n.yVarId.toString());d+=" <SampleSelectionEntry var_ids='"+p.join()+"'>";d+=n.toXml(o);return d+" </SampleSelectionEntry>"}}class SmplFilterItem{constructor(t){this.setDefaults();this.varIds=Fct.toNumericArray(Fct.xmlStr(t.attributes,"var_ids",""));let e=$$(t,"QualityFilter");if(e.length>0){this.type=0;this.schemaId=Fct.xmlNum(e[0].attributes,"schema_id",0);this.exclFlags=Fct.toNumericArray(e[0].textContent)}e=$$(t,"RangeFilter");if(e.length>0){this.type=1;this.minVal=Fct.xmlNum(e[0].attributes,"min_value",0);this.maxVal=Fct.xmlNum(e[0].attributes,"max_value",1);this.wildCards=Fct.xmlStr(e[0].attributes,"wildcard_expression","")}e=$$(t,"Patch");if(e.length>0){this.type=2;this.patch=new Patch(e[0])}}setDefaults(){this.type=0;this.varIds=[];this.schemaId=0;this.exclFlags=[];this.minVal=0;this.maxVal=1;this.wildCards="";this.patch=new Patch}toXml(){if(this.varIds.length==0)return;let t=" <SampleSelectionEntry var_ids='"+this.varIds.join()+"'>";if(this.type==0)t+=" <QualityFilter schema_id='"+this.schemaId+"'>"+this.exclFlags.join()+"</QualityFilter>";else if(this.type==1){if(coll.isDataVarNumeric(this.varIds[0]))t+=" <RangeFilter min_value='"+this.minVal+"' max_value='"+this.maxVal+"'/>";else t+=" <RangeFilter wildcard_expression='"+this.wildCards+"'/>"}else if(this.type==2){t+=this.patch.toXml()}return t+" </SampleSelectionEntry>"}}class Section{constructor(e){this.setDefaults();Section.widthCnvFac=2500;if(e==undefined)return;if(typeof e=="string")this.fromXmlStr(e);else{let t=$$(e,"Section");if(t.length>0)this.fromSectionElem(t[0])}}fromXmlStr(t){let e=new DOMParser;let i=$$(e.parseFromString(t,"text/xml"),"Section");if(i.length>0)this.fromSectionElem(i[0])}fromSectionElem(t){let e=t.attributes,i;let s=Fct.xmlStr(e,"bathymetry_name","Station Depths"),a=2;if(s=="(none)")a=0;else if(s=="Station Depths")a=1;else if(s.indexOf("ETOPO1")>-1)a=2;else if(s.indexOf("GEBCO")>-1)a=3;this.name=Fct.xmlStr(e,"section_name","");this.type=Fct.xmlNum(e,"coordinate",0);this.width=Fct.xmlNum(e,"width",.08)*Section.widthCnvFac;this.bathyType=a;this.bathyColor=Fct.xmlNum(e,"color",17);i=$$(t,"xNodes")[0];this.xNodes=Fct.toNumericArray(i.textContent);i=$$(t,"yNodes")[0];this.yNodes=Fct.toNumericArray(i.textContent)}isValid(){return this.type>-1}setDefaults(){this.name="";this.type=-1;this.width=200;this.bathyType=2;this.bathyColor=17}setName(t){this.name=t}setVals(t="",e=0,i=200,s=2,a=17){this.name=t;this.type=e;this.width=i;this.bathyType=s;this.bathyColor=a}toXml(){if(!this.isValid())return"";const t=["(none)","Station Depths","ETOPO1_2x2min_Global.nc","GEBCO_2023_2x2min_Global.nc"];let e=Fct.roundedVal(this.width/Section.widthCnvFac,3);return" <Section color='"+this.bathyColor+"' coordinate='"+this.type+"' section_name='"+this.name+"' width='"+e+"' bathymetry_name='"+t[this.bathyType]+"'> <xNodes>"+this.xNodes.join(",")+"</xNodes> <yNodes>"+this.yNodes.join(",")+"</yNodes> </Section>"}}class StatFilter{constructor(t){this.setDefaults();let e=$$(t,"StationSelectionCriteria"),i;if(e.length==0)return;let s,a=e[0];this.invert=Fct.xmlStr(a.attributes,"is_inverting","F");let l=$$(a,"Names");if(l.length>0){s=l[0].attributes;this.cruise=Fct.xmlStr(s,"cruise","*");this.statType=Fct.xmlStr(s,"station_type","*");this.statNameMin=Fct.xmlStr(s,"first_station","0");this.statNameMax=Fct.xmlStr(s,"last_station","99999999")}l=$$(a,"Range");if(l.length>0){s=l[0].attributes;this.statIdMin=Fct.xmlNum(s,"first_station_id",0);this.statIdMax=Fct.xmlNum(s,"last_station_id",99999999);this.smplCountMin=Fct.xmlNum(s,"sample_count_min",0);this.smplCountMax=Fct.xmlNum(s,"sample_count_max",99999999)}l=$$(a,"Period");if(l.length>0){s=l[0].attributes;this.periodDay0=Fct.xmlNum(s,"first_day",1);this.periodDay1=Fct.xmlNum(s,"last_day",31);this.periodMon0=Fct.xmlNum(s,"first_month",1);this.periodMon1=Fct.xmlNum(s,"last_month",12);this.periodYear0=Fct.xmlNum(s,"first_year",-99999);this.periodYear1=Fct.xmlNum(s,"last_year",99999);this.periodHour0=Fct.xmlNum(s,"first_hour",0);this.periodHour1=Fct.xmlNum(s,"last_hour",23);this.periodMinute0=Fct.xmlNum(s,"first_minute",0);this.periodMinute1=Fct.xmlNum(s,"last_minute",59)}l=$$(a,"Season");if(l.length>0){s=l[0].attributes;this.seasonDay0=Fct.xmlNum(s,"first_day",1);this.seasonDay1=Fct.xmlNum(s,"last_day",31);this.seasonMon0=Fct.xmlNum(s,"first_month",1);this.seasonMon1=Fct.xmlNum(s,"last_month",12)}l=$$(a,"DayTime");if(l.length>0){s=l[0].attributes;this.dayTimHour0=Fct.xmlNum(s,"first_hour",0);this.dayTimHour1=Fct.xmlNum(s,"last_hour",23);this.dayTimMin0=Fct.xmlNum(s,"first_minute",0);this.dayTimMin1=Fct.xmlNum(s,"last_minute",59)}l=$$(a,"RequiredVars");if(l.length>0){s=l[0].attributes;this.reqVarIsOrLogic=Fct.xmlStr(s,"use_or_logic","F");this.reqVarIds=Fct.toNumericArray(Fct.xmlStr(s,"var_ids",""))}let r;l=$$(a,"MetaVarRange");for(r=0;r<l.length;++r){s=l[r].attributes;this.mvRangeVarIds.push(Fct.xmlNum(s,"var_id",0));this.mvRangeMinVals.push(Fct.xmlNum(s,"min_value",0));this.mvRangeMaxVals.push(Fct.xmlNum(s,"max_value",1))}l=$$(a,"MetaVarWildCardExpression");for(r=0;r<l.length;++r){s=l[r].attributes;this.mvWildCardVarIds.push(Fct.xmlNum(s,"var_id",0));this.mvWildCardExprs.push(Fct.xmlStr(s,"wildcard_expression",""));this.mvWildCardCases.push(Fct.xmlStr(s,"case_sensitive","F"))}l=$$(a,"MetaVarQualityFilter");for(r=0;r<l.length;++r){this.mvQFilters.push(new MetaVarQualityFilter(l[r]))}l=$$(a,"Domain");if(l.length>0){s=l[0].attributes;this.wLonDom=Fct.xmlNum(s,"lon_min",App.missDOUBLE);this.eLonDom=Fct.xmlNum(s,"lon_max",App.largeDOUBLE);this.sLatDom=Fct.xmlNum(s,"lat_min",App.missDOUBLE);this.nLatDom=Fct.xmlNum(s,"lat_max",App.largeDOUBLE)}l=$$(a,"Polygon");if(l.length>0){i=$$(l[0],"xValues")[0];this.xPoly=Fct.toNumericArray(i.textContent);i=$$(l[0],"yValues")[0];this.yPoly=Fct.toNumericArray(i.textContent)}l=$$(a,"HistoryPeriod");if(l.length>0){s=l[0].attributes;this.historyDay0=Fct.xmlNum(s,"first_day",1);this.historyDay1=Fct.xmlNum(s,"last_day",31);this.historyMon0=Fct.xmlNum(s,"first_month",1);this.historyMon1=Fct.xmlNum(s,"last_month",12);this.historyYear0=Fct.xmlNum(s,"first_year",-99999);this.historyYear1=Fct.xmlNum(s,"last_year",99999);this.historyHour0=Fct.xmlNum(s,"first_hour",0);this.historyHour1=Fct.xmlNum(s,"last_hour",23);this.historyMinute0=Fct.xmlNum(s,"first_minute",0);this.historyMinute1=Fct.xmlNum(s,"last_minute",59)}l=$$(a,"HistoryWildCardExpressions");if(l.length>0){s=l[0].attributes;this.historyUser=Fct.xmlStr(s,"user","*");this.historyAction=Fct.xmlStr(s,"action","*");this.historyDescr=Fct.xmlStr(s,"description","*")}}getMetaVarQualityFilters(){let t,e=this.mvQFilters.length,i,s=[],a=[],l=[];for(t=0;t<e;++t){i=this.mvQFilters[t];i.varIds.map(t=>{s.push(t);a.push(i.schemaId);l.push(i.exclFlags)})}return{varIds:s,schemaIds:a,exclQfArrs:l}}setDefaults(){this.setDefaultsNameRange();this.setDefaultsDateTime();this.setDefaultsDomain();this.setDefaultsMetaData();this.setDefaultsMetaDataQuality();this.setDefaultsAvail();this.setDefaultsHistory();this.invert="F"}setDefaultsAvail(){this.reqVarIds=[];this.reqVarIsOrLogic="F"}setDefaultsDateTime(){this.periodDay0=1;this.periodDay1=31;this.periodMon0=1;this.periodMon1=12;this.periodYear0=-99999;this.periodYear1=99999;this.periodHour0=0;this.periodHour1=23;this.periodMinute0=0;this.periodMinute1=59;this.seasonDay0=1;this.seasonDay1=31;this.seasonMon0=1;this.seasonMon1=12;this.dayTimHour0=0;this.dayTimHour1=23;this.dayTimMin0=0;this.dayTimMin1=59}setDefaultsDomain(){this.xPolyPix=[];this.yPolyPix=[];this.xPoly=[];this.yPoly=[];this.wLonDom=this.sLatDom=App.missDOUBLE;this.eLonDom=this.nLatDom=App.largeDOUBLE;this.polyfileName=""}setDefaultsHistory(){this.historyDay0=1;this.historyDay1=31;this.historyMon0=1;this.historyMon1=12;this.historyYear0=-99999;this.historyYear1=99999;this.historyHour0=0;this.historyHour1=23;this.historyMinute0=0;this.historyMinute1=59;this.historyUser="*";this.historyAction="*";this.historyDescr="*"}setDefaultsMetaData(){this.mvRangeVarIds=[];this.mvRangeMinVals=[];this.mvRangeMaxVals=[];this.mvWildCardVarIds=[];this.mvWildCardExprs=[];this.mvWildCardCases=[]}setDefaultsMetaDataQuality(){this.mvQFilters=[]}setDefaultsNameRange(){this.cruise="*";this.statNameMin="0";this.statNameMax="99999999";this.statIdMin=0;this.statIdMax=99999999;this.statType="*";this.smplCountMin=0;this.smplCountMax=99999999}setMetaVarQualityFilters(t,e,i){let s,a=t.length,l;this.mvQFilters=[];for(s=0;s<a;++s){l=new MetaVarQualityFilter(t[s],e[s],i[s]);this.mvQFilters.push(l)}}toXml(){return"<StationSelectionCriteria is_inverting='"+this.invert+"'> <Names cruise='"+Fct.escapedStr(this.cruise)+"' station_type='"+this.statType+"' first_station='"+this.statNameMin+"' last_station='"+this.statNameMax+"'/> <Range first_station_id='"+this.statIdMin+"' last_station_id='"+this.statIdMax+"' sample_count_min='"+this.smplCountMin+"' sample_count_max='"+this.smplCountMax+"'/> <Period first_day='"+this.periodDay0+"' last_day='"+this.periodDay1+"' last_year='"+this.periodYear1+"' last_month='"+this.periodMon1+"' first_month='"+this.periodMon0+"' first_year='"+this.periodYear0+"' first_hour='"+this.periodHour0+"' last_hour='"+this.periodHour1+"' first_minute='"+this.periodMinute0+"' last_minute='"+this.periodMinute1+"'/> <Season first_day='"+this.seasonDay0+"' last_day='"+this.seasonDay1+"' last_month='"+this.seasonMon1+"' first_month='"+this.seasonMon0+"'/> <DayTime last_hour='"+this.dayTimHour1+"' first_minute='"+this.dayTimMin0+"' last_minute='"+this.dayTimMin1+"' first_hour='"+this.dayTimHour0+"'/> <RequiredVars use_or_logic='"+this.reqVarIsOrLogic+"' var_ids='"+this.reqVarIds.join()+"'/> "+this.toXmlDomain()+this.toXmlMetaData()+this.toXmlMetaDataQuality()+" <HistoryPeriod first_day='"+this.historyDay0+"' last_day='"+this.historyDay1+"' last_year='"+this.historyYear1+"' last_month='"+this.historyMon1+"' first_month='"+this.historyMon0+"' first_year='"+this.historyYear0+"' first_hour='"+this.historyHour0+"' last_hour='"+this.historyHour1+"' first_minute='"+this.historyMinute0+"' last_minute='"+this.historyMinute1+"'/> <HistoryWildCardExpressions user='"+this.historyUser+"' action='"+this.historyAction+"' description='"+this.historyDescr+"'/> </StationSelectionCriteria>"}toXmlDomain(){let t="";if(this.wLonDom!=App.missDOUBLE)t+="<Domain lat_min='"+this.sLatDom+"' lat_max='"+this.nLatDom+"' lon_min='"+this.wLonDom+"' lon_max='"+this.eLonDom+"'/>";else if(this.xPoly.length>0)t+="<Polygon> <xValues>"+this.xPoly.join()+"</xValues> <yValues>"+this.yPoly.join()+"</yValues> </Polygon>";else if(this.xPolyPix.length>0)t+="<PolygonPix> <xValues>"+this.xPolyPix.join()+"</xValues> <yValues>"+this.yPolyPix.join()+"</yValues> </PolygonPix>";else if(this.polyfileName.length>0)t+="<PolygonFile name='"+this.polyfileName+"'/>";return t}toXmlMetaData(){let t,e="";for(t=0;t<this.mvRangeVarIds.length;++t)e+="<MetaVarRange var_id='"+this.mvRangeVarIds[t]+"' min_value='"+this.mvRangeMinVals[t]+"' max_value='"+this.mvRangeMaxVals[t]+"'/> ";for(t=0;t<this.mvWildCardVarIds.length;++t)e+="<MetaVarWildCardExpression var_id='"+this.mvWildCardVarIds[t]+"' wildcard_expression='"+this.mvWildCardExprs[t]+"' case_sensitive='"+this.mvWildCardCases[t]+"'/>";return e}toXmlMetaDataQuality(){let t,e=this.mvQFilters.length,i="";for(t=0;t<e;++t){i+=this.mvQFilters[t].toXml()}return i}}"use strict";class Collection{constructor(t){if(arguments.length==0)return;this.name=t.name;this.extension=t.extension;this.format=t.format;this.description=t.description.length>0?t.description:extPrms.collDescription;this.dataField=t.data_field;this.dataType=t.data_type;this.stationCount=t.station_count;this.accessMode=t.access_mode;this.usageAgreementText=t.usage_agreement_text;this.usageAgreementIntervalDays=t.usage_agreement_interval_days;this.keyVarIds=t.keyvar_ids;this.keyVarDataVarIds=t.keyvar_datavar_ids;this.goodCovPrms=t.coverage_checker;this.cruiseNames=t.cruise_names;this.viewFilesCount=t.view_files_count;this.viewFilesTree=t.view_files_tree;this.secFilesCount=t.sec_files_count;this.secFilesTree=t.sec_files_tree;this.mandatoryMetaVarCount=t.mandatory_metavar_count;this.extendedMetaVarIds=t.extended_metavar_ids;this.metaVars=new OdvVarSet(t.metavar_names,t.metavar_unames,t.metavar_units,t.metavar_uunits,t.metavar_comments,t.metavar_qfschema_ids,t.metavar_types,t.metavar_value_types,t.metavar_value_bytes,t.metavar_decimals,t.metavar_error_var_ids);this.primaryVarId=t.primary_var_id;this.dataVars=new OdvVarSet(t.datavar_names,t.datavar_unames,t.datavar_units,t.datavar_uunits,t.datavar_comments,t.datavar_qfschema_ids,t.datavar_types,t.datavar_value_types,t.datavar_value_bytes,t.datavar_decimals,t.datavar_error_var_ids,t.datavar_data_counts);let e,i=new DOMParser;this.pubPatches=new Map;t.patches_as_xml.map(t=>{e=new Patch(i.parseFromString(t,"text/xml").firstChild);this.pubPatches.set(e.name,e)});this.privPatches=new Map;let s,a,l=this.name+"/patches/",r=Fct.localStorageKeys(l,true);r.map(t=>{a=localStorage.getItem(l+t);this.privPatches.set(t,new Patch(i.parseFromString(a,"text/xml").firstChild))})}basicDataVarFullLabels(t=true){let e,i=this.dataVars.count(),s="",a=[];for(e=0;e<i;++e){s=this.dataVar(e).fullLabel();if(t)s=e+1+": "+s;a.push(s)}return a}dataCount(t){return this.isBasicDataVar(t)?this.dataVars.varArr[t].dataCount:0}dataVar(t){return this.dataVars.var(t)}dataVarAtSpec(t){let e=ui.dockDataVarIds.indexOf(this.primaryVarId);return this.isoVarFullLabel(t,this.primaryVarId,ui.dockDataValues[e])}dataVarCount(){return this.dataVars.count()}dataVarDecimalCount(e,i=view.drvdVarSet.drvdVarArr){if(this.isBasicDataVar(e))return this.dataVar(e).digitsCount;else{let t=View.indexOfDrvdVar(e,i);return t>-1?i[t].digitsCount:2}}dataVarFullLabel(e,i=true,s=view.drvdVarSet.drvdVarArr){if(this.isBasicDataVar(e))return this.dataVar(e).fullLabel(i);else{let t=View.indexOfDrvdVar(e,s);if(t>-1)return i?Fct.fullVarLabel(s[t].uname,s[t].uunits):Fct.fullVarLabel(s[t].name,s[t].units)}return""}dataVarFullLabels(t=[],e=true){let i=this.basicDataVarFullLabels(e);if(e)t.map(t=>{i.push("drvd: "+Fct.fullVarLabel(t.uname,t.uunits))});else t.map(t=>{i.push(Fct.fullVarLabel(t.uname,t.uunits))});return i}dataVarIds(t=[],e=0){let i=Fct.intArray(0+e,coll.dataVarCount());t.map(t=>{i.push(t.varId+e)});return i}dataVarIdsFromAvail(t,i=0){let s=[];t.map((t,e)=>{if(t>0)s.push(e+i)});return s}dataVarNameLabel(e,i=true,s=view.drvdVarSet.drvdVarArr){if(this.isBasicDataVar(e))return this.dataVar(e).nameLabel(i);else{let t=View.indexOfDrvdVar(e,s);if(t>-1)return i?s[t].uname:s[t].name}return""}dataVarNameLabelEx(e,i=true){if(this.isBasicDataVar(e))return this.dataVar(e).nameLabel(i);else{let t=viewInfo.drvdVarIds.indexOf(e);if(t>-1)return i?viewInfo.drvdVarUNames[t]:viewInfo.drvdVarNames[t]}return""}dataVarQfSetId(t){return this.isBasicDataVar(t)?this.dataVar(t).qfId:0}dataVarUnitsLabel(e,i=true,s=view.drvdVarSet.drvdVarArr){if(this.isBasicDataVar(e))return this.dataVar(e).unitsLabel(i);else{let t=View.indexOfDrvdVar(e,s);if(t>-1)return i?s[t].uunits:s[t].units}return""}dataVarValType(t){return this.isBasicDataVar(t)?this.dataVar(t).valType:"DOUBLE"}indexOfDataVar(t,e){return this.dataVars.indexOfVar(t,e)}indexOfMetaVar(t,e){return this.metaVars.indexOfVar(t,e)}isBasicDataVar(t){return t<this.dataVarCount()}isCollection(){return this.format=="ODVGENERIC"||this.format=="ODVCF5"||this.format=="ODVCF6"}isNumericDataVar(t){return this.isBasicDataVar(t)?this.dataVar(t).isNumeric():true}isoVarFullLabel(t,e,i){return this.dataVarFullLabel(t)+" @ "+this.dataVarFullLabel(e)+" = "+i}metaVar(t){return this.metaVars.var(t)}metaVarCount(){return this.metaVars.count()}metaVarFullLabels(t,e,i,s){let a=[],l,r=this.metaVars.count();for(l=0;l<r;++l){if(this.metaVarIsMatch(l,t,e,i,s))a.push(this.metaVar(l).fullLabel())}return a}metaVarIds(t,e,i,s){let a=[],l,r=this.metaVars.count();for(l=0;l<r;++l){if(this.metaVarIsMatch(l,t,e,i,s))a.push(l)}return a}metaVarIsMatch(t,e,i,s,a){let l=coll.extendedMetaVarIds.includes(t+1);let r=coll.metaVar(t).isNumeric();let n=e&&!l||i&&l;let o=s&&r||a&&!r;return n&&o}primaryVar(){return this.dataVars.var(this.primaryVarId)}usageAgreeRequired(){if(this.usageAgreementText.length==0)return false;let t=parseInt(localStorage.getItem(this.name+"/lastAgreeTime"));if(isNaN(t))t=0;let e=Date.now(),i=(e-t)/864e5;return i>this.usageAgreementIntervalDays}static valueTypeStrArr(){return["FLOAT","DOUBLE","INTEGER","SHORT","SIGNED_BYTE","UNSIGNED_INTEGER","UNSIGNED_SHORT","BYTE","TEXT","INDEXED_TEXT"]}static valueBytes(t,e=21){const i=[4,8,4,2,1,4,2,1,e,4];let s=Collection.valueTypeStrArr().indexOf(t);return s>-1?i[s]:4}}class OdvVarSet{constructor(t,e,i,s,a,l,r,n,o,d,c,m=[]){this.varArr=[];let u,p=t.length,g=m.length>0;for(u=0;u<p;++u)this.varArr.push(new OdvVar(t[u],i[u],e[u],s[u],a[u],l[u],r[u],n[u],o[u],d[u],c[u],g?m[u]:-1))}count(){return this.varArr.length}indexOfVar(t,e){return Fct.indexOf(this.varArr,t,e)}var(t){return t<this.varArr.length?this.varArr[t]:new OdvVar}}class OdvVar{constructor(t,e,i,s,a,l,r,n,o,d,c,m){if(arguments.length==0)return;this.name=t;this.units=e;this.uname=i;this.uunits=s;this.cmt=a;this.qfId=l;this.varType=r;this.valType=n;this.valBytes=o;this.digitsCount=d;this.errVarId=c;this.dataCount=m}fullLabel(t=true){return t?Fct.fullVarLabel(this.uname,this.uunits):Fct.fullVarLabel(this.name,this.units)}isNumeric(){return!(this.valType=="INDEXED_TEXT"||this.valType=="TEXT")}isValid(t){return this.name!=undefined}nameLabel(t=true){return t?this.uname:this.name}unitsLabel(t=true){return t?this.uunits:this.units}}"use strict";class Ui{static dlgA2aStr="Apply to all windows";static cmPageWidth=29.7;static cmPageHeight=21;static dragOutlineColor="red";static dragOutlinePattern=[6,2];static isAliveTimeoutId=null;static isAliveTimeoutMilliSecs=3e4;static xAlignIdx=[1,1,1,2,2,0,0,2,0];static yAlignIdx=[1,0,2,0,2,0,2,1,1];static menuWidth={CanvasMenu:185,CurrStatMenu:150,CurrStatTbMenu:150,CwLayoutMenu:200,DataWinMenu:180,DataAvailabilityMenu:140,DwExtrasMenu:170,DwFullRangeMenu:105,DwLayoutMenu:200,DwStatisticsMenu:110,GObjActMenu:150,GObjAddMenu:120,GObjExpDwMenu:150,GObjExpMwMenu:150,LayoutTemplateMenu:140,MapMenu:195,MwExtrasMenu:170,MwLayoutMenu:200,PickedStatMenu:250,RedoMenu:250,SmplInfoValMenu:120,SmplFilterMenu:140,SmplNameMenu:150,SmplValMenu:160,StatFilterMenu:120,UndoMenu:250,ViewMenu:180};constructor(){this.cnvsFract=.75;this.smplLstFract=.5;this.isovLstFract=.175;this.fullWidth=-1;this.gridContainer=$("GridContainer");this.popupBckgrd=$("PopupBckgrd");this.controlBlock=$("ControlBlock");this.cnvsContainer=$("CanvasContainer");this.cnvs=$("CanvasArea");this.imgArea=$("ImageArea");this.currStatList=$("CurrStatList");this.currSmplList=$("CurrSmplList");this.currIsoVarList=$("CurrIsoVarList");this.currSmplTitleBar=$("CurrSmplListTitleBar");this.currIsovTitleBar=$("CurrIsoVarListTitleBar");this.ctx=this.cnvs.getContext("2d");this.ctxLineWidth=1;this.ctxStrokeStyle="red";this.ctxFillStyle="red";this.imgOdvCnvsLeft=-1;this.imgOdvCnvsRight=-1;this.imgOdvCnvsTop=-1;this.imgOdvCnvsBottom=-1;this.odvPixPerHtmlPix=-1;this.odvPixPerCm=-1;this.visibleMenuNames=[];this.menuItemHtmls=new Map;this.menuItemDescriptions=new Map;this.menuOptionsByKeyName=new Map;this.menuOptionsByKeyName.set("ArrowDown","miNextSample");this.menuOptionsByKeyName.set("ArrowRight","miNextStation");this.menuOptionsByKeyName.set("ArrowUp","miPrevSample");this.menuOptionsByKeyName.set("ArrowLeft","miPrevStation");this.visibleMenuNames=[];this.dlgArr=[];this.dlgHeaderArr=[];this.dlgCloseBtnArr=[];this.dlgTitleArr=[];this.dlgContentsArr=[];this.dlgMessageArr=[];this.dlgFooterArr=[];this.dlgOrigDisabledByEl1=new Map;this.dlgOrigDisabledByEl2=new Map;this.dlgOrigVals=new Map;this.currDlgIdx=-1;this.dragDlgIdx=-1;this.dlgLastOpenElems=new Map;this.currStatId=-1;this.currValStatId=-1;this.currStatAccNum=-1;this.currSmplId=-1;this.smplCount=-1;this.currGObjIdx=-1;this.currMiOption="";this.currCnvsX=-1;this.currCnvsY=-1;this.currWinId=-2;this.lclickGObjIdx=-1;this.rclickCnvsX=-1;this.rclickCnvsY=-1;this.rclickOdvCnvsX=-1;this.rclickOdvCnvsY=-1;this.rclickWinId=-1;this.rclickTblItem={};this.rclickGObjIdx=-1;this.hlPolylines=[];this.hlPoints=null;this.hlDrawDataDots=false;this.ptgWinId=-1;this.ptgMinPtCount=-1;this.ptgMaxPtCount=-1;this.ptgCnvsX=[];this.ptgCnvsY=[];this.zoomPixTol=10;this.zoomCnvsLeftBegin=-1;this.zoomCnvsRightBegin=-1;this.zoomCnvsTopBegin=-1;this.zoomCnvsBottomBegin=-1;this.zoomCnvsLeft=-1;this.zoomCnvsRight=-1;this.zoomSpotId=-1;this.zoomCnvsTop=-1;this.zoomCnvsBottom=-1;this.zoomWinId;this.beginCnvsX=-1;this.beginCnvsY=-1;this.finishOnDbleClick=true;Ui.onHideDlgFct=Fct.noOpFct;Ui.onFinishPointGetterFct=Fct.noOpFct;Ui.onFinishZoomFct=Fct.noOpFct;Ui.onFileLoadFct=Fct.noOpFct;this.dockMetaVarLabels=[];this.dockDataVarLabels=[];this.dockIsoVarLabels=[];this.dockMetaVarIds=[];this.dockDataVarIds=[];this.dockDataVarLabelClickableFlags=[];this.dockIsoVarIds=[];this.dockMetaValues=[];this.dockMetaValueOdvFlags=[];this.dockMetaValueClickableFlags=[];this.dockDataValues=[];this.dockDataFlags=[];this.dockDataOdvFlags=[];this.dockDataValueClickableFlags;this.dockDataInfoValues=[];this.dockDataInfoValueClickableFlags=[];this.drvdVarChoices=[];this.drvdVarGroups=[];this.varCnvIds=[];this.varCnvLbls=[];this.varCnvFacs=[];this.varCnvOffs=[];this.timeVarCnvIds=[];this.timeVarCnvLbls=[];this.metaTimeVarCnvIds=[];this.metaTimeVarCnvLbls=[];this.dataVarTypeNames=[];this.metaVarTypeNames=[];this.keyVarIdChoices=[];this.keyVarLblChoices=[];this.paletteNames=[];this.paletteReds=[];this.paletteGreens=[];this.paletteBlues=[];this.macroNames=[];this.privMacroNames=[];this.lastDateTime=Date.now()}activateTree(e,i){let t=$(e);let s=t.getElementsByClassName("tree-group-node");for(let t=0;t<s.length;++t)s[t].addEventListener("click",function(){this.parentElement.querySelector(".tree-nested-list").classList.toggle("tree-nested-list-open");this.classList.toggle("tree-group-node-open");ui.dlgLastOpenElems.set(e,this.innerHTML)});let a=t.getElementsByClassName("tree-item-node");for(let t=0;t<a.length;++t)a[t].addEventListener("click",i)}clearCanvas(){this.ctx.clearRect(0,0,this.cnvs.width,this.cnvs.height)}clearIsAlivePolling(){if(Ui.isAliveTimeoutId){clearTimeout(Ui.isAliveTimeoutId);Ui.isAliveTimeoutId=null}}clipToRect(t){let e=ui.toHtmlCanvasX(t.left);let i=ui.toHtmlCanvasX(t.right);let s=ui.toHtmlCanvasY(t.top);let a=ui.toHtmlCanvasY(t.bottom);this.ctx.beginPath();this.ctx.moveTo(e,s);this.ctx.lineTo(i,s);this.ctx.lineTo(i,a);this.ctx.lineTo(e,a);this.ctx.lineTo(e,s);this.ctx.closePath();this.ctx.clip()}closeSession(t){ui.hideInterface();appState.clear();let e=opener;if(e!=null){open(e.href,e.name);close()}else if(extPrms.returnUrl.length>0){open(extPrms.returnUrl,"_parent")}else{ui.dlgMsgBox("<b>"+t+"</b><br><br>Your last view will be restored when you return.")}}createDomElements(){let t="SAVE";if(extPrms.collectionName.length==0)extPrms.collectionName=t;this.controlBlock.innerHTML='<p> <b>webODV Client</b> &emsp;&emsp; <button onClick="app.sendWebSocketMessage();"><b>Send</b></button> <button onClick="app.sendLoginRequest();"><b>Start Session</b></button> <button onClick="app.webSocketStop();">Disconnect</button> <button onClick="localStorage.clear();">Clear localStorage</button> &emsp;&emsp; <input type="checkbox" id="showMsgCb"> Show messages in console </p> <p> '+Html.txtInput("Identifier","","5%")+" "+Html.txtInput("Collection",t,"20%")+" "+Html.txtInput("InitialView","","10%")+" :: "+Html.txtInput("InputText","","60%")+" </p>";$("TitleBar").innerHTML='<div id="TbIconPane" class="TbPane"><img src="'+extPrms.resourceRoot+'img/odv-icon.gif"></div> <div id="TbInfoPane" class="TbPane"></div> <div id="TbMenuPane" class="TbPane"></div>';$("CurrStatListTitleBar").innerHTML='<div id="CurrStatListTitleBarInfoPane" class="LbPane"></div> <div id="CurrStatListTitleBarBttn1Pane" class="LbPane"> <button class="is-dlgcolor" title="previous station" onClick="app.onCurrStatOrSmplByKeyCode(&quot;ArrowLeft&quot;);"><b>'+Html.LeftArrow+'</b></button> </div> <div id="CurrStatListTitleBarBttn2Pane" class="LbPane"> <button class="is-dlgcolor" title="next station" onClick="app.onCurrStatOrSmplByKeyCode(&quot;ArrowRight&quot;);"><b>'+Html.RightArrow+"</b></button> </div>";this.currSmplTitleBar.innerHTML='<div id="CurrSmplListTitleBarInfoPane" class="LbPane"></div> <div id="CurrSmplListTitleBarBttn1Pane" class="LbPane"> <button class="is-dlgcolor" title="previous sample"" onClick="app.onCurrStatOrSmplByKeyCode(&quot;ArrowUp&quot;);"><b>'+Html.UpArrow+'</b></button> </div> <div id="CurrSmplListTitleBarBttn2Pane" class="LbPane"> <button class="is-dlgcolor" title="next sample" onClick="app.onCurrStatOrSmplByKeyCode(&quot;ArrowDown&quot;);"><b>'+Html.DownArrow+"</b></button> </div>";$("StatusBar").innerHTML='<div id="SbPaneLeft"></div> <div id="SbPaneRight" class="SbPane"></div> <div id="SbMsgPane" class="SbPane has-panebckcolor"></div> <div id="SbInfoPane" class="SbPane has-panebckcolor"></div> <div id="SbAccessPane" class="SbPane has-panebckcolor"></div> <div id="SbSmplFilPane" class="SbPane has-panebckcolor"></div> <div id="SbStatFilPane" class="SbPane has-panebckcolor"></div> <div id="SbModePane" class="SbPane has-panebckcolor"></div>';this.sbPaneLeft=$("SbPaneLeft");this.sbPaneRight=$("SbPaneRight");this.sbMsgPane=$("SbMsgPane");this.sbInfoPane=$("SbInfoPane");this.sbAccessPane=$("SbAccessPane");this.sbSmplFilPane=$("SbSmplFilPane");this.sbStatFilPane=$("SbStatFilPane");this.sbModePane=$("SbModePane");this.popupBckgrd.innerHTML=Html.popupDlg(1)+Html.popupDlg(2)+Html.popupDlg(3);this.dlgArr=[$("PopupDlg1"),$("PopupDlg2"),$("PopupDlg3")];this.dlgHeaderArr=[$("DlgHeader1"),$("DlgHeader2"),$("DlgHeader3")];this.dlgCloseBtnArr=[$("DlgCloseBtn1"),$("DlgCloseBtn2"),$("DlgCloseBtn3")];this.dlgTitleArr=[$("DlgTitle1"),$("DlgTitle2"),$("DlgTitle3")];this.dlgContentsArr=[$("DlgContents1"),$("DlgContents2"),$("DlgContents3")];this.dlgMessageArr=[$("DlgMessage1"),$("DlgMessage2"),$("DlgMessage3")];this.dlgFooterArr=[$("DlgFooter1"),$("DlgFooter2"),$("DlgFooter3")]}createMenuItems(){const t="Applies a predefined window layout.";ui.newMenuItem("mi1DEstimation","1D Estimation","");ui.newMenuItem("mi2DEstimation","2D Estimation","Estimates Z-values at user-specified X-Y points using gridding parameters of the data window.");ui.newMenuItem("miAddAnnotation","Annotation","Adds a text annotation.",Fct.keyCode(1,0,0,"A"));ui.newMenuItem("miAddEllipse","Ellipse","Adds an ellipse or circle.");ui.newMenuItem("miAddLine","Line","Adds a straight line.");ui.newMenuItem("miAddPolygon","Polygon","Adds a filled polygon.");ui.newMenuItem("miAddPolyline","Polyline","Adds a polyline.");ui.newMenuItem("miAddRectangle","Rectangle","Adds a rectangle.");ui.newMenuItem("miAddSymbol","Symbol","Adds a symbol.");ui.newMenuItem("miAddSymbolSet","Symbol Set","Selects a data subset and associates a symbol.");ui.newMenuItem("miAutoZoomIn","Auto-Zoom In","Zooms into area at current mouse position.",Fct.keyCode(1,0,0,"+"),false);ui.newMenuItem("miAutoZoomOut","Auto-Zoom Out","Zooms out and automatically enlarges the X and Y ranges.",Fct.keyCode(1,0,0,"-"),false);ui.newMenuItem("miBrowseHistory","Browse Station History","Shows the history records for this station.");ui.newMenuItem("miClipboardCopy","Clipboard Copy","Copies the data of the current window to the clipboard.");ui.newMenuItem("miCloseSession","<b>Close Session</b>","Closes the session.");ui.newMenuItem("miCollBrowseAgreement","Browse Data Usage Agreement","Shows the collection data usage agreement.");ui.newMenuItem("miCollBrowseInfo","Browse Info File","Shows the collection info file.");ui.newMenuItem("miCollBrowseLogfile","Browse Log File","Retrieves the collection log file.");ui.newMenuItem("miCollCopy","Copy","Creates a copy of the current collection.");ui.newMenuItem("miCollDeleteCurrStation","Delete Current Station","Deletes the current station from the collection.");ui.newMenuItem("miCollDeleteStationSubset","Delete Station Subset","Deletes all stations shown in the map from the collection.");ui.newMenuItem("miCollectStrValsDv","Collect Unique Values","Constructs the alphabetically sorted unique value list for this data variable and the current station set.");ui.newMenuItem("miCollectStrValsMv","Collect Unique Values","Constructs the alphabetically sorted unique value list for this meta variable and the current station set.");ui.newMenuItem("miCollInvByCruise","By Cruise","Retrieves the collection inventory by cruise.");ui.newMenuItem("miCollInvByCruiseAndVar","By Cruise And Variable","Retrieves the collection inventory by cruise and variable.");ui.newMenuItem("miCollPropsDataVariables","Data Variables","Changes the properties of data variables.");ui.newMenuItem("miCollPropsGeneral","General","Changes the properties of the collection.");ui.newMenuItem("miCollPropsMetaVariables","Meta Variables","Changes the properties of meta variables.");ui.newMenuItem("miCollRename","Rename","Renames the collection.");ui.newMenuItem("miCollSortCondense","Sort and Condense","Sorts and condenses the collection.");ui.newMenuItem("miCreateOverviewPlots","Create Overview Plots","Creates overview plots showing all data in the collection.");ui.newMenuItem("miCreateSnapshot","Create Snapshot","Copies the collection to ZIP package for backup or exchange.");ui.newMenuItem("miCurrSmplById","Current Sample by ID");ui.newMenuItem("miCurrStatByAccession","Accession Number","Selects a new current station by accession number.",".");ui.newMenuItem("miCurrStatById","Station ID","Selects a new current station by station ID.","#");ui.newMenuItem("miCurrStatByName","Name","Selects a new current station by cruise label, station label and station type.");ui.newMenuItem("miCurveFittingDw","Curve Fitting","Shows the curve fitting dialog for the current plot.");ui.newMenuItem("miDataAvailCollection","Collection","Shows data availability information for the entire collection.");ui.newMenuItem("miDataAvailCruise","Current Cruise","Shows data availability information for the current cruise.");ui.newMenuItem("miDataAvailStation","Current Station","Shows data availability information for the current station.");ui.newMenuItem("miDataAvailStationSet","Current Station Set","Shows data availability information for the current station set.");ui.newMenuItem("miDefineSection","Define Section","Defines a new section along a user specified track.");ui.newMenuItem("miDefPatch","Define Patch","Lets the user specify a X-Y polygon patch. The polygon is closed automatically.");ui.newMenuItem("miDisplayOrder","Display Order","Changes the order of data variables in the display list.");ui.newMenuItem("miDrvdVars","Derived Variables","Adds, deletes or edits derived variables.",Fct.keyCode(0,1,0,"D"));ui.newMenuItem("miDvCbCopyVal","Clipboard Copy","Copies data value to the clipboard.");ui.newMenuItem("miDvCbCopyInfo","Clipboard Copy","Copies info value to the clipboard.");ui.newMenuItem("miDwDelete","Delete Window","Deletes the data window.");ui.newMenuItem("miDwMoveBot","Move to Background","Moves the data window to the background.");ui.newMenuItem("miDwMoveResize","Move / Resize Window","Moves or resizes the data window.",Fct.keyCode(1,0,0,"R"));ui.newMenuItem("miDwMoveTop","Move to Foreground","Moves the data window to the foreground.");ui.newMenuItem("miDwNewOverlay","Create Overlay Window","Creates a new overlay data window for the current window.");ui.newMenuItem("miDwNewWin","Create New Window","Creates a new data window.");ui.newMenuItem("miDwProperties","<b>Properties</b>","Changes properties of the data window.",Fct.keyCode(0,1,0,"P"),false);ui.newMenuItem("miEditData","Edit Data","Edits the data values of the current variable.");ui.newMenuItem("miEditInfoVal","Edit Info Value","Edits the data info value of the current variable.");ui.newMenuItem("miEditMetadata","Edit Metadata","Edits the metadata of the current station.");ui.newMenuItem("miEditSampleData","Edit Sample Data","Edits the data values of the current sample.");ui.newMenuItem("miExpCollection","ODV Collection","Exports the data of all stations shown in the map to a new ODV collection.");ui.newMenuItem("miExpHistory","History","Exports the history records of all stations shown in the map to a file.");ui.newMenuItem("miExpNetCDF","NetCDF File","Exports the data of all stations shown in the map to a netCDF file.");ui.newMenuItem("miExpSpreadsheet","ODV Spreadsheet File","Exports the data of all stations shown in the map to an ODV spreadsheet file.");ui.newMenuItem("miFindDuplicates","Find Duplicate Stations","Finds and resolves duplicate stations. Only the current station set is searched.");ui.newMenuItem("miFiveIsoSurfaceWin","5 SURFACE Windows",t);ui.newMenuItem("miFiveMixedWin","5 MIXED Windows",t);ui.newMenuItem("miFiveSectionWin","5 SECTION Windows",t);ui.newMenuItem("miFullDomain","Full Domain","Sets the map domain to the collection full domain.",Fct.keyCode(1,0,0,"F"));ui.newMenuItem("miFullScreenMap","Full Screen Map",t);ui.newMenuItem("miFullRangeXYZ","All","Sets all axis ranges of the data window to full range.",Fct.keyCode(1,0,0,"F"));ui.newMenuItem("miFullRangeX","X Axis","Sets X axis ranges of the data window to full range.");ui.newMenuItem("miFullRangeY","Y Axis","Sets Y axis ranges of the data window to full range.");ui.newMenuItem("miFullRangeZ","Z Axis","Sets Z axis ranges of the data window to full range.");ui.newMenuItem("miFullRangeAllWin","Full Range All Windows","Sets the axis ranges of all data windows to full range.",Fct.keyCode(1,0,0,"F"));ui.newMenuItem("miGlobalMap","Global Map","Produces a global map.");ui.newMenuItem("miGObjCopy","Copy Object","Creates a copy of current graphics object.");ui.newMenuItem("miGObjDelete","Delete Object","Deletes the current graphics object.");ui.newMenuItem("miGObjDeleteAll","Delete All Objects","Deletes all graphics objects of this window.");ui.newMenuItem("miGObjExpContoursFile","to GOB File","Exports the contour lines to a graphics object file.");ui.newMenuItem("miGObjExpContoursCb","to Clipboard","Exports the contour lines to the clipboard.");ui.newMenuItem("miGObjExpCurrent","Export Object","Exports current graphics object to a file.");ui.newMenuItem("miGObjExpSecBathyFile","to GOB File","Exports the section bathymetry to a graphics object file.");ui.newMenuItem("miGObjExpSecBathyCb","to Clipboard","Exports the section bathymetry to the clipboard.");ui.newMenuItem("miGObjExpSecStatLblsFile","to GOB File","Exports the section station labels to a graphics object file.");ui.newMenuItem("miGObjExpSecStatLblsCb","to Clipboard","Exports the section station labels to the clipboard.");ui.newMenuItem("miGObjExpSmplDotsFile","to GOB File","Exports the sample dots to a graphics object file.");ui.newMenuItem("miGObjExpSmplDotsCb","to Clipboard","Exports the sample dots to the clipboard.");ui.newMenuItem("miGObjExpStatDotsFile","to GOB File","Exports the sample dots to a graphics object file.");ui.newMenuItem("miGObjExpStatDotsCb","to Clipboard","Exports the sample dots to the clipboard.");ui.newMenuItem("miGObjExpStatSelPolyFile","to GOB File","Exports the station filter polygon to a graphics object file.");ui.newMenuItem("miGObjExpStatSelPolyCb","to Clipboard","Exports the station filter polygon to the clipboard.");ui.newMenuItem("miGObjFromClipboard","from Clipboard","Adds graphics objects from the clipboard.");ui.newMenuItem("miGObjFromGobFile","from GOB File","Adds graphics objects from a *.xgob or *.gob file.");ui.newMenuItem("miGObjFromShapeFile","from Shapefile","Adds graphics objects from a *.shp shapefile.");ui.newMenuItem("miGObjMgr","Manage Graphics Objects","Manages the graphics objects of the current window or canvas.");ui.newMenuItem("miGObjMoveBot","Move to Background","Moves the current graphics object to the background.");ui.newMenuItem("miGObjMoveDwn","Move Down","Moves the current graphics object towards the background.");ui.newMenuItem("miGObjMoveTop","Move to Foreground","Moves the current graphics object to the foreground.");ui.newMenuItem("miGObjMoveUp","Move Up","Moves the current graphics object towards the foreground.");ui.newMenuItem("miGObjProps","<b>Properties</b>","Changes properties of the graphics object.",Fct.keyCode(0,1,0,"P"),false);ui.newMenuItem("miGoodCoverageCriteria","Good Coverage Criteria","Changes the good coverage criteria of the collection.");ui.newMenuItem("miHelpGettingStarted","Getting Started","Shows the ODV-online Getting Started document.",Fct.helpdocKeyCode());ui.newMenuItem("miHelpHowToGuide","HowTo Guide","Shows the ODV-online HowTo document.");ui.newMenuItem("miHelpOdvUserGuide","ODV User Guide","Shows the ODV Users Guide.");ui.newMenuItem("miHelpShortcutKeys","Shortcut Key Summary","Shows the ODV-online shortcut key summary document.");ui.newMenuItem("miIdentifyKeyVariables","Identify Key Variables","Identifies and remembers key collection variables.");ui.newMenuItem("miIsopynals","Isopynals","Selects potential or neutral density isolines for the data window.");ui.newMenuItem("miIsoVars","Isosurface Variables &emsp;","Adds, deletes or edits isosurface variables.");ui.newMenuItem("miLoadSection","Load Section","Loads a section from a resource.");ui.newMenuItem("miLoadView","<b>Load View</b>","Loads view settings from a resource.",Fct.keyCode(1,0,0,"V"));ui.newMenuItem("miManageGObjects","Graphics Objects","Downloads, renames, deletes existing graphics objects or uploads new graphics objects.");ui.newMenuItem("miManageSections","Sections","Downloads, renames, deletes existing sections or uploads new sections.");ui.newMenuItem("miManageViews","Views","Downloads, renames, deletes existing views or uploads new views.");ui.newMenuItem("miMapProperties","<b>Properties</b>","Changes properties of the map.",Fct.keyCode(0,1,0,"P"),false);ui.newMenuItem("miMoveResize","Move / Resize","Moves or resizes the map.",Fct.keyCode(1,0,0,"R"));ui.newMenuItem("miMvCbCopyVal","Clipboard Copy","Copies meta value to the clipboard.");ui.newMenuItem("miOneIsoSurfaceWin","1 SURFACE Window",t);ui.newMenuItem("miOnePickWin","1 STATION Window",t);ui.newMenuItem("miOneScatterWin","1 SCATTER Window",t);ui.newMenuItem("miOneSectionWin","1 SECTION Window",t);ui.newMenuItem("miOutlierRangeCheck","Range Check","Finds samples inside or outside specified bounds and allows automatic editing. Only the stations shown in the map are scanned.");ui.newMenuItem("miOutlierSpikeCheck","Spike Check","Finds spike samples and allows automatic editing. Only the stations shown in the map are scanned.");ui.newMenuItem("miPickListAdd","Add Current Station to Pick List","Adds the current station to the list of picked stations.","+");ui.newMenuItem("miPickListClear","Clear Pick List","Clears the list of picked stations.");ui.newMenuItem("miPickListEdit","<b>Edit Pick List</b>","Opens the pick list managing dialog.");ui.newMenuItem("miPickListRemove","Remove Current Station from Pick List","Removes the current station from the list of picked stations.","-");ui.newMenuItem("miRefreshCanvas","Refresh","Redraws the canvas.");ui.newMenuItem("miRemoveSection","Remove Section","Removes the current section.");ui.newMenuItem("miSaveAsInterruptedMap","Save As Interrupted Map","Saves and retrieves the map as interrupted map image file.");ui.newMenuItem("miSaveAsInterruptedMapDw","Save As Interrupted Map","Saves and retrieves the data window as interrupted map image file.");ui.newMenuItem("miSaveImageCanvas","Save Canvas As","Saves and retrieves the entire canvas as image file.",Fct.keyCode(1,0,0,"S"));ui.newMenuItem("miSaveImageDw","Save Plot As","Saves and retrieves the data window as image file.",Fct.keyCode(1,0,0,"S"));ui.newMenuItem("miSaveImageMap","Save Map As","Saves and retrieves the map as image file.",Fct.keyCode(1,0,0,"S"));ui.newMenuItem("miSaveSectionAs","Save Section As","Saves the current section as named resource.");ui.newMenuItem("miSaveViewAs","Save View As","Saves the current view settings as named resource.");ui.newMenuItem("miSectionProperties","<b>Section Properties</b>","Changes the section title, width and section coordinate (e.g., distance, longitude, latitude).");ui.newMenuItem("miSetRanges","Set Ranges","Sets ranges of the X, Y, and Z axis of the data window.");ui.newMenuItem("miSixPickWin","6 STATION Windows",t);ui.newMenuItem("miSixScatterWin","6 SCATTER Windows",t);ui.newMenuItem("miSixSectionWin","6 SECTION Windows",t);ui.newMenuItem("miSmplFilter","Customize","Changes sample filter settings.",Fct.keyCode(0,0,1,"S"));ui.newMenuItem("miSmplFilterRelax","Relax","Relaxes the sample filter and accepts all data.");ui.newMenuItem("miSmplFilterNoOutliers","Reject Outliers","Applies sample filter settings that reject outlier data.");ui.newMenuItem("miStatFilter","Customize","Changes the station filter settings.",Fct.keyCode(0,1,0,"S"));ui.newMenuItem("miStatFilterRelax","Relax","Relaxes the station filter and accepts all stations.");ui.newMenuItem("miStatisticsDw","Summary","Shows mean, standard deviation, standard error, minimum, maximum and data histograms for the data window.","F4");ui.newMenuItem("miStatisticsMw","Statistics","Shows mean, standard deviation, minimum, maximum and data histograms for the map.","F4");ui.newMenuItem("miThreeIsoSurfaceWin","3 SURFACE Windows",t);ui.newMenuItem("miThreeSectionWin","3 SECTION Windows",t);ui.newMenuItem("miTwoIsoSurfaceWin","2 SURFACE Windows",t);ui.newMenuItem("miTwoPickWin","2 STATION Windows",t);ui.newMenuItem("miTwoScatterWin","2 SCATTER Windows",t);ui.newMenuItem("miTwoSectionWin","2 SECTION Windows",t);ui.newMenuItem("miUndoAll","<b>Undo All Changes</b>","Undoes all un-saved view changes.",Fct.sysInfo.isMacOS?"":Fct.keyCode(0,1,0,"Z"));ui.newMenuItem("miViewProperties","View Properties","Changes the general properties of the view.");ui.newMenuItem("miXVariable","X-Variable","Selects a new X variable for the data window.","X");ui.newMenuItem("miYVariable","Y-Variable","Selects a new Y variable for the data window.","Y");ui.newMenuItem("miZVariable","Z-Variable","Selects a new Z variable for the data window.","Z");ui.newMenuItem("miZoom","Zoom","Zooms into the map or data window.");ui.newMenuItem("miZZoom","Z-Zoom","Zooms into the color bar of the data window.")}dlgMsgBox(t,e="",i=false){ui.dlgOrigVals.set("dlgMsg",t);let s=window.innerHeight-100;let a=e.length>0?"<p><b>"+e+"</b></p>":"";let l='<p style="clear:both">'+Html.dlgBtnC("ui.hideDlg()","Close")+"&emsp;";if(i)l+=Html.dlgBtnC("ui.dlgMsgBoxExport()","Export");l+="</p>";Fct.setElemDisplay(this.dlgHeaderArr[this.currDlgIdx+1],false);ui.showDlg("",a+'<p style="line-height:150%;max-height:'+s+'px;overflow:auto;">'+t+"</p>",l)}dlgMsgBoxExport(){let t=ui.dlgOrigVals.get("dlgMsg");t=t.replaceAll("<b>","");t=t.replaceAll("</b>","");t=t.replaceAll("<br>","\n");Fct.saveBlobAs(new Blob([t],{type:"text/plain"}),"curve-fit.txt")}dlgMultiLineMsgBox(t,e,i,s){let a,l=e.length;let r='<p> <div class="has-border" style="padding:0 0 0 4px;width:'+i+"px;height:"+s+'px;overflow:auto;">';for(a=0;a<l;++a)r+="<p>"+e[a]+"</p>";r+="</div> </p>";ui.showDlg(t,r,Html.dlgBtn("ui.hideDlg()","Close"))}dlgQueryFile(t,e,i){Ui.onFileLoadFct=i;ui.showDlg(t,Html.labelFor("fileSelector",e)+'<p><input type="file" id="fileSelector"/></p>',"");$("fileSelector").addEventListener("change",app.onFileSelect)}dlgQueryStr(t,e,i,s,a="Apply",l=""){this.dlgOrigVals.set("queryStr",i);if(l.length==0)l=i.length<40?"28em":"38em";ui.showDlg(t,"<p>"+e+"</p><p>"+Html.txtInput("queryStr",i,l)+"</p>",Html.dlgBtn(s,a));let r=$("queryStr");r.focus();r.select()}dlgSelectItem(t,e,i,s="",a=""){let l=s.length>0?"<p>"+s+"</p>":"",r=e[0];if(a.length>0){let t=e.findIndex(t=>t.includes(a));r=t==-1?"":e[t]}l+=Html.selectList("selectList",e,e,r);ui.showDlg(t,l,Html.dlgBtn(i,"Select"));let n=$("selectList");n.size=Math.min(8,e.length);if(r.length==0)n.selectedIndex=-1}dlgSelectQf(t,e,i,s){if(t>=App.VID_FIRSTDRVD)return;let a=e==1?coll.dataVar(t):coll.metaVar(t);let l=a.qfId;if(!qfSets.has(l))return;let r=a.fullLabel(),n=qfSets.get(l);let o="<p><b>"+r+"</b></p>";o+=Html.selectList("qfList",n.flags,n.flag_descriptions,i);ui.showDlg("Assign Quality Flags",o,Html.dlgBtn(s));$("qfList").size=Math.min(10,n.flags.length)}dlgSetDisabled(t){if(t<0||t>1)return;let e=new Map;let i=this.dlgArr[t].querySelectorAll("button"),s,a=i.length;for(s=0;s<a;++s){e.set(i[s],i[s].disabled);i[s].disabled=true}if(t==1)this.dlgOrigDisabledByEl1=new Map(e);else this.dlgOrigDisabledByEl2=new Map(e)}dlgUnsetDisabled(t){if(t<0||t>1)return;let e=t==1?this.dlgOrigDisabledByEl1:this.dlgOrigDisabledByEl2;for(let t of e.keys()){t.disabled=e.get(t)}if(t==1)this.dlgOrigDisabledByEl1=new Map;else this.dlgOrigDisabledByEl2=new Map}dlgValChanged(t,e){let i=this.dlgOrigVals.get(t);if(i==undefined)return false;else return e!=i}dlgYesNoBox(t,e,i,s="ui.hideDlg()"){ui.showDlg(t,"<p>"+e+"</p>",'<p><button class="is-dlgcolor" onClick="'+i+';"><b>Yes</b></button>&emsp;<button class="is-dlgcolor" onClick="'+s+';"><b>No</b></button></p>')}drawCrossHair(t,e,i,s){let a=ui.toHtmlCanvasX(t);let l=ui.toHtmlCanvasY(e);this.ctx.beginPath();this.ctx.moveTo(a-i,l);this.ctx.lineTo(a+i,l);this.ctx.moveTo(a,l-i);this.ctx.lineTo(a,l+i);this.ctx.stroke();ui.drawDot(a,l,1.25*s)}drawCurrGObjPolygon(t,e){if(Math.abs(t)<3&&Math.abs(t)<3)return;let i=viewInfo.gObjInfoArr[this.lclickGObjIdx],s=i.x_coords,a=i.y_coords;let l,r=s.length;ui.clearCanvas();this.ctx.save();this.ctx.setLineDash(Ui.dragOutlinePattern);this.ctx.strokeStyle=Ui.dragOutlineColor;this.ctx.beginPath();this.ctx.moveTo(ui.toHtmlCanvasX(s[0])+t,ui.toHtmlCanvasY(a[0])+e);for(l=1;l<r;l++)this.ctx.lineTo(ui.toHtmlCanvasX(s[l])+t,ui.toHtmlCanvasY(a[l])+e);this.ctx.stroke();this.ctx.restore()}drawCurve(t,e){let i,s=t.length;this.ctx.beginPath();this.ctx.moveTo(ui.toHtmlCanvasX(t[0]),ui.toHtmlCanvasY(e[0]));for(i=1;i<s;i++)this.ctx.lineTo(ui.toHtmlCanvasX(t[i]),ui.toHtmlCanvasY(e[i]));this.ctx.stroke()}drawDiamond(t,e,i){let s=i*55/100,a=s+1;this.ctx.beginPath();this.ctx.moveTo(t,e-a);this.ctx.lineTo(t+s,e);this.ctx.lineTo(t,e+a);this.ctx.lineTo(t-s,e);this.ctx.lineTo(t,e-a);this.ctx.fill();this.ctx.stroke()}drawDot(t,e,i){this.ctx.beginPath();this.ctx.arc(t,e,i,0,2*Math.PI,true);this.ctx.fill();this.ctx.stroke()}drawDots(t,e,i){let s,a=t.length;for(s=0;s<a;s++)ui.drawDot(ui.toHtmlCanvasX(t[s]),ui.toHtmlCanvasY(e[s]),i)}drawDataCurve(t,e){this.ctx.save();ui.clipToRect(t.rect);ui.drawCurve(t.x_coords,t.y_coords);if(e>0)ui.drawDots(t.x_coords,t.y_coords,e);this.ctx.restore()}drawHighlighting(){if(!appState.isReady()||!appState.isCnvsReady())return;const t=2,e=12;ui.clearCanvas();this.ctx.lineWidth=1;this.ctx.strokeStyle="red";this.ctx.fillStyle="red";let i,s,a,l,r;if(this.hlPolylines!=null){s=this.hlPolylines.length;for(i=0;i<s;i++){a=this.highlightStyles[i+1];if(a==3)continue;this.ctx.save();ui.clipToRect(this.hlPolylines[i].rect);if(a==0||a==2)ui.drawCurve(this.hlPolylines[i].x_coords,this.hlPolylines[i].y_coords);if(this.hlDrawDataDots&&(a==1||a==2))ui.drawDots(this.hlPolylines[i].x_coords,this.hlPolylines[i].y_coords,t);this.ctx.restore()}}if(this.hlPoints!=null){s=this.hlPoints.x_coords.length;for(i=0;i<s;i++){l=this.hlPoints.x_coords[i];r=this.hlPoints.y_coords[i];if(Fct.isInsideRect(l,r,this.odvCnvsRects[this.hlPoints.win_ids[i]]))ui.drawCrossHair(l,r,e,t)}}}drawRectOutline(t,e,i,s){ui.clearCanvas();this.ctx.save();this.ctx.setLineDash(Ui.dragOutlinePattern);this.ctx.strokeStyle=Ui.dragOutlineColor;this.ctx.strokeRect(t,e,i,s);this.ctx.restore()}drawInvTriangle(t,e,i){let s=i/2+1,a=i*65/100,l=i*4/10;this.ctx.beginPath();this.ctx.moveTo(t-s,e-l);this.ctx.lineTo(t+s,e-l);this.ctx.lineTo(t,e+a);this.ctx.lineTo(t-s,e-l);this.ctx.fill();this.ctx.stroke()}drawPlus(t,e,i){let s=i/2+1;this.ctx.beginPath();this.ctx.moveTo(t-s,e);this.ctx.lineTo(t+s,e);this.ctx.moveTo(t,e-s);this.ctx.lineTo(t,e+s);this.ctx.stroke()}drawPointGetterPoly(){let t,e=this.ptgCnvsX.length;if(e==0)return;const i=4;ui.clearCanvas();this.ctx.fillStyle="white";this.ctx.strokeStyle="red";this.ctx.lineWidth="2";this.ctx.beginPath();this.ctx.moveTo(this.ptgCnvsX[0],this.ptgCnvsY[0]);for(t=1;t<e;++t){this.ctx.lineTo(this.ptgCnvsX[t],this.ptgCnvsY[t])}this.ctx.lineTo(this.currCnvsX,this.currCnvsY);this.ctx.stroke();this.ctx.strokeStyle="gray";this.ctx.lineWidth=1;for(t=0;t<e;++t){ui.drawDot(this.ptgCnvsX[t],this.ptgCnvsY[t],i)}}drawQuickZoomRect(){let t=Math.abs(this.currCnvsX-this.beginCnvsX);let e=Math.abs(this.currCnvsY-this.beginCnvsY);if(t<2&&e<2)return;ui.clearCanvas();this.ctx.beginPath();this.ctx.moveTo(this.currCnvsX,this.currCnvsY);this.ctx.lineTo(this.currCnvsX,this.beginCnvsY);this.ctx.lineTo(this.beginCnvsX,this.beginCnvsY);this.ctx.lineTo(this.beginCnvsX,this.currCnvsY);this.ctx.lineTo(this.currCnvsX,this.currCnvsY);this.ctx.stroke()}drawSquare(t,e,i){let s=i*45/100;this.ctx.beginPath();this.ctx.moveTo(t-s,e-s);this.ctx.lineTo(t+s,e-s);this.ctx.lineTo(t+s,e+s);this.ctx.lineTo(t-s,e+s);this.ctx.lineTo(t-s,e-s);this.ctx.fill();this.ctx.stroke()}drawStar(t,e,i){let s=i*60/100,a=s-1;this.ctx.beginPath();this.ctx.moveTo(t-s,e);this.ctx.lineTo(t+s,e);this.ctx.moveTo(t,e-s);this.ctx.lineTo(t,e+s);this.ctx.moveTo(t-a,e-a);this.ctx.lineTo(t+a,e+a);this.ctx.moveTo(t-a,e+a);this.ctx.lineTo(t+a,e-a);this.ctx.stroke()}drawSymbol(t,e,i,s){switch(t){case 0:ui.drawDot(e,i,s/2);break;case 1:ui.drawSquare(e,i,s);break;case 2:ui.drawDiamond(e,i,s);break;case 3:ui.drawTriangle(e,i,s);break;case 4:ui.drawInvTriangle(e,i,s);break;case 5:ui.drawStar(e,i,s);break;case 6:ui.drawX(e,i,s);break;case 7:ui.drawPlus(e,i,s);break}}drawTriangle(t,e,i){let s=i/2+1,a=i*65/100,l=i*4/10;this.ctx.beginPath();this.ctx.moveTo(t-s,e+l);this.ctx.lineTo(t+s,e+l);this.ctx.lineTo(t,e-a);this.ctx.lineTo(t-s,e+l);this.ctx.fill();this.ctx.stroke()}drawX(t,e,i){let s=i*55/100;this.ctx.beginPath();this.ctx.moveTo(t-s,e-s);this.ctx.lineTo(t+s,e+s);this.ctx.moveTo(t-s,e+s);this.ctx.lineTo(t+s,e-s);this.ctx.stroke()}drawZoomRect(){const t=this.zoomPixTol-6;ui.clearCanvas();this.ctx.fillStyle="white";this.ctx.strokeStyle="red";this.ctx.lineWidth=2;this.ctx.beginPath();this.ctx.moveTo(this.zoomCnvsLeft,this.zoomCnvsBottom);this.ctx.lineTo(this.zoomCnvsRight,this.zoomCnvsBottom);this.ctx.lineTo(this.zoomCnvsRight,this.zoomCnvsTop);this.ctx.lineTo(this.zoomCnvsLeft,this.zoomCnvsTop);this.ctx.lineTo(this.zoomCnvsLeft,this.zoomCnvsBottom);this.ctx.stroke();this.ctx.strokeStyle="gray";this.ctx.lineWidth=1;let e=appState.current();if(e==AppState.Zooming){ui.drawDot(this.zoomCnvsLeft,this.zoomCnvsBottom,t);ui.drawDot(this.zoomCnvsRight,this.zoomCnvsBottom,t);ui.drawDot(this.zoomCnvsRight,this.zoomCnvsTop,t);ui.drawDot(this.zoomCnvsLeft,this.zoomCnvsTop,t)}if(e==AppState.Zooming||e==AppState.ZZoomingVer){ui.drawDot(.5*(this.zoomCnvsLeft+this.zoomCnvsRight),this.zoomCnvsBottom,t);ui.drawDot(.5*(this.zoomCnvsLeft+this.zoomCnvsRight),this.zoomCnvsTop,t)}if(e==AppState.Zooming||e==AppState.ZZoomingHor){ui.drawDot(this.zoomCnvsLeft,.5*(this.zoomCnvsBottom+this.zoomCnvsTop),t);ui.drawDot(this.zoomCnvsRight,.5*(this.zoomCnvsBottom+this.zoomCnvsTop),t)}}drvdVarChoice(e){for(let t=0;t<this.drvdVarChoices.length;++t){if(this.drvdVarChoices[t].type==e)return this.drvdVarChoices[t]}}enableMenu(t){let o=coll.accessMode=="RW",d=coll.isCollection(),c,m;let u,p,g,h=false,v=false,f,b;let D;if(this.rclickWinId>0)D=view.dataWinArr[this.rclickWinId-1];switch(t){case"AssignQfMenu":c=this.rclickTblItem.row;h=o&&coll.isBasicDataVar(this.dockDataVarIds[c]);Fct.setElemEnabled("miAssignQfCurrSmpl",h);Fct.setElemEnabled("miAssignQfCurrStat",h);Fct.setElemEnabled("miAssignQfValStat",h);Fct.setElemEnabled("miAssignQfAllStat",h);for(f=1;f<=view.dataWinArr.length;++f){b=$("miAssignQfWin:"+f);if(b!=null)Fct.setElemEnabledC(b,h)}break;case"AssignQfMvMenu":c=this.rclickTblItem.row;m=coll.metaVars.varArr[this.dockMetaVarIds[c]];h=o&&m.varType!="METAACCESSIONNUMBER";Fct.setElemEnabled("miAssignQfMvCurrStat",h);Fct.setElemEnabled("miAssignQfMvValStat",h);Fct.setElemEnabled("miAssignQfMvAllStat",h);break;case"CollectionMenu":Fct.setElemEnabled("miCollCopy",o);Fct.setElemEnabled("miCreateSnapshot",o);Fct.setElemEnabled("miCollRename",o&&appState.isSingleSession);Fct.setElemEnabled("miCollBrowseAgreement",coll.usageAgreementText.length>0);Fct.setElemEnabled("miCollSortCondense",o&&appState.isSingleSession);Fct.setElemEnabled("miCollDeleteCurrStation",o&&appState.isSingleSession);Fct.setElemEnabled("miCollDeleteStationSubset",o&&appState.isSingleSession);Fct.setElemEnabled("miIdentifyKeyVariables",o&&appState.isSingleSession);Fct.setElemEnabled("miGoodCoverageCriteria",o&&appState.isSingleSession);Fct.setElemEnabled("miCollPropsGeneral",o&&appState.isSingleSession);Fct.setElemEnabled("miCollPropsMetaVariables",o&&appState.isSingleSession);Fct.setElemEnabled("miCollPropsDataVariables",o&&appState.isSingleSession);Fct.setElemEnabled("miCreateOverviewPlots",d);break;case"CurrStatMenu":Fct.setElemEnabled("miCurrStatByAccession",this.currStatAccNum!=App.missUINT);break;case"CurrStatTbMenu":Fct.setElemEnabled("miBrowseHistory",coll.format=="ODVCF6");break;case"CwLayoutMenu":case"DwLayoutMenu":case"MwLayoutMenu":h=view.getGObjArr(this.rclickWinId).length>0;Fct.setElemEnabled("miGObjMgr",h);break;case"DataWinMenu":Fct.setElemEnabled("miSaveAsInterruptedMapDw",viewInfo.isGeoMap[this.rclickWinId]==1)?true:false;Fct.setElemEnabled("miZZoom",this.colbarCnvsRects[this.rclickWinId].left>-1);break;case"DwExtrasMenu":let l="Not available.";if(D.scope!=3){let t=coll.keyVarIds.indexOf(4);let e=t>-1?coll.keyVarDataVarIds[t]:-1;let i=View.derivedVarType(D.xvId),s=View.derivedVarType(D.yvId);let a=D.xvId==coll.primaryVarId?D.yvId:D.xvId;h=D.xvId==e&&(s==104||s==1)||i==101&&s==105;v=D.xvId==coll.primaryVarId||D.yvId==coll.primaryVarId;if(v)l="Estimates "+coll.dataVarNameLabel(a)+" values at user-specified "+coll.primaryVar().uname+" values, using piece-wise linear least squares."}Fct.setElemEnabled("mi1DEstimation",v);Fct.setElemEnabled("mi2DEstimation",D.isGridding());Fct.setElemEnabled("miDefPatch",D.scope!=3);Fct.setElemEnabled("miIsopynals",h);this.menuItemDescriptions.set("mi1DEstimation",l);break;case"FindOutliersMenu":Fct.setElemEnabled("miOutlierRangeCheck",o);Fct.setElemEnabled("miOutlierSpikeCheck",o);break;case"GObjAddMenu":Fct.setElemEnabled("miAddSymbolSet",this.rclickWinId>-1);break;case"GObjActMenu":let t=viewInfo.gObjInfoArr[this.rclickGObjIdx],e=t.win_id;let i=t.non_template_index,s=view.getGObjArr(e);let a=s.length,r=t.automatic,n=s[i];Fct.setElemEnabled("miGObjExpCurrent",n.canBeExported());Fct.setElemEnabled("miGObjCopy",n.canBeCopied());Fct.setElemEnabled("miGObjDelete",n.canBeDeleted());Fct.setElemEnabled("miGObjMoveTop",!r&&i>0);Fct.setElemEnabled("miGObjMoveUp",!r&&i>0);Fct.setElemEnabled("miGObjMoveDwn",!r&&i<a-1);Fct.setElemEnabled("miGObjMoveBot",!r&&i<a-1);Fct.setElemEnabled("miGObjProps",n.canBeEdited());break;case"GObjExpDwMenu":break;case"GObjExpMwMenu":break;case"GObjExpContours":h=D.drawContours=="T"&&D.contours.length>0;Fct.setElemEnabled("miGObjExpContoursFile",h);Fct.setElemEnabled("miGObjExpContoursCb",h);break;case"GObjExpSecBathy":h=view.section.isValid()&&view.section.bathyType>0;Fct.setElemEnabled("miGObjExpSecBathyFile",h);Fct.setElemEnabled("miGObjExpSecBathyCb",h);break;case"GObjExpSecStatLbls":h=view.section.isValid();Fct.setElemEnabled("miGObjExpSecStatLblsFile",h);Fct.setElemEnabled("miGObjExpSecStatLblsCb",h);break;case"GObjExpStatDots":h=viewInfo.valStationCount>0;Fct.setElemEnabled("miGObjExpStatDotsFile",h);Fct.setElemEnabled("miGObjExpStatDotsCb",h);break;case"GObjExpStatSelPoly":h=view.statFilter.xPoly.length>0;Fct.setElemEnabled("miGObjExpStatSelPolyFile",h);Fct.setElemEnabled("miGObjExpStatSelPolyCb",h);break;case"MapMenu":Fct.setElemEnabled("miSaveAsInterruptedMap",true);break;case"MetaVarMenu":p=this.dockMetaVarIds[this.rclickTblItem.row];g=p>-1?coll.metaVar(p).valType:"FLOAT";Fct.setElemEnabled("miCollectStrValsMv",!(g=="FLOAT"||g=="DOUBLE"));break;case"MetaValMenu":Fct.setElemEnabled("miEditMetadata",o);break;case"PickedStatMenu":u=view.pickId(this.currStatId)>-1;Fct.setElemEnabled("miPickListAdd",!u);Fct.setElemEnabled("miPickListRemove",u);u=view.pickedStatArr.length>0;Fct.setElemEnabled("miPickListClear",u);Fct.setElemEnabled("miPickListEdit",u);break;case"SectionMenu":u=view.section.isValid();Fct.setElemEnabled("miRemoveSection",u);Fct.setElemEnabled("miSaveSectionAs",u);Fct.setElemEnabled("miSectionProperties",u);break;case"SmplInfoValMenu":u=o&&coll.format=="ODVCF6"&&coll.isBasicDataVar(this.dockDataVarIds[this.rclickTblItem.row]);Fct.setElemEnabled("miEditInfoVal",u);break;case"SmplNameMenu":p=this.dockDataVarIds[this.rclickTblItem.row];g=coll.isBasicDataVar(p)?coll.dataVar(p).valType:"FLOAT";Fct.setElemEnabled("miDataAvailCollection",d);Fct.setElemEnabled("miDataAvailStationSet",d);Fct.setElemEnabled("miDataAvailCruise",d);Fct.setElemEnabled("miDataAvailStation",d);Fct.setElemEnabled("miDisplayOrder",d);Fct.setElemEnabled("miCollectStrValsDv",!(!d||g=="FLOAT"||g=="DOUBLE"));break;case"SmplValMenu":u=o&&coll.isBasicDataVar(this.dockDataVarIds[this.rclickTblItem.row]);Fct.setElemEnabled("miEditData",u);Fct.setElemEnabled("miEditSampleData",o);break;case"SmplFilterMenu":u=this.rclickWinId==-10||this.rclickWinId>0;Fct.setElemEnabled("miSmplFilterRelax",u);Fct.setElemEnabled("miSmplFilterNoOutliers",u);Fct.setElemEnabled("miSmplFilter",u);break;case"ToolsMenu":Fct.setElemEnabled("miFindDuplicates",o&&appState.isSingleSession);break}}enableGObjFromClipboardOption(t){Fct.setElemEnabled("miGObjFromClipboard",t.includes("<GraphicsObjects>"))}finishPointGetting(t=false){ui.restoreOldState();appState.leave(AppState.Ready);addEventListener("contextmenu",app.onRightClick);Ui.onFinishPointGetterFct(this.ptgCnvsX.length>=this.ptgMinPtCount?t:false)}finishPointGettingOrZooming(t){if(appState.isState(AppState.PointGetter))this.finishPointGetting(t);else if(appState.isZooming())this.finishZooming(t)}finishZooming(t){if(!appState.isZooming())return;let e=appState.current();ui.restoreOldState();addEventListener("contextmenu",app.onRightClick);if(!t)return;if(e==AppState.Zooming){let e=ui.toOdvCanvasX(this.zoomCnvsLeft);let i=ui.toOdvCanvasX(this.zoomCnvsRight);let s=ui.toOdvCanvasY(this.zoomCnvsTop);let a=ui.toOdvCanvasY(this.zoomCnvsBottom);if(Ui.onFinishZoomFct==undefined){if(this.currMiOption=="miZoom"){let t=0;if(this.zoomCnvsLeft==this.zoomCnvsLeftBegin){e=App.missINT;++t}if(this.zoomCnvsRight==this.zoomCnvsRightBegin){i=App.missINT;++t}if(this.zoomCnvsTop==this.zoomCnvsTopBegin){s=App.missINT;++t}if(this.zoomCnvsBottom==this.zoomCnvsBottomBegin){a=App.missINT;++t}if(t<4)app.sendWsMsg(Msg.zoom(this.zoomWinId,e,s,i,a)+","+Msg.msgGetCanvasCurrInfo)}else if(this.currMiOption=="miMoveResize"||this.currMiOption=="miDwMoveResize")app.sendWsMsg(Msg.updateGeometry(this.zoomWinId,e,s,i,a)+","+Msg.msgGetCanvasCurrInfo)}else{if(this.currMiOption.startsWith("miAddEllipse"))Fct.ellipsePathFromRect(this.zoomCnvsLeft,this.zoomCnvsRight,this.zoomCnvsBottom,this.zoomCnvsTop,this.ptgCnvsX,this.ptgCnvsY);else Fct.rectPathFromRect(this.zoomCnvsLeft,this.zoomCnvsRight,this.zoomCnvsBottom,this.zoomCnvsTop,this.ptgCnvsX,this.ptgCnvsY);Ui.onFinishZoomFct(t)}}else if(e==AppState.ZZoomingHor){let t=view.dataWinArr[this.zoomWinId-1];let e=t.zBottom,i=this.colbarCnvsRects[this.zoomWinId].left;let s=(t.zTop-e)/(this.colbarCnvsRects[this.zoomWinId].right-i);let a=e+s*(ui.toOdvCanvasX(this.zoomCnvsLeft)-i);let l=e+s*(ui.toOdvCanvasX(this.zoomCnvsRight)-i);app.sendWsMsg(Msg.zZoom(this.zoomWinId,a,l)+","+Msg.msgGetCanvasCurrInfo)}else if(e==AppState.ZZoomingVer){let t=view.dataWinArr[this.zoomWinId-1];let e=t.zBottom,i=this.colbarCnvsRects[this.zoomWinId].bottom;let s=(t.zTop-e)/(this.colbarCnvsRects[this.zoomWinId].top-i);let a=e+s*(ui.toOdvCanvasX(this.zoomCnvsBottom)-i);let l=e+s*(ui.toOdvCanvasX(this.zoomCnvsTop)-i);app.sendWsMsg(Msg.zZoom(this.zoomWinId,a,l)+","+Msg.msgGetCanvasCurrInfo)}}getLastOpenElem(t){return this.dlgLastOpenElems.has(t)?this.dlgLastOpenElems.get(t):1}gObjectsAt(t,e){if(this.imgOdvCnvsLeft==-1)return"";let i=[],s,a,l=viewInfo.gObjInfoArr.length,r="";this.currGObjIdx=-1;for(a=0;a<l;++a){s=viewInfo.gObjInfoArr[a];if(Fct.isInsidePolygon(t,e,s.x_coords,s.y_coords)){r=Ui.windowNameAbbrev(s.win_id,true)+"."+(s.index+1);if(i.indexOf(r)==-1)i.push(r);if(this.currGObjIdx==-1)this.currGObjIdx=a}}return i.join(", ")}hideDlg(t=false){let e=this.currDlgIdx;if(e<0)return;let i=t?-1:e-1;while(e>i){this.dlgArr[e].style.display="none";this.dlgContentsArr[e].innerHTML="";this.dlgMessageArr[e].innerHTML="";--this.currDlgIdx;--e;this.dlgUnsetDisabled(e)}if(e==-1){this.popupBckgrd.style.display="none";appState.leave(AppState.Popup)}Ui.onHideDlgFct();Ui.onHideDlgFct=Fct.noOpFct}hideInterface(){ui.hideDlg(true);ui.hideMenus();this.gridContainer.style.display="none"}hideMenus(t=-1){while(this.visibleMenuNames.length>t+1){let t=$(this.visibleMenuNames.pop());t.style.display="none";t.innerHTML="";if(this.visibleMenuNames.length==0){t.remove();appState.leave(AppState.Menu)}}this.updateSbInfoPane("")}isClickable(t){let e=false,i=t.tbl,s=t.row,a=t.col;if(i=="D1"&&a==1)e=this.dockMetaValueClickableFlags[s]==1?true:false;else if(i=="D2"&&a==0)e=this.dockDataVarLabelClickableFlags[s]==1?true:false;else if(i=="D2"&&a==1)e=this.dockDataValueClickableFlags[s]==1?true:false;else if(i=="D2"&&a==3)e=this.dockDataInfoValueClickableFlags[s]==1?true:false;return e}isInsideWindow(t,e,i){let s=this.odvCnvsPolygons[i];let a=s.x_coords,l=s.y_coords,r=a.length;if(r>5)return Fct.isInsidePolygon(t,e,a,l);else return Fct.isInsideRect(t,e,this.odvCnvsRects[i])}menuItem(t){return this.menuItemHtmls.get(t)}newMenuItem(t,e,i,s,a=true){this.menuItemHtmls.set(t,Html.menuItem(t,e,i,s,a))}newMenuItemStr(t,e,i,s,a=true){let l=Html.menuItem(t,e,i,s,a);this.menuItemHtmls.set(t,l);return l}onAssignQf(){ui.dlgOrigVals.set("qfVal",Fct.selectedStr("qfList",""));ui.hideDlg();switch(ui.dlgOrigVals.get("assignQfMode")){case"miAssignQfCurrStat":case"miAssignQfValStat":case"miAssignQfAllStat":case"miAssignQfWin":case"miAssignQfMvValStat":case"miAssignQfMvAllStat":ui.dlgYesNoBox("Change Quality Flags","Really want to change many quality flags?","ui.onAssignQfYn()");break;default:Ui.onAssignQfC();break}}static onAssignQfC(){let t="current_sample";switch(ui.dlgOrigVals.get("assignQfMode")){case"miAssignQfCurrStat":case"miAssignQfMvCurrStat":t="current_station";break;case"miAssignQfValStat":case"miAssignQfMvValStat":t="valid_stations";break;case"miAssignQfAllStat":case"miAssignQfMvAllStat":t="collection";break;case"miAssignQfWin":t="window_"+ui.dlgOrigVals.get("winId");break}let e=ui.dlgOrigVals.get("varGroup")==1?"assign_quality_flag_value":"assign_metadata_quality_flag_value";let i='{"cmd":"'+e+'","var_id":'+ui.dlgOrigVals.get("varId")+',"context":"'+t+'","new_value":"'+ui.dlgOrigVals.get("qfVal")+'"}';app.sendWsMsg(i+","+Msg.msgGetCanvas+","+Msg.msgGetDockDataVarVals+","+Msg.msgGetCurrInfo)}onAssignQfYn(){ui.hideDlg();Ui.onAssignQfC()}paletteIndex(t){let e=this.paletteNames.indexOf(t);if(e==-1)e=this.paletteNames.indexOf("Odv");return e}placeDlg(t,e,i){if(t==undefined)t=this.currDlgIdx;let s=this.dlgArr[t];let a=this.currDlgIdx==0?this.popupBckgrd:this.dlgArr[this.currDlgIdx-1];if(e==undefined)e=a.offsetLeft+.5*(a.clientWidth-s.clientWidth);if(i==undefined)i=a.offsetTop+.5*(a.clientHeight-s.clientHeight);e=Math.max(0,Math.min(e,window.innerWidth-s.clientWidth));i=Math.max(0,Math.min(i,window.innerHeight-s.clientHeight));s.style.left=e+"px";s.style.top=i+"px"}rememberPenAndBrushStyles(){this.ctxLineWidth=this.ctx.lineWidth;this.ctxStrokeStyle=this.ctx.strokeStyle;this.ctxFillStyle=this.ctx.fillStyle}restoreOldState(){this.sbPaneLeft.innerText="";this.sbPaneLeft.style.display="none";this.sbPaneRight.innerText="";this.sbPaneRight.style.display="none";document.body.style.cursor="default";appState.leave();appState.isZoomDragging=false;this.zoomSpotId=-1;ui.restorePenAndBrushStyles();this.drawHighlighting()}restorePenAndBrushStyles(){this.ctx.lineWidth=this.ctxLineWidth;this.ctx.strokeStyle=this.ctxStrokeStyle;this.ctx.fillStyle=this.ctxFillStyle}scaledCnvsRect(t,e){let i={left:0,top:0,right:this.imgOdvCnvsRight,bottom:this.imgOdvCnvsBottom};if(t>=0)i={...this.odvCnvsRects[t]};let s=.5*(i.right+i.left),a=.5*(i.bottom+i.top);let l=.5*(i.right-i.left)*e,r=.5*(i.bottom-i.top)*e;i.left=s-l;i.top=a-r;i.right=s+l;i.bottom=a+r;return i}setAccessMode(t){if(t==undefined)return;coll.accessMode=t;this.sbAccessPane.innerHTML='<div style="text-align: center">'+coll.accessMode+"</div>"}setLastOpenElem(t,e){this.dlgLastOpenElems.set(t,e);let i=JSON.stringify([...this.dlgLastOpenElems]);localStorage.setItem("_settings/lastOpenElems",i)}showAlert(t,e="red"){ui.hideMenus();ui.showDlg("",'<div class="is-'+e+'">'+t+"</div>","")}showDlg(t,e,i){this.showNewPopup(t,e,i,false)}showInterface(){ui.hideDlg(true);let t=$("TbInfoPane");t.innerText=coll.name;t.setAttribute("title",coll.description);let e=Html.mainMenuElem("Collection")+"&emsp;"+Html.mainMenuElem("View");if(!this.disableExports)e+="&emsp;"+Html.mainMenuElem("Export");if(coll.accessMode=="RW")e+="&emsp;"+Html.mainMenuElem("Tools");e+="&emsp;"+Html.mainMenuElem("Help");$("TbMenuPane").innerHTML=e;ui.setAccessMode(coll.accessMode);let i=null;if(i==null){let t=Math.min(14,coll.metaVarCount()-8);let e=Math.min(40,coll.dataVarCount()),i=4;let s=1*(t+e+i);this.smplLstFract=e/s;this.isovLstFract=i/s}else{let t=i.split(";");this.cnvsFract=parseFloat(t[0]);this.smplLstFract=parseFloat(t[1]);this.isovLstFract=parseFloat(t[2])}ui.updateGridLayout();this.gridContainer.style.display="grid";app.sendWsMsg(Msg.msgGetCanvasCurrInfo)}showMainMenu(t){ui.hideMenus();let e=$(t+"Span");ui.showMenu(t+"Menu",e.offsetLeft,e.offsetTop+e.offsetHeight)}showMenu(t,e,i){let s=Fct.createMenu(t,Ui.menuWidth[t]);s.innerHTML=Html.menu(t);ui.enableMenu(t);i-=8;s.style.display="block";appState.enter(AppState.Menu);let a=i+s.clientHeight+30-window.innerHeight;if(a>0)i-=a;a=e+s.clientWidth+20-window.innerWidth;if(a>0)e-=a;s.style.left=e+"px";s.style.top=i+"px";ui.visibleMenuNames.push(t)}showMsg(t,e,i){this.showNewPopup(t,e,i,true)}showNewPopup(t,e,i,s){if(e.length==0)return;if(this.currDlgIdx==-1)appState.enter(AppState.Popup);if(this.currDlgIdx==0||this.currDlgIdx==1)this.dlgSetDisabled(this.currDlgIdx);this.currDlgIdx=Math.min(++this.currDlgIdx,2);let a=this.currDlgIdx;Fct.setElemDisplay(this.dlgContentsArr[a],!s);Fct.setElemDisplay(this.dlgMessageArr[a],s);this.dlgTitleArr[a].innerHTML=t;Fct.setElemDisplay(this.dlgHeaderArr[a],t.length>0);if(s)this.dlgMessageArr[a].innerHTML=e;else this.dlgContentsArr[a].innerHTML=e;this.dlgFooterArr[a].innerHTML=i;Fct.setElemDisplay(this.dlgFooterArr[a],i.length>0);this.popupBckgrd.style.display="block";this.dlgArr[a].style.display="block";this.placeDlg()}showSubMenu(t){if(this.visibleMenuNames.length==0||this.visibleMenuNames.indexOf(t)>-1)return;let e=$(t),i=this.visibleMenuNames.length;e.style.display="block";e.innerHTML=Html.menu(t);let s=e.clientHeight,a=e.clientWidth,l=0;let r=$(this.visibleMenuNames[i-1]);let n=$(this.visibleMenuNames[0]);ui.enableMenu(t);if(n==null){let t="error"}l=n.offsetTop+n.offsetHeight+s+16-window.innerHeight;let o=l>0?-1*s+6:-20;if(l>0&&n.offsetTop-s<0)o/=2;l=r!=null?r.offsetLeft+r.offsetWidth+a+16-window.innerWidth:0;e.style.marginTop=o+"px";if(l>0){a+=e.offsetParent.offsetWidth-17;e.style.marginLeft="-"+a+"px"}this.visibleMenuNames.push(t)}showUsageAgreement(){this.gridContainer.style.display="none";Ui.onHideDlgFct=function(){app.sendWsMsg('{"cmd":"logout_request"}')};this.showMsg(coll.name+" - Data Usage Agreement",coll.usageAgreementText,Html.dlgBtn("app.onUsageAgree()","I Agree"))}startIsAlivePolling(){ui.clearIsAlivePolling();if(Ui.isAliveTimeoutMilliSecs>0)Ui.isAliveTimeoutId=setTimeout(()=>{app.sendWsMsg('{"cmd":"is_alive"}')},Ui.isAliveTimeoutMilliSecs)}startPointGetting(t,e=2,i=1500){appState.enter(AppState.Ready);appState.enter(AppState.PointGetter);this.ptgWinId=this.rclickWinId;this.ptgMinPtCount=e;this.ptgMaxPtCount=i;this.ptgCnvsX.length=0;this.ptgCnvsY.length=0;ui.clearCanvas();document.body.style.cursor="crosshair";Ui.onFinishPointGetterFct=t;this.sbPaneLeft.innerHTML="<div class='is-red'><button class='is-red' title='Applies the entered points' onClick='ui.finishPointGetting(true);'><b>Apply</b></button>&emsp;<button class='is-red' title='Cancels the operation' onClick='ui.finishPointGetting(false);'><b>Cancel</b></button> &emsp;<b>Get Points.</b> left mouse click: add point; right mouse click: remove last point</div>";this.sbPaneLeft.style.display="block";this.sbPaneRight.innerHTML="";this.sbPaneRight.style.display="block";removeEventListener("contextmenu",app.onRightClick)}startWaiting(t,e="<b>Processing...</b>"){if(appState.waitingForCmd.length==0){document.body.classList.add("Waiting");appState.waitingForCmd=t;this.showAlert(e)}}startZooming(t,e,i){if(t.left==-1)return;appState.enter(e);this.zoomWinId=this.rclickWinId;this.zoomCnvsLeft=this.zoomCnvsLeftBegin=ui.toHtmlCanvasX(t.left);this.zoomCnvsRight=this.zoomCnvsRightBegin=ui.toHtmlCanvasX(t.right);this.zoomCnvsTop=this.zoomCnvsTopBegin=ui.toHtmlCanvasY(t.top);this.zoomCnvsBottom=this.zoomCnvsBottomBegin=ui.toHtmlCanvasY(t.bottom);this.zoomZBottom=App.missDOUBLE;this.zoomZTop=App.missDOUBLE;if(this.zoomWinId>0&&(e==AppState.ZZoomingHor||e==AppState.ZZoomingVer)){let t=view.dataWinArr[this.zoomWinId-1];this.zoomZBottom=t.zBottom;this.zoomZTop=t.zTop}ui.rememberPenAndBrushStyles();this.zoomSpotId=-1;ui.drawZoomRect();ui.updateZoomPane();ui.updateSbCurrPos();Ui.onFinishZoomFct=i;this.sbPaneLeft.innerHTML="<div class='is-red'><button class='is-red' title='Applies the current zoom rectangle' onClick='ui.finishZooming(true);'><b>Apply</b></button>&emsp;<button class='is-red' title='Cancels the zoom operation' onClick='ui.finishZooming(false);'><b>Cancel</b></button> &emsp;<b>Zooming:</b>  click and hold left mouse button to drag zoom rectangle, corners or edges</div>";this.sbPaneLeft.style.display="block";this.sbPaneRight.style.display="block";removeEventListener("contextmenu",app.onRightClick)}stopWaiting(t){if(appState.waitingForCmd.length>0&&(t==undefined||t===appState.waitingForCmd)){document.body.classList.remove("Waiting");appState.waitingForCmd="";ui.hideDlg()}}static tableItem(t){let e=t.split(":"),i;let s=e[0],a=parseInt(e[1]),l=parseInt(e[2]);switch(s){case"D1":if(l==0)i=ui.dockMetaVarLabels[a];else if(l==1)i=ui.dockMetaValues[a];break;case"D2":if(l==0)i=ui.dockDataVarLabels[a];else if(l==1)i=ui.dockDataValues[a];else if(l==2)i=ui.dockDataFlags[a];else if(l==3)i=ui.dockDataInfoValues[a];break}return{tbl:s,row:a,col:l,val:i}}static textAlignIdx(t,e){let i,s=Ui.xAlignIdx.length;for(i=0;i<s;++i)if(t==Ui.xAlignIdx[i]&&e==Ui.yAlignIdx[i])return i;return 0}static titleW(t,e){return t+" - "+Ui.windowName(e)}toCmCanvasX(t){return(t-this.imgOdvCnvsLeft)/this.odvPixPerCm}toCmCanvasY(t){return Ui.cmPageHeight-(t-this.imgOdvCnvsTop)/this.odvPixPerCm}toHtmlCanvasX(t){return Math.round((t-this.imgOdvCnvsLeft)/this.odvPixPerHtmlPix)}toHtmlCanvasY(t){return Math.round((t-this.imgOdvCnvsTop)/this.odvPixPerHtmlPix)}toOdvCanvasX(t){return Math.round(this.imgOdvCnvsLeft+t*this.odvPixPerHtmlPix)}toOdvCanvasY(t){return Math.round(this.imgOdvCnvsTop+t*this.odvPixPerHtmlPix)}toUsrX(e,i){let s=App.missDOUBLE;if(i<-1)return s;if(i==-1)return Ui.cmPageWidth*e/ui.imgOdvCnvsRight;let a=i==0?view.mapWin:view.dataWinArr[i-1];let t=viewInfo.isGeoMap[i];if(t&&view.mapWin.prjType==0||!t&&a.xProj==0){let t=this.odvCnvsRects[i];s=a.xLeft+(a.xRight-a.xLeft)*(e-t.left)/(t.right-t.left)}return s}toUsrY(e,i){let s=App.missDOUBLE;if(i<-1)return s;if(i==-1)return Ui.cmPageHeight*(1-e/ui.imgOdvCnvsBottom);let a=i==0?view.mapWin:view.dataWinArr[i-1];let t=viewInfo.isGeoMap[i];if(t&&view.mapWin.prjType==0||!t&&a.yProj==0){let t=this.odvCnvsRects[i];s=a.yBottom+(a.yTop-a.yBottom)*(e-t.bottom)/(t.top-t.bottom)}return s}updateCurrSmplList(t,e){let i=$("CurrSmplListTitleBarInfoPane");i.innerHTML='<b><div id="CurrSmplLbl">Sample: '+Math.min(t,e)+" / "+e+"</div></b>";const s="is-blue has-pointercursor";let a,l,r,n='<table id="CurrSmplTbl" class="has-altbckcolor">';let o,d,c,m,u,p,g,h,v,f,b,D;for(a=0;a<this.dockDataFlags.length;a++){c=this.dockDataInfoValues[a].length>0?"&#x24D8;":"";m=Fct.colorClassFromOdvFlag(this.dockDataOdvFlags[a]);u=m;p=this.dockDataVarIds[a];if(this.dockDataValueClickableFlags[a]==1)u=s;h=this.dockDataValues[a];if(h.length==0)h="no data";b=this.dockDataFlags[a];D=-1;v=0;r=coll.isBasicDataVar(p);o=coll.dataVar(p);if(r){v=o.qfId;d=o.cmt;if(d.length>0){let t=d.split(" | ");g+="\n";for(l=0;l<t.length;++l)g+="\n"+t[l]}}if(qfSets.has(v)){f=qfSets.get(v);D=f.flags.indexOf(b)}g=coll.dataVarFullLabel(p);if(r&&o.cmt.length>0)g+=" - "+o.cmt;g+="\n\nValue:&emsp;"+h;if(D>-1)g+="\nQF:&emsp;"+f.flag_descriptions[D];if(this.dockDataInfoValues[a].length>0)g+="\nINFO:&emsp;"+this.dockDataInfoValues[a];n+="<tr>";n+='<td id="D2:'+a+':0" title="'+g+'"';if(this.dockDataVarLabelClickableFlags[a]==1)n+=' class="'+s+'"';n+=">"+this.dockDataVarLabels[a]+"</td>";n+='<td id="D2:'+a+':1" class="'+u+'">'+this.dockDataValues[a]+"</td>";n+='<td id="D2:'+a+':2" class="'+m+'">'+b+"</td>";n+='<td id="D2:'+a+':3"';if(this.dockDataInfoValueClickableFlags[a]==1)n+=' class="is-bold '+s+'"';n+=">"+c+"</td>";n+="</tr>"}let S=this.currSmplList.scrollTop;this.currSmplList.innerHTML=n+"</table>";this.currSmplList.scrollTop=S}updateCurrStatIsoVarList(e){$("CurrIsoVarListTitleBarInfoPane").innerHTML="<b><div>Isosurface Values</div></b>";let i='<table id="IsovarTbl" class="has-altbckcolor">';for(let t=0;t<e.length;t++){i+='<tr title="'+this.dockIsoVarLabels[t]+": "+e[t]+'"><td id="D3:'+t+':0">'+this.dockIsoVarLabels[t]+'</td><td id="D3:'+t+':1">'+e[t]+"</td></tr>"}let t=this.currIsoVarList.scrollTop;this.currIsoVarList.innerHTML=i+"</table>";this.currIsoVarList.scrollTop=t}updateCurrStatList(t){let e='<b><div id="CurrStatLbl">Station ID: '+t+"</div></b>",i;$("CurrStatListTitleBarInfoPane").innerHTML=e;const s="is-blue has-pointercursor";let a,l,r;e='<table id="CurrStatTbl" class="has-altbckcolor">';for(a=0;a<this.dockMetaValues.length;a++){l=Fct.colorClassFromOdvFlag(this.dockMetaValueOdvFlags[a]);r=l;if(this.dockMetaValueClickableFlags[a]==1)r=s;i=this.dockMetaVarLabels[a]+": "+this.dockMetaValues[a];e+='<tr><td id="D1:'+a+':0" title="'+i+'">'+this.dockMetaVarLabels[a]+'</td><td id="D1:'+a+':1" class="'+r+'">'+this.dockMetaValues[a]+"</td></tr>"}let n=this.currStatList.scrollTop;this.currStatList.innerHTML=e+"</table>";this.currStatList.scrollTop=n}updateGridLayout(){let t=$("odvonline_iframe"),e=extPrms.isDevEnvironment?75:0;if(t==null)t=document.documentElement;this.fullWidth=t.clientWidth-2*this.gridContainer.offsetLeft;let i=t.clientHeight-2*this.gridContainer.offsetTop-e-78;let s=this.cnvsFract*this.fullWidth;this.gridContainer.style.gridTemplateColumns="[cl0] "+s+"px [cl1] "+(this.fullWidth-s)+"px [cl2]";this.gridContainer.style.gridTemplateRows="[rl-1] "+e+"px [rl0] 26px [rl1] 26px [rl2] 1fr [rl3] 26px [rl4] "+this.smplLstFract*i+"px [rl5] 26px [rl6] "+this.isovLstFract*i+"px [rl7] 24px [rl8]";app.onImageReady()}updatePaletteIdx(t,e){let i=$(t),s=i.attributes.idx.value;i.attributes.palidx.value=e;i.attributes.style.value=Html.colorStyle(this.paletteReds[e][s],this.paletteGreens[e][s],this.paletteBlues[e][s])}updatePointGetterCoords(){let t=0,e=2,i=2;let s=this.toOdvCanvasX(this.currCnvsX),a=this.toOdvCanvasY(this.currCnvsY);let l=this.toUsrX(s,this.ptgWinId),r=this.toUsrY(a,this.ptgWinId);if(l==App.missDOUBLE||r==App.missDOUBLE)return;if(this.ptgWinId>=0){t=viewInfo.isGeoMap[this.ptgWinId]?0:this.ptgWinId;e=viewInfo.xDecimals[t]+1;i=viewInfo.yDecimals[t]+1}this.sbPaneRight.innerHTML='<div class="is-red">'+this.ptgCnvsX.length+" / "+this.ptgMaxPtCount+":&emsp;"+l.toFixed(e)+" / "+r.toFixed(i)+"</div>"}updateSbCurrPos(t,e){if(appState.isState(AppState.Waiting))return;if(!(t==undefined||e==undefined)){this.currCnvsX=t;this.currCnvsY=e}let a=[],l="",r="";this.currWinId=-2;if(this.currCnvsX>-1&&this.currCnvsY>-1){let i=ui.toOdvCanvasX(this.currCnvsX),s=ui.toOdvCanvasY(this.currCnvsY);a=this.windowIdsAt(i,s);l=this.gObjectsAt(i,s);this.currWinId=a[a.length-1];if(this.currWinId==0||this.currWinId>0&&viewInfo.dataCountsByWin[this.currWinId-1]>0){let a=this.toUsrX(i,this.currWinId),l=this.toUsrY(s,this.currWinId);if(a!=App.missDOUBLE&&l!=App.missDOUBLE){let t=viewInfo.isGeoMap[this.currWinId]?0:this.currWinId;let i=viewInfo.xDecimals[t];let s=viewInfo.yDecimals[t];if(viewInfo.isGeoMap[this.currWinId]){let t=a<0?"&deg;W":"&deg;E";let e=l<0?"&deg;S":"&deg;N";r=":&emsp;"+Math.abs(a).toFixed(i)+t+" / "+Math.abs(l).toFixed(s)+e}else r=":&emsp;"+a.toFixed(i)+" / "+l.toFixed(s)}}else if(this.currWinId==-1){let t=this.toCmCanvasX(i),e=this.toCmCanvasY(s);r=":&emsp;"+t.toFixed(2)+" / "+e.toFixed(2)}}if(!appState.isReady())return;let i=this.windowNameFromIds(a);if(r.length>0)i+=r;if(l.length>0)i+=" - Object: "+l;this.updateSbInfoPane(i);if(this.currWinId>-1){i=this.currWinId>0?this.filterStatusStrings[this.currWinId]:"";this.sbSmplFilPane.innerHTML="<div>"+i+"</div>"}}updateSbInfoPane(t,e=true){if(e){this.sbInfoPane.classList.remove("has-hovbckcolor");this.sbInfoPane.classList.add("has-panebckcolor");this.sbInfoPane.innerHTML='<div style="float: right">'+t+" &emsp;</div>"}else{this.sbInfoPane.classList.remove("has-panebckcolor");this.sbInfoPane.classList.add("has-hovbckcolor");this.sbInfoPane.innerHTML="<div>"+t+"</div>"}}updateSbModePane(){let t=viewHistory.isModified()?" *":"";this.sbModePane.innerHTML="<div>"+Fct.formattedInt(viewInfo.valStationCount)+" / "+Fct.formattedInt(coll.stationCount)+": "+viewHistory.currentName()+t+"</div>"}updateZoomCoords(){let l=this.toOdvCanvasX(this.zoomCnvsLeft);let r=this.toOdvCanvasY(this.zoomCnvsBottom);let n=this.toUsrX(l,this.zoomWinId),o=this.toUsrY(r,this.zoomWinId);if(n!=App.missDOUBLE&&o!=App.missDOUBLE){l=this.toOdvCanvasX(this.zoomCnvsRight);r=this.toOdvCanvasY(this.zoomCnvsTop);let t=this.toUsrX(l,this.zoomWinId),e=this.toUsrY(r,this.zoomWinId);let i=viewInfo.isGeoMap[this.zoomWinId]?0:this.zoomWinId;let s=viewInfo.xDecimals[i]+1,a=viewInfo.yDecimals[i]+1;this.sbPaneRight.innerHTML='<div class="is-red">LL: '+n.toFixed(s)+" / "+o.toFixed(a)+"&emsp;UR: "+t.toFixed(s)+" / "+e.toFixed(a)+"</div>"}}updateZZoomHorCoords(){let t=this.zoomCnvsLeftBegin,e=this.zoomZBottom;let i=(this.zoomZTop-e)/(this.zoomCnvsRightBegin-t);let s=e+(this.zoomCnvsLeft-t)*i,a=e+(this.zoomCnvsRight-t)*i;let l=viewInfo.zDecimals[this.zoomWinId]+1;this.sbPaneRight.innerHTML='<div class="is-red">Z-Range: '+s.toFixed(l)+" - "+a.toFixed(l)+"</div>"}updateZZoomVerCoords(){let t=this.zoomCnvsBottomBegin,e=this.zoomZBottom;let i=(this.zoomZTop-e)/(this.zoomCnvsTopBegin-t);let s=e+(this.zoomCnvsBottom-t)*i,a=e+(this.zoomCnvsTop-t)*i;let l=viewInfo.zDecimals[this.zoomWinId]+1;this.sbPaneRight.innerHTML='<div class="is-red">Z-Range: '+s.toFixed(l)+" - "+a.toFixed(l)+"</div>"}updateZoomPane(){let t=appState.current();if(t==AppState.Zooming)ui.updateZoomCoords();else if(t==AppState.ZZoomingHor)ui.updateZZoomHorCoords();else if(t==AppState.ZZoomingVer)ui.updateZZoomVerCoords()}updateZoomSpot(){let t,e,i,s;t=e=i=s=false;let a=appState.current();if(a==AppState.Zooming||a==AppState.ZZoomingHor){t=Math.abs(this.currCnvsX-this.zoomCnvsLeft)<=this.zoomPixTol;e=Math.abs(this.currCnvsX-this.zoomCnvsRight)<=this.zoomPixTol}if(a==AppState.Zooming||a==AppState.ZZoomingVer){i=Math.abs(this.currCnvsY-this.zoomCnvsBottom)<=this.zoomPixTol;s=Math.abs(this.currCnvsY-this.zoomCnvsTop)<=this.zoomPixTol}let l=this.currCnvsX>=this.zoomCnvsLeft&&this.currCnvsX<=this.zoomCnvsRight;let r=this.currCnvsY>=this.zoomCnvsTop&&this.currCnvsY<=this.zoomCnvsBottom;if(t&&i){this.zoomSpotId=1;document.body.style.cursor="ne-resize"}else if(e&&s){this.zoomSpotId=2;document.body.style.cursor="ne-resize"}else if(e&&i){this.zoomSpotId=3;document.body.style.cursor="nw-resize"}else if(t&&s){this.zoomSpotId=4;document.body.style.cursor="nw-resize"}else if(s&&l){this.zoomSpotId=5;document.body.style.cursor="n-resize"}else if(t&&r){this.zoomSpotId=6;document.body.style.cursor="e-resize"}else if(i&&l){this.zoomSpotId=7;document.body.style.cursor="n-resize"}else if(e&&r){this.zoomSpotId=8;document.body.style.cursor="e-resize"}else if(l&&r){this.zoomSpotId=9;document.body.style.cursor="move"}else{this.zoomSpotId=-1;document.body.style.cursor="default"}}windowIdAt(t,e){if(this.imgOdvCnvsLeft==-1)return-1e3;let i=this.windowIdsAt(t,e),s=i.length;return s>0?i[s-1]:-1}windowIdAtHtmlCoords(t,e){return this.windowIdAt(ui.toOdvCanvasX(t),ui.toOdvCanvasY(e))}windowIdsAt(t,e){let i,s=this.odvCnvsRects.length,a=[];if(this.imgOdvCnvsLeft==-1)return a;if(this.isInsideWindow(t,e,0)==true){a.push(0);return a}for(i=1;i<s;i++){if(this.isInsideWindow(t,e,i)==true)a.push(i)}if(a.length==0)a.push(-1);return a}static windowName(t){if(t==-1)return"Canvas";else if(t==0)return"Map";else if(t>0)return"Window "+t;else return""}static windowNameAbbrev(t,e=false){if(t==0)return"M";else if(t>0)return e?t.toString():"D";else return"C"}windowNameFromIds(t){let e=t.length;if(e==1)return Ui.windowName(t[0]);else if(e>1)return"Window "+t[e-1]+" on "+t[e-2];else return""}}class XSelector{constructor(t,e=false,i=true){this.itArr=t;this.multiSelect=e;this.ignoreFirst=i}clear(){this.itArr.map(t=>t.classList.remove("is-selected"))}firstSelection(){let t=this.selections();return t.length>0?t[0]:-1}invert(){this.itArr.map(t=>t.classList.toggle("is-selected"));if(this.ignoreFirst)this.itArr[0].classList.remove("is-selected")}scrollTo(t){this.itArr[t].scrollIntoView({block:"center"})}select(a,t=false,e=false){if(t&&this.multiSelect){let t=this.selections(),e,i=a,s=a;if(t.length>0){e=t[Fct.closestIndexOf(t,a)];i=Math.min(a,e);s=Math.max(a,e)}this.clear();for(e=i;e<=s;++e)this.itArr[e].classList.add("is-selected")}else if(e&&this.multiSelect){this.itArr[a].classList.toggle("is-selected")}else{this.clear();this.itArr[a].classList.add("is-selected")}}selectAll(){this.clear();this.invert()}selections(){let i=[];this.itArr.map((t,e)=>{if(t.classList.contains("is-selected"))i.push(e)});return i}selectedCount(){return this.selections().length}size(){let t=this.itArr.length;if(this.ignoreFirst)--t;return t}}"use strict";class Html{static LeftArrow="&#x02C2;";static RightArrow="&#x02C3;";static UpArrow="&#x02C4;";static DownArrow="&#x02C5;";static button(t,e,i,s){let a='<button onClick="'+e+';"';if(i!=undefined)a+=' id="'+i+'"';if(s==true)a+=' class="is-fullwidth"';return a+">"+t+"</button>"}static canvas(t,e,i){return'<canvas id="'+t+'" width="'+e+'px" height="'+i+'px"></canvas>'}static checkBox(t,e,i){let s='<span> <input type="checkbox" id="'+t+'"';if(i!=0)s+=" checked";s+="> "+Html.labelFor(t,e)+" </span>";return s}static checkBoxTF(t,e,i){return Html.checkBox(t,e,Fct.toBool(i))}static colorSelector(t,e,i,s=false,a=false,l=""){let r=ui.paletteIndex(e),n=i;let o='<span class="colorSelector has-border" palidx="'+r+'" idx="'+n+'" has_none="'+s+'" has_automatic="'+a+'" description="'+l+'" onclick="DlgColorSelector.show(\''+t+'\')" id="'+t+'" style="'+Html.colorStyle(ui.paletteReds[r][n],ui.paletteGreens[r][n],ui.paletteBlues[r][n])+'">'+Fct.colorItemNameFromIndex(n,false)+"</span>";return o}static colorSelectorItem(t,e,i,s,a,l=false){let r='<li class="colorSelectorItem has-border" style="'+Html.colorStyle(i,s,a)+'" value="'+t+'" onclick="DlgColorSelector.onClick('+t+')"'+'" id="ColorSelectorItem-'+e+'"';r+=">"+Fct.colorItemNameFromIndex(t,true,l)+"</li>";return r}static colorStyle(t,e,i){let s=t+e+i<400?"white":"black";return"color:"+s+";background-color:"+Html.rgb(t,e,i)+";"}static dlgBtn(t,e="Apply",i="xxx"){return'<p style="clear:both">'+Html.dlgBtnC(t,e,i)+"</p>"}static dlgBtnC(t,e="Apply",i="xxx"){let s="<button";if(i!="xxx")s+=' id="'+i+'"';s+=' class="is-dlgcolor" onClick="'+t+';"><b>'+e+"</b></button>";return s}static drvdVarChoices(t){let e,s='<ul id="'+t+'" class="TreeView">';for(let i=0;i<ui.drvdVarGroups.length;++i){e=ui.drvdVarGroups[i].name;s+=' <li><span id="'+e+'" class="tree-group-node">'+e+"</span>";s+=' <ul class="tree-nested-list">';for(let e=0;e<ui.drvdVarGroups[i].types.length;++e){let t=ui.drvdVarChoice(ui.drvdVarGroups[i].types[e]);s+='<li class="tree-item-node" value="'+t.type+'">'+Fct.fullVarLabel(t.uname,t.uunit)+"</li>"}s+=" </ul></li>"}s+="</ul>";return s}static labelFor(t,e){return'<label id="'+t+'Lbl" for="'+t+'">'+e+"</label>"}static listInput(i,s,a="",l="7em",r="off"){if(s.length>0){let t=i+"Lst";let e='<input id="'+i+'" list="'+t+'" autocomplete="'+r+'" style="width:'+l+';" value="'+a+'"/> <datalist id="'+t+'">';s.map(t=>e+='<option value="'+t+'"/>');return e+"</datalist>"}else return Html.txtInput(i,a,l,r)}static menu(t){let e=coll.accessMode=="RW",i="";switch(t){case"AssignQfMenu":i=Html.menuAssignQf();break;case"AssignQfMvMenu":i=Html.menuAssignQfMv();break;case"BrowseInvMenu":i=ui.menuItem("miCollInvByCruise");i+=ui.menuItem("miCollInvByCruiseAndVar");break;case"CanvasMenu":i=ui.menuItem("miRefreshCanvas");i+=ui.menuItem("miSaveImageCanvas");i+=Html.menuSep();i+=ui.menuItem("miFullRangeAllWin");i+=Html.menuSep();i+=Html.subMenu("WinPropsMenu","Window Properties");i+=ui.menuItem("miViewProperties");i+=Html.menuSep();i+=Html.subMenu("CwLayoutMenu","Layout");i+=Html.menuSep();i+=Html.subMenu("UndoMenu","Undo");i+=Html.subMenu("RedoMenu","Redo");i+=Html.menuSep();i+=ui.menuItem("miSaveViewAs");i+=ui.menuItem("miLoadView","<b>Load View</b>");i+=Html.menuSep();i+=ui.menuItem("miCloseSession");break;case"CollectionMenu":if(e){i+=ui.menuItem("miCollCopy");i+=ui.menuItem("miCreateSnapshot");i+=ui.menuItem("miCollRename");i+=ui.menuItem("miCollSortCondense");i+=Html.menuSep();i+=ui.menuItem("miCollDeleteCurrStation");i+=ui.menuItem("miCollDeleteStationSubset");i+=Html.menuSep()}i+=ui.menuItem("miCollBrowseAgreement");i+=ui.menuItem("miCollBrowseInfo");i+=Html.subMenu("BrowseInvMenu","Browse Inventory &emsp;");i+=ui.menuItem("miCollBrowseLogfile");i+=Html.menuSep();i+=ui.menuItem("miCreateOverviewPlots");if(e){i+=Html.menuSep();i+=ui.menuItem("miIdentifyKeyVariables");i+=ui.menuItem("miGoodCoverageCriteria");i+=Html.menuSep();i+=Html.subMenu("CollPropsMenu","Properties")}break;case"CollPropsMenu":i=ui.menuItem("miCollPropsGeneral");i+=ui.menuItem("miCollPropsMetaVariables");i+=ui.menuItem("miCollPropsDataVariables");break;case"CurrSmplTbMenu":i=ui.menuItem("miCurrSmplById","Current Sample by ID");break;case"CurrStatMenu":i=ui.menuItem("miCurrStatById");i+=ui.menuItem("miCurrStatByAccession");i+=ui.menuItem("miCurrStatByName");break;case"CurrStatTbMenu":i=Html.subMenu("CurrStatMenu","Current Station by");i+=Html.menuSep();i+=ui.menuItem("miBrowseHistory");break;case"CwLayoutMenu":i=Html.subMenu("LayoutTemplateMenu","Layout Templates");i+=ui.menuItem("miDwNewWin");i+=Html.menuSep();i+=Html.subMenu("GObjAddMenu","Add Graphics Object");i+=Html.menuSep();i+=ui.menuItem("miGObjMgr");break;case"DwFullRangeMenu":i=ui.menuItem("miFullRangeX");i+=ui.menuItem("miFullRangeY");i+=ui.menuItem("miFullRangeZ");i+=Html.menuSep();i+=ui.menuItem("miFullRangeXYZ");break;case"DataAvailabilityMenu":i=ui.menuItem("miDataAvailCollection");i+=ui.menuItem("miDataAvailStationSet");i+=ui.menuItem("miDataAvailCruise");i+=ui.menuItem("miDataAvailStation");break;case"DataWinMenu":i=ui.menuItem("miSaveImageDw");i+=ui.menuItem("miSaveAsInterruptedMapDw");i+=Html.menuSep();i+=Html.subMenu("DwFullRangeMenu","Full Range");i+=ui.menuItem("miZoom");i+=ui.menuItem("miZZoom");i+=ui.menuItem("miAutoZoomIn");i+=ui.menuItem("miAutoZoomOut");i+=ui.menuItem("miSetRanges");i+=Html.menuSep();i+=ui.menuItem("miXVariable");i+=ui.menuItem("miYVariable");i+=ui.menuItem("miZVariable");i+=Html.menuSep();i+=Html.subMenu("DwExtrasMenu","Extras");i+=Html.subMenu("DwLayoutMenu","Layout");i+=Html.menuSep();i+=Html.subMenu("DwStatisticsMenu","Statistics");i+=Html.subMenu("SmplFilterMenu","Sample Filter");i+=ui.menuItem("miDwProperties");break;case"DwExtrasMenu":i+=ui.menuItem("mi1DEstimation");i+=ui.menuItem("mi2DEstimation");i+=Html.menuSep();i+=ui.menuItem("miDefPatch");i+=ui.menuItem("miIsopynals");i+=Html.menuSep();i+=Html.subMenu("GObjExpDwMenu","Export as Graphics Object");break;case"DwLayoutMenu":i=ui.menuItem("miDwMoveResize");i+=ui.menuItem("miDwDelete");i+=Html.menuSep();i+=ui.menuItem("miDwNewWin");i+=ui.menuItem("miDwNewOverlay");i+=Html.menuSep();i+=ui.menuItem("miDwMoveTop");i+=ui.menuItem("miDwMoveBot");i+=Html.menuSep();i+=Html.subMenu("GObjAddMenu","Add Graphics Object");i+=Html.menuSep();i+=ui.menuItem("miGObjMgr");break;case"DwStatisticsMenu":i=ui.menuItem("miStatisticsDw");i+=ui.menuItem("miCurveFittingDw");break;case"ExportMenu":i=Html.subMenu("ExportStationDataMenu","Data &emsp;");i+=ui.menuItem("miExpHistory");i+=Html.menuSep();i+=Html.subMenu("WinDataExpMenu","Window Data&emsp;");break;case"ExportStationDataMenu":i=ui.menuItem("miExpSpreadsheet");i+=ui.menuItem("miExpCollection");i+=ui.menuItem("miExpNetCDF");break;case"GObjActMenu":i=ui.menuItem("miGObjExpCurrent");i+=ui.menuItem("miGObjCopy");i+=ui.menuItem("miGObjDelete");i+=Html.menuSep();i+=ui.menuItem("miGObjMoveTop");i+=ui.menuItem("miGObjMoveUp");i+=ui.menuItem("miGObjMoveDwn");i+=ui.menuItem("miGObjMoveBot");i+=Html.menuSep();i+=ui.menuItem("miGObjDeleteAll");i+=Html.menuSep();i+=ui.menuItem("miGObjProps");break;case"GObjAddMenu":i=ui.menuItem("miAddAnnotation");i+=ui.menuItem("miAddEllipse");i+=ui.menuItem("miAddLine");i+=ui.menuItem("miAddPolygon");i+=ui.menuItem("miAddPolyline");i+=ui.menuItem("miAddRectangle");i+=ui.menuItem("miAddSymbol");i+=ui.menuItem("miAddSymbolSet");i+=Html.menuSep();i+=ui.menuItem("miGObjFromGobFile");i+=ui.menuItem("miGObjFromShapeFile");i+=ui.menuItem("miGObjFromClipboard");break;case"GObjExpContours":i=ui.menuItem("miGObjExpContoursFile");i+=ui.menuItem("miGObjExpContoursCb");break;case"GObjExpDwMenu":i=Html.subMenu("GObjExpSmplDots","Sample Dots");i+=Html.subMenu("GObjExpContours","Contour Lines");i+=Html.subMenu("GObjExpSecBathy","Section Bathymetry");i+=Html.subMenu("GObjExpSecStatLbls","Section Station Labels");break;case"GObjExpMwMenu":i=Html.subMenu("GObjExpStatDots","Station Dots");i+=Html.subMenu("GObjExpStatSelPoly","Station Filter Polygon");i+=Html.subMenu("GObjExpSecBathy","Section Bathymetry");break;case"GObjExpSecBathy":i=ui.menuItem("miGObjExpSecBathyFile");i+=ui.menuItem("miGObjExpSecBathyCb");break;case"GObjExpSecStatLbls":i=ui.menuItem("miGObjExpSecStatLblsFile");i+=ui.menuItem("miGObjExpSecStatLblsCb");break;case"GObjExpSmplDots":i=ui.menuItem("miGObjExpSmplDotsFile");i+=ui.menuItem("miGObjExpSmplDotsCb");break;case"GObjExpStatDots":i=ui.menuItem("miGObjExpStatDotsFile");i+=ui.menuItem("miGObjExpStatDotsCb");break;case"GObjExpStatSelPoly":i=ui.menuItem("miGObjExpStatSelPolyFile");i+=ui.menuItem("miGObjExpStatSelPolyCb");break;case"HelpMenu":i=ui.menuItem("miHelpGettingStarted");i+=ui.menuItem("miHelpShortcutKeys");i+=ui.menuItem("miHelpHowToGuide");i+=ui.menuItem("miHelpOdvUserGuide");break;case"IsoVarMenu":i=Html.subMenu("SmplFilterMenu","Sample Filter");i+=ui.menuItem("miIsoVars");break;case"LayoutTemplateMenu":i=ui.menuItem("miFullScreenMap");i+=Html.menuSep();i+=ui.menuItem("miOnePickWin");i+=ui.menuItem("miTwoPickWin");i+=ui.menuItem("miSixPickWin");i+=Html.menuSep();i+=ui.menuItem("miOneScatterWin");i+=ui.menuItem("miTwoScatterWin");i+=ui.menuItem("miSixScatterWin");i+=Html.menuSep();i+=ui.menuItem("miOneSectionWin");i+=ui.menuItem("miTwoSectionWin");i+=ui.menuItem("miThreeSectionWin");i+=ui.menuItem("miFiveSectionWin");i+=ui.menuItem("miSixSectionWin");i+=Html.menuSep();i+=ui.menuItem("miOneIsoSurfaceWin");i+=ui.menuItem("miTwoIsoSurfaceWin");i+=ui.menuItem("miThreeIsoSurfaceWin");i+=ui.menuItem("miFiveIsoSurfaceWin");i+=Html.menuSep();i+=ui.menuItem("miFiveMixedWin");break;case"ManageResources":i=ui.menuItem("miManageViews");i+=ui.menuItem("miManageSections");i+=ui.menuItem("miManageGObjects");break;case"MapMenu":i=ui.menuItem("miSaveImageMap");i+=ui.menuItem("miSaveAsInterruptedMap");i+=Html.menuSep();i+=ui.menuItem("miFullDomain");i+=ui.menuItem("miGlobalMap");i+=ui.menuItem("miZoom");i+=ui.menuItem("miAutoZoomIn");i+=ui.menuItem("miAutoZoomOut");i+=Html.menuSep();i+=Html.subMenu("CurrStatMenu","Current Station by");i+=Html.menuSep();i+=Html.subMenu("PickedStatMenu","Manage Pick List");i+=Html.subMenu("SectionMenu","Manage Section");i+=Html.menuSep();i+=Html.subMenu("MwExtrasMenu","Extras");i+=Html.subMenu("MwLayoutMenu","Layout");i+=Html.menuSep();i+=ui.menuItem("miStatisticsMw");i+=Html.subMenu("StatFilterMenu","Station Filter");i+=ui.menuItem("miMapProperties");break;case"MetaValMenu":i=ui.menuItem("miEditMetadata");i+=Html.menuSep();i+=Html.subMenu("AssignQfMvMenu","Assign Quality Flag &emsp;");i+=Html.menuSep();i+=ui.menuItem("miMvCbCopyVal");break;case"MetaVarMenu":i=ui.menuItem("miCollectStrValsMv");i+=Html.menuSep();i+=Html.subMenu("StatFilterMenu","Station Filter");break;case"MwExtrasMenu":i+=Html.subMenu("GObjExpMwMenu","Export as Graphics Object");break;case"MwLayoutMenu":i=ui.menuItem("miMoveResize");i+=Html.menuSep();i+=Html.subMenu("GObjAddMenu","Add Graphics Object");i+=Html.menuSep();i+=ui.menuItem("miGObjMgr");break;case"PickedStatMenu":i=ui.menuItem("miPickListAdd");i+=ui.menuItem("miPickListRemove");i+=ui.menuItem("miPickListClear");i+=Html.menuSep();i+=ui.menuItem("miPickListEdit");break;case"RedoMenu":i=Html.menuRedo();break;case"SectionMenu":i=ui.menuItem("miDefineSection");i+=ui.menuItem("miLoadSection");i+=ui.menuItem("miRemoveSection");i+=ui.menuItem("miSaveSectionAs");i+=Html.menuSep();i+=ui.menuItem("miSectionProperties");break;case"SmplFilterMenu":i=ui.menuItem("miSmplFilterRelax");i+=ui.menuItem("miSmplFilterNoOutliers");i+=Html.menuSep();i+=ui.menuItem("miSmplFilter");break;case"SmplInfoValMenu":i=ui.menuItem("miEditInfoVal");i+=Html.menuSep();i+=ui.menuItem("miDvCbCopyInfo");break;case"SmplNameMenu":i=ui.menuItem("miDrvdVars");i+=Html.menuSep();i+=Html.subMenu("DataAvailabilityMenu","Data Availability");i+=Html.menuSep();i+=ui.menuItem("miDisplayOrder");i+=Html.menuSep();i+=ui.menuItem("miCollectStrValsDv");break;case"SmplValMenu":i=ui.menuItem("miEditData");i+=ui.menuItem("miEditSampleData");i+=Html.menuSep();i+=Html.subMenu("AssignQfMenu","Assign Quality Flag");i+=Html.menuSep();i+=ui.menuItem("miDvCbCopyVal");break;case"StatFilterMenu":i=ui.menuItem("miStatFilterRelax");i+=ui.menuItem("miStatFilter");break;case"ToolsMenu":i=ui.menuItem("miFindDuplicates");break;case"UndoMenu":i=Html.menuUndo();break;case"ViewMenu":i=Html.subMenu("UndoMenu","Undo");i+=Html.subMenu("RedoMenu","Redo");i+=Html.menuSep();i+=Html.subMenu("StatFilterMenu","Station Filter");i+=Html.menuSep();i+=ui.menuItem("miDrvdVars");i+=ui.menuItem("miIsoVars");i+=Html.menuSep();i+=Html.subMenu("WinPropsMenu","Window Properties");i+=ui.menuItem("miViewProperties");i+=Html.menuSep();i+=Html.subMenu("LayoutTemplateMenu","Layout Templates");i+=Html.menuSep();i+=Html.subMenu("ManageResources","Manage Resources");i+=Html.menuSep();i+=ui.menuItem("miSaveViewAs");i+=ui.menuItem("miLoadView");i+=Html.menuSep();i+=ui.menuItem("miCloseSession");break;case"WinDataExpMenu":i=Html.menuWinDataExp();break;case"WinPropsMenu":i=Html.menuWinProps();break}return i}static menuAssignQf(){const t=ui.rclickTblItem.row;let e="";if(t<0||t>=ui.dockDataVarIds.length)return e;const i=ui.dockDataVarIds[t];const s="<i>"+coll.dataVarNameLabel(i)+"</i>";const a="Assign quality flag value to ";let l=view.winIdsWithVar(i),r,n=l.length;e=ui.newMenuItemStr("miAssignQfCurrSmpl","Current Sample",a+"current "+s+" value.");e+=ui.newMenuItemStr("miAssignQfCurrStat","All Samples of Current Station",a+"all "+s+" values of current station.");for(r=0;r<n;++r)e+=ui.newMenuItemStr("miAssignQfWin:"+l[r],"All Samples in Window "+l[r],a+"all "+s+" values shown in data window "+l[r]+".");e+=ui.newMenuItemStr("miAssignQfValStat","All Samples of Valid Stations",a+"all "+s+" values of all stations shown in the map.");e+=ui.newMenuItemStr("miAssignQfAllStat","All Samples in Collection",a+"all "+s+" values in the collection.");return e}static menuAssignQfMv(){const t=ui.rclickTblItem.row;let e="";if(t<0||t>=ui.dockMetaVarIds.length)return e;const i=ui.dockMetaVarIds[t];const s=coll.metaVars.varArr[i],a="<i>"+s.name+"</i>";const l="Assign quality flag value to ";e=ui.newMenuItemStr("miAssignQfMvCurrStat","Current Station",l+"current "+a+" value.");e+=ui.newMenuItemStr("miAssignQfMvValStat","All Valid Stations",l+"all "+a+" values of all stations shown in the map.");e+=ui.newMenuItemStr("miAssignQfMvAllStat","All Stations in Collection",l+"all "+a+" values in the collection.");return e}static menuRedo(){const t="Redoes the selected view change.",e="miUndoRedo ";let i,s=viewHistory.currIdx,a=viewHistory.size(),l="";for(i=a-1;i>s+1;--i){l+=ui.newMenuItemStr(e+i,viewHistory.undoArr[i].descr,t)}i=s+1;if(i<a)l+=ui.newMenuItemStr(e+i,viewHistory.undoArr[i].descr,t,Fct.redoKeyCode());return l}static menuUndo(){const t="Undoes the selected view change.",e="miUndoRedo ";let i,s=viewHistory.currIdx,a=viewHistory.size(),l="";if(s>0)l+=ui.newMenuItemStr(e+(s-1),viewHistory.undoArr[s].descr,t,Fct.keyCode(1,0,0,"Z"));for(i=s-1;i>0;--i){l+=ui.newMenuItemStr(e+(i-1),viewHistory.undoArr[i].descr,t)}l+=Html.menuSep();l+=ui.menuItem("miUndoAll");return l}static menuWinDataExp(){const t="Window ",e=20;const i="Exports the data of the selected window.";let s=0,a=Math.min(e,view.dataWinArr.length),l="";l=ui.newMenuItemStr("miDataExp"+t+s,"Map",i);for(s=1;s<=a;++s){l+=ui.newMenuItemStr("miDataExp"+t+s,t+s,i)}return l}static menuWinProps(){const t="Window ",e=20;const i="Changes properties of the selected map or data window.";let s=0,a=Math.min(e,view.dataWinArr.length),l="";l=ui.newMenuItemStr("mi"+t+s,"Map",i);for(s=1;s<=a;++s){l+=ui.newMenuItemStr("mi"+t+s,t+s,i)}return l}static mainMenuElem(t){let e=t+"Menu",i="\"ui.showMainMenu('"+t+"')\"";return'<span id="'+t+'Span" class="main-menu-item" onMouseEnter='+i+" onClick="+i+">"+t+"</span>"}static menuItem(t,e,i,s,a=true){if(i!=undefined)ui.menuItemDescriptions.set(t,i);let l=`<li id="${t}" class="menu-item" onClick="app.processMenuOption(\'${t}\')" onmouseenter="app.onMouseEnterMenuItem(\'${t}\')">${e}`;if(s!=undefined&&s.length>0){l+=` <span style="float:right">${s}</span>`;if(a)ui.menuOptionsByKeyName.set(s,t)}return l+"</li>"}static menuSep(){return'<li class="menu-separator"><hr></li>'}static minMaxEntry(t,e,i,s,a,l,r){if(e<=-1)return"";let n=Math.min(l,r),o=Math.max(l,r);ui.dlgOrigVals.set(s,n);ui.dlgOrigVals.set(a,o);let d="",c=t==3?ui.dockIsoVarLabels[e]:coll.dataVarFullLabel(e);if(c=="")c=i;if(i!="X Axis")d+='<tr><td colspan="2">&nbsp;</td></tr>';d+='<tr><td colspan="2"><b>'+c+"</b></td></tr>";d+="<tr><td>Minimum:</td><td>"+Html.txtInput(s,n)+"</td></tr>";d+="<tr><td>Maximum:</td><td>"+Html.txtInput(a,o)+"</td></tr>";return d}static noResults(){return'<p class="is-red">&emsp;No results</p>'}static numInput(t,e,i,s,a=1){return'<input type="number" id="'+t+'" min="'+i+'" max="'+s+'" step="'+a+'" value="'+e+'"/>'}static option(t,e,i){let s='<option value="'+t+'"';if(i.indexOf(t)>-1)s+=" selected";s+=">"+e+"</option>";return s}static paletteSelector(t,e){let i=ui.paletteIndex(e);let s='<span id="'+t+'" class="paletteSelector has-border" idx="'+i+'" onclick="DlgPaletteSelector.show(\''+t+"')\">"+Html.paletteSelectorItem(i,false)+"</span>";return s}static paletteSelectorItem(t,e,i=false){let s="",a=ui.paletteNames[t];let l=extPrms.resourceRoot;let r='<li class="paletteSelectorItem" value="'+t+'" id="PaletteSelectorItem-'+t+'"';if(e){s=i?"&#x2713;&ensp;":"&emsp;&ensp;";r+=' onclick="DlgPaletteSelector.onClick('+t+')"'}let n='<img src="'+l+"img/pal/"+a+'.jpg" width="45%" height="100%">&emsp;';r+=">"+s+n+a+"</li>";return r}static panelBegin(t,e,i,s=false){let a="tabPanel"+e;let l='<input name="tabPanel" id="'+a+'" type="radio" onClick="ui.setLastOpenElem(\''+t+"','"+e+"')\"";if(s)l+=" checked";l+="><section><h1>"+Html.labelFor(a,i)+"</h1><div>";return l}static panelEnd(){return"</div></section>"}static popupDlg(t){return'<div id="PopupDlg'+t+'" class="PopupDlg" level="'+t+'"> <div id="DlgHeader'+t+'" class="DlgHeader"> <span id="DlgTitle'+t+'" class="DlgTitle"></span> &emsp;&emsp; <button id="DlgCloseBtn'+t+'" class="DlgCloseBtn" onclick="ui.hideDlg(false)">&times;</button> </div> <div id="DlgContents'+t+'" class="DlgContents"></div> <div id="DlgMessage'+t+'" class="DlgMessage"></div> <div id="DlgFooter'+t+'" class="DlgFooter"></div> </div> '}static rgb(t,e,i){return"rgb("+t+","+e+","+i+")"}static selectList(t,e,i,s,a=0,l=-1,r="",n=0){let o=[];o.push(s);return Html.selectListEx(t,e,i,o,a,l,r,n)}static selectListAggrVarConversion(t,e){return Html.selectList(t,ui.varCnvIds,ui.varCnvLbls,e)}static selectListAlignX(t,e){return Html.selectList(t,[0,1,2],["left","center","right"],e)}static selectListAlignY(t,e){return Html.selectList(t,[0,1,2],["top","center","bottom"],e)}static selectListAxisPosition(t,e,i){let s=[];if(e=="X")s=["no axis","bottom","top"];else if(e=="Y")s=["no axis","left","right"];else if(e=="Z")s=["no colorbar","right","bottom"];return Html.selectList(t,[0,1,2],s,i)}static selectListAxisProjection(t,e,i){const s=e=="X"?"left":"bottom";const a=e=="X"?"right":"top";let l=[0,1,10,11,12,13,14,15],r=["Linear","Logarithmic","Stretched "+s+" part","Stretched "+s+" part (strong)","Stretched middle part","Stretched middle part (strong)","Stretched "+a+" part","Stretched "+a+" part (strong)"];return Html.selectList(t,l,r,i)}static selectListColumnSep(t,e){return Html.selectList(t,[0,1,2,3,4],["TAB",";",",","SPACE","/"],e)}static selectListContents(e,i,s,t=-1,a=""){let l="";if(a!=="")l+=Html.option(t,a,s);for(let t=0;t<i.length;t++){l+=Html.option(e[t],i[t],s)}return l}static selectListContourLabelCount(t,e){return Html.selectList(t,[0,1,2],["no labels","few labels","many labels"],e)}static selectListDay(t,e){let i=Fct.intArray(1,31),s=i.map(t=>Fct.padZeros(t,2));return Html.selectList(t,i,s,e)}static selectListEditable(t,e,i="",s=16){let a='<div class="select-editable">';a+='<select id="'+t+'Select" onchange="Fct.setSiblingsValue(\''+t+'\')" style="width:'+s+'em;">';a+=Html.selectListContents(e,e,[])+"</select>";a+='<input type="text" id="'+t+'" value="'+i+'" style="width:'+(s-1.7)+'em;"/>';return a+"</div>"}static selectListEx(t,e,i,s,a=0,l=-1,r="",n=0){let o='<select class="is-12ptfontsize" id="'+t+'"';if(a==1||n>0){o+=' size="'+(n>0?n:Math.min(10,i.length))+'"'}if(a==1){o+=" multiple"}o+=">";o+=Html.selectListContents(e,i,s,l,r);o+="</select>";return o}static selectListGObjCoords(t,e,i){let s=[-1],a=["Canvas"],l=i.ownCoords=="T"?e:-1;if(e>-1){s.push(e);a.push(Ui.windowName(e))}return Html.selectList(t,s,a,l)}static selectListGObjOwner(t,e,i){let s=[-1,0],a=["Canvas","Map"],l,r=view.dataWinArr.length;for(l=1;l<=r;++l){s.push(l);a.push(Ui.windowName(l))}return Html.selectList(t,s,a,e)}static selectListHighlighting(t,e){return Html.selectList(t,[0,1,2,3],["curve","dots","curve and dots","(none)"],e)}static selectListHour(t,e){let i=Fct.intArray(0,24),s=i.map(t=>Fct.padZeros(t,2));return Html.selectList(t,i,s,e)}static selectListLineStartEnd(t,e){return Html.selectList(t,[-1,0,1,2,3],["(none)","arrow head","filled dot","open dot","bar"],e)}static selectListLineStyle(t,e){return Html.selectList(t,[0,1,2,3,4],["solid","dashed","dotted","dash-dot","dash-dot-dot"],e)}static selectListLineWidth(t,e,i=false){let s=[-1,0,1,2,3,4,5,6,7],a=["(none)","very thin","thin","thin medium","medium","medium thick","thick","very thick","extra thick"];if(i){s.unshift(-1);a.unshift("(none)")}return Html.selectList(t,s,a,e)}static selectListMinute(t,e){let i=Fct.intArray(0,60),s=i.map(t=>Fct.padZeros(t,2));return Html.selectList(t,i,s,e)}static selectListMonth(t,e){return Html.selectList(t,Fct.intArray(1,12),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e)}static selectListQfScheme(t,e){return Html.selectList(t,[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],["ODV","GTSPP","ARGO","SEADATANET","ESEAS","WOD","WODSTATION","WOCEBOTTLE","WOCECTD","WOCESAMPLE","QARTOD","BODC","PANGAEA","SMHI","OCEANSITES","IODE"],e)}static selectListSymbol(t,e){return Html.selectList(t,[0,1,2,3,4,5,6,7],["dot","square","diamond","triangle","inverted triangle","*","X","+"],e)}static selectListValType(t,e){return Html.selectList(t,Collection.valueTypeStrArr(),Collection.valueTypeStrArr(),e)}static selectListVarType(t,e,i){let s=e?ui.dataVarTypeNames:ui.metaVarTypeNames;return Html.selectList(t,s,s,i)}static slider(t,e,i,s){if(s==undefined)s=e;return'<input type="range" id="'+t+'" min="'+e+'" max="'+i+'" value="'+s+'">'}static subMenu(t,e,i){if(i==undefined)i=Ui.menuWidth[t];return Html.subMenuStart(t,e,i)+Html.subMenuEnd()}static subMenuEnd(){return"</ul></li>"}static subMenuStart(t,e,i){let s='<li class="menu-item submenu-root" onmouseenter="app.onMouseEnterMenuItem(\''+t+"')\">"+e+' <span style="float:right">'+Html.RightArrow+'</span> <ul id="'+t+'" class=" dropdown-menu"';if(i!=undefined)s+=' style="width:'+i+'px;"';return s+">"}static toolTipElem(t,e,i){return"<"+t+' title="'+i+'">'+e+"</"+t+">"}static treeAsHtml(t,e,i=true,s=true){let a,l,r,n="",o=0;if(e==0){l=coll.viewFilesTree;r=coll.viewFilesCount}else if(e==1){l=coll.secFilesTree;r=coll.secFilesCount}else if(e==2){l=ui.gobjFilesTree;r=ui.gobjFilesCount}else if(e==3){l=ui.macroNames;r=l.length}else if(e==4){l=ui.shapeFilesTree;r=ui.shapeFilesCount;i=false}a=Fct.localStorageKeys(Ui.rsrc.keys[e],true);if(e==0)a=a.filter(t=>!t.endsWith("~"));if(i)o+=a.length;if(s)o+=r;if(o>0){n=' <ul id="'+t+'" class="TreeView">';if(i)n+=Html.treeNodeFromArr(a,true);if(s){if(e==3)n+=Html.treeNodeFromArr(l,false);else n+=Html.treeNodeFromTree(l,r,false)}n+="</ul>"}else n+=Html.noResults();return{html:n,count:o}}static treeNodeFromArr(t,e=true){let i="",s=e?"private":"public";let a=e?"private:":"";if(t.length>0){i+=' <li><span id="'+s+'-node" class="tree-group-node">'+s+'</span> <ul class="tree-nested-list">';t.map(t=>i+=' <li class="tree-item-node" value="'+a+t+'">'+t+"</li>");i+=" </ul></li>"}return i}static treeNodeFromTree(t,e,i=true){let s="",a=i?"private":"public";if(e>0){s+=' <li><span id="'+a+'-node" class="tree-group-node">'+a+"</span>";s+=' <ul class="tree-nested-list">'+t+" </ul></li>"}return s}static txtInput(t,e="",i="7em",s="off"){return'<input type="text" id="'+t+'" autocomplete="'+s+'" style="width:'+i+';" value="'+e+'"/>'}static winGeneral(t,e){ui.dlgOrigVals.set("palName",t.palName);ui.dlgOrigVals.set("fontSizeFac",Fct.roundedVal(t.fontSizeFac,1));ui.dlgOrigVals.set("bckColor",t.bckColor);ui.dlgOrigVals.set("gridColor",t.gridColor);ui.dlgOrigVals.set("drawGrid",t.drawGrid);ui.dlgOrigVals.set("drawLabels",t.drawLabels);ui.dlgOrigVals.set("buddySync",t.buddyAxisSync);if(t.highlightStyle!=undefined)ui.dlgOrigVals.set("hlStyle",t.highlightStyle);let i='<table class="StdTable">';i+="<tr><td>Palette:</td><td>"+Html.paletteSelector("palName",t.palName)+"</td></tr>";i+="<tr><td>Font size [%]:</td><td>"+Html.numInput("fontSizeFac",Fct.roundedVal(t.fontSizeFac,1),0,499,5)+"</td></tr>";i+="<tr><td>Background color:</td><td>"+Html.colorSelector("bckColor",t.palName,t.bckColor,true)+"</td></tr>";i+="<tr><td>Axis color:</td><td>"+Html.colorSelector("gridColor",t.palName,t.gridColor,true)+"</td></tr>";if(t.highlightStyle!=undefined)i+="<tr><td>Highlighting style:</td><td>"+Html.selectListHighlighting("hlStyle",t.highlightStyle)+"</td></tr>";i+="<tr><td></td><td>"+Html.checkBoxTF("drawGrid","Draw grid",t.drawGrid)+"</td></tr>";i+="<tr><td></td><td>"+Html.checkBoxTF("drawLabels","Automatic axis titles",t.drawLabels)+"</td></tr>";if(e&&t.winType==1)i+="<tr><td></td><td>"+Html.checkBoxTF("buddySync","Synchronize parent/overlay ranges",t.buddyAxisSync)+"</td></tr>";i+="</table>";return i}}"use strict";class DlgAcVar{static add(){let t=DlgDrvdVars.dv;let e="<p>Select: "+t.queryStrsMultiInpVar[0]+"</p>";e+=Html.selectList("inpVarMulti",coll.dataVarIds(view.drvdVarSet.drvdVarArr),coll.dataVarFullLabels(view.drvdVarSet.drvdVarArr,true),-1,1);ui.showDlg("Derived Variable: "+Fct.fullVarLabel(t.name,t.units),e,Html.dlgBtn("DlgAcVar.onAddVars()","Add"))}static addInpVars(t){let e,i=t.length,s=DlgDrvdVars.dv;for(e=0;e<i;++e){s.inpVarIds.push(t[e]);s.iPrms.push(0);s.facs.push(1);s.offs.push(0)}}static convert(){let t=DlgAcVar.selectedRow.id;let e=DlgAcVar.selectedRow.rowIndex-1;let i=DlgDrvdVars.dv.iPrms[e];let s=coll.dataVarUnitsLabel(t,false,App.wrkArr)+"&emsp;>>&emsp;"+Fct.strFromElem("varUnits","");let a="<p>Select suitable conversion for </p><p>"+s+"</p>";a+=Html.selectListAggrVarConversion("cnvChoicesList",i);ui.showDlg("Conversion",a,Html.dlgBtn("DlgAcVar.onCnvSelect('"+s+"')"))}static delete(){if(DlgAcVar.selectedRow==null)return;let t=DlgDrvdVars.dv,e=DlgAcVar.selectedRow.rowIndex-1;t.inpVarIds.splice(e,1);t.iPrms.splice(e,1);t.facs.splice(e,1);t.offs.splice(e,1);DlgAcVar.updateContribTable()}static enableButtons(){$("BtnVarDelete").disabled=true;$("BtnVarCnv").disabled=true;$("BtnVarUp").disabled=true;$("BtnVarTop").disabled=true;$("BtnVarDown").disabled=true;$("BtnVarBottom").disabled=true;if(DlgAcVar.selectedRow!=null){let t=DlgAcVar.selectedRow.rowIndex==1;let e=DlgAcVar.selectedRow.rowIndex==DlgDrvdVars.dv.inpVarIds.length;$("BtnVarDelete").disabled=false;$("BtnVarCnv").disabled=false;$("BtnVarUp").disabled=t;$("BtnVarTop").disabled=t;$("BtnVarDown").disabled=e;$("BtnVarBottom").disabled=e}if(DlgDrvdVars.dv.type==142){Fct.setVisibility("BtnVarAdd");Fct.setVisibility("BtnVarDelete");Fct.setVisibility("BtnVarUp");Fct.setVisibility("BtnVarTop");Fct.setVisibility("BtnVarDown");Fct.setVisibility("BtnVarBottom")}}static moveBottom(){DlgAcVar.moveTo(DlgDrvdVars.dv.inpVarIds.length-1)}static moveDown(){DlgAcVar.moveTo(DlgAcVar.selectedRow.rowIndex)}static moveTo(t){if(DlgAcVar.selectedRow==null)return;let e=DlgAcVar.selectedRow.rowIndex-1,i=DlgDrvdVars.dv;Fct.moveElem(i.inpVarIds,e,t);Fct.moveElem(i.iPrms,e,t);Fct.moveElem(i.facs,e,t);Fct.moveElem(i.offs,e,t);DlgAcVar.updateContribTable();let s=$("ContribTable").childNodes[0].childNodes[t+1];Fct.setSelected(s);DlgAcVar.selectedRow=s;DlgAcVar.enableButtons()}static moveTop(){DlgAcVar.moveTo(0)}static moveUp(){DlgAcVar.moveTo(DlgAcVar.selectedRow.rowIndex-2)}static onAddVars(){let t=Fct.selectedNums("inpVarMulti",-1);ui.hideDlg();if(t.length>0){DlgAcVar.addInpVars(t);DlgAcVar.updateContribTable()}}static onApply(){let t=DlgDrvdVars.dv;t.name=Fct.strFromElem("varName",DlgAcVar.prefix+"Variable");t.units=Fct.strFromElem("varUnits","");t.uname=t.name;t.uunits=t.units;t.digitsCount=Fct.numFromElem("digitsCount",2);if(t.type==140)t.iPrms.push(Fct.selectedNum("Mode",0));t.fPrms=t.facs.concat(t.offs);ui.hideDlg();DlgDrvdVars.addVar(DlgAcVar.updateIdx)}static onCnvSelect(t){let e=DlgAcVar.selectedRow.rowIndex-1;let i=Fct.selectedNum("cnvChoicesList",0);ui.hideDlg();let s=DlgDrvdVars.dv;if(i==1){ui.showDlg(t,"<p>Y = "+Html.txtInput("factor",s.facs[e])+" * X  + "+Html.txtInput("offset",s.offs[e])+"</p>",Html.dlgBtn("DlgAcVar.onLinTransf()"))}else{let t=ui.varCnvIds.indexOf(i);if(t>-1){s.iPrms[e]=i;s.facs[e]=ui.varCnvFacs[t];s.offs[e]=ui.varCnvOffs[t];DlgAcVar.updateContribTable()}}}static onContribTblClick(t){if(DlgAcVar.selectedRow!=null){Fct.unselect(DlgAcVar.selectedRow);DlgAcVar.selectedRow=null}const e=t.target.parentNode;if(e.innerHTML.indexOf("<td>")>-1){Fct.setSelected(e);DlgAcVar.selectedRow=e}DlgAcVar.enableButtons()}static onLinTransf(){let t=DlgAcVar.selectedRow.rowIndex-1,e=DlgDrvdVars.dv;let i=Fct.numFromElem("factor",1),s=Fct.numFromElem("offset",0);ui.hideDlg();e.iPrms[t]=1;e.facs[t]=i;e.offs[t]=s;DlgAcVar.updateContribTable()}static show(t=-1){DlgAcVar.updateIdx=t;let i=DlgDrvdVars.dv,s=i.inpVarIds.length;DlgAcVar.prefix=i.type==140?"Aggregated ":"Converted ";if(t>-1){i.aggrType=i.type==140?i.iPrms[s]:0;i.fPrms.map((t,e)=>{if(e<s)i.facs.push(t);else i.offs.push(t)})}let e='<table class="StdTable">';e+='<tr><th width="70%">Label</th><th width="30%">Digits</th></tr>';e+="<tr><td>"+Html.txtInput("varName",i.name,"20em")+"</td><td>"+Html.numInput("digitsCount",i.digitsCount,0,8)+'</td></tr> <tr><td><b>Units</b></td><td><span id="spMode"><b>Mode</b></span></td></tr>';e+="<tr><td>"+Html.txtInput("varUnits",i.units,"20em")+"</td><td>"+Html.selectList("Mode",[0,1,2],["Exclusive","Average","Median"],i.aggrType)+"</td></tr>";e+='<tr><td colspan="2">&nbsp;</td></tr>';e+='<tr><td colspan="2"><b>Contributing variables</b></td></tr>';e+='<tr><td rowspan="4">';e+='<table id="ContribTable" class="StdTable has-border has-altbckcolor" style="width:20em"></table>';e+="</td><td><center>"+Html.button("Add","DlgAcVar.add()","BtnVarAdd")+"&emsp;"+Html.button("Delete","DlgAcVar.delete()","BtnVarDelete")+"</center></td></tr>";e+="<tr><td><center>"+Html.button("Conversion","DlgAcVar.convert()","BtnVarCnv")+"</center></td></tr>";e+="<tr><td><center>"+Html.button("Up","DlgAcVar.moveUp()","BtnVarUp")+"&emsp;"+Html.button("Top","DlgAcVar.moveTop()","BtnVarTop")+"</center></td></tr>";e+="<tr><td><center>"+Html.button("Down","DlgAcVar.moveDown()","BtnVarDown")+"&emsp;"+Html.button("Bottom","DlgAcVar.moveBottom()","BtnVarBottom")+"</center></td></tr>";e+="</table>";ui.showDlg(DlgAcVar.prefix+"Variable",e,Html.dlgBtn("DlgAcVar.onApply()"));DlgAcVar.updateContribTable();$("ContribTable").addEventListener("click",DlgAcVar.onContribTblClick);if(i.type==142){Fct.setVisibility("spMode");Fct.setVisibility("Mode")}}static updateContribTable(){let t="<tr><th>Variable</th><th>Conversion</th></tr>";let e=DlgDrvdVars.dv,i=e.inpVarIds.length,s,a,l;for(s=0;s<i;++s){l=e.inpVarIds[s];a=ui.varCnvIds.indexOf(e.iPrms[s]);t+='<tr id="'+l+'"><td>'+coll.dataVarFullLabel(l,true,App.wrkArr)+"</td><td>"+ui.varCnvLbls[a]+"</td></tr>"}$("ContribTable").innerHTML=t;DlgAcVar.selectedRow=null;DlgAcVar.enableButtons()}}class DlgArrowProps{static onApply(){let t=DlgDataWin.dw;t.arrXvId=Fct.selectedNum("arrXvId",-1);t.arrYvId=Fct.selectedNum("arrYvId",-1);t.arrLineWidth=Fct.selectedNum("ArrowLWidth",1);t.arrColor=Fct.idxFromElem("ArrowCol",0);t.arrScale=Fct.numFromElem("ArrowScale",1);DlgDataWin.arrowPropsChanged=1;ui.hideDlg()}static show(){let t=DlgDataWin.dw;const e=t.scope==3?ui.dockIsoVarIds:ui.dockDataVarIds;const i=t.scope==3?ui.dockIsoVarLabels:ui.dockDataVarLabels;let s="<p><fieldset><legend>X/Y Components</legend>";s+="<p>X:&ensp;"+Html.selectList("arrXvId",e,i,t.arrXvId)+"</p>";s+="<p>Y:&ensp;"+Html.selectList("arrYvId",e,i,t.arrYvId)+"</p>";s+="</fieldset></p>";s+='<p><table class="StdTable">';s+="<tr><td>Scale [per cm]:</td><td>"+Html.numInput("ArrowScale",t.arrScale,1,999,1)+"</td></tr>";s+="<tr><td>Line width:</td><td>"+Html.selectListLineWidth("ArrowLWidth",t.arrLineWidth)+"</td></tr>";s+="<tr><td>Color:</td><td>"+Html.colorSelector("ArrowCol",t.palName,t.arrColor,true,true)+"</td></tr>";s+="</table></p>";ui.showDlg(Ui.titleW("Arrow Properties",ui.rclickWinId),s,Html.dlgBtn("DlgArrowProps.onApply()"))}}class DlgAxisRanges{static onApply(){let t=Fct.numFromElem("xMin",-1e10),e=Fct.numFromElem("xMax",1e10);let i=Fct.numFromElem("yMin",-1e10),s=Fct.numFromElem("yMax",1e10);let a=Fct.numFromElem("zMin",-1e10),l=Fct.numFromElem("zMax",1e10);let r=ui.dlgValChanged("xMin",t)||ui.dlgValChanged("xMax",e)||ui.dlgValChanged("yMin",i)||ui.dlgValChanged("yMax",s)||ui.dlgValChanged("zMin",a)||ui.dlgValChanged("zMax",l);ui.hideDlg();if(r)app.sendWsMsg(Msg.setRanges(DlgAxisRanges.winId,t,e,i,s,a,l)+","+Msg.msgGetCanvasCurrInfo)}static show(t){let e=view.dataWinArr[t-1],i=e.scope;DlgAxisRanges.winId=t;ui.dlgOrigVals=new Map;let s='<table class="StdTable">';s+=Html.minMaxEntry(i,e.xvId,"X Axis","xMin","xMax",e.xLeft,e.xRight);s+=Html.minMaxEntry(i,e.yvId,"Y Axis","yMin","yMax",e.yBottom,e.yTop);s+=Html.minMaxEntry(i,e.zvId,"Z Axis","zMin","zMax",e.zBottom,e.zTop);s+="</table>";ui.showDlg(Ui.titleW("Axis Ranges",t),s,Html.dlgBtn("DlgAxisRanges.onApply()"))}}class DlgAxisVar{static onApply(t,e){const i=Fct.selectedNum("vId",-1),s=Fct.checkBoxState("rev");ui.hideDlg();if(i==-1)return;let a=view.dataWinArr[ui.rclickWinId-1];let l=false,r=false,n,o;switch(t){case"X":l=i!=a.xvId;r=s!=a.xRev;if(r&&a.xLeft!=App.missDOUBLE&&a.xLeft!=App.largeDOUBLE){n=Math.min(a.xLeft,a.xRight);o=Math.max(a.xLeft,a.xRight);if(s=="T"){a.xLeft=o;a.xRight=n}else{a.xLeft=n;a.xRight=o}}if(l){a.xLeft=App.missDOUBLE;a.xRight=App.largeDOUBLE}a.xvId=i;a.xRev=s;break;case"Y":l=i!=a.yvId;r=s!=a.yRev;if(r&&a.yBottom!=App.missDOUBLE&&a.yBottom!=App.largeDOUBLE){n=Math.min(a.yBottom,a.yTop);o=Math.max(a.yBottom,a.yTop);if(s=="T"){a.yBottom=o;a.yTop=n}else{a.yBottom=n;a.yTop=o}}if(l){a.yBottom=App.missDOUBLE;a.yTop=App.largeDOUBLE}a.yvId=i;a.yRev=s;break;case"Z":l=i!=a.zvId;r=s!=a.zRev;if(r&&a.zBottom!=App.missDOUBLE&&a.zBottom!=App.largeDOUBLE){n=Math.min(a.zBottom,a.zTop);o=Math.max(a.zBottom,a.zTop);if(s=="T"){a.zBottom=o;a.zTop=n}else{a.zBottom=n;a.zTop=o}}if(l){a.zBottom=App.missDOUBLE;a.zTop=App.largeDOUBLE}a.zvId=i;a.zRev=s;break}if(e){if(l){a.drawShaded="F";a.isopycnicGridding="F";a.autoContours="T";a.drawContours="T";a.contours=[];a.nonLinAutoAdjust="F";a.nonLinStart=-.1;a.nonLinEnd=.1;if(t=="Z")a.plotMode=7;else if(t=="X")a.xAlign=2}app.sendWsMsg(Msg.loadView(view.toXml(),viewHistory.currentName(),"Change "+t+"-Axis Variable - "+Ui.windowName(ui.rclickWinId)));if(t=="X")app.processMenuOption("miFullRangeXYZ")}else{if(l){a.plotMode=0;a.contours=[];a.drawContours="F";a.nonLinAutoAdjust="F";a.nonLinStart=-.1;a.nonLinEnd=.1}if(l||r)app.sendWsMsg(Msg.setDwXYZVars(ui.rclickWinId)+","+Msg.msgGetCanvasCurrInfo)}}static show(t,e,i=false){let s=view.dataWinArr[t-1],a,l;let r=s.scope==3?ui.dockIsoVarIds:ui.dockDataVarIds;let n=s.scope==3?ui.dockIsoVarLabels:ui.dockDataVarLabels;switch(e){case"X":a=s.xvId;l=s.xRev;break;case"Y":a=s.yvId;l=s.yRev;break;case"Z":a=s.zvId;l=s.zRev;break}let o="";if(e==="Z")o+="<p>"+Html.selectList("vId",r,n,a,0,App.VID_NONE,"(none)")+"</p>";else o+="<p>"+Html.selectList("vId",r,n,a)+"</p>";o+="<p>"+Html.checkBoxTF("rev","Reverse range",l)+"</p>";ui.showDlg(Ui.titleW(e+"-Axis Variables",t),o,Html.dlgBtn("DlgAxisVar.onApply('"+e+"',"+i+")","Select"));$("vId").size=Math.min(11,r.length);$("vId").addEventListener("change",()=>{$("rev").checked=false});$("vId").addEventListener("dblclick",function(){DlgAxisVar.onApply(e,i)});let d=Fct.selectedOption("vId");if(d!=null)d.scrollIntoView()}}class DlgCollPropsGeneral{static onApply(){let t=Fct.strFromElem("collDescr","");let e=Fct.selectedStr("collField",coll.dataField);let i=Fct.selectedStr("collType",coll.dataType);let s=Fct.selectedNum("collPrimVar");ui.hideDlg();if(t!=coll.description||e!=coll.dataField||i!=coll.dataType||s!=coll.primaryVarId)app.sendWsMsg('{"cmd":"set_collection_properties","primary_var_id":'+(s+1)+',"data_field":"'+e+'","data_type":"'+i+'","description":"'+t+'"},'+Msg.msgGetCollInfo+","+Msg.msgGetCanvasCurrInfo)}static show(){const t=["GeneralField","Ocean","Atmosphere","Land","IceSheet","SeaIce","Sediment"],e=["GeneralType","Profiles","Trajectories","TimeSeries"],i="20em";let s='<table class="StdTable">';s+="<tr><td>Description::</td><td>"+Html.txtInput("collDescr",coll.description,"25em")+"</td></tr>";s+="<tr><td>Data Field:</td><td>"+Html.selectList("collField",t,t,coll.dataField)+"</td></tr>";s+="<tr><td>Data Type:</td><td>"+Html.selectList("collType",e,e,coll.dataType)+"</td></tr>";s+="<tr><td>Primary Variable:</td><td>"+Html.selectList("collPrimVar",coll.dataVarIds(),coll.basicDataVarFullLabels(false),coll.primaryVarId)+"</td></tr>";s+="</table>";ui.showDlg("Collection Properties",s,Html.dlgBtn("DlgCollPropsGeneral.onApply()"));$("collField").style.width=i;$("collType").style.width=i;$("collPrimVar").style.width=i}}class DlgColorSelector{static onClick(t){let e=DlgColorSelector.el,i=e.attributes.palidx.value;e.attributes.style.value=Html.colorStyle(ui.paletteReds[i][t],ui.paletteGreens[i][t],ui.paletteBlues[i][t]);e.attributes.idx.value=t;e.innerHTML=Fct.colorItemNameFromIndex(t,false);ui.hideDlg()}static onClose(){ui.hideDlg()}static show(t){let e,i=-1,s=-1,a=$(t);DlgColorSelector.el=a;let l=a.attributes.idx.value,r=a.attributes.palidx.value;let n=a.attributes.description.value,o="",d="",c=$(t+"Lbl");if(n.length>0)d=n;else if(c!=null)d=c.innerText;if(d.length>0)o+='<div class="is-dlgcolor"><b>'+d+"</b></div>";o+='<ul id="selectorList" class="colorSelectorList has-border">';if(a.attributes.has_automatic.value==="true"){o+=Html.colorSelectorItem(-2,++i,255,255,255,l==-2);if(l==-2)s=i}if(a.attributes.has_none.value==="true"){o+=Html.colorSelectorItem(-1,++i,255,255,255,l==-1||l==App.missINT);if(l==-1||l==App.missINT)s=i}for(e=0;e<ui.paletteReds[r].length;e++){o+=Html.colorSelectorItem(e,++i,ui.paletteReds[r][e],ui.paletteGreens[r][e],ui.paletteBlues[r][e],l==e);if(l==e)s=i}o+="</ul>";ui.showDlg("",o,"");if(s!=-1){let t="ColorSelectorItem-"+s;$("selectorList").scrollTop=$(t).offsetTop-80}}}class DlgCoverage{static onApply(){let t=Fct.numFromElem("gccSmplCount",4);let e=Fct.numFromElem("gccSmplPerc",5);let i=Fct.numFromElem("gccMin",175);let s=Fct.numFromElem("gccSlope",.5);let a=Fct.numFromElem("gccMax",700);ui.hideDlg();if(t!=coll.goodCovPrms.obs_count||e!=coll.goodCovPrms.obs_percent||i!=coll.goodCovPrms.gap_min||s!=coll.goodCovPrms.gap_slope||a!=coll.goodCovPrms.gap_max)app.sendWsMsg('{"cmd":"assign_coverage_params","obs_count":'+t+',"obs_percent":'+e+',"gap_min":'+i+',"gap_slope":'+s+',"gap_max":'+a+"},"+Msg.msgGetCollInfo+","+Msg.msgGetCanvasCurrInfo)}static onDefault(){DlgCoverage.update(4,5,175,.5,700)}static show(){let t='<div id="gccTextDiv">Calculation of some derived variables, such as Dynamic Height, Brunt Vaisala Frequency, <br>Derivative, Integral or Geostrophic Velocity, requires good data coverage. These derived variables <br>are not calculated if any of the input variables fails one or more of the tests below.</div>';t+='<p><div id="gccGridDiv"></div><p>';t+="<p>with Z="+coll.primaryVar().fullLabel()+'<span style="float:right">'+Html.button("Default Settings","DlgCoverage.onDefault()")+"</span></p>";ui.showDlg("Good Coverage Criteria",t,Html.dlgBtn("DlgCoverage.onApply()"));DlgCoverage.update(coll.goodCovPrms.obs_count,coll.goodCovPrms.obs_percent,coll.goodCovPrms.gap_min,coll.goodCovPrms.gap_slope,coll.goodCovPrms.gap_max)}static update(t,e,i,s,a){let l='<div id="gccCr1c1">Number of samples with data:</div>';l+='<div id="gccCr1c2">&gt;</div>';l+='<div id="gccCr1c3">'+Html.numInput("gccSmplCount",t,0,999)+"</div>";l+='<div id="gccCr2c1">Fraction of samples with data:</div>';l+='<div id="gccCr2c2">&gt;</div>';l+='<div id="gccCr2c3">'+Html.numInput("gccSmplPerc",e,0,100)+"</div>";l+='<div id="gccCr2c4">%</div>';l+='<div id="gccCr3c1">Data gaps:</div>';l+='<div id="gccCr3c2">&lt;</div>';l+='<div id="gccCr3c3">min (</div>';l+='<div id="gccCr4c3">'+Html.txtInput("gccMin",i,"5.2em")+"</div>";l+='<div id="gccCr4c4">+</div>';l+='<div id="gccCr4c5">'+Html.txtInput("gccSlope",s,"5.2em")+"</div>";l+='<div id="gccCr4c6">* Z ,</div>';l+='<div id="gccCr5c3">'+Html.txtInput("gccMax",a,"5.2em")+"</div>";l+='<div id="gccCr5c4">)</div>';$("gccGridDiv").innerHTML=l}}class DlgCurrStatByName{static onApply(){let t=Fct.strFromElem("crLbl","");let e=Fct.strFromElem("stLbl",""),i=Fct.strFromElem("stTyp","*");ui.hideDlg();if(t.length==0||e.length==0)return;let s='{"cmd":"select_current_sample","conditions":[{"name":"Cruise",'+'"value":"'+t+'"}, {"name":"Station","value":"'+e+'"},';if(i=="B"||i=="C"||i=="X")s+=' {"name":"Type","value":"'+i+'"},';s+=' {"name":"sample_id","value":"'+ui.currSmplId+'"}]},';app.sendWsMsg(s+Msg.msgGetCurrInfo)}static show(){let t=ui.dockMetaVarLabels.indexOf("Station");let e=ui.dockMetaVarLabels.indexOf("Cruise");let i=ui.dockMetaValues[t].split("(");let s='<table class="StdTable">';s+="<tr><td>Cruise label:</td><td>"+Html.txtInput("crLbl",ui.dockMetaValues[e],"10em")+"</td></tr>";s+="<tr><td>Station label:</td><td>"+Html.txtInput("stLbl",i[0].trim(),"10em")+"</td></tr>";s+="<tr><td>Station type:</td><td>"+Html.txtInput("stTyp",i[1].charAt(0),"10em")+"</td></tr>";s+="</table>";ui.showDlg("Select Station by Name",s,Html.dlgBtn("DlgCurrStatByName.onApply()","Select"))}}class DlgCurveFitting{static constructCurve(){let t=Fct.selectedNum("LineType",0),e=Fct.selectedNum("LineOrient",0);let i=Fct.numFromElem("GridPtCount",30),s=Fct.numFromElem("LengthScale",80);app.sendWsMsg('{"cmd":"curve_fit","win_id":'+DlgCurveFitting.winId+',"curve_type":'+t+',"orientation":'+e+',"grid_point_count":'+i+',"length_scale":'+s+"}")}static enableControls(){let t=Fct.selectedNum("LineType",0);$("GridPtCount").disabled=t<1;$("LengthScale").disabled=t<2;$("btnShow").disabled=DlgCurveFitting.fitX.length==0}static onClose(){ui.hideDlg()}static onCurveChanged(){DlgCurveFitting.fitX=[];DlgCurveFitting.fitY=[];DlgCurveFitting.enableControls()}static show(){DlgCurveFitting.winId=ui.rclickWinId;let t=view.dataWinArr[ui.rclickWinId-1].yvId==coll.primaryVarId?1:0;DlgCurveFitting.fitX=[];DlgCurveFitting.fitY=[];let e="<p><fieldset><legend>Fitted Curves (based on visible data)</legend>";e+='<p><span style="float:right">Type:&ensp;'+Html.selectList("LineType",[0,1,2],["Least-squares line","Piece-wise linear least-squares","Moving average"],0)+"</span></p>";e+='<p><span style="float:right">Orientation:&ensp;'+Html.selectList("LineOrient",[0,1],["Y ( X )","X ( Y )"],t)+"</span></p>";e+='<p><span style="float:right">Number of gridpoints:&ensp;'+Html.numInput("GridPtCount",30,2,999,10)+"</span></p>";e+='<p><span style="float:right">Averaging length-scale [permille]:&ensp;'+Html.numInput("LengthScale",80,2,999,10)+"</span></p>";e+='<p style="clear:both">&nbsp;</p><p>'+Html.button("Construct Curve","DlgCurveFitting.constructCurve()")+'<span style="float:right">'+Html.button("Show Curve","DlgCurveFitting.showCurve()","btnShow")+"</span></p>";e+="</fieldset></p>";ui.showDlg(Ui.titleW("Curve Fitting",ui.rclickWinId),e,Html.dlgBtn("DlgCurveFitting.onClose()","Close"));$("LineOrient").style.width="70px";$("GridPtCount").style.width="62px";$("LengthScale").style.width="62px";$("LineType").addEventListener("change",DlgCurveFitting.onCurveChanged);$("LineOrient").addEventListener("change",DlgCurveFitting.onCurveChanged);$("GridPtCount").addEventListener("change",DlgCurveFitting.onCurveChanged);$("LengthScale").addEventListener("change",DlgCurveFitting.onCurveChanged);DlgCurveFitting.enableControls()}static showCurve(){let t=view.dataWinArr[ui.rclickWinId-1];let e=new GObject(11,[0,1],[0,1]);delete e.pxCoords;delete e.pyCoords;e.clipping="T";e.dragging="F";e.lColor=12;e.xCoords=[...DlgCurveFitting.fitX];e.yCoords=[...DlgCurveFitting.fitY];t.gObjSet.gObjArr.push(e);let i=Msg.modifyView(t.toXmlDataWindowOpen(ui.rclickWinId)+t.toXmlWindowOpen()+t.gObjSet.toXml()+t.toXmlWindowClose()+t.toXmlDataWindowClose(),viewHistory.currentName(),"Add Fitted Curve");app.sendWsMsg(i+","+Msg.msgGetCanvasCurrInfo)}}class DlgDataWin{static addContours(){const e=Fct.numFromElem("startVal",1),i=Fct.numFromElem("incVal",1),t=Fct.numFromElem("endVal",0),s=Fct.idxFromElem("LColor",0),a=Fct.numFromElem("FntSiz",10),l=Fct.selectedNum("LblCount",1),r=Fct.selectedNum("LWidth",0),n=Fct.selectedNum("LStyle",0),o=Fct.idxFromElem("FColor",-1);if(i==0)return;let d=Math.floor((t-e)/i+1),c,m;for(c=0;c<d;++c){m=e+c*i;let t=new Contour(m,a,s,l,s,r,n,o);DlgDataWin.dwCntrs.set(m,t)}DlgDataWin.updateContourAlreadyList();DlgDataWin.updateDoContour("T")}static colorBarNonLinIndexFor(t){if(t.nonLinAutoAdjust=="T")return 0;let e,i,s=DlgDataWin.nonLinEndArr.length,a,l=App.largeDOUBLE;let r=t.nonLinStart,n=t.nonLinEnd;for(i=1;i<s;++i){a=Math.abs(r-DlgDataWin.nonLinStartArr[i])+Math.abs(n-DlgDataWin.nonLinEndArr[i]);if(a<l){e=i;l=a}}return e}static currBlockVals(){let e=0,i=1,s=1;const a=viewInfo.zMatchingWinId(Fct.selectedNum("scope",0),Fct.selectedNum("zvId",-1));if(a>0){let t=viewInfo.contourBlocks[a];e=t.strt;i=t.inc;s=t.end}return{strt:e,inc:i,end:s}}static deleteContours(){const t=Fct.selectedNums("DwCntrCurrCntrs");t.forEach(t=>DlgDataWin.dwCntrs.delete(t));DlgDataWin.updateContourAlreadyList()}static enableArrPropBtn(){let t=Fct.selectedNum("PlotMode",0);if(t==6)Fct.setVisibility("DwArrPropsBtn",true);else Fct.setVisibility("DwArrPropsBtn");return t}static enableColorMappingPage(){const t=Fct.selectedNum("zvId",-1),e=t==App.VID_NONE;$("DwCMMedianSldr").disabled=e;$("DwCMNonLinSldr").disabled=e;$("DwCMLinMapBtn").disabled=e;$("DwCMAutoAdjBtn").disabled=e}static enableIsopycnicGridding(){let t=$("DoIsopycGridding"),e=false;t.disabled=true;let i=view.drvdVarSet.drvdVarArr,s,a=i.length;for(s=0;s<a;++s){if(i[s].type==2||i[s].type==44||i[s].type==107){e=true;break}}if(!e)return;if(Fct.selectedNum("scope",0)!=2||Fct.selectedNum("xvId",-1)!=App.VID_SECTION_COORD)return;if(!Fct.isChecked("DispGridded")||Fct.selectedNum("GridType",2)!=7)return;t.disabled=false}static fromSliderValues(t){let e=196-Fct.numFromElem("DwCMMedianSldr",196);let i=196-Fct.numFromElem("DwCMNonLinSldr",196);let s=(200-i)/20;t.nonLinStart=(e/200-1)*s;t.nonLinEnd=t.nonLinStart+s}static onApply(){const t=["","GEBCO_2023_2x2min_Global.nc","ETOPO1_2x2min_Global.nc"];let e=view.dataWinArr[ui.rclickWinId-1],i=DlgDataWin.dw;e.xLeft=i.xLeft;e.xRight=i.xRight;e.xProj=i.xProj;e.xTic=i.xTic;e.xLTic=i.xLTic;e.xAlign=i.xAlign;e.yBottom=i.yBottom;e.yTop=i.yTop;e.yProj=i.yProj;e.yTic=i.yTic;e.yLTic=i.yLTic;e.yAlign=i.yAlign;e.zBottom=i.zBottom;e.zTop=i.zTop;e.zProj=i.zProj;e.zTic=i.zTic;e.zLTic=i.zLTic;e.colBarAlign=i.colBarAlign;e.nonLinStart=i.nonLinStart;e.nonLinEnd=i.nonLinEnd;e.nonLinAutoAdjust=i.nonLinAutoAdjust;if(DlgDataWin.arrowPropsChanged==1){e.arrXvId=i.arrXvId;e.arrYvId=i.arrYvId;e.arrColor=i.arrColor;e.arrScale=i.arrScale;e.arrLineStyle=i.arrLineStyle;e.arrLineWidth=i.arrLineWidth}let s=Fct.isChecked("a2aGeneral");let a=Fct.idxFromElem("palName",-1);e.buddyAxisSync=e.winType==1?Fct.checkBoxState("buddySync"):"F";view.setDataWinGeneralProps(s?-1:ui.rclickWinId,a>-1?ui.paletteNames[a]:"Odv",Fct.numFromElem("fontSizeFac",100),Fct.idxFromElem("bckColor",31),Fct.idxFromElem("gridColor",0),Fct.checkBoxState("drawGrid"),Fct.checkBoxState("drawLabels"),Fct.selectedNum("hlStyle",2));let l=Fct.isChecked("a2aData");view.setDataWinVars(l?-1:ui.rclickWinId,Fct.selectedNum("scope",0),Fct.selectedNum("xvId",-1),Fct.selectedNum("yvId",-1),Fct.selectedNum("zvId",-1),Fct.checkBoxState("xRev"),Fct.checkBoxState("yRev"),Fct.checkBoxState("zRev"));e.drawContours=Fct.checkBoxState("DoContours");e.contours=Array.from(DlgDataWin.dwCntrs.values());let r=Fct.isChecked("a2aStyle");view.setDataWinMarkProps(r?-1:ui.rclickWinId,Fct.checkBoxState("MarkYes"),Fct.numFromElem("MarkSize",2)*.1,Fct.idxFromElem("MarkCol",17));if(Fct.isChecked("DispGridded")){if(e.contours.length>0)e.drawContours="T";view.setDataWinDispStyleGridded(r?-1:ui.rclickWinId,Fct.selectedNum("GridType",2),Fct.checkBoxState("AutoScale"),Fct.numFromElem("XScale",20)*.1,Fct.numFromElem("YScale",20)*.1,Fct.checkBoxState("DoIsopycGridding"),Fct.checkBoxState("DoShading"),Fct.checkBoxState("HideBad"),Fct.numFromElem("QualLim",3))}else{view.setDataWinDispStyleOrig(r?-1:ui.rclickWinId,Fct.selectedNum("PlotMode",0),Fct.numFromElem("SymbSize",7)*.1,Fct.idxFromElem("SymbCol",0),Fct.selectedNum("LWidthO",1))}e.DivaNonNegativity=Fct.checkBoxState("NonNeg");e.DivaSnr=Fct.numFromElem("SNR",50);e.DivaUseSecPoly=Fct.selectedNum("DomainSec",2)==2?"T":"F";e.DivaBathyFile=t[Fct.selectedNum("DomainMap",1)];let n=Fct.strFromElem("DomainDepth","");e.DivaBathyVal=n==="(automatic)"?App.missDOUBLE:parseFloat(n);ui.hideDlg();let o=s||l||r?-1:ui.rclickWinId;app.sendWsMsg(Msg.setDwProperties(o)+","+Msg.msgGetCanvasCurrInfo)}static onApplyAxisSettings(t){let e=DlgDataWin.dw;let i=Fct.numFromElem("minVal",App.missDOUBLE);let s=Fct.numFromElem("maxVal",App.largeDOUBLE);switch(t){case"X":e.xProj=Fct.selectedNum("axPrj",0);e.xTic=Fct.numFromElem("ticVal",App.largeDOUBLE);e.xLTic=Fct.numFromElem("lTicVal",App.largeDOUBLE);e.xAlign=Fct.selectedNum("axPos",1);if(Fct.isChecked("xRev")){e.xLeft=s;e.xRight=i}else{e.xLeft=i;e.xRight=s}break;case"Y":e.yProj=Fct.selectedNum("axPrj",0);e.yTic=Fct.numFromElem("ticVal",App.largeDOUBLE);e.yLTic=Fct.numFromElem("lTicVal",App.largeDOUBLE);e.yAlign=Fct.selectedNum("axPos",1);if(Fct.isChecked("yRev")){e.yBottom=s;e.yTop=i}else{e.yBottom=i;e.yTop=s}break;case"Z":e.zLTic=Fct.numFromElem("lTicVal",App.largeDOUBLE);e.colBarAlign=Fct.selectedNum("axPos",1);DlgDataWin.setSliderValues(e);if(Fct.isChecked("zRev")){e.zBottom=s;e.zTop=i}else{e.zBottom=i;e.zTop=s}break}ui.hideDlg()}static onAxisSettingsClick(t){const e=Fct.selectedNum("scope",0),i=View.varGroupId(e);let s,a,l=0,r,n,o,d,c=DlgDataWin.dw;let m=App.missDOUBLE,u=App.largeDOUBLE;switch(t){case"X":a=Fct.selectedNum("xvId",-1);l=c.xProj;r=c.xTic;n=c.xLTic;o=c.xAlign;m=Math.min(c.xLeft,c.xRight);u=Math.max(c.xLeft,c.xRight);break;case"Y":a=Fct.selectedNum("yvId",-1);l=c.yProj;r=c.yTic;n=c.yLTic;o=c.yAlign;m=Math.min(c.yBottom,c.yTop);u=Math.max(c.yBottom,c.yTop);break}if(e==3){s=ui.dockIsoVarIds.indexOf(a);d=ui.dockIsoVarLabels[s]}else d=coll.dataVarFullLabel(a);let p="<p><b>"+t+" Axis: "+d+"</b></p>";p+='<table class="StdTable">';p+="<tr><td>Minimum:</td><td>"+Html.txtInput("minVal",Fct.numToStr(m))+"</td></tr>";p+="<tr><td>Maximum:</td><td>"+Html.txtInput("maxVal",Fct.numToStr(u))+"</td></tr>";p+="<tr><td>Projection:</td><td>"+Html.selectListAxisProjection("axPrj",t,l)+"</td></tr>";p+="<tr><td>Tic mark interval:</td><td>"+Html.txtInput("ticVal",Fct.toStrOrAutomatic(r))+"</td></tr>";p+="<tr><td>Label interval:</td><td>"+Html.txtInput("lTicVal",Fct.toStrOrAutomatic(n))+"</td></tr>";p+="<tr><td>Position:</td><td>"+Html.selectListAxisPosition("axPos",t,o)+"</td></tr>";p+="</table>";ui.showDlg("Axis Properties",p,Html.dlgBtn("DlgDataWin.onApplyAxisSettings('"+t+"')"))}static onCbSettingsClick(){let t=DlgDataWin.dw;let e=Math.min(t.zBottom,t.zTop);let i=Math.max(t.zBottom,t.zTop);let s=Fct.selectedNum("scope",0),a,l=Fct.selectedNum("zvId",-1),r;if(s==3){a=ui.dockIsoVarIds.indexOf(l);r=ui.dockIsoVarLabels[a]}else r=coll.dataVarFullLabel(l);let n="<p><b>Colorbar: "+r+"</b></p>";n+='<table class="StdTable">';n+="<tr><td>Minimum:</td><td>"+Html.txtInput("minVal",Fct.numToStr(e))+"</td></tr>";n+="<tr><td>Maximum:</td><td>"+Html.txtInput("maxVal",Fct.numToStr(i))+"</td></tr>";n+="<tr><td>Label interval:</td><td>"+Html.txtInput("lTicVal",Fct.toStrOrAutomatic(t.zLTic))+"</td></tr>";n+="<tr><td>Position:</td><td>"+Html.selectListAxisPosition("axPos","Z",t.colBarAlign)+"</td></tr>";n+="</table>";ui.showDlg("Axis Properties",n,Html.dlgBtn("DlgDataWin.onApplyAxisSettings('Z')"))}static onGridTypeChange(){$("DispGridded").checked=true;DlgDataWin.enableIsopycnicGridding()}static onPaletteChange(){let t=Fct.idxFromElem("palName",-1);if(t==-1)return;ui.updatePaletteIdx("bckColor",t);ui.updatePaletteIdx("gridColor",t);ui.updatePaletteIdx("MarkCol",t);ui.updatePaletteIdx("SymbCol",t);ui.updatePaletteIdx("LColor",t);ui.updatePaletteIdx("FColor",t);DlgDataWin.updateColorBar()}static onPlotModeChange(){$("DispOrig").checked=true;let t=DlgDataWin.enableArrPropBtn();if(t==6)DlgArrowProps.show();DlgDataWin.enableIsopycnicGridding()}static onScopeChange(){let m=Fct.selectedNum("scope",0),u=View.varGroupId(m);if(u!=App.wrkArr[1]){let t=view.dataWinArr[App.wrkArr[0]-1],e=View.varGroupId(t.scope);let i=t.xvId,s=t.yvId,a=t.zvId;let l=t.xvLst,r=t.yvLst,n=t.zvLst;let o=t.xRev,d=t.yRev,c=t.zRev;if(u!=e&&u==1){i=1;s=0;a=App.VID_NONE;l=1;r=1;n=1;o="F";d="T";c="F"}else if(u!=e&&u==2){i=0;s=1;a=Math.min(4,view.isoVarSet.isoVarArr.length+3);l=2;r=2;n=2;o="F";d="F";c="F"}App.wrkArr[1]=u;DlgDataWin.updateAxisVars(m,i,s,a,o,d,c);DlgDataWin.onZVarChange();DlgDataWin.enableIsopycnicGridding()}if(m==0){$("zvId").selectedIndex=0;DlgDataWin.onZVarChange()}}static onXVarChange(){$("DispOrig").checked=true;$("xRev").checked=false;let t=DlgDataWin.dw;t.xProj=0;t.xLeft=App.missDOUBLE;t.xRight=App.largeDOUBLE;DlgDataWin.enableIsopycnicGridding()}static onYVarChange(){$("DispOrig").checked=true;$("yRev").checked=false;let t=DlgDataWin.dw;t.yProj=0;t.yBottom=App.missDOUBLE;t.yTop=App.largeDOUBLE}static onZVarChange(){let t=DlgDataWin.dw;$("zRev").checked=false;t.zBottom=App.missDOUBLE;t.zTop=App.largeDOUBLE;t.nonLinStart=-.1;t.nonLinEnd=.1;t.nonLinAutoAdjust="F";DlgDataWin.dwCntrs.clear();DlgDataWin.updateContourAlreadyList();let{strt:e,inc:i,end:s}=DlgDataWin.currBlockVals();DlgDataWin.updateContourBlock(e,i,s);DlgDataWin.setSliderValues(t);DlgDataWin.updateColorMappingTitle();DlgDataWin.enableColorMappingPage()}static setAutoAdjustedColorMapping(){let t=viewInfo.autoColorMappingPrms[DlgDataWin.clickWinId];DlgDataWin.setSliderValuesP(t[0],t[1])}static setAutoContours(){DlgDataWin.dwCntrs.clear();const t=viewInfo.zMatchingWinId(Fct.selectedNum("scope",0),Fct.selectedNum("zvId",-1));if(t>0){const e=Fct.idxFromElem("LColor","0");viewInfo.autoContours[t].forEach(t=>DlgDataWin.dwCntrs.set(t.zVal,new Contour(t.zVal,t.fntSiz,e,t.lblCount,e,t.lWidth,t.lStyle,t.fCol)));DlgDataWin.updateContourAlreadyList();DlgDataWin.updateDoContour("T")}}static setLinearColorMapping(){let t=DlgDataWin.dw;t.nonLinStart=-.1;t.nonLinEnd=.1;t.nonLinAutoAdjust="F";DlgDataWin.setSliderValues(t)}static setSliderValues(t){let e=t.nonLinEnd-t.nonLinStart;let i=200*(1+t.nonLinStart/e),s=200-20*e;DlgDataWin.setSliderValuesP(i,s)}static setSliderValuesP(t,e){$("DwCMMedianSldr").value=196-t;$("DwCMNonLinSldr").value=196-e;DlgDataWin.updateColorBar()}static show(t,e){DlgDataWin.nonLinStartArr=[-.1,-.1,0,0,-.75,-1.5,-1.5,-3];DlgDataWin.nonLinEndArr=[.1,.1,1.5,3,.75,1.5,0,0];DlgDataWin.clickWinId=t;DlgDataWin.arrowPropsChanged=0;DlgDataWin.isGeographicMap=e;let i=view.dataWinArr[t-1],s=i.plotMode;if(s==3)s=0;let a=s==1||s==2||s==7,l=a?s:2,r=i.colBarAlign;let n=viewInfo.contourBlocks[t];let o=i.DivaBathyVal==App.missDOUBLE?"(automatic)":i.DivaBathyVal.toString();let d=0;if(i.DivaBathyFile.indexOf("GEBCO")>-1)d=1;else if(i.DivaBathyFile.indexOf("ETOPO1")>-1)d=2;DlgDataWin.dw={};ui.dlgOrigVals=new Map;Object.assign(DlgDataWin.dw,i);const c="DlgDataWin",m=ui.getLastOpenElem(c);let u='<div class="TabbedDlg" id="'+c+'" style="width:660px">';u+=Html.panelBegin(c,1,"General",m==1);u+=Html.winGeneral(i,true);u+="<p>&nbsp;</p>";u+=Html.checkBox("a2aGeneral",Ui.dlgA2aStr,false);u+=Html.panelEnd();u+=Html.panelBegin(c,2,"Data",m==2);u+="<p>Scope: "+Html.selectList("scope",[0,1,2,3],["STATION: Data of picked stations","SCATTER: Data of all stations shown in the map","SECTION: Data of all stations inside the section band","SURFACE: Isosurface data of all stations shown in the map"],i.scope)+"</p><p>&nbsp;</p>";u+='<div id="DwAxisVars"></div>';u+="<p>&nbsp;</p>";u+=Html.checkBox("a2aData",Ui.dlgA2aStr,false);u+=Html.panelEnd();u+=Html.panelBegin(c,3,"Display Style",m==3);u+='<table id="DwDispStyleTbl">';u+='<tr><td><input type="radio" id="DispOrig" name="DispStyle"> '+Html.labelFor("DispOrig","<b>Original data</b>")+'</td><td><input type="radio" id="DispGridded" name="DispStyle"> '+Html.labelFor("DispGridded","<b>Gridded field</b>")+"</td></tr>";u+="<tr><td>&nbsp;</td><td></td></tr>";u+="<tr><td>"+Html.selectList("PlotMode",[0,8,4,6,9,10,11],["Colored Dots","Sized Dots","Numbers","Arrows","Colored Dots (X Quality)","Colored Dots (Y Quality)","Colored Dots (Z Quality)"],i.plotMode)+"</td><td>"+Html.selectList("GridType",[1,2,7],["Quick gridding","Weighted-average gridding","DIVA gridding"],l)+"</td></tr>";u+="<tr><td>&nbsp;</td><td></td></tr>";u+="<tr><td>"+Html.numInput("SymbSize",Fct.roundedVal(i.symbSize*10,0),1,99,1)+"&ensp;Symbol size</td><td>"+Html.checkBoxTF("AutoScale","Automatic scale lengths",i.autoScale)+"</td></tr>";u+="<tr><td>"+Html.colorSelector("SymbCol",i.palName,i.symbColor,true)+"&ensp;Symbol color</td><td>"+Html.numInput("XScale",Fct.roundedVal(i.xScale*10,0),1,999,5)+"&ensp;X scale-length [permille]</td></tr>";u+="<tr><td>"+Html.selectListLineWidth("LWidthO",i.lineWidth)+"&ensp;Line width</td><td>"+Html.numInput("YScale",Fct.roundedVal(i.yScale*10,0),1,999,5)+"&ensp;Y scale-length [permille]</td></tr>";u+="<tr><td></td><td>"+Html.checkBoxTF("DoIsopycGridding","Isopycnic gridding",i.isopycnicGridding)+"</td></tr>";u+="<tr><td></td><td>"+Html.checkBoxTF("DoShading","Do color shading",i.drawShaded)+"</td></tr>";u+="<tr><td>"+Html.button("Arrow Properties","DlgArrowProps.show()","DwArrPropsBtn")+"</td><td>"+Html.checkBoxTF("HideBad","Hide bad estimates",i.hideBad)+"</td></tr>";u+="<tr><td></td><td>"+Html.numInput("QualLim",Fct.roundedVal(i.hideDistance,1),0,1e5,.5)+"&ensp;Quality limit</td></tr>";u+='<tr><td colspan="2"><hr></td></tr>';u+="<tr><td>"+Html.checkBoxTF("MarkYes","Draw marks",i.drawMarks)+"</td><td>"+Html.numInput("MarkSize",Fct.roundedVal(i.markSize*10,0),1,99)+"&ensp;Mark size&emsp;&emsp;"+Html.colorSelector("MarkCol",i.palName,i.markColor)+"&ensp;Mark color</td></tr>";u+="</table>";u+="<p>"+Html.checkBox("a2aStyle",Ui.dlgA2aStr,false)+"</p>";u+=Html.panelEnd();u+=Html.panelBegin(c,4,"Contours",m==4);u+='<div id="DwCntrGrid">';u+='<div id="DwCntrDoContours" class="is-displaynone">'+Html.checkBoxTF("DoContours","Do contours",i.drawContours)+"</div>";u+='<div id="DwCntrLblDefined"><b>Already Defined</b></div>';u+='<div id="DwCntrLblNew"><b>New</b></div>';u+='<div id="DwCntrLblLine">Line</div>';u+='<div id="DwCntrLblLabels">Labels</div>';u+='<div id="DwCntrLblFill">Fill</div>';u+='<div id="DwCntrDefinedLst"></div>';u+=Html.button("<b> << </b>","DlgDataWin.addContours()","DwCntrAddBtn");u+=Html.button("<b> >> </b>","DlgDataWin.deleteContours()","DwCntrDelBtn");u+=Html.button("<b> << auto-create </b>","DlgDataWin.setAutoContours()","DwCntrAddAutoBtn");u+='<div id="DwCntrStrt">'+Html.txtInput("startVal",n.strt)+" Start</div>";u+='<div id="DwCntrInc">'+Html.txtInput("incVal",n.inc)+" Increment</div>";u+='<div id="DwCntrEnd">'+Html.txtInput("endVal",n.end)+" End</div>";u+='<div id="DwCntrFntSiz">'+Html.numInput("FntSiz",10,0,50)+" pt</div>";u+='<div id="DwCntrLWidth">'+Html.selectListLineWidth("LWidth",0)+"</div>";u+='<div id="DwCntrColor">'+Html.colorSelector("LColor",i.palName,0,false,false,"Contour line color")+"</div>";u+='<div id="DwCntrLStyle">'+Html.selectListLineStyle("LStyle",0)+"</div>";u+='<div id="DwCntrFillColor">'+Html.colorSelector("FColor",i.palName,-1,true,true,"Contour fill color")+"</div>";u+='<div id="DwCntrLblCount">'+Html.selectListContourLabelCount("LblCount",1)+"</div>";u+="</div>";u+=Html.panelEnd();u+=Html.panelBegin(c,5,"Color Mapping",m==5);u+='<div id="DwCMGrid">';u+='<div id="DwCMTitle"></div>';u+='<div id="DwCMMedianLbl">Median</div>';u+='<div id="DwCMNonLinLbl">Nonlinearity</div>';u+='<div id="DwCMBarDiv">'+Html.canvas("DwCMBarCnvs",20,160)+"</div>";u+='<div id="DwCMMedian">'+Html.slider("DwCMMedianSldr",0,196)+"</div>";u+='<div id="DwCMNonLin">'+Html.slider("DwCMNonLinSldr",0,196)+"</div>";u+='<div id="DwCMHighLbl">high</div>';u+='<div id="DwCMLowLbl">low</div>';u+='<div id="DwCMLinMap">'+Html.button("Linear Mapping","DlgDataWin.setLinearColorMapping()","DwCMLinMapBtn")+"</div>";u+='<div id="DwCMAutoAdj">'+Html.button("Auto Adjust","DlgDataWin.setAutoAdjustedColorMapping()","DwCMAutoAdjBtn")+"</div>";u+="</div>";u+=Html.panelEnd();u+=Html.panelBegin(c,6,"DIVA Settings",m==6);u+=Html.checkBoxTF("NonNeg","Prevent negative gridded values",i.DivaNonNegativity);u+='<table class="StdTable"><tr><td>&nbsp;</td><td></td></tr>';u+="<tr><td>Signal-to-noise ratio:</td><td>"+Html.txtInput("SNR",i.DivaSnr)+"</td></tr>";u+="<tr><td>&nbsp;</td><td></td></tr>";u+="<tr><td>Domain selection - Section:</td><td>"+Html.selectList("DomainSec",[1,2],["(none)","Section Bathymetry Polygon"],Fct.toBool(i.DivaUseSecPoly)?2:1)+"</td></tr>";u+="<tr><td>&nbsp;</td><td></td></tr>";u+="<tr><td>Domain selection - Map:</td><td>"+Html.selectList("DomainMap",[0,1,2],["(none)","GEBCO","ETOPO1"],d)+"</td></tr>";u+="<tr><td>Depth [m]:</td><td>"+Html.txtInput("DomainDepth",o)+"</td></tr>";u+="</table>";u+=Html.panelEnd()+"</div>";App.wrkArr=[];App.wrkArr.push(t);App.wrkArr.push(View.varGroupId(i.scope));DlgDataWin.dwCntrs=new Map;i.contours.forEach(function(t){DlgDataWin.dwCntrs.set(t.zVal,t)});ui.showDlg("Properties "+Ui.windowName(t),u,Html.dlgBtn("DlgDataWin.onApply()"));$("tabPanel"+m).click();DlgDataWin.updateAxisVars(i.scope,i.xvId,i.yvId,i.zvId,i.xRev,i.yRev,i.zRev);$("DispOrig").checked=!a;$("DispGridded").checked=a;if(DlgDataWin.observer==undefined)DlgDataWin.observer=new MutationObserver(DlgDataWin.onPaletteChange);DlgDataWin.observer.observe($("palName"),{childList:true});$("scope").addEventListener("change",DlgDataWin.onScopeChange);$("xvId").addEventListener("change",DlgDataWin.onXVarChange);$("yvId").addEventListener("change",DlgDataWin.onYVarChange);$("zvId").addEventListener("change",DlgDataWin.onZVarChange);$("PlotMode").addEventListener("change",DlgDataWin.onPlotModeChange);$("GridType").addEventListener("change",DlgDataWin.onGridTypeChange);$("DwCMMedianSldr").addEventListener("change",DlgDataWin.updateColorBar);$("DwCMNonLinSldr").addEventListener("change",DlgDataWin.updateColorBar);let p=$("LWidthO"),g=p.clientWidth-30,h=p.offsetWidth+1;$("SymbSize").style.width=g+"px";$("SymbCol").style.width=g+"px";$("MarkCol").style.width=g+"px";DlgDataWin.updateContourAlreadyList();DlgDataWin.enableArrPropBtn();DlgDataWin.enableIsopycnicGridding();DlgDataWin.setSliderValues(i)}static updateAxisVars(t,e,i,s,a,l,r){const n=t==3?ui.dockIsoVarIds:ui.dockDataVarIds;const o=t==3?ui.dockIsoVarLabels:ui.dockDataVarLabels;let d=DlgDataWin.isGeographicMap==1?"":"Reverse range";let c=DlgDataWin.isGeographicMap==1?"":Html.button("X-Axis Settings","DlgDataWin.onAxisSettingsClick('X')");let m=DlgDataWin.isGeographicMap==1?"":Html.button("Y-Axis Settings","DlgDataWin.onAxisSettingsClick('Y')");let u=s==App.VID_NONE?"":Html.button("Colorbar Settings","DlgDataWin.onCbSettingsClick()");let p='<table class="StdTable" id="AxisVarsTable">';p+="<tr><td><b>X Axis:</b></td><td>"+Html.selectList("xvId",n,o,e)+"</td><td>"+c+"</td><td>"+Html.checkBoxTF("xRev",d,a)+"</td></tr>";p+='<tr><td colspan="4">&nbsp;</td></tr>';p+="<tr><td><b>Y Axis:</b></td><td>"+Html.selectList("yvId",n,o,i)+"</td><td>"+m+"</td><td>"+Html.checkBoxTF("yRev",d,l)+"</td></tr>";p+='<tr><td colspan="4">&nbsp;</td></tr>';p+="<tr><td><b>Z Axis:</b></td><td>"+Html.selectList("zvId",n,o,s,0,App.VID_NONE,"(none)")+"</td><td>"+u+"</td><td>"+Html.checkBoxTF("zRev","Reverse range",r)+"</td></tr>";p+="</table>";$("DwAxisVars").innerHTML=p;DlgDataWin.updateColorMappingTitle();DlgDataWin.enableColorMappingPage();if(DlgDataWin.isGeographicMap==1){$("xRev").style.display="none";$("yRev").style.display="none"}}static updateColorBar(){let t=Fct.idxFromElem("palName",-1);if(t==-1)return;let e=ui.paletteReds[t],i=ui.paletteGreens[t];let s=ui.paletteBlues[t];let a=DlgDataWin.dw;DlgDataWin.fromSliderValues(a);let l=a.zBottom,r=a.zTop;if(l==App.missDOUBLE){l=0;r=1}let n=a.nonLinStart,o=a.nonLinEnd;let d=Math.tanh(n),c=Math.tanh(o);let m=1/(r-l),u=o-n,p=1/(c-d);const g=$("DwCMBarCnvs"),h=g.getContext("2d");const v=g.clientHeight,f=g.clientWidth;const b=2,D=v/b;const S=32,y=144,w=y-S-2;let x,I,C=3,F=(l-r)/v,V,M;h.lineWidth=b+1;for(x=0;x<=D;++x){V=F*C+r;M=n+(V-l)*m*u;M=(Math.tanh(M)-d)*p;M=Math.max(0,Math.min(1,M));I=Math.floor(S+1+w*M);h.strokeStyle=Html.rgb(e[I],i[I],s[I]);h.beginPath();h.moveTo(0,C);h.lineTo(f,C);h.stroke();C+=b}}static updateColorMappingTitle(){const t=Fct.selectedNum("scope",0),e=Fct.selectedNum("zvId",-1);const i=t==3?ui.dockIsoVarLabels:ui.dockDataVarLabels;$("DwCMTitle").innerHTML=e==App.VID_NONE?"(none)":i[e]}static updateContourAlreadyList(){let e=[];const t=Array.from(DlgDataWin.dwCntrs.keys()).sort((t,e)=>t-e);t.map(t=>{e.push(Fct.roundedVal(t,5))});$("DwCntrDefinedLst").innerHTML=Html.selectList("DwCntrCurrCntrs",e,e,App.missDOUBLE,1);$("DwCntrCurrCntrs").addEventListener("click",DlgDataWin.updateContourNewProps)}static updateContourBlock(t,e,i){$("startVal").value=t;$("incVal").value=e;$("endVal").value=i}static updateContourNewProps(){let t=ui.rclickWinId,e=0,i=0,s=0,a=1,l=-1,r=10;let{strt:n,inc:o,end:d}=DlgDataWin.currBlockVals();const c=view.dataWinArr[t-1].palName;const m=Fct.selectedNums("DwCntrCurrCntrs");if(m.length==1){let t=DlgDataWin.dwCntrs.get(m[0]);n=d=t.zVal;o=1;e=t.lWidth;i=t.lblCol;s=t.lStyle;a=t.lblCount;l=t.fCol;r=t.fntSiz}DlgDataWin.updateContourBlock(n,o,d);$("FntSiz").value=r;$("DwCntrLWidth").innerHTML=Html.selectListLineWidth("LWidth",e);$("DwCntrColor").innerHTML=Html.colorSelector("LColor",c,i,false,false,"Contour line color");$("DwCntrLStyle").innerHTML=Html.selectListLineStyle("LStyle",s);$("DwCntrFillColor").innerHTML=Html.colorSelector("FColor",c,l,true,true,"Contour fill color");$("DwCntrLblCount").innerHTML=Html.selectListContourLabelCount("LblCount",a)}static updateDoContour(t){$("DwCntrDoContours").innerHTML=Html.checkBoxTF("DoContours","Do contours",t)}}class DlgDispOrder{static enableButtons(){let t=App.wrkArr.length-1,e=!(App.wrkIdx>0);$("btnUp").disabled=e;$("btnTop").disabled=e;e=!(App.wrkIdx>=0&&App.wrkIdx<t);$("btnDown").disabled=e;$("btnBottom").disabled=e}static moveBottom(){DlgDispOrder.moveTo(App.wrkArr.length-1)}static moveDown(){DlgDispOrder.moveTo(App.wrkIdx+1)}static moveTo(t){if(App.wrkIdx==-1)return;Fct.moveElem(App.wrkArr,App.wrkIdx,t);Fct.moveElem(App.wrkArr2,App.wrkIdx,t);DlgDispOrder.updateList()}static moveTop(){DlgDispOrder.moveTo(0)}static moveUp(){DlgDispOrder.moveTo(App.wrkIdx-1)}static onApply(){ui.hideDlg();DlgDispOrder.sendMsg()}static onClick(t){App.wrkVal=Fct.selectedNum("DispOrderLst",-1);App.wrkIdx=App.wrkArr.indexOf(App.wrkVal);DlgDispOrder.enableButtons()}static sendMsg(){app.sendWsMsg(Msg.modifyView("<VariableDisplayOrder>"+App.wrkArr.join(",")+"</VariableDisplayOrder>",viewHistory.currentName(),"Change Variable Display Order")+","+Msg.msgGetDockDataVarLbls+","+Msg.msgGetDockDataVarVals)}static setDefault(){ui.hideDlg();App.wrkArr=Fct.intArray(0,coll.dataVarCount());App.wrkArr=App.wrkArr.concat(viewInfo.drvdVarIds);DlgDispOrder.sendMsg()}static show(){App.wrkVal=0;App.wrkArr=[...ui.dockDataVarIds];App.wrkArr2=[...ui.dockDataVarLabels];let t='<table class="StdTable"> <tr><td rowspan="10"><div id="DispOrderDiv"></div></td><td>'+Html.button("Top","DlgDispOrder.moveTop()","btnTop",true)+"</td></tr> <tr><td>"+Html.button("Up","DlgDispOrder.moveUp()","btnUp",true)+"</td></tr> <tr><td>"+Html.button("Down","DlgDispOrder.moveDown()","btnDown",true)+"</td></tr> <tr><td>"+Html.button("Bottom","DlgDispOrder.moveBottom()","btnBottom",true)+"</td></tr> <tr><td>&nbsp;</td></tr> <tr><td>"+Html.button("<b>Default Order</b>","DlgDispOrder.setDefault()","btnDflt",true)+"</td></tr> </table>";ui.showDlg("Display Order - Variables",t,Html.dlgBtn("DlgDispOrder.onApply()"));DlgDispOrder.updateList()}static updateList(){$("DispOrderDiv").innerHTML=Html.selectList("DispOrderLst",App.wrkArr,App.wrkArr2,App.wrkVal);let t=$("DispOrderLst");t.size=14;t.setAttribute("style","max-width:340px");t.addEventListener("click",DlgDispOrder.onClick);App.wrkIdx=App.wrkArr.indexOf(App.wrkVal);DlgDispOrder.enableButtons()}}class DlgDrvdVars{static addVar(a=-1){let l=this.dv,r=l.type,n=l.inpVarIds;if(r==9){l.name="Ratio ("+coll.dataVarFullLabel(n[0],false,App.wrkArr)+" / "+coll.dataVarFullLabel(n[1],false,App.wrkArr)+")";l.uname="Ratio ("+coll.dataVarFullLabel(n[0],true,App.wrkArr)+" / "+coll.dataVarFullLabel(n[1],true,App.wrkArr)+")"}else if(r==10||r==11||r==50||r==146){l.name+=" "+coll.dataVarNameLabel(n[1],false,App.wrkArr);l.uname+=" "+coll.dataVarNameLabel(n[1],true,App.wrkArr)}else if(r==104||r==107){let t=l.fPrms[0],e=ui.drvdVarChoice(r);l.name=e.name;l.uname=e.uname;if(t>0){l.name+="-"+t;l.uname+="-"+t}}else if(r==141){l.name="Interpolated "+coll.dataVarNameLabel(n[1],false,App.wrkArr);l.uname="Interpolated "+coll.dataVarNameLabel(n[1],true,App.wrkArr);l.units=coll.dataVarUnitsLabel(n[1],false,App.wrkArr);l.uunits=coll.dataVarUnitsLabel(n[1],true,App.wrkArr)}else if(r==143){l.name="StandardDeviation "+coll.dataVarNameLabel(n[0],false,App.wrkArr);l.uname="StandardDeviation "+coll.dataVarNameLabel(n[0],true,App.wrkArr);l.units=coll.dataVarUnitsLabel(n[0],false,App.wrkArr);l.uunits=coll.dataVarUnitsLabel(n[0],true,App.wrkArr)}else if(r==81||r==49||r==64||r==83||r==66||r==68||r==48||r==147){let t=r==48?ui.timeVarCnvIds:ui.metaTimeVarCnvIds;let e=r==48?ui.timeVarCnvLbls:ui.metaTimeVarCnvLbls;let i=coll.dataVarFullLabel(n[0],false);let s=Fct.identifyTimeConversionIdx(i,e);if(s==-1){DlgTimeVarSelCnv.show(a,l,i,t,e);return}else{if(r==48){DlgTimeVarSettings.show(a,l,t[s]);return}else DlgDrvdVars.setTimeVarIPrms(l,t[s])}}DlgDrvdVars.newDrvdVar(a,l)}static deepCopy(t){DlgDrvdVars.dv=Object.assign({},t);DlgDrvdVars.dv.inpVarIds=[...t.inpVarIds];DlgDrvdVars.dv.iPrms=[...t.iPrms];DlgDrvdVars.dv.fPrms=[...t.fPrms]}static enableButtons(){if(ui.currDlgIdx>0)return;let t=Fct.selectedNums("DrvdVarList"),e=t.length;$("DeleteDrvdVarsBttn").disabled=e==0;$("EditDrvdVarsBttn").disabled=e!=1||!DlgDrvdVars.isEditable(t[0])}static identifyInpVar(t){if(t==DlgDrvdVars.dv.queryStrsInpVarLabels.length){DlgDrvdVars.addVar();return}let e=DlgDrvdVars.dv.queryStrsInpVarLabels[t];ui.dlgSelectItem("Macro File",coll.dataVarFullLabels(App.wrkArr,true),"DlgDrvdVars.setInpVar("+t+")","Identify: "+e,e)}static isEditable(t){let e=App.wrkArr[t].type,i=ui.drvdVarChoice(e);if(i===undefined)return false;return e==12||e==45||i.queryStrsInpVar.length>0||i.queryStrsRef.length>0||i.queryStrsMultiInpVar.length>0}static newDrvdVar(t,e){let i=t==-1?View.nextDrvdVarId(App.wrkArr):e.varId;let s=new DrvdVar(e.name,e.units,e.uname,e.uunits,i,e.type,e.digitsCount,e.inpVarIds,e.iPrms,e.fPrms,e.macroFile,e.expr,e.patches,App.missDOUBLE,App.largeDOUBLE);if(t==-1)App.wrkArr.push(s);else App.wrkArr[t]=s;DlgDrvdVars.update()}static onApply(){view.drvdVarSet.drvdVarArr=App.wrkArr;ui.hideDlg();app.sendWsMsg(Msg.setDrvdVars()+","+Msg.msgGetDockDataVarLbls+","+Msg.msgGetCanvasCurrInfo)}static onApplyProps(e=-1){let i=this.dv,s=i.type,t=true,a,l=[],r;if(i.queryStrsMultiInpVar.length>=1){l=Fct.selectedNums("inpVarMulti",-1);t=l.length>0}if(i.queryStrsInpVar.length>=1){i.inpVarIds=[];if(s==10||s==50||s==11||s==141||s==146)i.inpVarIds.push(coll.primaryVarId);a=Fct.selectedNum("inpVarId1",-1);if(a>-1){if(s==142)l.push(a);else if(s==74){i.iPrms.push(a);let t=coll.metaVar(a);i.name=t.name;i.uname=t.uname;i.units=t.units;i.uunits=t.uunits}else i.inpVarIds.push(a)}else t=false}if(t&&i.queryStrsInpVar.length>=2){a=Fct.selectedNum("inpVarId2",-1);if(a>-1)i.inpVarIds.push(a);else t=false}if(t&&i.queryStrsRef.length>=1){a=Fct.numFromElem("refVal1",App.missDOUBLE);if(a!=App.missDOUBLE){i.fPrms=[];i.fPrms.push(a)}else t=false}ui.hideDlg();if(!t)return;if(s==140||s==142){let t=s==140?"Aggregated ":"Converted ";i.name=t+coll.dataVarNameLabel(l[0],false,App.wrkArr);i.units=coll.dataVarUnitsLabel(l[0],false,App.wrkArr);i.digitsCount=coll.dataVarDecimalCount(l[0],App.wrkArr);i.aggrType=0;i.facs=[];i.offs=[];DlgAcVar.addInpVars(l);DlgAcVar.show(e)}else DlgDrvdVars.addVar(e)}static onDelete(){let t=Fct.selectedNums("DrvdVarList");if(t.length>0){App.wrkArr=Fct.strippedArray(App.wrkArr,t);DlgDrvdVars.update()}}static onEdit(){let e=Fct.selectedNum("DrvdVarList");let t=App.wrkArr[e].type,i=ui.drvdVarChoice(t);DlgDrvdVars.setCurrDrvdVar(i,e);if(t==140||t==142){let t=DlgDrvdVars.dv;t.aggrType=0;t.facs=[];t.offs=[];DlgAcVar.show(e)}else if(t==12||t==45)DlgExprVar.show(e);else if(i.queryStrsMultiInpVar.length>0||i.queryStrsInpVar.length>0||i.queryStrsRef.length>0)DlgDrvdVars.queryProps(e)}static onMacroSelected(t){if(t.length>0)app.sendWsMsg('{"cmd":"get_macro","macro_name":"'+t+'"}')}static onSelectPatches(){DlgDrvdVars.patchNames=Fct.selectedStrs("selectList");ui.hideDlg();if(DlgDrvdVars.patchNames.length)ui.dlgQueryStr("Patches Variable","Label","Patches","DlgDrvdVars.onSelectPatches2()")}static onSelectPatches2(){let t=$("queryStr").value;ui.hideDlg();if(t.length==0)return;let e=DlgDrvdVars.dv,i=DlgDrvdVars.patchNames,s,a=i.length,l;e.name=t;e.uname=e.name;e.inpVarIds=[];e.patches=[];for(s=0;s<a;++s){l=coll.privPatches.has(i[s])?coll.privPatches.get(i[s]):coll.pubPatches.get(i[s]);if(l===undefined)continue;e.inpVarIds.push(l.xVarId);e.inpVarIds.push(l.yVarId);e.patches.push(l)}DlgDrvdVars.addVar(-1)}static onSelectStrVar(){let t=Fct.selectedStr("selectList","");ui.hideDlg();let e=DlgDrvdVars.dv;e.name=t+" "+e.name;e.uname=e.name;let i=DlgDrvdVars.dvLbls.indexOf(t);if(i>-1){e.iPrms.push(DlgDrvdVars.dvIds[i]);e.iPrms.push(1);e.iPrms.push(0)}else{i=DlgDrvdVars.mvLbls.indexOf(t);if(i>-1){e.iPrms.push(DlgDrvdVars.mvIds[i]);e.iPrms.push(0);e.iPrms.push(0)}}if(i>-1)DlgDrvdVars.addVar(-1)}static onTreeItemClick(){if(ui.currDlgIdx>0)return;let t=this.value,e=ui.drvdVarChoice(t);DlgDrvdVars.setCurrDrvdVar(e,-1);if(e.queryStrsMultiInpVar.length>0||e.queryStrsInpVar.length>0||e.queryStrsRef.length>0)DlgDrvdVars.queryProps(-1);else if(e.type==12)DlgSelTreeItem.show("Select Macro File",3,DlgDrvdVars.onMacroSelected);else if(e.type==45)DlgExprVar.show(-1);else if(e.type==145){DlgDrvdVars.dvIds=[];DlgDrvdVars.mvIds=[];DlgDrvdVars.dvLbls=[];DlgDrvdVars.mvLbls=[];coll.dataVars.varArr.map((t,e)=>{if(!t.isNumeric()){DlgDrvdVars.dvIds.push(e);DlgDrvdVars.dvLbls.push(t.fullLabel())}});coll.metaVars.varArr.map((t,e)=>{if(!t.isNumeric()){DlgDrvdVars.mvIds.push(e);DlgDrvdVars.mvLbls.push(t.fullLabel())}});ui.dlgSelectItem("Select a String Variable",DlgDrvdVars.dvLbls.concat(DlgDrvdVars.mvLbls),"DlgDrvdVars.onSelectStrVar()")}else if(e.type==17){let t=Array.from(coll.privPatches.keys()).concat(Array.from(coll.pubPatches.keys()));if(t.length>0)DlgSelItems.show("Select Patches",t,t,"DlgDrvdVars.onSelectPatches()")}else DlgDrvdVars.addVar(-1)}static queryProps(e=-1){let i=DlgDrvdVars.dv,s,a="",l=coll.dataVarIds(App.wrkArr);let r=coll.dataVarFullLabels(App.wrkArr,true);if(i.queryStrsMultiInpVar.length>=1){a+="<p>Select: "+i.queryStrsMultiInpVar[0]+"</p>";let t=e==-1?[-1]:i.inpVarIds;a+=Html.selectListEx("inpVarMulti",l,r,t,1)}if(i.queryStrsInpVar.length>=1){a+="<p>Select: "+i.queryStrsInpVar[0]+"</p>";s=e==-1?-1:i.inpVarIds[0];if(i.type==74){let t=coll.metaVarIds(false,true,true,false);let e=coll.metaVarFullLabels(false,true,true,false);if(t.length>0)a+=Html.selectList("inpVarId1",t,e,s)}else a+=Html.selectList("inpVarId1",l,r,s)}if(i.queryStrsInpVar.length>=2){a+="<p>Select: "+i.queryStrsInpVar[1]+"</p>";s=e==-1?-1:i.inpVarIds[1];a+=Html.selectList("inpVarId2",l,r,s)}if(i.queryStrsRef.length>=1){a+="<p>"+i.queryStrsRef[0]+"</p>";a+=Html.txtInput("refVal1",i.fPrms[0])}ui.showDlg(Fct.fullVarLabel(i.uname,i.uunits),a,Html.dlgBtn("DlgDrvdVars.onApplyProps("+e+")","Select"))}static setCurrDrvdVar(t,e=-1){if(e>-1){DlgDrvdVars.deepCopy(App.wrkArr[e]);DlgDrvdVars.dv.queryStrsInpVar=[...t.queryStrsInpVar];DlgDrvdVars.dv.queryStrsMultiInpVar=[...t.queryStrsMultiInpVar];DlgDrvdVars.dv.queryStrsRef=[...t.queryStrsRef]}else DlgDrvdVars.deepCopy(t)}static setInpVar(e){let t=Fct.selectedStr("selectList","");ui.hideDlg();let i=coll.dataVarFullLabels(App.wrkArr,true).indexOf(t);if(i>-1){let t=coll.dataVarIds(App.wrkArr)[i];DlgDrvdVars.dv.inpVarIds.push(t);DlgDrvdVars.identifyInpVar(e+1)}}static setTimeVarIPrms(t,e,i=0,s=0,a=1,l=1){t.iPrms=[];t.iPrms.push(e);if(t.type==48){t.iPrms.push(i);t.iPrms.push(s);t.iPrms.push(a);t.iPrms.push(l)}}static show(){const t="DrvdVarTree";ui.dlgOrigVals=new Map;App.wrkArr=[...view.drvdVarSet.drvdVarArr];let e='<table id="DrvdVarTable">';e+="<tr><td><b>Already Defined</b></td><td><b>Choices</b></td></tr>";e+='<tr><td colspan="2">&nbsp;</td></tr>';e+='<tr><td><div id="DrvdVarAlreadyDiv">'+Html.selectList("DrvdVarList",[],[],-1,1,-1,"",6)+"<p>"+Html.button("Delete","DlgDrvdVars.onDelete()","DeleteDrvdVarsBttn")+"&emsp;&emsp;"+Html.button("Edit","DlgDrvdVars.onEdit()","EditDrvdVarsBttn")+'</p></div></td><td><div id="DrvdVarChoicesDiv" class="has-border">'+Html.drvdVarChoices(t)+"</div></td></tr>";e+="</table>";ui.showDlg("Derived Variables",e,Html.dlgBtn("DlgDrvdVars.onApply()"));DlgDrvdVars.update();ui.activateTree(t,DlgDrvdVars.onTreeItemClick);$("DrvdVarList").addEventListener("click",DlgDrvdVars.enableButtons);let i=$(ui.getLastOpenElem(t));if(i!=null)i.click()}static update(){let e=[],i=[],t=$("DrvdVarList");for(let t=0;t<App.wrkArr.length;++t){e.push(t);i.push(Fct.fullVarLabel(App.wrkArr[t].uname,App.wrkArr[t].uunits))}t.innerHTML=Html.selectListContents(e,i,[]);DlgDrvdVars.enableButtons()}}class DlgDwStats{static rXh(){$("btnXh").blur();app.sendWsMsg(Msg.getImage("x_histogram","jpg",DlgDwStats.winId))}static rYh(){$("btnYh").blur();app.sendWsMsg(Msg.getImage("y_histogram","jpg",DlgDwStats.winId))}static rZh(){$("btnZh").blur();app.sendWsMsg(Msg.getImage("z_histogram","jpg",DlgDwStats.winId))}static rXYh(){$("btnXYh").blur();app.sendWsMsg(Msg.getImage("xy_histogram","jpg",DlgDwStats.winId))}static show(t){const e="Visible data",i="All data";DlgDwStats.winId=t.window_id;let s='<table id="DwStatsTbl" class="StdTable has-border">';s+="<tr><th></th>"+Html.toolTipElem("th","Mean",e)+Html.toolTipElem("th","Stand. Dev.",e)+Html.toolTipElem("th","Stand. Err.",e)+Html.toolTipElem("th","Count",e)+Html.toolTipElem("th","Minimum",i)+Html.toolTipElem("th","Maximum",i)+"</tr>";s+="<tr><td><b>"+t.X.label+"</b></td>"+Html.toolTipElem("td",t.X.mean,e)+Html.toolTipElem("td",t.X.stdev,e)+Html.toolTipElem("td",t.X.sterr,e)+Html.toolTipElem("td",Fct.formattedInt(t.X.count),e)+Html.toolTipElem("td",t.X.min,i)+Html.toolTipElem("td",t.X.max,i)+"</tr>";s+="<tr><td><b>"+t.Y.label+"</b></td>"+Html.toolTipElem("td",t.Y.mean,e)+Html.toolTipElem("td",t.Y.stdev,e)+Html.toolTipElem("td",t.Y.sterr,e)+Html.toolTipElem("td",Fct.formattedInt(t.Y.count),e)+Html.toolTipElem("td",t.Y.min,i)+Html.toolTipElem("td",t.Y.max,i)+"</tr>";if(t.Z!=undefined)s+="<tr><td><b>"+t.Z.label+"</b></td>"+Html.toolTipElem("td",t.Z.mean,e)+Html.toolTipElem("td",t.Z.stdev,e)+Html.toolTipElem("td",t.Z.sterr,e)+Html.toolTipElem("td",Fct.formattedInt(t.Z.count),e)+Html.toolTipElem("td",t.Z.min,i)+Html.toolTipElem("td",t.Z.max,i)+"</tr>";s+='</table><p>&nbsp;</p><table class="StdTable">';s+="<tr><td>"+Html.button("X Histogram","DlgDwStats.rXh()","btnXh",true)+"</td><td>"+Html.button("Y Histogram","DlgDwStats.rYh()","btnYh",true)+"</td>";if(t.Z!=undefined)s+="<td>"+Html.button("Z Histogram","DlgDwStats.rZh()","btnZh",true)+"</td>";s+="<td>"+Html.button("Heat Map","DlgDwStats.rXYh()","btnXYh",true)+"</td></tr></table>";ui.showDlg("Window "+t.window_id+" Statistics",s,Html.dlgBtn("ui.hideDlg(true)","Close"))}}class DlgEditData{static atStr(t){return coll.isoVarFullLabel(DlgEditData.varId-1,coll.primaryVarId,t.innerText)}static changeErrVal(){let t=DlgEditData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditData.xSel.itArr[t].cells)[3].innerText=e;ui.hideDlg()}static changeQFlags(){let t=Fct.selectedStr("qfList","");ui.hideDlg();DlgEditData.setSelectedTblVals(4,t,"change","quality flags")}static changeVal(){let t=DlgEditData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditData.xSel.itArr[t].cells)[2].innerText=e;ui.hideDlg()}static onApply(){let t,e=DlgEditData.smplCount,i=DlgEditData.varId;let s,a,l,r,n,o,d,c,m,u=[],p;for(t=0;t<e;++t){s="DV:"+t+":1";a="DV:"+t+":2";l="DV:"+t+":3";r=$(s).innerText;o=$(a).innerText;c=$(l).innerText;n=ui.dlgOrigVals.get(s);d=ui.dlgOrigVals.get(a);m=ui.dlgOrigVals.get(l);if(r!=n||o!=d||c!=m){p='{"var_id":'+i+',"sample_id":'+(t+1)+',"new_value":"'+r+'","old_value":"'+n+'","new_error_value":"'+o+'","old_error_value":"'+d+'","new_flag":"'+c+'","old_flag":"'+m+'"}';u.push(p)}}ui.hideDlg();if(u.length>0)app.sendWsMsg('{"cmd":"assign_data_values","items":['+u.join(",")+"]},"+Msg.msgGetCanvas+","+Msg.msgGetCurrInfo)}static onChangeErrVal(){let t=DlgEditData.xSel.firstSelection();let e=Array.from(DlgEditData.xSel.itArr[t].cells);ui.dlgQueryStr("Enter new error value","Error "+DlgEditData.atStr(e[1]),e[3].innerText,"DlgEditData.changeErrVal()")}static onChangeFlags(){let t=DlgEditData.xSel.selections(),e=t.length,i="z";if(e==1)i=Array.from(DlgEditData.xSel.itArr[t[0]].cells)[4].innerText;ui.dlgSelectQf(DlgEditData.varId-1,1,i,"DlgEditData.changeQFlags()")}static onChangeVal(){let t=DlgEditData.xSel.firstSelection();let e=Array.from(DlgEditData.xSel.itArr[t].cells);ui.dlgQueryStr("Enter new data value",DlgEditData.atStr(e[1]),e[2].innerText,"DlgEditData.changeVal()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey);DlgEditData.updateStatus()}static onDelErrVals(){DlgEditData.setSelectedTblVals(3,"","delete","error values")}static onDelVals(){DlgEditData.setSelectedTblVals(2,"","delete","data values")}static onInvert(){DlgEditData.xSel.invert();DlgEditData.updateStatus()}static onSelectAll(){DlgEditData.xSel.clear();DlgEditData.xSel.invert();DlgEditData.updateStatus()}static setSelectedTblVals(t,e,i,s){let a=DlgEditData.xSel.selections().length;if(a>1)ui.dlgYesNoBox("Edit Data - "+coll.dataVarFullLabel(DlgEditData.varId-1),"Really want to "+i+" "+a+" "+s+"?","DlgEditData.setSelectedTblValsYn("+t+",'"+e+"')");else DlgEditData.setSelectedTblValsC(t,e)}static setSelectedTblValsC(t,e){let i=DlgEditData.xSel.selections(),s,a=i.length;for(s=0;s<a;++s)Array.from(DlgEditData.xSel.itArr[i[s]].cells)[t].innerText=e}static setSelectedTblValsYn(t,e){ui.hideDlg();DlgEditData.setSelectedTblValsC(t,e)}static show(t,e,i,s,a){DlgEditData.smplCount=i.length;DlgEditData.varId=t;ui.dlgOrigVals=new Map;let l,r=i.length,n,o,d,c=coll.dataVarNameLabel(t-1);let m='<div id="edGrid">';m+='<div id="edDataTblDiv" class="has-border">';m+='<table id="edDataTbl" class="StdTable has-altbckcolor">';m+='<tr><th width="10%"></th><th>'+coll.dataVarNameLabel(coll.primaryVarId)+"</th><th>"+c+"</th><th>Errors "+c+'</th><th width="7%">QF</th></tr>';for(l=0;l<r;++l){n="DV:"+l+":1";ui.dlgOrigVals.set(n,i[l]);o="DV:"+l+":2";ui.dlgOrigVals.set(o,s[l]);d="DV:"+l+":3";ui.dlgOrigVals.set(d,a[l]);m+="<tr><td>"+(l+1)+"</Td3><td>"+e[l]+'</td><td id="'+n+'">'+i[l]+'</td><td id="'+o+'">'+s[l]+'</td><td id="'+d+'">'+a[l]+"</td></tr>"}m+="</table></div>";m+='<div id="edButtons">';m+="<p>"+Html.button("Change Value","DlgEditData.onChangeVal()","edBtnChVal",true)+"</p>";m+="<p>"+Html.button("Change Error Value","DlgEditData.onChangeErrVal()","edBtnChErrVal",true)+"</p>";m+="<p>"+Html.button("Delete Value(s)","DlgEditData.onDelVals()","edBtnDelVal",true)+"</p>";m+="<p>"+Html.button("Delete Error Value(s)","DlgEditData.onDelErrVals()","edBtnDelErrVal",true)+"</p>";m+="<p>"+Html.button("Change Quality Flag(s)","DlgEditData.onChangeFlags()","edBtnChFlags",true)+"</p>";m+="</div>";m+='<div id="edDataFooter">'+Html.button("Select All","DlgEditData.onSelectAll()")+'<span style="float:right">'+Html.button("Invert Selection","DlgEditData.onInvert()")+'</span><p><div id="edStatus"></div></p></div>';m+="</div>";ui.showDlg("Edit Data - "+coll.dataVarFullLabel(t-1),m,Html.dlgBtn("DlgEditData.onApply()"));let u=$("edDataTbl"),p=Array.from(u.rows);u.addEventListener("click",DlgEditData.onClick);DlgEditData.xSel=new XSelector(p,true);DlgEditData.xSel.select(ui.currSmplId);if(ui.currSmplId>6)p[ui.currSmplId].scrollIntoView();DlgEditData.updateStatus()}static updateStatus(){let t=DlgEditData.xSel.selectedCount();$("edStatus").innerText=t+" of "+DlgEditData.xSel.size()+" sample(s) selected";$("edBtnChVal").disabled=t!=1;$("edBtnChErrVal").disabled=t!=1;$("edBtnDelVal").disabled=t==0;$("edBtnDelErrVal").disabled=t==0;$("edBtnChFlags").disabled=t==0}}class DlgEditMetaData{static changeQFlags(){let t=Fct.selectedStr("qfList","");ui.hideDlg();DlgEditMetaData.setSelectedQfVal(t)}static onApply(){let t,e,i=DlgEditMetaData.varIds.length,s,a,l,r="",n=0,o;for(t=0;t<i;++t){e=DlgEditMetaData.varIds[t];o=coll.metaVar(e);s="MV:"+t+":1";a=$(s).innerText;l=ui.dlgOrigVals.get(s);if(a!=l&&o.valType=="INDEXED_TEXT"){r+="<p>"+o.fullLabel()+": "+l+" > "+a+"</p>";++n}}DlgEditScope.modifyAll=0;if(n>0)DlgEditScope.show(r,DlgEditMetaData.sendMsg);else DlgEditMetaData.sendMsg()}static onChangeFlags(){let t=DlgEditMetaData.xSel.firstSelection();if(t==-1)return;let e=Array.from(DlgEditMetaData.xSel.itArr[t].cells)[2].innerText;let i=t;if(i>=coll.mandatoryMetaVarCount-1)++i;ui.dlgSelectQf(i,0,e,"DlgEditMetaData.changeQFlags()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditMetaData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey)}static sendMsg(){let t,e,i=DlgEditMetaData.varIds.length,s,a,l,r,n,o;let d=[],c;for(t=0;t<i;++t){e=DlgEditMetaData.varIds[t]+1;s="MV:"+t+":1";a="MV:"+t+":2";l=$(s).innerText;n=$(a).innerText;r=ui.dlgOrigVals.get(s);o=ui.dlgOrigVals.get(a);if(l!=r||n!=o){c='{"var_id":'+e+',"new_value":"'+Fct.escapedStr(l)+'","old_value":"'+Fct.escapedStr(r)+'","new_flag":"'+n+'","old_flag":"'+o+'","modify_all_instances":'+DlgEditScope.modifyAll+"}";d.push(c)}}ui.hideDlg();if(d.length>0)app.sendWsMsg('{"cmd":"assign_metadata_values","items":['+d.join(",")+"]},"+Msg.msgGetCanvas+","+Msg.msgGetCurrInfo)}static setSelectedQfVal(t){let e=DlgEditMetaData.xSel.firstSelection();Array.from(DlgEditMetaData.xSel.itArr[e].cells)[2].innerText=t}static show(t,e,i){DlgEditMetaData.varIds=t;ui.dlgOrigVals=new Map;let s,a=t.length,l,r;let n='<div id="MetaVarTblDiv" class="has-border">';n+='<table id="MetaVarTbl" class="StdTable has-altbckcolor">';for(s=0;s<a;++s){l="MV:"+s+":1";ui.dlgOrigVals.set(l,e[s]);r="MV:"+s+":2";ui.dlgOrigVals.set(r,i[s]);n+="<tr><td>"+coll.metaVar(t[s]).fullLabel()+':</td><td id="'+l+'" contenteditable="true">'+e[s]+'</td><td id="'+r+'">'+i[s]+"</td></tr>"}n+="</table></div>";n+='<p><span style="float:right">'+Html.button("Change Quality Flag","DlgEditMetaData.onChangeFlags()","edBtnChFlags")+"</span></p>";ui.showDlg("Edit Station Metadata",n,Html.dlgBtn("DlgEditMetaData.onApply()"));let o=$("MetaVarTbl"),d=Array.from(o.rows);o.addEventListener("click",DlgEditMetaData.onClick);DlgEditMetaData.xSel=new XSelector(d,false,false);DlgEditMetaData.xSel.select(0)}}class DlgEditSmplData{static atStr(t){return coll.isoVarFullLabel(t,coll.primaryVarId,DlgEditSmplData.primVarVal)}static changeErrVal(){let t=DlgEditSmplData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditSmplData.xSel.itArr[t].cells)[3].innerText=e;ui.hideDlg()}static changeQFlag(){let t=Fct.selectedStr("qfList","");ui.hideDlg();let e=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[e].cells)[4].innerText=t}static changeVal(){let t=DlgEditSmplData.xSel.firstSelection(),e=$("queryStr").value;Array.from(DlgEditSmplData.xSel.itArr[t].cells)[2].innerText=e;ui.hideDlg()}static onApply(){let t,e,i,s,a,l,r,n,o,d,c=[],m;for(t=0;t<coll.dataVarCount();++t){e="DV:"+t+":1";i="DV:"+t+":2";s="DV:"+t+":3";a=$(e).innerText;r=$(i).innerText;o=$(s).innerText;l=ui.dlgOrigVals.get(e);n=ui.dlgOrigVals.get(i);d=ui.dlgOrigVals.get(s);if(a!=l||r!=n||o!=d){m='{"var_id":'+(t+1)+',"sample_id":'+ui.currSmplId+',"new_value":"'+a+'","old_value":"'+l+'","new_error_value":"'+r+'","old_error_value":"'+n+'","new_flag":"'+o+'","old_flag":"'+d+'"}';c.push(m)}}ui.hideDlg();if(c.length>0)app.sendWsMsg('{"cmd":"assign_data_values","items":['+c.join(",")+"]},"+Msg.msgGetCanvas+","+Msg.msgGetCurrInfo)}static onChangeErrVal(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells);ui.dlgQueryStr("Enter new error value",DlgEditSmplData.atStr(t-1),e[3].innerText,"DlgEditSmplData.changeErrVal()")}static onChangeFlag(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells)[4].innerText;ui.dlgSelectQf(t-1,1,e,"DlgEditSmplData.changeQFlag()")}static onChangeVal(){let t=DlgEditSmplData.xSel.firstSelection();let e=Array.from(DlgEditSmplData.xSel.itArr[t].cells);ui.dlgQueryStr("Enter new data value",DlgEditSmplData.atStr(t-1),e[2].innerText,"DlgEditSmplData.changeVal()")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;DlgEditSmplData.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey)}static onDelVal(){let t=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[t].cells)[2].innerText=""}static onDelErrVal(){let t=DlgEditSmplData.xSel.firstSelection();Array.from(DlgEditSmplData.xSel.itArr[t].cells)[3].innerText=""}static show(t,e,i){ui.dlgOrigVals=new Map;let s,a=t.length,l,r,n;let o='<div id="esdGrid">';o+='<div id="esdDataTblDiv" class="has-border">';o+='<table id="esdDataTbl" class="StdTable has-altbckcolor">';o+='<tr><th width="10%"></th><th>Variable</th><th>Value</th><th>Error Value</th><th width="7%">QF</th></tr>';for(s=0;s<a;++s){l="DV:"+s+":1";ui.dlgOrigVals.set(l,t[s]);r="DV:"+s+":2";ui.dlgOrigVals.set(r,e[s]);n="DV:"+s+":3";ui.dlgOrigVals.set(n,i[s]);o+="<tr><td>"+(s+1)+"</td><td>"+coll.dataVarFullLabel(s)+'</td><td id="'+l+'">'+t[s]+'</td><td id="'+r+'">'+e[s]+'</td><td id="'+n+'">'+i[s]+"</td></tr>"}o+="</table></div>";o+='<div id="esdButtons">';o+="<p>"+Html.button("Change Value","DlgEditSmplData.onChangeVal()","esdBtnChVal",true)+"</p>";o+="<p>"+Html.button("Change Error Value","DlgEditSmplData.onChangeErrVal()","esdBtnChErrVal",true)+"</p>";o+="<p>"+Html.button("Delete Value","DlgEditSmplData.onDelVal()","esdBtnDelVal",true)+"</p>";o+="<p>"+Html.button("Delete Error Value","DlgEditSmplData.onDelErrVal()","esdBtnDelErrVal",true)+"</p>";o+="<p>"+Html.button("Change Quality Flag","DlgEditSmplData.onChangeFlag()","esdBtnChFlags",true)+"</p>";o+="</div>";o+="</div>";ui.showDlg("Edit Sample Data - "+ui.currSmplId+" / "+ui.smplCount,o,Html.dlgBtn("DlgEditSmplData.onApply()"));let d=$("esdDataTbl"),c=Array.from(d.rows);d.addEventListener("click",DlgEditSmplData.onClick);DlgEditSmplData.xSel=new XSelector(c);DlgEditSmplData.xSel.select(2);DlgEditSmplData.primVarVal=t[coll.primaryVarId]}}class DlgEditScope{static onApply(){DlgEditScope.modifyAll=Fct.selectedNum("editScope",0);ui.hideDlg();DlgEditScope.cbFct()}static show(t,e){DlgEditScope.cbFct=e;let i=t;i+=Html.selectList("editScope",[0,1],["Modify current instance","Modify all instances"],0);ui.showDlg("Edit Option",i,Html.dlgBtn("DlgEditScope.onApply()"))}}class DlgExportData{static onFilChanged(){let t=Fct.selectedNum("smplFil",0)==2?"<b>Apply</b>":"<b>Start Export</b>";$("expBtn").innerHTML=t}static onProps(){let t=Fct.selectedNum("smplFil",0);DlgExportData.lonRangeId=Fct.selectedNum("lonRange",0);DlgExportData.expErr=$("doErr").checked;DlgExportData.expInfos=$("doInf").checked;DlgExportData.expQf=$("doQf").checked;DlgExportData.expHist=false;DlgExportData.expCompact=false;DlgExportData.colSepId=0;DlgExportData.missValStr="";if(DlgExportData.option!="miExpNetCDF"){DlgExportData.expHist=$("doHist").checked;DlgExportData.expCompact=$("doComp").checked;DlgExportData.colSepId=Fct.selectedNum("colSep",0);let t=Fct.strFromElem("missVal","");if(t!="(empty field)")DlgExportData.missValStr=t}ui.hideDlg();if(t==2)DlgSmplFilter.show(-20,DlgExportData.onSmplFilProps);else DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,DlgExportData.expErr,DlgExportData.expInfos,DlgExportData.expQf,DlgExportData.expHist,DlgExportData.expCompact,DlgExportData.lonRangeId,DlgExportData.colSepId,DlgExportData.missValStr,t)}static onSelectDvs(){DlgExportData.dvIds=Fct.selectedNums("selectList");ui.hideDlg();if(DlgExportData.option=="miExpCollection")DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,true,true,true,true,false,0,0,"",0);else{let t="<fieldset>",e=DlgExportData.option=="miExpNetCDF";t+='<table class="StdTable">';if(!e){t+="<tr><td>Column separator:</td><td>"+Html.selectListColumnSep("colSep",0)+"</td></tr>";t+="<tr><td>Missing value string:</td><td>"+Html.txtInput("missVal","(empty field)")+"</td></tr>"}t+="<tr><td>Longitude range:</td><td>"+Html.selectList("lonRange",[0,1],["[0 ... 360] degrees_E","[-180 ... +180] degrees_E"],0)+"</td></tr>";t+="<tr><td>Data Filter:</td><td>"+Html.selectList("smplFil",[0,1,2],["Export all data","Reject outliers","Customize filter settings"],0)+"</td></tr>";t+="</table>";if(!e)t+="<p>"+Html.checkBox("doComp","Use compact output format",1)+"</p>";t+="<p>"+Html.checkBox("doQf","Export data quality flags",1)+"</p>";t+="<p>"+Html.checkBox("doErr","Export data errors",1)+"</p>";t+="<p>"+Html.checkBox("doInf","Export data infos",0)+"</p>";if(!e)t+="<p>"+Html.checkBox("doHist","Export history",1)+"</p>";t+="</fieldset>";ui.showDlg((e?"NetCDF":"Spreadsheet")+" Properties",t,Html.dlgBtn("DlgExportData.onProps()","Start Export","expBtn"));$("smplFil").addEventListener("change",DlgExportData.onFilChanged)}}static onSelectExtMvs(){DlgExportData.emvIds=Fct.selectedNums("selectList");ui.hideDlg();DlgExportData.selectDvs()}static onSmplFilProps(t){DlgExportData.startExport(DlgExportData.emvIds,DlgExportData.dvIds,DlgExportData.expErr,DlgExportData.expInfos,DlgExportData.expQf,DlgExportData.expHist,DlgExportData.expCompact,DlgExportData.lonRangeId,DlgExportData.colSepId,DlgExportData.missValStr,2,t)}static selectDvs(){let t=DlgExportData.option=="miExpCollection"?"Start Export":"Select";let e=coll.dataVarIdsFromAvail(viewInfo.valDataCountsByVar,1);let i=e;DlgSelItems.show("Select Data Variables for Export",coll.dataVarIds(view.drvdVarSet.drvdVarArr,1),coll.dataVarFullLabels(view.drvdVarSet.drvdVarArr),"DlgExportData.onSelectDvs()",i,t,e,"Select Items with Data")}static show(t,e){DlgExportData.option=t;DlgExportData.outFileName=e;DlgExportData.emvIds=[];let i=[];coll.extendedMetaVarIds.map(t=>i.push(t+": "+coll.metaVar(t-1).fullLabel()));if(i.length>0)DlgSelItems.show("Select Extended Metadata Variables for Export",coll.extendedMetaVarIds,i,"DlgExportData.onSelectExtMvs()",coll.extendedMetaVarIds);else DlgExportData.selectDvs()}static startExport(t,e,i,s,a,l,r,n,o,d,c,m){let u="txt";if(DlgExportData.option=="miExpCollection")u="odv";else if(DlgExportData.option=="miExpNetCDF")u="nc";let p='{"cmd":"export_data","name":"'+DlgExportData.outFileName+"."+u+'","var_ids":['+e.join()+'],"extended_metavar_ids":['+t.join()+'],"error_export":'+i+',"info_export":'+s+',"quality_flag_export":'+a+',"history_export":'+l+',"compact_export":'+r+',"longitude_range_id":'+n+',"column_separator_id":'+o+',"missing_value_string":"'+d+'"'+',"sample_filter_type":'+c;if(c==2&&m!=undefined)p+=',"sample_filter_snippet":"'+m+'"';app.sendWsMsg(p+"}")}}class DlgExportHist{static show(){let t='<table class="StdTable">';t+="<tr><td>Station set:</td><td>"+Html.selectList("setId",[0,1],["Current station set","Current station"],0)+"</td></tr>";t+="<tr><td>Filter substring:</td><td>"+Html.txtInput("filStr")+"</td></tr>";t+="</table><p>Leave the filter substring empty to export all records.</p>";ui.showDlg("Export Station History",t,Html.dlgBtn("DlgExportHist.startExport()","Start Export"))}static startExport(){let t=Fct.selectedNum("setId",0);let e=Fct.strFromElem("filStr","");ui.hideDlg();app.sendWsMsg('{"cmd":"export_history","filter_substring":"'+e+'","station_set":'+t+"}")}}class DlgExprVar{static addInpVar(){let t=Fct.selectedNum("inpChoices",-1);if(t>-1){DlgDrvdVars.dv.inpVarIds.push(t);DlgExprVar.updateDefined()}}static inFix2postFix(){ui.dlgQueryStr("Infix Expression","Expression in Infix Notation","","DlgExprVar.onInFix2postFix()","Convert")}static onApply(){let t=DlgDrvdVars.dv;t.name=Fct.strFromElem("varName","Expression");t.units=Fct.strFromElem("varUnits","");t.uname=t.name;t.uunits=t.units;t.digitsCount=Fct.numFromElem("digitsCount",2);t.expr=$("PfExpr").value;ui.hideDlg();DlgDrvdVars.addVar(DlgExprVar.updateIdx)}static onInFix2postFix(){let t=$("queryStr").value;ui.hideDlg();if(t.length>0)app.sendWsMsg('{"cmd":"convert_infix_to_postfix","infix_expression":"'+t+'"}')}static rmInpVar(){let t=Fct.selectedNums("inpDefined",-1);if(t.length>0){DlgDrvdVars.dv.inpVarIds=Fct.strippedArray(DlgDrvdVars.dv.inpVarIds,t);DlgExprVar.updateDefined()}}static show(t=-1){let e=DlgDrvdVars.dv;DlgExprVar.updateIdx=t;let i,s='<table class="StdTable">';s+='<tr><th width="300px">Label</th><th width="200px">Units</th><th>Digits</th></tr>';s+="<tr><td>"+Html.txtInput("varName",e.uname,"100%")+"</td><td>"+Html.txtInput("varUnits",e.uunits,"100%")+"</td><td>"+Html.numInput("digitsCount",e.digitsCount,0,8)+"</td></tr></table>";s+="<p><fieldset><legend><b>Input Variables</b></legend>";s+='<table class="StdTable">';s+="<tr><td>Defined</td><td></td><td>Choices</td></tr>";s+='<tr><td rowspan="2"><div id="divDefined"></div></td><td>'+Html.button("<b> << </b>","DlgExprVar.addInpVar()")+'</td><td rowspan="2">'+Html.selectList("inpChoices",coll.dataVarIds(App.wrkArr),coll.dataVarFullLabels(App.wrkArr,true),-1)+"</td></tr>";s+="<tr><td>"+Html.button("<b> >> </b>","DlgExprVar.rmInpVar()")+"</td></tr>";s+="</table></fieldset></p>";s+="<p><fieldset><legend><b>Expression in Postfix Notation</b></legend>";s+='<textarea id="PfExpr" style="width:100%;height:80px;">'+e.expr+"</textarea>";s+="<p>"+Html.button("Validate","DlgExprVar.validatePfExpr()")+"&emsp;&emsp;";s+=Html.button("Enter Infix Expression","DlgExprVar.inFix2postFix()")+"</p>";s+="</fieldset></p>";ui.showDlg("Edit Expression",s,Html.dlgBtn("DlgExprVar.onApply()"));i=$("varName");i.focus();i.select();i=$("inpChoices");i.size=5;i.selectedIndex=-1;i.style.width="250px";DlgExprVar.updateDefined()}static updateDefined(){let i=DlgDrvdVars.dv.inpVarIds,s=[],a=[];i.map((t,e)=>{s.push(e);a.push("#"+(e+1)+" "+coll.dataVarFullLabel(i[e],true,App.wrkArr))});$("divDefined").innerHTML=Html.selectList("inpDefined",s,a,-1);let t=$("inpDefined");t.size=5;t.style.width="250px"}static validatePfExpr(){let t=$("PfExpr").value;app.sendWsMsg('{"cmd":"compile_postfix_expression","postfix_expression":"'+t+'"}')}}class DlgFindDupStats{static onApply(){DlgFindDupStats.lonTol=Fct.numFromElem("dupLonTol",.001);DlgFindDupStats.latTol=Fct.numFromElem("dupLatTol",.001);DlgFindDupStats.timeTol=Fct.numFromElem("dupTtimeTol",1);DlgFindDupStats.mvVids=Fct.selectedNums("dupMVarLst",-1);DlgFindDupStats.act=Fct.selectedNum("dupActLst",0);if(DlgFindDupStats.act>0)ui.dlgYesNoBox("Confirm Duplicate Station Deletion","<p>Really want to delete duplicate stations?</p>","DlgFindDupStats.sendMsg()");else DlgFindDupStats.sendMsg()}static sendMsg(){app.sendWsMsg('{"cmd":"find_and_resolve_duplicate_stations", "lon_tolerance":'+DlgFindDupStats.lonTol+', "lat_tolerance":'+DlgFindDupStats.latTol+', "time_tolerance":'+DlgFindDupStats.timeTol+', "scan_metavar_ids":'+JSON.stringify(DlgFindDupStats.mvVids)+', "out_metavar_ids":[], "action_id":'+DlgFindDupStats.act+"}")}static show(){let t="<p><fieldset><legend><b>Checks</b></legend>";t+="<p>Two stations are considered duplicates if station position and time agree within the<br>specified tolerances and if the values of other selected meta variables agree.</p>";t+="<table><tr>";t+='<td><table class="StdTable">';t+="<tr><th></th><th>Tolerances</th></tr>";t+="<tr><td>Longitude [deg]:</td><td>"+Html.txtInput("dupLonTol","0.001")+"</td></tr>";t+="<tr><td>Latitude [deg]:</td><td>"+Html.txtInput("dupLatTol","0.001")+"</td></tr>";t+="<tr><td>Time [hours]:</td><td>"+Html.txtInput("dupTtimeTol","1.0")+"</td></tr>";t+="</table></td>";t+="<td><table><tr><th>&emsp;&emsp;&emsp;Meta Variables</th></tr>";t+="<tr><td>&emsp;&emsp;&emsp;"+Html.selectListEx("dupMVarLst",coll.metaVarIds(false,true,true,true),coll.metaVarFullLabels(false,true,true,true),[],1)+"</td></tr>";t+="</table></td>";t+="</tr></table>";t+="</fieldset></p><p><fieldset><legend><b>Action</b></legend>";t+=Html.selectList("dupActLst",[0,1,2,3,4],["no action","keep station with most data, delete others","keep first station, delete others","keep second station, delete others","merge data of all stations into one"],0);t+="</fieldset></p>";ui.showDlg("Duplicate Station Identification",t,Html.dlgBtn("DlgFindDupStats.onApply()"))}}class DlgGObjMgr{static enableButtons(){let t=DlgGObjMgr.xSel.selectedCount(),e=!(t==1);let i=App.wrkIdx,s=App.wrkArr.length-1;let a=i>-1?App.wrkArr[i].isAuto=="T":false;let l=i>-1?App.wrkArr[i].dragging=="T":false;$("BtnGoEdit").disabled=e||a;$("BtnGoExport").disabled=e;$("BtnGoDel").disabled=t==0||t==1&&a;$("BtnGoTop").disabled=e||a||i==0;$("BtnGoUp").disabled=e||a||i==0;$("BtnGoDown").disabled=e||a||i==s;$("BtnGoBottom").disabled=e||a||i==s}static moveBottom(){DlgGObjMgr.moveTo(App.wrkArr.length-1)}static moveDown(){DlgGObjMgr.moveTo(App.wrkIdx+1)}static moveTo(t){if(App.wrkIdx==-1)return;Fct.moveElem(App.wrkArr,App.wrkIdx,t);App.wrkIdx=t;DlgGObjMgr.updateList()}static moveTop(){DlgGObjMgr.moveTo(0)}static moveUp(){DlgGObjMgr.moveTo(App.wrkIdx-1)}static onApply(){ui.hideDlg();let t=DlgGObjMgr.wId,e=view.getGObjSet(t);e.gObjArr=[...App.wrkArr];app.sendUpdateGobjMsg(t,-1,e,"Manage Graphics Objects")}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;const i=e.parentNode.rowIndex;if(i>0){App.wrkIdx=i-1;DlgGObjMgr.xSel.select(i,t.shiftKey,t.ctrlKey);DlgGObjMgr.enableButtons()}}static onDelete(){let t,e,i=DlgGObjMgr.xSel.selections(),s=0,a=i.length-1;for(t=a;t>=0;--t){e=i[t]-1;if(App.wrkArr[e].isAuto!="T"){App.wrkArr.splice(e,1);++s}}if(s>0){App.wrkIdx=-1;DlgGObjMgr.updateList()}}static onEditClick(){DlgGObjProps.show(App.wrkArr[App.wrkIdx],DlgGObjMgr.wId,false,true)}static onExport(){App.wrkObj=App.wrkArr[App.wrkIdx];ui.dlgQueryStr("Export GObject","Enter graphics object name",App.wrkObj.getName(),"app.onGObjSave()","Save")}static show(s){DlgGObjMgr.wId=s;App.wrkArr=[...view.getGObjArr(s)];App.wrkArr.map((t,e)=>{let i=viewInfo.getGObjInfo(s,e);if(i!=undefined){t.type_str=i.type_str;t.value_str=i.value_str}});let t='<div id="goGrid" style="height:250px">';t+='<div id="goTblDiv" class="has-border"></div>';t+='<div id="goButtons">';t+=Html.button("Edit","DlgGObjMgr.onEditClick()","BtnGoEdit",true);t+="<p>"+Html.button("Export","DlgGObjMgr.onExport()","BtnGoExport",true)+"</p>";t+="<p>"+Html.button("Delete","DlgGObjMgr.onDelete()","BtnGoDel",true)+"</p>";t+="<p>&ensp;</p>";t+="<p>"+Html.button("Foreground","DlgGObjMgr.moveTop()","BtnGoTop",true)+"</p>";t+="<p>"+Html.button("Up","DlgGObjMgr.moveUp()","BtnGoUp",true)+"</p>";t+="<p>"+Html.button("Down","DlgGObjMgr.moveDown()","BtnGoDown",true)+"</p>";t+="<p>"+Html.button("Background","DlgGObjMgr.moveBottom()","BtnGoBottom",true)+"</p>";t+="</div>";t+="</div>";ui.showDlg(Ui.windowName(s)+" Graphics Objects",t,Html.dlgBtn("DlgGObjMgr.onApply()"));App.wrkIdx=-1;DlgGObjMgr.updateList()}static updateList(){let e,t=App.wrkArr.length;let i='<table id="goTbl" class="StdTable">';i+='<tr><th style="width:20%">Type</th><th style="width:75">Value</th></tr>';for(e=0;e<t;++e){let t=App.wrkArr[e];i+="<tr><td>"+t.type_str+"</td><td>"+t.value_str+"</td></tr>"}i+="</table>";$("goTblDiv").innerHTML=i;let s=$("goTbl"),a=Array.from(s.rows);s.addEventListener("click",DlgGObjMgr.onClick);DlgGObjMgr.xSel=new XSelector(a,true);if(App.wrkIdx>-1){DlgGObjMgr.xSel.select(App.wrkIdx+1);if(App.wrkIdx>8)a[App.wrkIdx].scrollIntoView()}DlgGObjMgr.enableButtons()}}class DlgGObjProps{static goStr(t,e){return"<p><b>"+t+"</b>:&emsp;"+Html.txtInput("goText",e,"28em")+"</p>"}static onApply(){let t=DlgGObjProps.winId,l=DlgGObjProps.go,r=l.type,n=0;if(r==1||r==30){let t=Fct.strFromElem("goText",l.text);if(t!=l.text){l.text=t;++n}}if(r==1||r==5||r==40){if(l.xCoord!=undefined){let t=Fct.numFromElem("goXpos",l.xCoord);if(t!=l.xCoord){l.xCoord=t;++n}let e=Fct.numFromElem("goYpos",l.yCoord);if(e!=l.yCoord){l.yCoord=e;++n}}if(r==1){let t=Ui.textAlignIdx(Fct.selectedNum("goXal",1),Fct.selectedNum("goYal",1));if(t!=l.align){l.align=t;++n}}}if(r==1||r==40||r==42){let t=Fct.idxFromElem("goTxtCol",l.txtColor);if(t!=l.txtColor){l.txtColor=t;++n}let e=Fct.idxFromElem("goBckCol",l.fColor);if(e!=l.fColor){l.fColor=e;++n}let i=Fct.numFromElem("goPtSize",l.ptSize);if(i!=DlgGObjProps.ptSize){l.ptSize=i;++n}let s=Fct.idxFromElem("goBCol",l.bColor);if(s!=l.bColor){l.bColor=s;++n}if(r==1){let t=Fct.numFromElem("goAngle",l.angle);if(t!=l.angle){l.angle=t;++n}}else if(r==42){let t=Fct.numFromElem("goArrLen",l.arrLen*10)*.1;if(t!=l.arrLen){l.arrLen=t;++n}}let a=Fct.selectedNum("goBWidth",l.bWidth);if(a!=l.bWidth){l.bWidth=a;++n}}if(r==5||r==30){let t=Fct.selectedNum("goSymbType",l.symbTyp);if(t!=l.symbTyp){l.symbTyp=t;++n}let e=Fct.idxFromElem("goSymbFCol",l.fColor);if(e!=l.fColor){l.fColor=e;++n}let i=Fct.numFromElem("goSymbSize",DlgGObjProps.symbSize);if(i!=DlgGObjProps.symbSize){l.symbSize=.1*i;++n}let s=Fct.idxFromElem("goSymbBCol",l.bColor);if(s!=l.bColor){l.bColor=s;++n}}if(r==11||r==12||r==15||r==30){let t=Fct.selectedNum("goLWidth",l.lWidth);if(t!=l.lWidth){l.lWidth=t;++n}let e=Fct.selectedNum("goLStyle",l.lStyle);if(e!=l.lStyle){l.lStyle=e;++n}let i=Fct.idxFromElem("goLCol",l.lColor);if(i!=l.lColor){l.lColor=i;++n}}if(r==12||l.type_str&&l.type_str.includes("polygon")){let t=Fct.idxFromElem("goFCol",l.fColor);if(t!=l.fColor){l.fColor=t;++n}}if(r==11){let t=Fct.selectedNum("goStartSymbType",l.startSymbType);if(t!=l.startSymbType){l.startSymbType=t;++n}let e=Fct.numFromElem("goStartSymbSize",l.startSymbSize);if(e!=DlgGObjProps.startSymbSize){l.startSymbSize=.1*e;++n}let i=Fct.selectedNum("goEndSymbType",l.endSymbType);if(i!=l.endSymbType){l.endSymbType=i;++n}let s=Fct.numFromElem("goEndSymbSize",l.endSymbSize);if(s!=DlgGObjProps.endSymbSize){l.endSymbSize=.1*s;++n}}let e=Fct.isChecked("goPrePlot")?"F":"T";if(e!=l.postData){l.postData=e;++n}let i=Fct.checkBoxState("goDragging");if(i!=l.dragging){l.dragging=i;++n}let s=Fct.checkBoxState("goDoClip");if(s!=l.clipping){l.clipping=s;++n}if(r==11||r==12){let t=Fct.checkBoxState("goSmooth");if(t!=l.doSmooth){l.doSmooth=t;++n}}ui.hideDlg();let a=view.getGObjSet(t);if(DlgGObjProps.prependGObjToSet)a.gObjArr.unshift(l);if((DlgGObjProps.prependGObjToSet||!DlgGObjProps.requireModify||n>0)&&!DlgGObjProps.preventUpdateMsg)app.sendUpdateGobjMsg(t,r,a,"Add / Modify Graphics Object")}static show(t,e,i=true,s=false,a=false){let l=t.type,r=view.paletteName(e),n="",o;DlgGObjProps.go=t;DlgGObjProps.winId=e;DlgGObjProps.requireModify=i;DlgGObjProps.preventUpdateMsg=s;DlgGObjProps.prependGObjToSet=a;if(l==1||l==30)n+=DlgGObjProps.goStr(l==1?"Text":"Legend",t.text);if(l==1||l==5||l==40){n+='<p><table class="StdTable">';if(t.xCoord!=undefined)n+="<tr><td><b>Position</b>&emsp;</td><td>X:</td><td>"+Html.txtInput("goXpos",t.xCoord)+"&emsp;</td><td>Y:</td><td>"+Html.txtInput("goYpos",t.yCoord)+"</td></tr>";if(l==1)n+="<tr><td><b>Alignment</b>&emsp;</td><td>X:</td><td>"+Html.selectListAlignX("goXal",Ui.xAlignIdx[t.align])+"&emsp;</td><td>Y:</td><td>"+Html.selectListAlignY("goYal",Ui.yAlignIdx[t.align])+"</td></tr>";n+="</table></p>"}if(l==1||l==40||l==42){if(l==1)o="Orientation [&deg;]:</td><td>"+Html.numInput("goAngle",t.angle,0,360,5);else if(l==42)o="Arrow length [mm]:</td><td>"+Html.numInput("goArrLen",t.arrLen*10,1,100,1);else if(l==40)o="</td><td>";DlgGObjProps.ptSize=Fct.roundedVal(t.ptSize,0);n+="<p><fieldset><legend><b>Properties</b></legend>";n+='<table class="StdTable">';n+="<tr><td>Text color:</td><td>"+Html.colorSelector("goTxtCol",r,t.txtColor)+"</td><td>Background:</td><td>"+Html.colorSelector("goBckCol",r,t.fColor,true)+"</td></tr>";n+="<tr><td>Font size [pt]:</td><td>"+Html.numInput("goPtSize",DlgGObjProps.ptSize,1,99)+"</td><td>Frame color:</td><td>"+Html.colorSelector("goBCol",r,t.bColor,true)+"</td></tr>";n+="<tr><td>"+o+"</td><td>Frame width:</td><td>"+Html.selectListLineWidth("goBWidth",t.bWidth,true)+"</td></tr>";n+="</table></fieldset></p>"}if(l==5||l==30){DlgGObjProps.symbSize=Fct.roundedVal(t.symbSize*10,0);n+="<p><fieldset><legend><b>Symbol</b></legend>";n+='<table class="StdTable">';n+="<tr><td>Type:</td><td>"+Html.selectListSymbol("goSymbType",t.symbTyp)+"</td><td>Fill color:</td><td>"+Html.colorSelector("goSymbFCol",r,t.fColor,true,l==30?true:false)+"</td></tr>";n+="<tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goSymbSize",DlgGObjProps.symbSize,1,499)+"</td><td>Border color:</td><td>"+Html.colorSelector("goSymbBCol",r,t.bColor,true,false)+"</td></tr>";n+="<tr><td></td><td></td><td>Border width:</td><td>"+Html.selectListLineWidth("goSymbBWidth",t.bWidth,true)+"</td></tr>";n+="</table></fieldset></p>"}if(l==11||l==12||l==15||l==30){n+="<p><fieldset><legend><b>Line</b></legend>";n+='<table class="StdTable">';n+="<tr><td>"+Html.selectListLineWidth("goLWidth",t.lWidth)+"</td><td>"+Html.selectListLineStyle("goLStyle",t.lStyle)+"</td><td>"+Html.colorSelector("goLCol",r,t.lColor,true,false,"Line color")+"</td></tr>";n+="</table></fieldset></p>"}if(l==12||t.type_str&&t.type_str.includes("polygon"))n+="<p><b>Fill</b>:&emsp;"+Html.colorSelector("goFCol",r,t.fColor,true,false,"Fill color")+"</p>";if(l==11){DlgGObjProps.startSymbSize=Fct.roundedVal(t.startSymbSize*10,0);DlgGObjProps.endSymbSize=Fct.roundedVal(t.endSymbSize*10,0);n+='<p><table class="StdTable"><tr><td><fieldset><legend><b>Start type</b></legend><table class="StdTable"><tr><td>Type:</td><td>'+Html.selectListLineStartEnd("goStartSymbType",t.startSymbType)+"</td></tr><tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goStartSymbSize",DlgGObjProps.startSymbSize,1,499)+'</td></tr></table></fieldset></td><td><fieldset><legend><b>End type</b></legend><table class="StdTable"><tr><td>Type:</td><td>'+Html.selectListLineStartEnd("goEndSymbType",t.endSymbType)+"</td></tr><tr><td>Size [.1 mm]:</td><td>"+Html.numInput("goEndSymbSize",DlgGObjProps.endSymbSize,1,499)+"</td></tr></table></fieldset></td></tr></table></p>"}n+="<p>"+Html.checkBox("goPrePlot","Pre-data plot",t.postData=="F")+"&emsp;"+Html.checkBoxTF("goDoClip","Clip to window",t.clipping)+"&emsp;"+Html.checkBoxTF("goDragging","Allow dragging",t.dragging);if(l==11||l==12)n+="&emsp;"+Html.checkBoxTF("goSmooth","Bezier smoothing",t.doSmooth);else if(l==30)n+="&emsp;"+Html.checkBoxTF("goAddLgd","Add to legends",t.addLgd);n+="</p>";ui.showDlg(GObject.typeName(l)+" - Properties",n,Html.dlgBtn("DlgGObjProps.onApply()"));if(l==1||l==30){let t=$("goText");t.focus();t.select()}}}class DlgGridCoords{static onApply(){let t=[],e=[],i=-1,s=-1,a,l;let r=Fct.numFromElem("gxStrt",App.missDOUBLE),n;let o=Fct.numFromElem("gxInc",0),d;let c=Fct.numFromElem("gxEnd",App.largeDOUBLE),m;if(DlgGridCoords.is2D){n=Fct.numFromElem("gyStrt",App.missDOUBLE);d=Fct.numFromElem("gyInc",App.largeDOUBLE);m=Fct.numFromElem("gyEnd",App.largeDOUBLE)}ui.hideDlg();if(r==App.missDOUBLE||c==App.largeDOUBLE||o==0)return;i=Math.floor((c-r)/o)+1;if(i<1||i>1e3)return;if(DlgGridCoords.is2D){if(n==App.missDOUBLE||m==App.largeDOUBLE||d==0)return;s=Math.floor((m-n)/d)+1;if(s<1||s>1e3)return;for(a=0;a<i;++a){for(l=0;l<s;++l){t.push(r+a*o);e.push(n+l*d)}}app.sendWsMsg(Msg.get2DEstimates(ui.rclickWinId,t,e))}else{for(a=0;a<i;++a){t.push(r+a*o)}app.sendWsMsg(Msg.get1DEstimates(ui.rclickWinId,t))}}static show(t){if(ui.rclickWinId<=0)return;let e=view.dataWinArr[ui.rclickWinId-1];DlgGridCoords.is2D=t;let i=e.axisLabel("X"),s=e.axisLabel("Y");let a=Fct.autoScale(e.xLeft,e.xRight);let l=Fct.autoScale(e.yBottom,e.yTop);if(!t&&e.yvId==coll.primaryVarId){i=s;a=l}let r="";r+='<p><table class="StdTable has-border">';r+="<tr><th></th><th>"+i+"</th>";if(t)r+="<th>"+s+"</th>";r+="</tr>";r+="<tr><td>Start:</td><td>"+Html.txtInput("gxStrt",a.adjLL,"4em")+"</td>";if(t)r+="<td>"+Html.txtInput("gyStrt",l.adjLL,"4em")+"</td>";r+="</tr>";r+="<tr><td>Increment:</td><td>"+Html.txtInput("gxInc",a.ticSpacing*.1,"4em")+"</td>";if(t)r+="<td>"+Html.txtInput("gyInc",l.ticSpacing*.1,"4em")+"</td>";r+="</tr>";r+="<tr><td>End:</td><td>"+Html.txtInput("gxEnd",a.adjUR,"4em")+"</td>";if(t)r+="<td>"+Html.txtInput("gyEnd",l.adjUR,"4em")+"</td>";r+="</tr>";r+="</table></p>";r+=Html.labelFor("fileSelector","Read Coordinates from File")+'<p><input type="file" id="fileSelector"/></p>';Ui.onFileLoadFct=t?app.onFileLoad2DEst:app.onFileLoad1DEst;ui.showDlg("Grid Coordinates",r,Html.dlgBtn("DlgGridCoords.onApply()"));$("fileSelector").addEventListener("change",app.onFileSelect)}}class DlgIdentKeyVars{static associate(t,e){DlgIdentKeyVars.kvIds.push(t);DlgIdentKeyVars.kvdIds.push(e)}static enableButtons(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=DlgIdentKeyVars.dvSel.firstSelection();$("IkvBtnUndoAll").disabled=DlgIdentKeyVars.kvIds.length==0;if(t==-1){$("IkvBtnAssoc").disabled=true;$("IkvBtnNotAvail").disabled=true;$("IkvBtnUndo").disabled=true;return}let i=DlgIdentKeyVars.kvIds.indexOf(ui.keyVarIdChoices[t]);let s=i>-1?DlgIdentKeyVars.kvdIds[i]:-1;let a=false,l=false,r=false;if(e>-1&&s<=-1)a=true;if(s!=-2)l=true;if(s==-2||e>-1&&s==e)r=true;$("IkvBtnAssoc").disabled=!a;$("IkvBtnNotAvail").disabled=!l;$("IkvBtnUndo").disabled=!r}static onApply(){ui.hideDlg();app.sendWsMsg('{"cmd":"assign_key_variables","keyvar_ids":'+JSON.stringify(DlgIdentKeyVars.kvIds)+',"var_ids":'+JSON.stringify(DlgIdentKeyVars.kvdIds)+"},"+Msg.msgGetDockLbls+","+Msg.msgGetCollInfo+","+Msg.msgGetCanvasCurrInfo+","+Msg.msgGetDrvdVarChoices)}static onAssoc(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=ui.keyVarIdChoices[t];DlgIdentKeyVars.removeAt(DlgIdentKeyVars.kvIds.indexOf(e));DlgIdentKeyVars.associate(e,DlgIdentKeyVars.dvSel.firstSelection());DlgIdentKeyVars.updateLists()}static onClickDv(t){t.preventDefault();const e=t.target;if(e==undefined)return;let i=e.parentNode.rowIndex,s;DlgIdentKeyVars.dvSel.select(i);let a=DlgIdentKeyVars.kvdIds.indexOf(i);if(a>-1){s=ui.keyVarIdChoices.indexOf(DlgIdentKeyVars.kvIds[a]);DlgIdentKeyVars.kvSel.select(s);DlgIdentKeyVars.kvSel.scrollTo(s)}DlgIdentKeyVars.enableButtons()}static onClickKv(t){t.preventDefault();const e=t.target;if(e==undefined)return;let i=e.parentNode.rowIndex,s;DlgIdentKeyVars.kvSel.select(i);let a=DlgIdentKeyVars.kvIds.indexOf(ui.keyVarIdChoices[i]);if(a>-1){s=DlgIdentKeyVars.kvdIds[a];if(s>-1){DlgIdentKeyVars.dvSel.select(s);DlgIdentKeyVars.dvSel.scrollTo(s)}}DlgIdentKeyVars.enableButtons()}static onNotAvail(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=ui.keyVarIdChoices[t];DlgIdentKeyVars.removeAt(DlgIdentKeyVars.kvIds.indexOf(e));DlgIdentKeyVars.associate(e,-2);DlgIdentKeyVars.updateLists()}static onUndo(){let t=DlgIdentKeyVars.kvSel.firstSelection();let e=DlgIdentKeyVars.kvIds.indexOf(ui.keyVarIdChoices[t]);DlgIdentKeyVars.removeAt(e);DlgIdentKeyVars.updateLists()}static onUndoAll(){DlgIdentKeyVars.kvIds=[];DlgIdentKeyVars.kvdIds=[];DlgIdentKeyVars.updateLists()}static removeAt(t){if(t<0||t>=DlgIdentKeyVars.kvIds.length)return;DlgIdentKeyVars.kvIds.splice(t,1);DlgIdentKeyVars.kvdIds.splice(t,1)}static show(){DlgIdentKeyVars.kvIds=[...coll.keyVarIds];DlgIdentKeyVars.kvdIds=[...coll.keyVarDataVarIds];let t='<fieldset><div id="IkvDiv">';t+='<div id="IkvKvLbl"><b>Key variables</b></div>';t+='<div id="IkvKvTblDiv" class="has-border"></div>';t+='<div id="IkvBtnDiv"><p>'+Html.button("Associate","DlgIdentKeyVars.onAssoc()","IkvBtnAssoc")+"</p><p>"+Html.button("Not Available","DlgIdentKeyVars.onNotAvail()","IkvBtnNotAvail")+"</p><p>"+Html.button("Undo","DlgIdentKeyVars.onUndo()","IkvBtnUndo")+"</p><p>"+Html.button("Undo All","DlgIdentKeyVars.onUndoAll()","IkvBtnUndoAll")+"</p></div>";t+='<div id="IkvCvLbl"><b>Data variables</b></div>';t+='<div id="IkvCvTblDiv" class="has-border"></div>';t+="</div></fieldset>";ui.showDlg("Identify Key Variables",t,Html.dlgBtn("DlgIdentKeyVars.onApply()"));DlgIdentKeyVars.updateLists()}static updateLists(){let t,e=ui.keyVarIdChoices.length,i,s,a,l;let r,n,o,d,c;c='<table id="IkvKvTbl" class="StdTable">';for(t=0;t<e;++t){r=ui.keyVarIdChoices[t];n=DlgIdentKeyVars.kvIds.indexOf(r);o=n>-1?DlgIdentKeyVars.kvdIds[n]:-1;if(o==-1)d="&ensp;";else if(o==-2)d="- ";else d="* ";c+="<tr><td>"+d+ui.keyVarLblChoices[t]+"</td></tr>"}$("IkvKvTblDiv").innerHTML=c+"</table>";c='<table id="IkvCvTbl" class="StdTable">';for(t=0;t<coll.dataVarCount();++t){d=DlgIdentKeyVars.kvdIds.indexOf(t)>-1?"* ":"&ensp;";c+="<tr><td>"+d+" "+(t+1)+": "+coll.dataVar(t).fullLabel()+"</td></tr>"}$("IkvCvTblDiv").innerHTML=c+"</table>";a=$("IkvKvTbl");l=Array.from(a.rows);a.addEventListener("click",DlgIdentKeyVars.onClickKv);DlgIdentKeyVars.kvSel=new XSelector(l,false,false);i=$("IkvCvTbl");s=Array.from(i.rows);i.addEventListener("click",DlgIdentKeyVars.onClickDv);DlgIdentKeyVars.dvSel=new XSelector(s,false,false);DlgIdentKeyVars.enableButtons()}}class DlgImg{static saveAs(){DlgImgProps.show("saveCustomImage",DlgImg.head)}static show(t,e){DlgImg.blobBody=t;DlgImg.head=e;let i='<div id="CustomDivArea"><img id="CustomImageArea"> </div>';ui.showDlg(e.caption,i,Html.dlgBtnC("ui.hideDlg()","Close")+"&emsp;&emsp;"+Html.dlgBtnC("DlgImg.saveAs()","Save As"))}}class DlgImgProps{static fmts=["png","gif","jpg","tif"];static styles=["normal","pure"];static fmt="jpg";static dpi=300;static style="Normal";static transpBck=false;static fontSizeFac=100;static drawNPolar=true;static drawSPolar=true;static title="";static label="";static copyright="";static onApply(){DlgImgProps.fmt=Fct.selectedStr("imgFmt","jpg");DlgImgProps.dpi=Fct.numFromElem("imgDpi",300);DlgImgProps.style=Fct.selectedStr("drawStyle","normal");DlgImgProps.transpBck=Fct.isChecked("transpBck");if(DlgImgProps.isInterrupted){DlgImgProps.title=Fct.strFromElem("imgTitle","");DlgImgProps.label=Fct.strFromElem("imgLabel","");DlgImgProps.copyright=Fct.strFromElem("imgCopyr","");DlgImgProps.fontSizeFac=Fct.numFromElem("imgFontSize",100);DlgImgProps.drawSPolar=Fct.isChecked("imgSPolar");DlgImgProps.drawNPolar=Fct.isChecked("imgNPolar")}ui.hideDlg();if(DlgImgProps.isInterrupted)app.sendWsMsg(Msg.exportAsInterruptedMap(ui.rclickWinId,DlgImgProps.fmt,DlgImgProps.dpi,DlgImgProps.transpBck,DlgImgProps.title,DlgImgProps.label,DlgImgProps.copyright,DlgImgProps.fontSizeFac*.01,DlgImgProps.drawSPolar,DlgImgProps.drawNPolar));else if(DlgImgProps.callerId=="saveCustomImage")app.sendWsMsg(Msg.getImage(DlgImgProps.args.plot_type,DlgImgProps.fmt,DlgImgProps.args.win_id,"file",DlgImgProps.dpi,DlgImgProps.style,DlgImgProps.transpBck));else app.sendWsMsg(Msg.exportGraphics(ui.rclickWinId,DlgImgProps.fmt,DlgImgProps.dpi,DlgImgProps.style,DlgImgProps.transpBck))}static onFmtChanged(){let t=Fct.selectedStr("imgFmt","jpg")=="jpg";let e=Fct.selectedStr("imgFmt","jpg")=="eps";Fct.setElemDisplay($("transpBck"),!(t||e))}static show(t,e){let i=t=="miSaveAsInterruptedMap"||t=="miSaveAsInterruptedMapDw";DlgImgProps.callerId=t;DlgImgProps.isInterrupted=i;DlgImgProps.args=e!=undefined?e:{};let s="Image Properties",a='<table class="StdTable">';if(i){s="Interrupted Map Properties";DlgImgProps.label="";let e=view.dataWinArr[ui.rclickWinId-1];if(e!=undefined&&e.zvId!=App.VID_NONE&&e.zvLst==2){let t=view.isoVarSet.isoVarArr[e.zvId-4];DlgImgProps.label=coll.isoVarFullLabel(t.varId,t.surfVarId,t.surfVal)}a+="<tr><td>Title:</td><td>"+Html.txtInput("imgTitle",DlgImgProps.title,"28em")+"</td></tr>";a+="<tr><td>Label:</td><td>"+Html.txtInput("imgLabel",DlgImgProps.label,"28em")+"</td></tr>";a+="<tr><td>Copyright:</td><td>"+Html.txtInput("imgCopyr",DlgImgProps.copyright,"28em")+"</td></tr>";a+="<tr><td>Font size [%]:</td><td>"+Html.numInput("imgFontSize",DlgImgProps.fontSizeFac,0,499,5)+"</td></tr>";a+="<tr><td></td><td>"+Html.checkBox("imgSPolar","Draw south polar map",DlgImgProps.drawSPolar)+"</td></tr>";a+="<tr><td></td><td>"+Html.checkBox("imgNPolar","Draw north polar map",DlgImgProps.drawNPolar)+"</td></tr>";a+='<tr><td colspan="2"><hr></td></tr>'}a+="<tr><td>Format:</td><td>"+Html.selectList("imgFmt",DlgImgProps.fmts,DlgImgProps.fmts,DlgImgProps.fmt)+"</td></tr>";a+="<tr><td>Resolution [dpi]:</td><td>"+Html.numInput("imgDpi",DlgImgProps.dpi,10,999,10)+"</td></tr>";a+="<tr><td>Drawing style:</td><td>"+Html.selectList("drawStyle",DlgImgProps.styles,DlgImgProps.styles,DlgImgProps.style)+"</td></tr>";a+="<tr><td></td><td>"+Html.checkBox("transpBck","Transparent background",DlgImgProps.transpBck)+"</td></tr>";a+="</table>";ui.showDlg(s,a,Html.dlgBtn("DlgImgProps.onApply()"));DlgImgProps.onFmtChanged();$("imgFmt").addEventListener("change",DlgImgProps.onFmtChanged)}}class DlgIsopynals{static onApply(){let t=view.dataWinArr[ui.rclickWinId-1];t.drawIsop=Fct.checkBoxState("IsopDoDraw");t.isopRefPress=Fct.numFromElem("IsopRefPress",0);t.isopColor=Fct.idxFromElem("IsopLineCol",8);t.isopLWidth=Fct.selectedNum("IsopLWidth",1);t.isopLStyle=Fct.selectedNum("IsopLStyle",0);ui.hideDlg();app.sendWsMsg(Msg.modifyView(t.toXmlDataWindowOpen(ui.rclickWinId)+t.toXmlIsopycnal()+t.toXmlDataWindowClose(),viewHistory.currentName(),"Change Isopycnals")+","+Msg.msgGetCanvasCurrInfo)}static show(){let t=view.dataWinArr[ui.rclickWinId-1];let e='<p><fieldset><legend>Properties</legend><table class="StdTable">';e+="<tr><td>"+Html.numInput("IsopRefPress",t.isopRefPress,0,9999,500)+"</td><td>Reference Pressure [dbar]</td></tr>";e+="<tr><td>"+Html.colorSelector("IsopLineCol",t.palName,t.isopColor)+"</td><td>Line Color</td></tr>";e+="<tr><td>"+Html.selectListLineWidth("IsopLWidth",t.isopLWidth)+"</td><td>Line width</td></tr>";e+="<tr><td>"+Html.selectListLineStyle("IsopLStyle",t.isopLStyle)+"</td><td>Line style</td></tr></table>";e+="<p>"+Html.checkBoxTF("IsopDoDraw","Draw isopycnals",t.drawIsop)+"</p>";e+="</fieldset></p>";e+="<p>Isopycnals can be drawn if Practical Salinity is on X<br>and Potential Temperature is on Y, or if Absolute<br>Salinity is on X and Conservative Temperature is on Y.</p>";ui.showDlg("Isopynal Properties",e,Html.dlgBtn("DlgIsopynals.onApply()"))}}class DlgIsoVars{static enableButtons(){let t=Fct.selectedNums("IsoVarList"),e=t.length;$("delIsoVarsBttn").disabled=e==0;$("edtIsoVarsBttn").disabled=e!=1;$("vsyIsoVarsBttn").disabled=e!=1;$("ssyIsoVarsBttn").disabled=e!=1;if(e!=1||t[0]!=DlgIsoVars.edtIdx)DlgIsoVars.edtIdx=-1;$("addIsoVarsBttn").innerHTML=DlgIsoVars.edtIdx>-1?"Update":"Add"}static onAdd(){let i=Fct.selectedNum("dispVarSel",-1);let s=Fct.selectedNum("surfVarSel",-1);let a=Fct.strFromElem("surfVal","first");if(a==="first"||a==="last"||a==="minimum"||a==="maximum"||Fct.numFromStr(a,App.missDOUBLE)!=App.missDOUBLE){let e=DlgIsoVars.edtIdx;if(e==-1)App.wrkArr.push(new IsoVar(i,s,a));else{let t=App.wrkArr[e];t.varId=i;t.surfVarId=s;t.surfVal=a;DlgIsoVars.edtIdx=-1}DlgIsoVars.update()}}static onApply(){view.isoVarSet.isoVarArr=App.wrkArr;ui.hideDlg();app.sendWsMsg(Msg.setIsoVars()+","+Msg.msgGetDockIsoVarLbls+","+Msg.msgGetCanvasCurrInfo)}static onDelete(){let t=Fct.selectedNums("IsoVarList");if(t.length>0){App.wrkArr=Fct.strippedArray(App.wrkArr,t);DlgIsoVars.update()}}static onEdit(){DlgIsoVars.edtIdx=Fct.selectedNum("IsoVarList");DlgIsoVars.enableButtons();let t=App.wrkArr[DlgIsoVars.edtIdx];$("dispVarSel").selectedIndex=ui.dockDataVarIds.indexOf(t.varId);$("surfVarSel").selectedIndex=ui.dockDataVarIds.indexOf(t.surfVarId);Fct.setInputElemStr("surfVal",t.surfVal)}static onSSync(){let t=Fct.selectedNum("IsoVarList"),e=App.wrkArr.length;let i=App.wrkArr[t].surfVarId,s=App.wrkArr[t].surfVal;for(t=0;t<e;++t){App.wrkArr[t].surfVarId=i;App.wrkArr[t].surfVal=s}DlgIsoVars.update()}static onVSync(){let t=Fct.selectedNum("IsoVarList");let e=App.wrkArr.length,i=App.wrkArr[t].varId;for(t=0;t<e;++t)App.wrkArr[t].varId=i;DlgIsoVars.update()}static show(){App.wrkArr=view.isoVarSet.isoVarArr;ui.dlgOrigVals=new Map;DlgIsoVars.edtIdx=-1;let t="<fieldset><legend><b>New</b></legend>";t+="<p>"+Html.selectList("dispVarSel",ui.dockDataVarIds,ui.dockDataVarLabels,1)+"&emsp;@&emsp;"+Html.selectList("surfVarSel",ui.dockDataVarIds,ui.dockDataVarLabels,0)+"&emsp;=&emsp;"+Html.txtInput("surfVal","first")+"</p>";t+='<span style="float:right">'+Html.button("Add","DlgIsoVars.onAdd()","addIsoVarsBttn")+"</span>";t+="</fieldset>";t+="<p><fieldset><legend><b>Already Defined</b></legend>";t+="<p>"+Html.selectList("IsoVarList",[],[],-1,1,-1,"",4)+"</p>";t+=Html.button("Delete","DlgIsoVars.onDelete()","delIsoVarsBttn")+"&ensp;";t+=Html.button("Edit","DlgIsoVars.onEdit()","edtIsoVarsBttn");t+='<span style="float:right">'+Html.button("V-Sync","DlgIsoVars.onVSync()","vsyIsoVarsBttn")+"&ensp;"+Html.button("S-Sync","DlgIsoVars.onSSync()","ssyIsoVarsBttn")+"</span>";t+="</fieldset></p>";ui.showDlg("Isosurface Variables",t,Html.dlgBtn("DlgIsoVars.onApply()"));$("dispVarSel").setAttribute("style","max-width:250px");$("surfVarSel").setAttribute("style","max-width:160px");$("IsoVarList").setAttribute("style","width:100%");ui.placeDlg();$("IsoVarList").addEventListener("click",DlgIsoVars.enableButtons);DlgIsoVars.update()}static update(){let e,i=[],s=[],t=$("IsoVarList"),a=$("delIsoVarsBttn");for(let t=0;t<App.wrkArr.length;++t){e=App.wrkArr[t];i.push(t);s.push(coll.isoVarFullLabel(e.varId,e.surfVarId,e.surfVal))}t.innerHTML=Html.selectListContents(i,s,[]);DlgIsoVars.enableButtons()}}class DlgRsrcMgr{static delete(){let t=DlgRsrcMgr.curr.attributes.value.nodeValue;ui.hideDlg();let e=Ui.rsrc.keys[DlgRsrcMgr.mode]+t.slice(8);localStorage.removeItem(e);localStorage.removeItem(e+"~");DlgRsrcMgr.updateTree();Fct.setLastLocalStorageChangeTime()}static enableButtons(){let t=DlgRsrcMgr.curr!=null,e=false;if(t)e=DlgRsrcMgr.curr.attributes.value.nodeValue.startsWith("private:");$("mvBtnDownload").disabled=!t;$("mvBtnRename").disabled=!t||!e;$("mvBtnDelete").disabled=!t||!e}static onDelete(){let t=DlgRsrcMgr.curr.attributes.value.nodeValue;let e=Ui.rsrc.names[DlgRsrcMgr.mode];if(!t.startsWith("private:"))return;ui.dlgYesNoBox("Confirm Delete Private "+e,"Really want to delete "+e.toLowerCase()+' "'+t.slice(8)+'"</b>?',"DlgRsrcMgr.delete()")}static onDownload(){let s=DlgRsrcMgr.curr.attributes.value.nodeValue,a=DlgRsrcMgr.mode;if(s.startsWith("private:")){let t=ViewSpec.validatedName(s.slice(8));let e=localStorage.getItem(Ui.rsrc.keys[a]+t);if(a==0){let t=JSON.parse(e);e=t.xmlStr}else e=App.xmlHeader+e;let i=t.lastIndexOf("/");if(i>-1)t=t.slice(i+1);Fct.saveBlobAs(new Blob([e],{type:"text/plain"}),t+Ui.rsrc.exts[a])}else{app.sendWsMsg('{"cmd":"get_resource_as_xml","type":'+a+',"file":"'+s+'"}')}}static onFileLoad(t){let e,i=false,s=DlgRsrcMgr.uploadFn,a=DlgRsrcMgr.mode;let l=Ui.rsrc.keys[a]+s,r=t.target.result;r=r.replace(/[\r\n]+/g," ");r=r.replaceAll('"',"'");if(a==0){r=JSON.stringify(new ViewSpec(s,r));localStorage.removeItem(l+"~");i=true}else if(a==1){e=r.indexOf("<Section");if(e>-1){r=r.substring(e);i=true}}else if(a==2){e=r.indexOf("<GraphicsObjects");if(e>-1){r=r.substring(e);i=true}}if(i){localStorage.setItem(l,r);Fct.setLastLocalStorageChangeTime();DlgRsrcMgr.updateTree()}}static onFileSelect(t){if(t.target.files.length==0)return;let e=new FileReader,i=t.target.files[0].name,s=DlgRsrcMgr.mode;let a=i.indexOf(Ui.rsrc.exts[s]);if(a==-1)return;DlgRsrcMgr.uploadFn=i.slice(0,a);e.addEventListener("load",DlgRsrcMgr.onFileLoad);e.readAsText(t.target.files[0])}static onRename(){let t=DlgRsrcMgr.curr.attributes.value.nodeValue;let e=Ui.rsrc.names[DlgRsrcMgr.mode];if(!t.startsWith("private:"))return;ui.dlgQueryStr("Rename "+e,"Enter new "+e.toLowerCase()+" name",t.slice(8),"DlgRsrcMgr.rename()","Rename")}static onTreeItemClick(){if(DlgRsrcMgr.curr!=null)DlgRsrcMgr.curr.classList.toggle("is-selected");this.classList.toggle("is-selected");DlgRsrcMgr.curr=this.classList.contains("is-selected")?this:null;DlgRsrcMgr.enableButtons()}static rename(){let s=DlgRsrcMgr.curr.attributes.value.nodeValue.slice(8);let a=ViewSpec.validatedName($("queryStr").value),t=DlgRsrcMgr.mode;let e=Ui.rsrc.keys[t],l=e+s,r=e+a;ui.hideDlg();if(a==s)return;let n=localStorage.getItem(l);if(n!=null){if(t==0){let t=JSON.parse(n);t.name=a;n=JSON.stringify(t);let e=localStorage.getItem(l+"~");if(e!=null){t=JSON.parse(e);t.name=a;e=JSON.stringify(t);localStorage.removeItem(l+"~");localStorage.setItem(r+"~",e)}let i=viewHistory.current();if(s==i.name){i.name=a;ui.updateSbModePane();app.sendWsMsg(Msg.modifyView("",i.name))}}else if(t==1){let t=new Section(n);t.setName(a);n=t.toXml()}else if(t==2){let t=new GObjectSet(n);t.setNames(a);n=t.toXml()}localStorage.removeItem(l);localStorage.setItem(r,n);DlgRsrcMgr.updateTree();Fct.setLastLocalStorageChangeTime()}}static show(t){const e=[460,470,510,460];DlgRsrcMgr.mode=t;let i=Ui.rsrc.names[DlgRsrcMgr.mode];let s='<div id="treeViewGrid">';s+='<div id="mvTreeViewDiv" class="has-border"></div>';s+='<div id="mvBtnsDiv">';s+="<p>&emsp;</p>";s+=Html.labelFor("fileSelector","Click to select a "+i.toLowerCase()+" for upload")+'<p><input type="file" id="fileSelector"/></p>';s+="<p>&emsp;</p>";s+="<p>"+Html.button("Download","DlgRsrcMgr.onDownload()","mvBtnDownload",true)+"</p>";s+="<p>"+Html.button("Rename","DlgRsrcMgr.onRename()","mvBtnRename",true)+"</p>";s+="<p>"+Html.button("Delete","DlgRsrcMgr.onDelete()","mvBtnDelete",true)+"</p>";s+="</div></div>";ui.showDlg("Manage "+i+"s",s,Html.dlgBtn("ui.hideDlg(true)","Close"));$("fileSelector").addEventListener("change",DlgRsrcMgr.onFileSelect);$("treeViewGrid").style.width=e[t]+"px";DlgRsrcMgr.updateTree()}static updateTree(){const t="SelectItemTree",e=Html.treeAsHtml(t,DlgRsrcMgr.mode);$("mvTreeViewDiv").innerHTML=e.html;if(e.count>0)ui.activateTree(t,DlgRsrcMgr.onTreeItemClick);let i=$("public-node");if(i!=null)i.click();i=$("private-node");if(i!=null)i.click();DlgRsrcMgr.curr=null;DlgRsrcMgr.enableButtons()}}class DlgMapWin{static onApply(){let e=view.mapWin,t=Fct.idxFromElem("palName",-1);e.palName=t>-1?ui.paletteNames[t]:"Odv";e.fontSizeFac=Fct.numFromElem("fontSizeFac",100);e.bckColor=Fct.idxFromElem("bckColor",31);e.gridColor=Fct.idxFromElem("gridColor",0);e.drawGrid=Fct.checkBoxState("drawGrid");e.drawLabels=Fct.checkBoxState("drawLabels");e.symbSize=Fct.numFromElem("symbSize",7)*.1;e.symbColor=Fct.idxFromElem("symbColor",1);e.wLon=Fct.numFromElem("wLon",-1e10);e.eLon=Fct.numFromElem("eLon",1e10);e.sLat=Fct.numFromElem("sLat",-1e10);e.nLat=Fct.numFromElem("nLat",1e10);let i=ui.dlgValChanged("wLon",e.wLon)||ui.dlgValChanged("eLon",e.eLon)||ui.dlgValChanged("sLat",e.sLat)||ui.dlgValChanged("nLat",e.nLat);e.prjType=Fct.selectedNum("prjType",0);if(i){e.prjCntrLon=.5*(e.wLon+e.eLon);e.prjCntrLat=.5*(e.sLat+e.nLat)}else{e.prjCntrLon=Fct.numFromElem("prjCntrLon",.5*(e.wLon+e.eLon));e.prjCntrLat=Fct.numFromElem("prjCntrLat",.5*(e.sLat+e.nLat));let t=e.eLon-e.wLon;e.eLon=e.prjCntrLon+.5*t;e.wLon=e.prjCntrLon-.5*t}e.doBathy=Fct.checkBoxState("doBathy");e.doCoast=Fct.checkBoxState("doCoast");e.doTopo=Fct.checkBoxState("doTopo");e.doRivers=Fct.checkBoxState("doRivers");e.doBorders=Fct.checkBoxState("doBorders");e.fillCoast=Fct.checkBoxState("fillCoast");e.colBarAlign=Fct.isChecked("colBarAlign")?1:0;e.annotationStyle=Fct.selectedNum("annotStyle",0);e.annotationFontSize=Fct.numFromElem("annotFntSize",10);ui.hideDlg();app.sendWsMsg(Msg.setMapProperties()+","+Msg.msgGetCanvasCurrInfo)}static onFullDomain(){Fct.setInputElemStr("wLon","");Fct.setInputElemStr("eLon","");Fct.setInputElemStr("sLat","");Fct.setInputElemStr("nLat","")}static onGlobalMap(){Fct.setInputElemStr("wLon","-180");Fct.setInputElemStr("eLon","180");Fct.setInputElemStr("sLat","-90");Fct.setInputElemStr("nLat","90")}static onPaletteChange(){let t=Fct.idxFromElem("palName",-1);if(t==-1)return;ui.updatePaletteIdx("bckColor",t);ui.updatePaletteIdx("gridColor",t);ui.updatePaletteIdx("symbColor",t)}static show(){const t="DlgMapWin",e=ui.getLastOpenElem(t);let i=view.mapWin;ui.dlgOrigVals=new Map;let s='<div class="TabbedDlg" id="'+t+'" style="width: 480px">';s+=Html.panelBegin(t,1,"General",e==1);s+=Html.winGeneral(i,false);s+=Html.panelEnd();s+=Html.panelBegin(t,2,"Display Style",e==2);s+='<table class="StdTable">';s+="<tr><td>Station dot size:</td><td>"+Html.numInput("symbSize",Fct.roundedVal(i.symbSize*10,1),-1,99)+"</td></tr>";s+="<tr><td>Station dot color:</td><td>"+Html.colorSelector("symbColor",i.palName,i.symbColor,false,true)+"</td></tr>";s+="</table>";s+=Html.panelEnd();ui.dlgOrigVals.set("wLon",Fct.roundedVal(i.wLon,5));ui.dlgOrigVals.set("eLon",Fct.roundedVal(i.eLon,5));ui.dlgOrigVals.set("sLat",Fct.roundedVal(i.sLat,5));ui.dlgOrigVals.set("nLat",Fct.roundedVal(i.nLat,5));s+=Html.panelBegin(t,3,"Domain",e==3);s+='<table id="MapDomainTbl">';s+="<tr><td></td><td>North</td><td></td></tr>";s+="<tr><td></td><td>"+Html.txtInput("nLat",ui.dlgOrigVals.get("nLat"))+"</td><td></td></tr>";s+='<tr><td></td><td rowspan="6"><img src="'+extPrms.resourceRoot+'img/windrose.png"></td><td></td></tr>';s+='<tr><td colspan="3">&nbsp;</td></tr>';s+="<tr><td>West</td><td></td><td>East</td><td></td></tr>";s+="<tr><td>"+Html.txtInput("wLon",ui.dlgOrigVals.get("wLon"))+"</td><td></td><td>"+Html.txtInput("eLon",ui.dlgOrigVals.get("eLon"))+"</td></tr>";s+='<tr><td colspan="3">&nbsp;</td></tr>';s+='<tr><td colspan="2">&nbsp;</td><td></td></tr>';s+="<tr><td></td><td>South</td><td></td><td></td><td>"+Html.button("Full Domain","DlgMapWin.onFullDomain()","btnFullDomain",true)+"</td></tr>";s+="<tr><td></td><td>"+Html.txtInput("sLat",ui.dlgOrigVals.get("sLat"))+"</td><td></td><td></td><td>"+Html.button("Global Map","DlgMapWin.onGlobalMap()","btnGlobalMap",true)+"</td></tr>";s+="</table>";s+=Html.panelEnd();s+=Html.panelBegin(t,4,"Projection",e==4);s+=Html.selectList("prjType",[0,1,2,3,5,4,7],["Default Projection","Orthographic (North Polar)","Orthographic (Equatorial)","Orthographic (South Polar)","Orthographic (Oblique)","Mollweide","Mercator"],i.prjType);s+='<p>&nbsp;</p><table class="StdTable">';s+="<tr><td>Pole longitude:</td><td>"+Html.txtInput("prjCntrLon",Fct.roundedVal(i.prjCntrLon,4))+" &#176E</td></tr>";s+="<tr><td>Pole latitude:</td><td>"+Html.txtInput("prjCntrLat",Fct.roundedVal(i.prjCntrLat,4))+" &#176N</td></tr>";s+="</table>";s+=Html.panelEnd();s+=Html.panelBegin(t,5,"Layers",e==5);s+="<div>"+Html.checkBoxTF("doBathy","Ocean bathymetry",i.doBathy)+"</div>";s+="<div>"+Html.checkBoxTF("doCoast","Coastlines",i.doCoast)+"</div>";s+="<div>"+Html.checkBoxTF("doTopo","Land topography",i.doTopo)+"</div>";s+="<div>"+Html.checkBoxTF("doRivers","Lakes and rivers",i.doRivers)+"</div>";s+="<div>"+Html.checkBoxTF("doBorders","Borders",i.doBorders)+"</div>";s+="<div>&nbsp;</div>";s+="<div>"+Html.checkBoxTF("fillCoast","Fill coastlines",i.fillCoast)+"</div>";s+="<div>"+Html.checkBox("colBarAlign","Draw color bar",i.colBarAlign)+"</div>";s+=Html.panelEnd();s+=Html.panelBegin(t,6,"Annotations",e==6);s+='<table class="StdTable">';s+="<tr><td>Style:</td><td>"+Html.selectList("annotStyle",[0,1,2],["No annotations","Station labels","Cruise and station labels"],i.annotationStyle)+"</td></tr>";s+="<tr><td>Font size [pt]:</td><td>"+Html.numInput("annotFntSize",i.annotationFontSize,0,49,1)+"</td></tr>";s+="</table>";s+=Html.panelEnd()+"</div>";ui.showDlg("Map Properties",s,Html.dlgBtn("DlgMapWin.onApply()"));$("tabPanel"+e).click();if(DlgMapWin.observer==undefined)DlgMapWin.observer=new MutationObserver(DlgMapWin.onPaletteChange);DlgMapWin.observer.observe($("palName"),{childList:true})}}class DlgMultiSample{static onClick(t){DlgMultiSample.setCurrentRow(t.target.parentNode.id)}static onSelect(){ui.hideDlg();let t=parseInt(DlgMultiSample.currRow.id.slice(4));let e=Msg.selectSampleByStationId(DlgMultiSample.statIds[t],DlgMultiSample.smplIds[t]);app.sendWsMsg(e+","+Msg.msgGetCurrInfo)}static setCurrentRow(t){let e=$(t);if(e!=null){if(DlgMultiSample.currRow!=undefined)Fct.unselect(DlgMultiSample.currRow);Fct.setSelected(e);DlgMultiSample.currRow=e}}static show(t,e,i,s,a,l,r,n,o,d,c){DlgMultiSample.statIds=e;DlgMultiSample.smplIds=i;let m,u=e.length;let p='<div id="MultiSampleDiv" class="has-border">';p+='<table id="MultiSampleTable" class="StdTable has-altbckcolor">';p+='<tr id="headerrow"><th></th><th>Station ID</th><th>Sample</th><th>Cruise</th><th>Station</th><th>Date</th><th>Position</th><th>X</th><th>Y</th><th>Z</th></tr>';for(m=0;m<u;++m){p+='<tr id="row:'+m+'"><th>'+(m+1)+"</th><td>"+e[m]+"</td><td>"+s[m]+"</td><td>"+a[m]+"</td><td>"+l[m]+"</td><td>"+r[m]+"</td><td>"+n[m]+"</td><td>"+o[m]+"</td><td>"+d[m]+"</td><td>"+c[m]+"</td></tr>"}p+="</table></div>";ui.showDlg(t+" Matching Samples: Select One ...",p,Html.dlgBtn("DlgMultiSample.onSelect()","Select"));let g=$("MultiSampleDiv");g.scrollTop=g.scrollHeight-g.clientHeight;$("MultiSampleTable").addEventListener("click",DlgMultiSample.onClick);DlgMultiSample.setCurrentRow("row:"+(u-1))}}class DlgMultiStation{static onClick(t){DlgMultiStation.setCurrentRow(t.target.parentNode.id)}static onSelect(){ui.hideDlg();let t=parseInt(DlgMultiStation.currRow.id.slice(4));let e=Msg.selectSampleByStationId(DlgMultiStation.statIds[t],ui.currSmplId);app.sendWsMsg(e+","+Msg.msgGetCurrInfo)}static setCurrentRow(t){let e=$(t);if(e!=null){if(DlgMultiStation.currRow!=undefined)Fct.unselect(DlgMultiStation.currRow);Fct.setSelected(e);DlgMultiStation.currRow=e}}static show(t,e,i,s,a,l,r,n){DlgMultiStation.statIds=e;let o,d=e.length,c=coll.dataVarFullLabel(coll.primaryVarId);o=c.indexOf(" [");if(o>-1)c=c.substring(0,o);let m='<div id="MultiStationDiv" class="has-border">';m+='<table id="MultiStationTable" class="StdTable has-altbckcolor">';m+='<tr id="headerrow"><th></th><th>Station ID</th><th>Cruise</th><th>Station</th><th>Date</th><th>Position</th><th># Samples</th><th>'+c+" Range</th></tr>";for(o=0;o<d;++o){m+='<tr id="row:'+o+'"><th>'+(o+1)+"</th><td>"+e[o]+"</td><td>"+s[o]+"</td><td>"+a[o]+"</td><td>"+l[o]+"</td><td>"+r[o]+"</td><td>"+i[o]+"</td><td>"+n[o]+"</td></tr>"}m+="</table></div>";ui.showDlg(t+" Matching Stations: Select One ...",m,Html.dlgBtn("DlgMultiStation.onSelect()","Select"));let u=$("MultiStationDiv");u.scrollTop=u.scrollHeight-u.clientHeight;$("MultiStationTable").addEventListener("click",DlgMultiStation.onClick);DlgMultiStation.setCurrentRow("row:"+(d-1))}}class DlgMwStats{static rXh(){$("btnXh").blur();app.sendWsMsg(Msg.getImage("x_histogram","jpg",0))}static rYh(){$("btnYh").blur();app.sendWsMsg(Msg.getImage("y_histogram","jpg",0))}static rXYh(){$("btnXYh").blur();app.sendWsMsg(Msg.getImage("xy_histogram","jpg",0))}static rTh(){$("btnTh").blur();app.sendWsMsg('{"cmd":"get_image","type":"time_histogram","fmt":"jpg","window_id":0}')}static rSh(){$("btnSh").blur();app.sendWsMsg('{"cmd":"get_image","type":"season_histogram","fmt":"jpg","window_id":0}')}static show(t){const e="Visible data",i="All data";let s='<table id="MwStatsTbl" class="StdTable has-border">';s+="<tr><th></th>"+Html.toolTipElem("th","Mean",e)+Html.toolTipElem("th","Stand. Dev.",e)+Html.toolTipElem("th","Count",e)+Html.toolTipElem("th","Minimum",i)+Html.toolTipElem("th","Maximum",i)+"</tr>";s+="<tr><td><b>"+t.X.label+"</b></td>"+Html.toolTipElem("td",t.X.mean,e)+Html.toolTipElem("td",t.X.stdev,e)+Html.toolTipElem("td",Fct.formattedInt(t.X.count),e)+Html.toolTipElem("td",t.X.min,i)+Html.toolTipElem("td",t.X.max,i)+"</tr>";s+="<tr><td><b>"+t.Y.label+"</b></td>"+Html.toolTipElem("td",t.Y.mean,e)+Html.toolTipElem("td",t.Y.stdev,e)+Html.toolTipElem("td",Fct.formattedInt(t.Y.count),e)+Html.toolTipElem("td",t.Y.min,i)+Html.toolTipElem("td",t.Y.max,i)+"</tr>";s+='</table><p>&nbsp;</p><table class="StdTable">';s+="<tr><td>"+Html.button("X Histogram","DlgMwStats.rXh()","btnXh",true)+"</td><td>"+Html.button("Y Histogram","DlgMwStats.rYh()","btnYh",true)+"</td><td>"+Html.button("Heat Map","DlgMwStats.rXYh()","btnXYh")+"</td></tr><tr><td>"+Html.button("Time Histogram","DlgMwStats.rTh()","btnTh",true)+"</td><td>"+Html.button("Season Histogram","DlgMwStats.rSh()","btnSh",true)+"</td></tr></table>";ui.showDlg("Map Statistics",s,Html.dlgBtn("ui.hideDlg(true)","Close"))}}class DlgPaletteSelector{static onClick(t){let e=DlgPaletteSelector.el;e.attributes.idx.value=t;e.selectedIndex=t;e.innerHTML=Html.paletteSelectorItem(t,false);ui.hideDlg()}static onClose(){ui.hideDlg()}static show(t){let e,i=-1,s=$(t);DlgPaletteSelector.el=s;let a=s.attributes.idx.value;let l='<ul id="paletteSelectorList" class="paletteSelectorList has-border">';for(e=0;e<ui.paletteNames.length;e++){l+=Html.paletteSelectorItem(e,true,a==e);if(a==e)i=e}l+="</ul>";ui.showDlg("",l,"");if(i!=-1){let t=$("paletteSelectorList");t.scrollTop=t.children[i].offsetTop-80}}}class DlgPickList{static enableButtons(){let t=App.wrkArr.length-1,e=!(App.wrkIdx>0);$("BtnPlUp").disabled=e;$("BtnPlTop").disabled=e;e=!(App.wrkIdx>=0&&App.wrkIdx<t);$("BtnPlDown").disabled=e;$("BtnPlBottom").disabled=e;e=App.wrkIdx==-1;$("BtnPlEdit").disabled=e;$("BtnPlDel").disabled=e;$("BtnPlDelAll").disabled=App.wrkArr.length==0}static moveBottom(){DlgPickList.moveTo(App.wrkArr.length-1)}static moveDown(){DlgPickList.moveTo(App.wrkIdx+1)}static moveTo(t){if(App.wrkIdx==-1)return;Fct.moveElem(App.wrkArr,App.wrkIdx,t);App.wrkIdx=t;DlgPickList.updateList()}static moveTop(){DlgPickList.moveTo(0)}static moveUp(){DlgPickList.moveTo(App.wrkIdx-1)}static onApply(){ui.hideDlg();view.pickedStatArr=[...App.wrkArr];app.sendWsMsg(Msg.setPickedStats()+","+Msg.msgGetCanvasCurrInfo)}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined||e.nodeName!="TD")return;const i=e.parentNode.rowIndex;if(i>0){App.wrkIdx=i-1;DlgPickList.xSel.select(i,t.shiftKey,t.ctrlKey);DlgPickList.enableButtons()}}static onDelete(){if(App.wrkIdx>-1){App.wrkArr.splice(App.wrkIdx,1);App.wrkIdx=-1;DlgPickList.updateList()}}static onDeleteAll(){App.wrkArr=[];App.wrkIdx=-1;DlgPickList.updateList()}static onEditApply(){let t=App.wrkArr[App.wrkIdx];t.symbType=Fct.selectedNum("pleType",t.symbType);t.frameWidth=Fct.selectedNum("pleBw",t.frameWidth);t.fillCol=Fct.idxFromElem("pleFc",t.fillCol);t.frameCol=Fct.idxFromElem("pleBc",t.frameCol);t.lineStyle=Fct.selectedNum("pleLst",t.lineStyle);t.lineCol=Fct.idxFromElem("pleLc",t.lineCol);t.align=Ui.textAlignIdx(Fct.selectedNum("pleAx",1),Fct.selectedNum("pleAy",1));ui.hideDlg();DlgPickList.updateList()}static onEditClick(){if(App.wrkIdx==-1)return;let t=App.wrkArr[App.wrkIdx],e=view.mapWin.palName;let i="<p><fieldset><legend>Symbol</legend>";i+='<table class="StdTable">';i+="<tr><td>Type:</td><td>"+Html.selectListSymbol("pleType",t.symbType)+"</td><td>Border width:</td><td>"+Html.selectListLineWidth("pleBw",t.frameWidth,true)+"</td></tr>";i+="<tr><td>Fill color:</td><td>"+Html.colorSelector("pleFc",e,t.fillCol,true)+"</td><td>Border color:</td><td>"+Html.colorSelector("pleBc",e,t.frameCol)+"</td></tr>";i+="</table></fieldset></p>";i+="<p><fieldset><legend>Line</legend>";i+='<table class="StdTable">';i+="<tr><td>Style:</td><td>"+Html.selectListLineStyle("pleLst",t.lineStyle)+"</td><td>Color:</td><td>"+Html.colorSelector("pleLc",e,t.lineCol,false,false,"Line color")+"</td></tr>";i+="</table></fieldset></p>";i+="<p><fieldset><legend>Annotation Alignment</legend>";i+='<table class="StdTable">';i+="<tr><td>X:</td><td>"+Html.selectListAlignX("pleAx",Ui.xAlignIdx[t.align])+"</td><td>Y:</td><td>"+Html.selectListAlignY("pleAy",Ui.yAlignIdx[t.align])+"</td></tr>";i+="</table></fieldset></p>";ui.showDlg("Station ID: "+t.statId+" - Properties",i,Html.dlgBtn("DlgPickList.onEditApply()"))}static show(){App.wrkArr=[...view.pickedStatArr];let t='<div id="plGrid" style="height:250px">';t+='<div id="plTblDiv" class="has-border"></div>';t+='<div id="plButtons">';t+=Html.button("Edit","DlgPickList.onEditClick()","BtnPlEdit",true);t+="<p>"+Html.button("Remove","DlgPickList.onDelete()","BtnPlDel",true)+"</p>";t+="<p>"+Html.button("Remove All","DlgPickList.onDeleteAll()","BtnPlDelAll",true)+"</p>";t+="<p>&ensp;</p>";t+="<p>"+Html.button("Foreground","DlgPickList.moveTop()","BtnPlTop",true)+"</p>";t+="<p>"+Html.button("Up","DlgPickList.moveUp()","BtnPlUp",true)+"</p>";t+="<p>"+Html.button("Down","DlgPickList.moveDown()","BtnPlDown",true)+"</p>";t+="<p>"+Html.button("Background","DlgPickList.moveBottom()","BtnPlBottom",true)+"</p>";t+="</div>";t+="</div>";ui.showDlg("Pick List Editor",t,Html.dlgBtn("DlgPickList.onApply()"));App.wrkIdx=-1;DlgPickList.updateList()}static updateList(){let i,t=App.wrkArr.length,e={};let s='<table id="plTbl" class="StdTable">';s+='<tr><th style="width:10%">Symbol</th><th style="width:14%">Station ID</th>'+'<th style="width:34%">Cruise Label</th><th style="width:22%">Station Label</th></tr>';for(i=0;i<t;++i){s+="<tr><td>"+Html.canvas("plCnvs"+i,20,18)+"</td><td>"+App.wrkArr[i].statId+"</td><td>"+App.wrkArr[i].cruiseLbl+"</td><td>"+App.wrkArr[i].statLbl+"</td></tr>"}$("plTblDiv").innerHTML=s+"</table>";let a=ui.ctx;let l=ui.paletteIndex(view.mapWin.palName),r=ui.paletteReds[l];let n=ui.paletteGreens[l],o=ui.paletteBlues[l];for(i=0;i<t;++i){ui.ctx=$("plCnvs"+i).getContext("2d");let t=App.wrkArr[i].fillCol,e=App.wrkArr[i].frameCol;ui.ctx.strokeStyle=Html.rgb(r[e],n[e],o[e]);ui.ctx.fillStyle=Html.rgb(r[t],n[t],o[t]);ui.drawSymbol(App.wrkArr[i].symbType,10,10,7)}ui.ctx=a;let d=$("plTbl"),c=Array.from(d.rows);d.addEventListener("click",DlgPickList.onClick);DlgPickList.xSel=new XSelector(c,false);if(App.wrkIdx>-1){DlgPickList.xSel.select(App.wrkIdx+1);if(App.wrkIdx>8)c[App.wrkIdx].scrollIntoView()}DlgPickList.enableButtons()}}class DlgSmplFilter{static applyQf(t,e,i){let s=this.Qf.varIds.indexOf(t);if(s>-1){if(i.length==0)DlgSmplFilter.removeQ(s);else this.Qf.exclQfArrs[s]=i}else{if(i.length>0){this.Qf.schemaIds.push(e);this.Qf.varIds.push(t);this.Qf.exclQfArrs.push(i)}}}static defPoly(){ui.popupBckgrd.style.display="none";ui.startPointGetting(DlgSmplFilter.setPoly)}static delPoly(){DlgSmplFilter.Pf.clear();DlgSmplFilter.updateP()}static onApply(){DlgSmplFilter.retrieveQ();DlgSmplFilter.retrieveR();ui.hideDlg();let t=SmplFilter.toXmlS(this.Rf.varIds,this.Rf.minVals,this.Rf.maxVals,this.Rf.wildCards,this.Qf.varIds,this.Qf.schemaIds,this.Qf.exclQfArrs,this.Pf,this.winId);if(this.winId==-20)this.callbFct(t);else app.sendWsMsg(Msg.setSmplFilter(DlgSmplFilter.winId,t)+","+Msg.msgGetCanvasCurrInfo)}static onQVarChanged(){let t=parseInt(this.value);DlgSmplFilter.retrieveQ();DlgSmplFilter.currQVid=t;DlgSmplFilter.updateQ()}static onRVarChanged(){let t=parseInt(this.value);DlgSmplFilter.retrieveR();DlgSmplFilter.currRVid=t;DlgSmplFilter.updateR()}static rejectOutliersCurrQ(){let t=DlgSmplFilter.currQVid,e=coll.dataVarQfSetId(t);let i=qfSets.get(e),s=[];if(i!=undefined){i.outlier_flags.map(t=>{s.push(t.charCodeAt(0))});DlgSmplFilter.applyQf(t,e,s);DlgSmplFilter.updateQ()}}static relaxAllR(){this.Rf.varIds=[];this.Rf.minVals=[];this.Rf.maxVals=[];this.Rf.wildCards=[];DlgSmplFilter.updateR()}static relaxCurrQ(){let t=this.Qf.varIds.indexOf(DlgSmplFilter.currQVid);if(t>-1)DlgSmplFilter.removeQ(t);DlgSmplFilter.updateQ()}static relaxCurrR(){let t=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);if(t>-1)DlgSmplFilter.removeR(t);DlgSmplFilter.updateR()}static removeQ(t){this.Qf.varIds.splice(t,1);this.Qf.schemaIds.splice(t,1);this.Qf.exclQfArrs.splice(t,1)}static removeR(t){this.Rf.varIds.splice(t,1);this.Rf.wildCards.splice(t,1);this.Rf.minVals.splice(t,1);this.Rf.maxVals.splice(t,1)}static retrieveCurrQ(){let t=DlgSmplFilter.currQVid,e=coll.dataVarQfSetId(t);let i=qfSets.get(e),s=Fct.selectedNums("SmplFilQfList"),a=[];i.flags.map(t=>{if(!s.includes(parseInt(t)))a.push(t.charCodeAt(0))});return{varId:t,qfSetId:e,excl:a}}static retrieveQ(){let t=DlgSmplFilter.retrieveCurrQ();DlgSmplFilter.applyQf(t.varId,t.qfSetId,t.excl)}static retrieveR(){let t=Fct.numFromElem("minValSmplF",App.missDOUBLE);let e=Fct.numFromElem("maxValSmplF",App.missDOUBLE);let i=Fct.strFromElem("wildCardsSmplF","");let s=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);let a=coll.isNumericDataVar(DlgSmplFilter.currRVid);let l=a&&t!=App.missDOUBLE&&e!=App.missDOUBLE||!a&&i.length>0;if(s>-1){if(!l){this.Rf.varIds.splice(s,1);this.Rf.minVals.splice(s,1);this.Rf.maxVals.splice(s,1);this.Rf.wildCards.splice(s,1)}else{this.Rf.minVals[s]=t;this.Rf.maxVals[s]=e;this.Rf.wildCards[s]=i}}else{if(l){this.Rf.varIds.push(DlgSmplFilter.currRVid);this.Rf.minVals.push(t);this.Rf.maxVals.push(e);this.Rf.wildCards.push(e)}}}static setPoly(t){ui.popupBckgrd.style.display="block";let e=DlgSmplFilter.winId;if(!t||ui.ptgCnvsX.length<3||e<1)return;let i=view.dataWinArr[e-1];if(i.scope==3)return;let s=[],a=[];ui.ptgCnvsX.push(ui.ptgCnvsX[0]);ui.ptgCnvsY.push(ui.ptgCnvsY[0]);ui.ptgCnvsX.map(t=>s.push(ui.toOdvCanvasX(t)));ui.ptgCnvsY.map(t=>a.push(ui.toOdvCanvasY(t)));DlgSmplFilter.Pf=new Patch("SampleFilterPatch",i.xvId,i.axisFullLabel("X"),i.yvId,i.axisFullLabel("Y"),s,a);DlgSmplFilter.updateP()}static show(t,e){if(t>0&&view.dataWinArr[t-1].scope==3)t=-10;const i="DlgSmplFilter",s=ui.getLastOpenElem(i);let a="Sample Filter - ";if(t==-20)a+="Export";else if(t==-10)a+="Isosurface Variables";else a+="Window "+t;DlgSmplFilter.winId=t;DlgSmplFilter.callbFct=e;let l=new SmplFilter;if(t==-10)l=view.isoVarSet.isoVarSmplFilter;else if(t>0)l=view.dataWinArr[t-1].smplFilter;this.Pf=l.getPatchFilter();this.Rf=l.getRangeFilters();this.Qf=l.getQualityFilters();this.varIds=coll.dataVarIds(view.drvdVarSet.drvdVarArr);this.varLbls=coll.dataVarFullLabels(view.drvdVarSet.drvdVarArr);DlgSmplFilter.currRVid=0;DlgSmplFilter.currQVid=0;let r='<div class="TabbedDlg" id="'+i+'">';r+=Html.panelBegin(i,1,"Range",s==1);r+='<p><b>Variable</b></p><p id="SmplFilRVarP"></p>';r+='<div id="sfrDiv"><p><b>Acceptable Range</b></p><p>'+Html.txtInput("minValSmplF")+" - "+Html.txtInput("maxValSmplF")+"</p></div>";r+='<div id="sfsDiv"><p><b>Acceptable Wildcards</b></p><p>'+Html.txtInput("wildCardsSmplF","15em")+"</p></div>";r+="<p>"+Html.button("Relax this range filter","DlgSmplFilter.relaxCurrR()")+"&emsp;"+Html.button("<b>Relax all range filters</b>","DlgSmplFilter.relaxAllR()")+"</p>";r+='<p><div id="StatSmplR"></div></p>';r+=Html.panelEnd();r+=Html.panelBegin(i,2,"Polygon",s==2);r+="<p>"+Html.button("Define Polygon","DlgSmplFilter.defPoly()","btnDefPoly")+"</p>";r+="<p>"+Html.button("Delete Polygon","DlgSmplFilter.delPoly()","btnDelPoly")+"</p>";r+='<p><div id="StatSmplP"></div></p>';r+=Html.panelEnd();r+=Html.panelBegin(i,3,"Quality",s==3);r+='<p><b>Variable</b></p><p id="SmplFilQVarP"></p>';r+='<p><b>Acceptable Quality Flags</b></p><p id="SmplFilQFlagP"></p>';r+="<p>"+Html.button("Relax this quality filter","DlgSmplFilter.relaxCurrQ()")+"&emsp;"+Html.button("Reject Outliers","DlgSmplFilter.rejectOutliersCurrQ()")+"&emsp;&emsp;&emsp;"+Html.button("<b>Apply to all variables</b>","DlgSmplFilter.useQForAll()")+"</p>";r+='<p><div id="StatSmplQ"></div></p>';r+=Html.panelEnd();r+="</div>";ui.showDlg(a,r,Html.dlgBtn("DlgSmplFilter.onApply()"));DlgSmplFilter.updateR();DlgSmplFilter.updateP();DlgSmplFilter.updateQ()}static updateP(){let t=DlgSmplFilter.winId;let e=t<1||view.dataWinArr[t-1].scope==3;let i=this.Pf.isDefined();$("btnDefPoly").disabled=e;$("btnDelPoly").disabled=e||!i;$("StatSmplP").innerText=i?"Polygon active":""}static updateQ(){let t=DlgSmplFilter.currQVid,e=[],i=[];this.varLbls.map((t,e)=>i.push(this.Qf.varIds.includes(this.varIds[e])?"* "+t:t));$("SmplFilQVarP").innerHTML=Html.selectList("SmplFilQVarLst",this.varIds,i,t);$("SmplFilQVarLst").addEventListener("change",DlgSmplFilter.onQVarChanged);let s=this.Qf.varIds.indexOf(t);let a=s>-1?this.Qf.exclQfArrs[s]:[];let l=qfSets.get(coll.dataVarQfSetId(t));l.flags.map(t=>{if(!a.includes(t.charCodeAt(0)))e.push(t)});$("SmplFilQFlagP").innerHTML=Html.selectListEx("SmplFilQfList",l.flags,l.flag_descriptions,e,1);$("StatSmplQ").innerText=Fct.countInfoString(this.Qf.varIds.length,this.varIds.length,"variable(s) quality filtering");$("SmplFilQfList").size=5}static updateR(){let i=[];this.varLbls.map((t,e)=>i.push(this.Rf.varIds.includes(this.varIds[e])?"* "+t:t));$("SmplFilRVarP").innerHTML=Html.selectList("SmplFilRVarLst",this.varIds,i,DlgSmplFilter.currRVid);$("SmplFilRVarLst").addEventListener("change",DlgSmplFilter.onRVarChanged);let t=coll.isNumericDataVar(DlgSmplFilter.currRVid);let e=this.Rf.varIds.indexOf(DlgSmplFilter.currRVid);Fct.setInputElemStr("minValSmplF",e>-1?this.Rf.minVals[e]:"");Fct.setInputElemStr("maxValSmplF",e>-1?this.Rf.maxVals[e]:"");Fct.setInputElemStr("wildCardsSmplF",e>-1?this.Rf.wildCards[e]:"");if(t){Fct.setDisplay("sfrDiv",true);Fct.setDisplay("sfsDiv",false)}else{Fct.setDisplay("sfrDiv",false);Fct.setDisplay("sfsDiv",true)}$("StatSmplR").innerText=Fct.countInfoString(this.Rf.varIds.length,this.varIds.length,"variable(s) range filtering")}static useQForAll(){let t=DlgSmplFilter.retrieveCurrQ();let e,i,s=this.varIds.length;for(e=0;e<s;++e){i=this.varIds[e];if(coll.dataVarQfSetId(i)==t.qfSetId)DlgSmplFilter.applyQf(i,t.qfSetId,t.excl)}DlgSmplFilter.updateQ()}}class DlgSecProps{static onApply(t){view.section.setVals(Fct.strFromElem("SecName",""),Fct.selectedNum("SecCoordSelect",0),Fct.numFromElem("SecWidth",200),Fct.selectedNum("SecBathySelect",2),Fct.idxFromElem("SecBathyColor",17));Ui.onHideDlgFct=Fct.noOpFct;ui.hideDlg();app.sendWsMsg(t()+","+Msg.msgGetDockDataVarLbls+","+Msg.msgGetCanvasCurrInfo)}static show(t){let e=0,i=2,s=200,a=17,l="",r=view.section;ui.dlgOrigVals=new Map;if(r.isValid()){l=r.name;e=r.type;a=r.bathyColor;i=r.bathyType;s=r.width}let n='<table class="StdTable">';n+="<tr><td>Section Name:</td><td>"+Html.txtInput("SecName",l)+"</td></tr>";n+="<tr><td>Section Coordinate:</td><td>"+Html.selectList("SecCoordSelect",[0,1,2,3],["Distance [km]","Longitude","Latitude","Time"],e)+"</td></tr>";n+="<tr><td>Mean Width [km]:</td><td>"+Html.txtInput("SecWidth",Fct.roundedVal(s,2))+"</td></tr>";n+="<tr><td>Bathymetry:</td><td>"+Html.selectList("SecBathySelect",[0,1,3,2],["No bathymetry","Station bottom depth","GEBCO","ETOPO1"],i)+"</td></tr>";n+="<tr><td>Bathymetry color:</td><td>"+Html.colorSelector("SecBathyColor",view.mapWin.palName,a)+"</td></tr>";n+="</table>";if(appState.isState(AppState.DefineSection2))Ui.onHideDlgFct=app.defSectionAbort;ui.showDlg("Section Properties",n,Html.dlgBtn("DlgSecProps.onApply("+t+")"))}}class DlgSelItems{static onChange(){$("selCountMsg").innerText=Fct.countInfoString(Fct.selectedStrs("selectList").length,DlgSelItems.optionCount,"items selected")}static onInvert(){Array.from($("selectList").options).map(t=>t.selected=!t.selected);DlgSelItems.onChange()}static onSelectAll(){Array.from($("selectList").options).map(t=>t.selected=true);DlgSelItems.onChange()}static onSelectExt(){let e=DlgSelItems.extSelect,t=Array.from($("selectList").options);t.map(t=>t.selected=e.indexOf(parseInt(t.value))>-1?true:false);DlgSelItems.onChange()}static show(t,e,i,s,a=[],l="Select",r=[],n=""){DlgSelItems.optionCount=e.length;DlgSelItems.extSelect=r;let o="<fieldset><b>Select one or more items</b></p>";o+=Html.selectListEx("selectList",e,i,a,1);o+='<p id="selCountMsg"></p>';o+=Html.button("Select All","DlgSelItems.onSelectAll()")+"&emsp;"+Html.button("Invert Selection","DlgSelItems.onInvert()");if(r.length>0)o+="&emsp;"+Html.button(n,"DlgSelItems.onSelectExt()");o+="</fieldset>";ui.showDlg(t,o,Html.dlgBtn(s,l));let d=$("selectList");d.size=Math.min(10,e.length);d.addEventListener("change",DlgSelItems.onChange);if(a.length==0)d.selectedIndex=-1;DlgSelItems.onChange()}}class DlgSelTreeItem{static onItemClick(){let t=this.attributes.value.nodeValue;ui.hideDlg();DlgSelTreeItem.onSelFct(t)}static show(t,e,i,s=true,a=true){DlgSelTreeItem.onSelFct=i;const l="SelectItemTree",r=Html.treeAsHtml(l,e,s,a);let n='<div id="TreeViewDivSelect" class="has-border">'+r.html+"</div>";ui.showDlg(t,n,"");if(r.count>0)ui.activateTree(l,DlgSelTreeItem.onItemClick);let o=$("public-node");if(o!=null)o.click();o=$("private-node");if(o!=null)o.click()}}class DlgStatFilter{static applyQf(t,e,i){let s=this.mvQf.varIds.indexOf(t);if(s>-1){if(i.length==0)DlgStatFilter.removeQ(t);else this.mvQf.exclQfArrs[s]=i}else{if(i.length>0){this.mvQf.varIds.push(t);this.mvQf.schemaIds.push(e);this.mvQf.exclQfArrs.push(i)}}}static clearPoly(){DlgStatFilter.xPolyPix=[];DlgStatFilter.yPolyPix=[];DlgStatFilter.xPoly=[];DlgStatFilter.yPoly=[];DlgStatFilter.polyfileName=""}static createLocalVars(){let t=coll.metaVarIds(true,true,true,true);let e=coll.metaVarFullLabels(true,true,true,true);let i=coll.metaVarIds(false,true,true,false);let s=coll.metaVarFullLabels(false,true,true,false);let a=[],l;if((l=coll.indexOfMetaVar("varType","METAPRIMVARMAX"))>-1){i.unshift(l);s.unshift(coll.metaVar(l).name);a.push(l)}if((l=coll.indexOfMetaVar("varType","METAPRIMVARMIN"))>-1){i.unshift(l);s.unshift(coll.metaVar(l).name);a.push(l)}if((l=coll.indexOfMetaVar("name","Accession Number"))>-1){i.unshift(l);s.unshift(coll.metaVar(l).name);a.push(l)}t=Fct.strippedArray(t,a);e=Fct.strippedArray(e,a);let r=coll.metaVarIds(false,true,false,true);let n=coll.metaVarFullLabels(false,true,false,true);this.emvNIds=i;this.emvNLbls=s;this.emvSIds=r;this.emvSLbls=n;this.mvQfIds=t;this.mvQfLbls=e;DlgStatFilter.currNumMvVid=i.length>0?i[0]:-1;DlgStatFilter.currStrMvVid=r.length>0?r[0]:-1;DlgStatFilter.currQVid=0;let o=view.statFilter;this.mvRaVarIds=[...o.mvRangeVarIds];this.mvRaMinVals=[...o.mvRangeMinVals];this.mvRaMaxVals=[...o.mvRangeMaxVals];this.mvWcVarIds=[...o.mvWildCardVarIds];this.mvWcExprs=[...o.mvWildCardExprs];this.mvWcCases=[...o.mvWildCardCases];this.mvQf=o.getMetaVarQualityFilters();this.xPolyPix=[];this.yPolyPix=[];this.polyfileName="";this.xPoly=[...o.xPoly];this.yPoly=[...o.yPoly]}static onApply(){let t=view.statFilter;t.cruise=Fct.strFromElem("CruiseLabel","*");t.statNameMin=Fct.strFromElem("StatLabelFirst","0");t.statNameMax=Fct.strFromElem("StatLabelLast","99999999");t.statIdMin=Fct.numFromElem("StatIdFirst",1)-1;t.statIdMax=Fct.numFromElem("StatIdLast",1e8)-1;t.smplCountMin=Fct.numFromElem("SmplCountMin",0);t.smplCountMax=Fct.numFromElem("SmplCountMax",99999999);if(Fct.isChecked("StfBottle"))t.statType="B";else if(Fct.isChecked("StfCTD"))t.statType="C";else if(Fct.isChecked("StfXBT"))t.statType="X";else if(Fct.isChecked("StfAny"))t.statType="*";t.periodDay0=Fct.selectedNum("PStrtDay");t.periodDay1=Fct.selectedNum("PEndDay");t.periodMon0=Fct.selectedNum("PStrtMon");t.periodMon1=Fct.selectedNum("PEndMon");t.periodYear0=Fct.numFromElem("PStrtYr",-99999);t.periodYear1=Fct.numFromElem("PEndYr",99999);t.periodHour0=Fct.numFromElem("PStrtHour",0);t.periodHour1=Fct.numFromElem("PEndHour",23);t.periodMinute0=Fct.numFromElem("PStrtMinute",0);t.periodMinute1=Fct.numFromElem("PEndMinute",59);t.seasonDay0=Fct.selectedNum("SStrtDay");t.seasonDay1=Fct.selectedNum("SEndDay");t.seasonMon0=Fct.selectedNum("SStrtMon");t.seasonMon1=Fct.selectedNum("SEndMon");t.wLonDom=Fct.numFromElem("wLonDom",App.missDOUBLE);t.eLonDom=Fct.numFromElem("eLonDom",App.largeDOUBLE);t.sLatDom=Fct.numFromElem("sLatDom",App.missDOUBLE);t.nLatDom=Fct.numFromElem("nLatDom",App.largeDOUBLE);t.xPolyPix=[...this.xPolyPix];t.yPolyPix=[...this.yPolyPix];t.xPoly=[...this.xPoly];t.yPoly=[...this.yPoly];t.polyfileName=this.polyfileName;DlgStatFilter.retrieveMetaDataNum();DlgStatFilter.retrieveMetaDataStr();t.mvRangeVarIds=[...this.mvRaVarIds];t.mvRangeMinVals=[...this.mvRaMinVals];t.mvRangeMaxVals=[...this.mvRaMaxVals];t.mvWildCardVarIds=[...this.mvWcVarIds];t.mvWildCardExprs=[...this.mvWcExprs];t.mvWildCardCases=[...this.mvWcCases];DlgStatFilter.retrieveCurrQ();t.setMetaVarQualityFilters(this.mvQf.schemaIds,this.mvQf.varIds,this.mvQf.exclQfArrs);t.reqVarIsOrLogic=Fct.checkBoxState("StfOr");t.reqVarIds=Fct.selectedNums("StfVarLst");t.historyDay0=Fct.selectedNum("PhStrtDay");t.historyDay1=Fct.selectedNum("PhEndDay");t.historyMon0=Fct.selectedNum("PhStrtMon");t.historyMon1=Fct.selectedNum("PhEndMon");t.historyYear0=Fct.numFromElem("PhStrtYr",-99999);t.historyYear1=Fct.numFromElem("PhEndYr",99999);t.historyHour0=Fct.numFromElem("PhStrtHour",0);t.historyHour1=Fct.numFromElem("PhEndHour",23);t.historyMinute0=Fct.numFromElem("PhStrtMinute",0);t.historyMinute1=Fct.numFromElem("PhEndMinute",59);t.historyUser=Fct.strFromElem("UserWc","*");t.historyAction=Fct.strFromElem("ActionWc","*");t.historyDescr=Fct.strFromElem("DescrWc","*");t.invert=Fct.checkBoxState("StfInvert","F");ui.hideDlg();app.sendWsMsg(Msg.setStatFilter()+","+Msg.msgGetCanvasCurrInfo)}static onDefPoly(){ui.popupBckgrd.style.display="none";ui.startPointGetting(DlgStatFilter.setPoly)}static onLoadPoly(){DlgSelTreeItem.show("Load Polygon",2,DlgStatFilter.onSelPoly)}static onMapDomain(){DlgStatFilter.clearPoly();DlgStatFilter.updateDomain()}static onNumMetaVarChanged(){let t=parseInt(this.value);DlgStatFilter.retrieveMetaDataNum();DlgStatFilter.currNumMvVid=t;DlgStatFilter.updateMetaDataNum()}static onQMetaVarChanged(){let t=parseInt(this.value);DlgStatFilter.retrieveCurrQ();DlgStatFilter.currQVid=t;DlgStatFilter.updateQ()}static onSelPoly(a){if(a.startsWith("private:")){let t=localStorage.getItem(Ui.rsrc.keys[2]+a.slice(8));let e=new GObjectSet;e.fromXGobStr(t);let i,s=e.gObjArr.length;if(s>0){for(i=0;i<s;++i){if(e.gObjArr[i].type==12){DlgStatFilter.setPolyFromGObj(e.gObjArr[i]);break}}}}else{DlgStatFilter.xPoly=[];DlgStatFilter.yPoly=[];DlgStatFilter.xPolyPix=[];DlgStatFilter.yPolyPix=[];DlgStatFilter.polyfileName=a;DlgStatFilter.updateDomain()}}static onStrMetaVarChanged(){let t=parseInt(this.value);DlgStatFilter.retrieveMetaDataStr();DlgStatFilter.currStrMvVid=t;DlgStatFilter.updateMetaDataStr()}static rejectOutliersCurrQ(){let t=DlgStatFilter.currQVid,e=coll.metaVar(t).qfId;let i=qfSets.get(e),s=[];if(i!=undefined){i.outlier_flags.map(t=>{s.push(t.charCodeAt(0))});DlgStatFilter.applyQf(t,e,s);DlgStatFilter.updateQ()}}static relaxAvail(){view.statFilter.setDefaultsAvail();$("StfVarLstElem").innerHTML=Html.selectListEx("StfVarLst",coll.dataVarIds(),coll.dataVarFullLabels(),view.statFilter.reqVarIds,1);DlgStatFilter.updateAvailInfo()}static relaxCurrQ(){let t=DlgStatFilter.currQVid;if(this.mvQfIds.indexOf(t)>-1)DlgStatFilter.removeQ(t);DlgStatFilter.updateQ()}static relaxDateTime(){view.statFilter.setDefaultsDateTime();DlgStatFilter.updateDateTime()}static relaxHistory(){view.statFilter.setDefaultsHistory();DlgStatFilter.updateHistory()}static relaxMvRange(){this.mvRaVarIds=[];this.mvRaMinVals=[];this.mvRaMaxVals=[];DlgStatFilter.currNumMvVid=this.emvNIds.length>0?this.emvNIds[0]:-1;DlgStatFilter.updateMetaDataNum()}static relaxMvWildCard(){this.mvWcVarIds=[];this.mvWcExprs=[];this.mvWcCases=[];DlgStatFilter.currStrMvVid=this.emvSIds.length>0?this.emvSIds[0]:-1;DlgStatFilter.updateMetaDataStr()}static relaxNameRange(){view.statFilter.setDefaultsNameRange();DlgStatFilter.updateNameRange()}static removeQ(t){let e=this.mvQf.varIds.indexOf(t);if(e==-1)return;this.mvQf.varIds=Fct.strippedArray(this.mvQf.varIds,[e]);this.mvQf.schemaIds=Fct.strippedArray(this.mvQf.schemaIds,[e]);this.mvQf.exclQfArrs=Fct.strippedArray(this.mvQf.exclQfArrs,[e])}static retrieveCurrQ(){let t=DlgStatFilter.currQVid,e=coll.metaVar(t).qfId;let i=qfSets.get(e),s=Fct.selectedNums("StfFilQfList"),a=[];i.flags.map(t=>{if(!s.includes(parseInt(t)))a.push(t.charCodeAt(0))});DlgStatFilter.applyQf(t,e,a);return{varId:t,qfSetId:e,excl:a}}static retrieveMetaDataNum(){let t=Fct.strFromElem("rMinVal","");let e=Fct.numFromStr(t,App.missDOUBLE);let i=t=="(empty)"?App.missDOUBLE:Fct.numFromElem("rMaxVal",App.largeDOUBLE);let s=e==App.missDOUBLE&&i==App.largeDOUBLE;let a=this.mvRaVarIds.indexOf(DlgStatFilter.currNumMvVid);if(a>-1){if(s){this.mvRaVarIds.splice(a,1);this.mvRaMinVals.splice(a,1);this.mvRaMaxVals.splice(a,1)}else{this.mvRaMinVals[a]=e;this.mvRaMaxVals[a]=i}}else{if(!s){this.mvRaVarIds.push(DlgStatFilter.currNumMvVid);this.mvRaMinVals.push(e);this.mvRaMaxVals.push(i)}}}static retrieveMetaDataStr(){let t=Fct.strFromElem("WildC","");let e=Fct.checkBoxState("WildCcase");let i=this.mvWcVarIds.indexOf(DlgStatFilter.currStrMvVid);if(i>-1){if(t.length==0){this.mvWcVarIds.splice(i,1);this.mvWcExprs.splice(i,1);this.mvWcCases.splice(i,1)}else{this.mvWcExprs[i]=t;this.mvWcCases[i]=e}}else{if(t.length>0){this.mvWcVarIds.push(DlgStatFilter.currStrMvVid);this.mvWcExprs.push(t);this.mvWcCases.push(e)}}}static setPoly(t){ui.popupBckgrd.style.display="block";if(!t||ui.ptgCnvsX.length<3)return;DlgStatFilter.xPoly=[];DlgStatFilter.yPoly=[];DlgStatFilter.xPolyPix=[];DlgStatFilter.yPolyPix=[];ui.ptgCnvsX.push(ui.ptgCnvsX[0]);ui.ptgCnvsY.push(ui.ptgCnvsY[0]);ui.ptgCnvsX.map(t=>DlgStatFilter.xPolyPix.push(ui.toOdvCanvasX(t)));ui.ptgCnvsY.map(t=>DlgStatFilter.yPolyPix.push(ui.toOdvCanvasY(t)));DlgStatFilter.updateDomain()}static setPolyFromGObj(t){if(t.type!=12||t.xCoords.length<3)return;DlgStatFilter.clearPoly();DlgStatFilter.xPoly=[...t.xCoords];DlgStatFilter.yPoly=[...t.yCoords];DlgStatFilter.updateDomain()}static show(){const t="DlgStatFilter",e=ui.getLastOpenElem(t);let i=view.statFilter;ui.dlgOrigVals=new Map;DlgStatFilter.createLocalVars();let s='<div class="TabbedDlg" id="'+t+'" style="width:680px">';s+=Html.panelBegin(t,1,"Name / Range",e==1);s+='<table class="StdTable">';s+='<tr><td>Cruise label:</td><td colspan="3">'+Html.selectListEditable("CruiseLabel",coll.cruiseNames,"",16.35)+"</td></tr>";s+="<tr><td>Station label:</td><td>"+Html.txtInput("StatLabelFirst")+"</td><td> - </td><td>"+Html.txtInput("StatLabelLast")+"</td></tr>";s+='<tr><td>Type:</td><td colspan="3"><input type="radio" id="StfBottle" name="StfType"/>'+Html.labelFor("StfBottle"," Bottle")+' <input type="radio" id="StfCTD" name="StfType"/>'+Html.labelFor("StfCTD"," CTD")+' <input type="radio" id="StfXBT" name="StfType"/>'+Html.labelFor("StfXBT"," XBT")+' <input type="radio" id="StfAny" name="StfType"/>'+Html.labelFor("StfAny"," Any")+" </td></tr>";s+="<tr><td>Station ID:</td><td>"+Html.txtInput("StatIdFirst")+"</td><td> - </td><td>"+Html.txtInput("StatIdLast")+"</td></tr>";s+="<tr><td>Sample count:</td><td>"+Html.txtInput("SmplCountMin")+"</td><td> - </td><td>"+Html.txtInput("SmplCountMax")+"</td><td>&emsp;&emsp;&emsp;"+Html.button("<b>Relax</b>","DlgStatFilter.relaxNameRange()")+"</td></tr>";s+="</table>";s+=Html.panelEnd();s+=Html.panelBegin(t,2,"Date / Time",e==2);s+='<table id="StfDateTimeTbl" class="StdTable"></table>';s+=Html.panelEnd();s+=Html.panelBegin(t,3,"Domain",e==3);s+='<table id="StfDomainTbl">';s+="<tr><td></td><td>North</td><td></td></tr>";s+="<tr><td></td><td>"+Html.txtInput("nLatDom")+"</td><td></td></tr>";s+='<tr><td></td><td rowspan="6"><img src="'+extPrms.resourceRoot+'img/windrose.png"></td><td></td></tr>';s+='<tr><td colspan="3">&nbsp;</td></tr>';s+="<tr><td>West</td><td></td><td>East</td><td></td></tr>";s+="<tr><td>"+Html.txtInput("wLonDom")+"</td><td></td><td>"+Html.txtInput("eLonDom")+"</td></tr>";s+='<tr><td colspan="3">&nbsp;</td></tr>';s+="<tr><td></td><td></td><td></td><td>"+Html.button("Define Polygon","DlgStatFilter.onDefPoly()","StfBtnDefPoly",true)+"</td></tr>";s+="<tr><td></td><td>South</td><td></td><td></td><td>"+Html.button("Load Polygon","DlgStatFilter.onLoadPoly()","StfBtnLoadPoly",true)+"</td></tr>";s+="<tr><td></td><td>"+Html.txtInput("sLatDom")+"</td><td></td><td></td><td>"+Html.button("Map Domain","DlgStatFilter.onMapDomain()","StfBtnMapDomain",true)+"</td></tr>";s+="</table>";s+='<p id="StfPolyLbl">Selection polygon active</p>';s+=Html.panelEnd();s+=Html.panelBegin(t,4,"Meta Data",e==4);s+='<table id="StfMetaDataTbl"><tr>';s+='<td><fieldset id="MetaDataNumF">';s+="<legend><b>Numeric Meta Variables</b></legend>";s+='<p id="MetaDataNumP"></p><p>Acceptable Range</p><p>'+Html.txtInput("rMinVal")+" - "+Html.txtInput("rMaxVal")+"<br>&nbsp;<br>&nbsp;</p>";s+='<p id="StfMvStatRange"></p><p><span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxMvRange()")+"</span></p>";s+="</fieldset></td>";s+='<td><fieldset id="MetaDataStrF">';s+="<legend><b>Text Meta Variables</b></legend>";s+='<p id="MetaDataStrP"></p><p>Wildcard Expression</p><p>'+Html.txtInput("WildC")+"<br>"+Html.checkBox("WildCcase","Case sensitive matching",false)+"</p>";s+='<p id="StfMvStatWildC"></p><p><span style="float:right">'+Html.button("<b>Relax</b>","DlgStatFilter.relaxMvWildCard()")+"</span></p>";s+="</fieldset></td>";s+="</tr></table>";s+=Html.panelEnd();s+=Html.panelBegin(t,5,"Meta Data Quality",e==5);s+='<p><b>Meta Variable</b></p><p id="StfFilQVarP"></p>';s+='<p><b>Acceptable Quality Flags</b></p><p id="StfFilQFlagP"></p>';s+="<p>"+Html.button("Relax this quality filter","DlgStatFilter.relaxCurrQ()")+"&emsp;"+Html.button("Reject Outliers","DlgStatFilter.rejectOutliersCurrQ()")+"&emsp;&emsp;&emsp;"+Html.button("<b>Apply to all variables</b>","DlgStatFilter.useQForAll()")+"</p>";s+='<p><div id="StfSmplQ"></div></p>';s+=Html.panelEnd();s+=Html.panelBegin(t,6,"Availability",e==6);s+='<table id="StfAvailabilityTbl">';s+="<tr><td><b>Required Variables</b></td></tr><tr><td>&nbsp;</td></tr>";s+='<tr><td><div id="StfVarLstElem">'+Html.selectListEx("StfVarLst",coll.dataVarIds(),coll.basicDataVarFullLabels(),i.reqVarIds,1)+"</div></td></tr>";s+='<tr><td>&nbsp;</td></tr><tr><td><div id="StfInfo"></div></td></tr>';s+='<tr><td>Logic: <input type="radio" id="StfAnd" name="Logic">'+Html.labelFor("StfAnd"," AND")+' <input type="radio" id="StfOr" name="Logic">'+Html.labelFor("StfOr"," OR")+"</td><td>&emsp;&emsp;&emsp;"+Html.button("<b>Relax</b>","DlgStatFilter.relaxAvail()")+"</td></tr>";s+="</table>";s+=Html.panelEnd();s+=Html.panelBegin(t,7,"History",e==7);s+='<table id="StfHistoryTbl" class="StdTable"></table>';s+=Html.panelEnd();s+=Html.panelBegin(t,8,"Invert",e==8);s+=Html.checkBoxTF("StfInvert","Invert selection",i.invert);s+="<p>Check this box to select all stations that do NOT<br>satisfy the selection criteria.</p>";s+=Html.panelEnd()+"</div>";ui.showDlg("Station Filter",s,Html.dlgBtn("DlgStatFilter.onApply()"));$("tabPanel"+e).click();DlgStatFilter.updateNameRange();DlgStatFilter.updateDateTime();const a=Fct.toBool(i.reqVarIsOrLogic);$("StfOr").checked=a;$("StfAnd").checked=!a;DlgStatFilter.updateAvailInfo();DlgStatFilter.updateMetaDataNum();DlgStatFilter.updateMetaDataStr();DlgStatFilter.updateQ();if(this.emvNIds.length==0)Fct.setVisibility("MetaDataNumF");if(this.emvSIds.length==0)Fct.setVisibility("MetaDataStrF");DlgStatFilter.updateDomain(i.wLonDom,i.eLonDom,i.sLatDom,i.nLatDom);DlgStatFilter.updateHistory();$("StfVarLstElem").addEventListener("click",DlgStatFilter.updateAvailInfo)}static updateAvailInfo(){const t=Fct.selectedStrs("StfVarLst");$("StfInfo").innerText=t.length+" of "+coll.dataVarCount()+" variables selected"}static updateDateTime(){let t=view.statFilter,e='<tr><td colspan="11"><b>Period</b></tr>';e+="<tr><td>From:</td><td>"+Html.selectListMonth("PStrtMon",t.periodMon0)+"</td><td> / </td><td>"+Html.selectListDay("PStrtDay",t.periodDay0)+"</td><td> / </td><td>"+Html.txtInput("PStrtYr",t.periodYear0,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PStrtHour",t.periodHour0)+"</td><td> : </td><td>"+Html.selectListMinute("PStrtMinute",t.periodMinute0)+"</td><td></td></tr>";e+="<tr><td>To:</td><td>"+Html.selectListMonth("PEndMon",t.periodMon1)+"</td><td> / </td><td>"+Html.selectListDay("PEndDay",t.periodDay1)+"</td><td> / </td><td>"+Html.txtInput("PEndYr",t.periodYear1,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PEndHour",t.periodHour1)+"</td><td> : </td><td>"+Html.selectListMinute("PEndMinute",t.periodMinute1)+"</td><td></td></tr>";e+="<tr><td>&nbsp;</td></tr>";e+='<tr><td colspan="11"><b>Season</b></td></tr>';e+="<tr><td>From:</td><td>"+Html.selectListMonth("SStrtMon",t.seasonMon0)+"</td><td> / </td><td>"+Html.selectListDay("SStrtDay",t.seasonDay0)+"</td><td></td><td></td><td></td></tr>";e+="<tr><td>To:</td><td>"+Html.selectListMonth("SEndMon",t.seasonMon1)+"</td><td> / </td><td>"+Html.selectListDay("SEndDay",t.seasonDay1)+'</td><td colspan="6"></td><td>'+Html.button("<b>Relax</b>","DlgStatFilter.relaxDateTime()")+"</td></tr>";$("StfDateTimeTbl").innerHTML=e}static updateDomain(t=App.missDOUBLE,e=App.largeDOUBLE,i=App.missDOUBLE,s=App.largeDOUBLE){Fct.setInputElemStr("wLonDom",t==App.missDOUBLE?"":Fct.roundedVal(t,5));Fct.setInputElemStr("eLonDom",e==App.largeDOUBLE?"":Fct.roundedVal(e,5));Fct.setInputElemStr("sLatDom",i==App.missDOUBLE?"":Fct.roundedVal(i,5));Fct.setInputElemStr("nLatDom",s==App.largeDOUBLE?"":Fct.roundedVal(s,5));Fct.setVisibility("StfPolyLbl",DlgStatFilter.xPoly.length>0||DlgStatFilter.xPolyPix.length>0||DlgStatFilter.polyfileName.length>0)}static updateHistory(){let t=view.statFilter,e="20em",i='<tr><td colspan="11"><b>Period</b></tr>';i+="<tr><td>From:</td><td>"+Html.selectListMonth("PhStrtMon",t.historyMon0)+"</td><td> / </td><td>"+Html.selectListDay("PhStrtDay",t.historyDay0)+"</td><td> / </td><td>"+Html.txtInput("PhStrtYr",t.historyYear0,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PhStrtHour",t.historyHour0)+"</td><td> : </td><td>"+Html.selectListMinute("PhStrtMinute",t.historyMinute0)+"</td><td></td></tr>";i+="<tr><td>To:</td><td>"+Html.selectListMonth("PhEndMon",t.historyMon1)+"</td><td> / </td><td>"+Html.selectListDay("PhEndDay",t.historyDay1)+"</td><td> / </td><td>"+Html.txtInput("PhEndYr",t.historyYear1,"4em")+"</td><td>&ensp;</td><td>"+Html.selectListHour("PhEndHour",t.historyHour1)+"</td><td> : </td><td>"+Html.selectListMinute("PhEndMinute",t.historyMinute1)+"</td><td></td></tr>";i+='<tr><td colspan="11">&nbsp;</td></tr>';i+='<tr><td colspan="2"><b>User:</b></td><td colspan="9">'+Html.txtInput("UserWc",t.historyUser,e)+"</td></tr>";i+='<tr><td colspan="2"><b>Action:</b></td><td colspan="9">'+Html.txtInput("ActionWc",t.historyAction,e)+"</td></tr>";i+='<tr><td colspan="2"><b>Description:</b></td><td colspan="9">'+Html.txtInput("DescrWc",t.historyDescr,e)+"</td><td>&emsp;&emsp;</td><td>"+Html.button("<b>Relax</b>","DlgStatFilter.relaxHistory()")+"</td></tr>";$("StfHistoryTbl").innerHTML=i}static updateMetaDataNum(){let i=[];this.emvNLbls.map((t,e)=>i.push(this.mvRaVarIds.includes(this.emvNIds[e])?"* "+t:t));$("MetaDataNumP").innerHTML=Html.selectList("MetaDataNumLst",this.emvNIds,i,DlgStatFilter.currNumMvVid);$("MetaDataNumLst").addEventListener("change",DlgStatFilter.onNumMetaVarChanged);$("rMinVal").value="";$("rMaxVal").value="";let s=this.mvRaVarIds.indexOf(DlgStatFilter.currNumMvVid);if(s>-1){let t=this.mvRaMinVals[s],e=this.mvRaMaxVals[s],i="";if(t==App.missDOUBLE&&e==App.missDOUBLE)i="(empty)";else if(t!=App.missDOUBLE)i=t;$("rMinVal").value=i;i=e==App.missDOUBLE||e==App.largeDOUBLE?"":e;$("rMaxVal").value=i}$("StfMvStatRange").innerText=this.mvRaVarIds.length+" of "+this.emvNLbls.length+" variable(s) range filtering"}static updateMetaDataStr(){let i=[];this.emvSLbls.map((t,e)=>i.push(this.mvWcVarIds.includes(this.emvSIds[e])?"* "+t:t));$("MetaDataStrP").innerHTML=Html.selectList("MetaDataStrLst",this.emvSIds,i,DlgStatFilter.currStrMvVid);$("MetaDataStrLst").addEventListener("change",DlgStatFilter.onStrMetaVarChanged);$("WildC").value="";$("WildCcase").checked=false;let t=this.mvWcVarIds.indexOf(DlgStatFilter.currStrMvVid);if(t>-1){$("WildC").value=this.mvWcExprs[t];$("WildCcase").checked=this.mvWcCases[t]=="T"?true:false}$("StfMvStatWildC").innerText=this.mvWcVarIds.length+" of "+this.emvSLbls.length+" variable(s) wildcard filtering"}static updateNameRange(){let t=view.statFilter;Fct.setInputElemStr("CruiseLabel",t.cruise);Fct.setInputElemStr("StatLabelFirst",t.statNameMin);Fct.setInputElemStr("StatLabelLast",t.statNameMax);Fct.setInputElemStr("StatIdFirst",t.statIdMin+1);Fct.setInputElemStr("StatIdLast",t.statIdMax+1);Fct.setInputElemStr("SmplCountMin",t.smplCountMin);Fct.setInputElemStr("SmplCountMax",t.smplCountMax);$("StfBottle").checked=t.statType=="B";$("StfCTD").checked=t.statType=="C";$("StfXBT").checked=t.statType=="X";$("StfAny").checked=t.statType=="*"}static updateQ(){let t=DlgStatFilter.currQVid,e=[],i=[];this.mvQfLbls.map((t,e)=>i.push(this.mvQf.varIds.includes(this.mvQfIds[e])?"* "+t:t));$("StfFilQVarP").innerHTML=Html.selectList("StfFilQVarLst",this.mvQfIds,i,t);$("StfFilQVarLst").addEventListener("change",DlgStatFilter.onQMetaVarChanged);let s=this.mvQf.varIds.indexOf(t);let a=s>-1?this.mvQf.exclQfArrs[s]:[];let l=qfSets.get(coll.metaVar(t).qfId);l.flags.map(t=>{if(!a.includes(t.charCodeAt(0)))e.push(t)});$("StfFilQFlagP").innerHTML=Html.selectListEx("StfFilQfList",l.flags,l.flag_descriptions,e,1);$("StfSmplQ").innerText=Fct.countInfoString(this.mvQf.varIds.length,this.mvQfLbls.length,"meta variable(s) quality filtering");$("StfFilQfList").size=5}static useQForAll(){let t=DlgStatFilter.retrieveCurrQ();let e,i,s=this.mvQfIds.length;for(e=0;e<s;++e){i=this.mvQfIds[e];if(coll.metaVar(i).qfId==t.qfSetId)DlgStatFilter.applyQf(i,t.qfSetId,t.excl)}DlgStatFilter.updateQ()}}class DlgSymbolSetCreate{static onApply(){let t=Fct.selectedNum("ScopeList",0),e=DlgSymbolSetCreate.wId;ui.hideDlg();app.sendWsMsg('{"cmd":"get_symbolset_nodes","window_id":'+e+',"scope":'+t+"}")}static show(t){DlgSymbolSetCreate.wId=t;const e=" are marked with the symbol.</p>";const i=["Current Station Set","Current Cruise","Current Station"];let s="<p>Select the set of stations.</p>";if(t==0)s+="<p>All selected stations"+e;else s+="<p>All samples of all selected stations"+e;s+=Html.selectList("ScopeList",[0,1,2],i,2);ui.showDlg("Symbol Set - "+Ui.windowName(t),s,Html.dlgBtn("DlgSymbolSetCreate.onApply()"))}}class DlgStdTable{static export(){let t=DlgStdTable.idx,e=DlgStdTable.headers,i=e.length,s=t.length;let a=DlgStdTable.vals,l,r,n="\n",o=[],d=e.join(";")+n;for(l=0;l<s;++l){o=[];for(r=0;r<i;++r){o.push(a[r][t[l]])}d+=o.join(";")+n}Fct.saveBlobAs(new Blob([d],{type:"text/plain"}),"table-contents.csv")}static show(t,e,i,s,a,l,r,n,o,d=true){DlgStdTable.idx=Array.from(r[0].keys());DlgStdTable.headers=s;DlgStdTable.widths=a;DlgStdTable.flags=l;DlgStdTable.vals=r;DlgStdTable.sortColId=0;DlgStdTable.sortAscending=true;let c="<p>"+e+'</p><div id="StdTableDiv" class="has-border" style="width:'+n+"px; height:"+o+'px; overflow-y:auto;">'+'<table id="StdTableTbl" class="StdTable has-altbckcolor" width="100%">'+"</table></div>";if(i.length>0)c+="<p>"+i+"</p>";let m='<p style="clear:both">'+Html.dlgBtnC("ui.hideDlg()","Close")+"&emsp;";if(d)m+=Html.dlgBtnC("DlgStdTable.export()","Export");m+="</p>";ui.showDlg(t,c,m);DlgStdTable.updateTable()}static sort(t){let e=DlgStdTable.vals[t],i=DlgStdTable.flags[t],s=[];if(t==DlgStdTable.sortColId)DlgStdTable.sortAscending=!DlgStdTable.sortAscending;else{DlgStdTable.sortColId=t;DlgStdTable.sortAscending=true}if(i){e.map(t=>{s.push(typeof t=="string"?t.replaceAll(",",""):t)});DlgStdTable.idx=Fct.sortIndicesNum(s,DlgStdTable.sortAscending)}else DlgStdTable.idx=Fct.sortIndicesStr(e,DlgStdTable.sortAscending);DlgStdTable.updateTable()}static updateTable(){const t="Click to sort; click again to reverse order";let e=DlgStdTable.idx,i=DlgStdTable.headers,s=DlgStdTable.widths;let a=DlgStdTable.flags,l=DlgStdTable.vals,r,n,o=i.length,d=e.length;let c="<tr>";for(n=0;n<o;++n)c+='<th id="StdTableH-'+n+'" title="'+t+'" onclick="DlgStdTable.sort('+n+')" width="'+s[n]+'%">'+i[n]+"</th>";c+="</tr>";for(r=0;r<d;++r){c+="<tr>";for(n=0;n<o;++n)c+="<td>"+l[n][e[r]]+"</td>";c+="</tr>"}$("StdTableTbl").innerHTML=c}}class DlgTimeVarSelCnv{static onSelect(){let t=Fct.selectedNum("CnvSelList",0),e=DlgTimeVarSelCnv.dv;ui.hideDlg();if(e.type==48)DlgTimeVarSettings.show(DlgTimeVarSelCnv.updateIdx,e,t);else{DlgDrvdVars.setTimeVarIPrms(e,t);DlgDrvdVars.newDrvdVar(DlgTimeVarSelCnv.updateIdx,e)}}static show(t,e,i,s,a){DlgTimeVarSelCnv.dv=e;DlgTimeVarSelCnv.updateIdx=t;let l="<p>Select suitable conversion for</p><p>"+i+"&emsp;>>&emsp;"+Fct.fullVarLabel(e.uname,e.uunits)+"</p>";l+=Html.selectList("CnvSelList",s,a,0);ui.showDlg("Conversion",l,Html.dlgBtn("DlgTimeVarSelCnv.onSelect()","Select"))}}class DlgTimeVarSettings{static onApply(){let e=Fct.selectedNum("tvUnits",0),i=DlgTimeVarSettings.dv;let s=Fct.numFromElem("tvYear",App.missINT);let a=Fct.numFromElem("tvMon",App.missINT);let l=Fct.numFromElem("tvDay",App.missINT);ui.hideDlg();if(s!=App.missINT&&a!=App.missINT&&l!=App.missINT){let t=DlgTimeVarSettings.uLbls[e]+" since "+Fct.padZeros(s,4)+"-"+Fct.padZeros(a,2)+"-"+Fct.padZeros(l,2);i.units=t;i.uunits=t;DlgDrvdVars.setTimeVarIPrms(i,DlgTimeVarSettings.cnvId,e,s,a,l);DlgDrvdVars.newDrvdVar(DlgTimeVarSettings.updateIdx,i)}}static show(t,e,i){DlgTimeVarSettings.uLbls=["years","days","hours"];DlgTimeVarSettings.dv=e;DlgTimeVarSettings.updateIdx=t;DlgTimeVarSettings.cnvId=i;let s="<p>Time&emsp; [ "+Html.selectList("tvUnits",[0,1,2],DlgTimeVarSettings.uLbls,0)+"&emsp;since&emsp;"+Html.txtInput("tvYear","0000","4em")+" - "+Html.txtInput("tvMon","01","2em")+" - "+Html.txtInput("tvDay","01","2em")+" ]</p>";ui.showDlg("Time Variable Settings",s,Html.dlgBtn("DlgTimeVarSettings.onApply()"))}}class DlgVarList{static moveBottom(){DlgVarList.moveTo(App.wrkArr.length-1)}static moveDown(){DlgVarList.moveTo(App.wrkIdx+1)}static moveTo(t){if(App.wrkIdx==-1)return;Fct.moveElem(App.wrkArr,App.wrkIdx,t);App.wrkIdx=t;DlgVarList.updateList();DlgVarList.mod=2}static moveTop(){DlgVarList.moveTo(0)}static moveUp(){DlgVarList.moveTo(App.wrkIdx-1)}static onApply(){ui.hideDlg();if(DlgVarList.mod==0)return;let t=DlgVarList.isDataVars?"data":"meta";let e='{"cmd":"set_collection_'+t+'vars","modify_level":'+DlgVarList.mod+',"'+t+'_vars":'+JSON.stringify(App.wrkArr)+"},";app.sendWsMsg(e+Msg.msgGetCollInfo+","+Msg.msgGetDockLbls+","+Msg.msgGetCanvasCurrInfo)}static onClick(t){t.preventDefault();const e=t.target;if(e==undefined)return;DlgVarList.xSel.select(e.parentNode.rowIndex,t.shiftKey,t.ctrlKey);DlgVarList.updateStatus()}static onDelete(){let t=DlgVarList.xSel.selections(),e,i=App.wrkArr.length;for(e=i-1;e>=0;--e)if(t.indexOf(e)>-1)App.wrkArr.splice(e,1);App.wrkIdx=-1;DlgVarList.updateList();DlgVarList.mod=2}static onEdit(){if(App.wrkIdx>-1)DlgVarProps.show(App.wrkArr[App.wrkIdx],DlgVarList.onEdited)}static onEdited(t,e){if(App.wrkIdx>-1)App.wrkArr[App.wrkIdx]=t;else{App.wrkIdx=App.wrkArr.length;App.wrkArr.push(t);e=2}DlgVarList.mod=Math.max(DlgVarList.mod,e);if(e>0)DlgVarList.updateList()}static onNew(){let t="New Variable",e="unknown units";let i={id:-1,name:t,units:e,uname:t,uunits:e,cmt:"",errId:-1,dec:2,qfId:0,valType:"FLOAT",valBytes:4};App.wrkIdx=-1;DlgVarProps.show(i,DlgVarList.onEdited)}static onSelectEmpty(){let t,e,i=App.wrkArr.length;DlgVarList.xSel.clear();for(t=0;t<i;++t){e=App.wrkArr[t].id;if(e>-1&&coll.dataCount(e)==0)DlgVarList.xSel.select(t,false,true)}DlgVarList.updateStatus()}static pushVar(t,e){App.wrkArr.push({id:t,name:e.name,units:e.units,uname:e.uname,uunits:e.uunits,cmt:e.cmt,errId:e.errVarId,dec:e.digitsCount,qfId:e.qfId,type:e.varType,valType:e.valType,valBytes:e.valBytes})}static show(t){DlgVarList.isDataVars=t;DlgVarList.mod=0;let e,i,s;App.wrkArr=[];App.wrkIdx=-1;if(t){i=coll.dataVarCount();for(e=0;e<i;++e)DlgVarList.pushVar(e,coll.dataVar(e))}else{i=coll.metaVarCount();for(e=0;e<i;++e)DlgVarList.pushVar(e,coll.metaVar(e))}let a='<div id="vlGrid">';a+='<div id="vlTblDiv" class="has-border">';a+='<table id="vlTbl" class="StdTable"></table></div>';a+='<div id="vlButtons">';a+=Html.button("Top","DlgVarList.moveTop()","BtnVlTop",true);a+="<p>"+Html.button("Up","DlgVarList.moveUp()","BtnVlUp",true)+"</p>";a+="<p>"+Html.button("Down","DlgVarList.moveDown()","BtnVlDown",true)+"</p>";a+="<p>"+Html.button("Bottom","DlgVarList.moveBottom()","BtnVlBottom",true)+"</p>";a+="<p>&ensp;</p>";a+="<p>"+Html.button("New","DlgVarList.onNew()","BtnVlNew",true)+"</p>";a+="<p>"+Html.button("Edit","DlgVarList.onEdit()","BtnVlEdit",true)+"</p>";a+="<p>"+Html.button("Delete","DlgVarList.onDelete()","BtnVlDel",true)+"</p>";a+="<p>"+Html.button("Select Empty<br>Variables","DlgVarList.onSelectEmpty()","BtnVlSelEmpty")+"</p>";a+="</div>";a+='<div id="vlFooter"><div id="vlDefStatus"></div><br><div id="vlSelStatus"></div></div>';a+="</div>";ui.showDlg((t?"Data":"Meta")+" Variables",a,Html.dlgBtn("DlgVarList.onApply()"));Fct.setVisibility("BtnVlSelEmpty",t);DlgVarList.updateList()}static updateList(){let t,e=App.wrkArr.length,i,s,a="";let l=-1,r=App.wrkIdx==-1?-1:App.wrkArr[App.wrkIdx].id;for(t=0;t<e;++t){i=App.wrkArr[t].id;if(r>-1&&i==r)l=t;s=i>-1?i+1+":&ensp;":"&ensp;";a+="<tr><td>"+s+Fct.fullVarLabel(App.wrkArr[t].uname,App.wrkArr[t].uunits)+"</td></tr>"}let n=$("vlTbl");n.innerHTML=a;let o=Array.from(n.rows);n.addEventListener("click",DlgVarList.onClick);DlgVarList.xSel=new XSelector(o,true,false);if(l>-1)DlgVarList.xSel.select(l);else App.wrkIdx=-1;DlgVarList.updateStatus()}static updateStatus(){let t=DlgVarList.xSel.selectedCount(),e=DlgVarList.xSel.size();let i=DlgVarList.xSel.firstSelection();App.wrkIdx=t==1?i:-1;let s=i>-1?App.wrkArr[i].id:-1,a=DlgVarList.isDataVars;let l=t==1&&s>-1,r=a&&s==coll.primaryVarId;let n=!a&&s<coll.mandatoryMetaVarCount;let o=!n&&l;let d=a?0:coll.mandatoryMetaVarCount;$("vlDefStatus").innerText=e+" variables defined";$("vlSelStatus").innerText=t+" variables selected";$("BtnVlTop").disabled=!(o&&a&&i>d);$("BtnVlUp").disabled=!(o&&i>d);$("BtnVlDown").disabled=!(o&&i<e-1);$("BtnVlBottom").disabled=!(o&&i<e-1);$("BtnVlEdit").disabled=!(l&&!(!a&&s==11));$("BtnVlDel").disabled=!(!n&&!r&&t>0)}}class DlgVarProps{static onApply(){let t=Fct.strFromElem("varName",""),e=Fct.strFromElem("varUnits","");let i=Fct.strFromElem("varCmt",""),s=Fct.selectedNum("varErrId",-1);let a=Fct.numFromElem("varDec",2),l=Fct.selectedNum("varQfId",0);let r=Fct.selectedStr("varType",DlgVarList.isDataVars?ui.dataVarTypeNames[0]:ui.metaVarTypeNames[0]);let n=Fct.selectedStr("varValTyp","FLOAT");let o=Fct.numFromElem("varBytes",4),d=0,c=DlgVarProps.v;ui.hideDlg();if(c.name!=t){c.name=t;c.uname=t;d=1}if(c.units!=e){c.units=e;c.uunits=e;d=1}if(c.cmt!=i){c.cmt=i;d=1}if(c.errId!=s){c.errId=s;d=1}if(c.dec!=a){c.dec=a;d=1}if(c.type!=r){c.type=r;d=1}if(c.qfId!=l){c.qfId=l;d=2}if(c.valType!=n){c.valType=n;d=2}if(c.valBytes!=o){c.valBytes=o;d=2}DlgVarProps.cbFct(c,d)}static show(t,e){DlgVarProps.cbFct=e;DlgVarProps.v=t;let i,s='<table id="VarPropsTbl" class="StdTable">';s+="<tr><td>Label:</td><td>"+Html.txtInput("varName",t.name,"22em")+"</td></tr>";s+="<tr><td>Units:</td><td>"+Html.txtInput("varUnits",t.units,"22em")+"</td></tr>";s+="<tr><td>Comment:</td><td>"+Html.txtInput("varCmt",t.cmt,"22em")+"</td></tr>";s+="<tr><td>Error Variable:</td><td>"+Html.selectList("varErrId",coll.dataVarIds(),coll.basicDataVarFullLabels(false),t.errId,0,-1,"(none)")+"</td></tr>";s+="<tr><td>Decimal Places:</td><td>"+Html.numInput("varDec",t.dec,0,9)+"</td></tr>";s+="<tr><td>&ensp;</td><td>&ensp;</td></tr>";s+="<tr><td>QF Scheme:</td><td>"+Html.selectListQfScheme("varQfId",t.qfId)+"</td></tr>";s+="<tr><td>Variable Type:</td><td>"+Html.selectListVarType("varType",DlgVarList.isDataVars,t.type)+"</td></tr>";s+="<tr><td>Value Type:</td><td>"+Html.selectListValType("varValTyp",t.valType)+"</td></tr>";s+="<tr><td>Byte Length:</td><td>"+Html.numInput("varBytes",t.valBytes,1,9999)+"</td></tr>";s+="</table>";ui.showDlg("Properties - "+t.name,s,Html.dlgBtn("DlgVarProps.onApply()"));$("varErrId").style.width="20em";$("varQfId").style.width="20em";$("varType").style.width="20em";i=$("varValTyp");i.style.width="20em";i.addEventListener("change",DlgVarProps.onValTypeChange);$("varDec").style.width="4em";i=$("varBytes");i.style.width="4em";i.disabled=t.valType!="TEXT"}static onValTypeChange(){let t=Fct.selectedStr("varValTyp","FLOAT");let e=$("varBytes");e.disabled=t!="TEXT";e.value=Collection.valueBytes(t)}}class DlgViewProps{static onApply(){let t=Fct.isChecked("axisSync"),e=Fct.toBool(view.axisSync);ui.hideDlg();if(t!=e){view.axisSync=t?"T":"F";app.sendWsMsg(Msg.modifyView(view.toXmlGeneral(),viewHistory.currentName(),"Change Axis Range Synchronization"))}}static show(){let t="<p>Switch axis range synchronization between different data windows in this view on or off.</p><p>If range synchronization is on and the axis range of a variable is changed in one window, <br>the range of this variable in other windows will be changed accordingly. <br>Other windows remain unchanged if range synchronization is switched off.</p>";t+=Html.checkBoxTF("axisSync","Keep axis ranges synchronized",view.axisSync);ui.showDlg("View Properties",t,Html.dlgBtn("DlgViewProps.onApply()"))}}class DlgWinDataExp{static show(i){DlgWinDataExp.clickWinId=i;let t=view.mapWin.prjType,s=t==0;let a=false,l=false,r="Export data values",e="";if(i>0){let t=view.dataWinArr[i-1];let e=t.plotMode;a=t.zvId!=App.VID_NONE;l=a&&(e==1||e==2||e==7);if(l)r+=" and gridding misfits at data positions";if(t.xProj!=100)s=t.xProj==0&&t.yProj==0}e+="<p>"+Html.selectList("modeLst",[0,1],[r,'Export gridded field values and "poor man\'s errors"'],0)+"</p>";e+="<p>"+Html.selectList("prjLst",[0,1],["Original X/Y values","Projected X/Y values"],0)+"</p>";e+="<p>"+Html.selectListColumnSep("colSep",0)+"&emsp;Column separator</p>";e+="<p>"+Html.checkBox("expLbl","Export variable labels",true)+"</p>";e+="<p>"+Html.checkBox("expMD","Export station metadata",false)+"</p>";e+="<p>"+Html.checkBox("expZmiss","Export data with missing Z value",true)+"</p>";ui.showDlg("Export Window Data",e,Html.dlgBtn("DlgWinDataExp.startExport()","Start Export"));if(!l)Fct.setDisplay("modeLst",false);if(s)Fct.setDisplay("prjLst",false);if(i==0||!a)Fct.setDisplay("expZmiss",false)}static startExport(){let t=Fct.selectedNum("modeLst");let e=Fct.selectedNum("colSep");let i=Fct.selectedNum("prjLst")>0?true:false;let s=Fct.isChecked("expLbl");let a=Fct.isChecked("expMD");let l=Fct.isChecked("expZmiss");ui.hideDlg();app.sendWsMsg('{"cmd":"export_window_data", "win_id":'+DlgWinDataExp.clickWinId+', "mode":'+t+', "separator_id":'+e+', "labels_export":'+s+', "metadata_export":'+a+', "z_missvals_export":'+l+', "projected_xy":'+i+"}")}}"use strict";class Msg{static getCanvasWindowCmdName="get_canvas_window";static msgGetCanvas='{"cmd":"'+Msg.getCanvasWindowCmdName+'","win_id":-1,"extended_rect":false,"fmt":"png"}';static msgGetCollInfo='{"cmd":"get_collection_information"}';static msgGetDockMetaVarLbls='{"cmd":"get_dock_metavar_labels"}';static msgGetDockDataVarLbls='{"cmd":"get_dock_datavar_labels"}';static msgGetDockIsoVarLbls='{"cmd":"get_dock_isosurfacevar_labels"}';static msgGetDockMetaVarVals='{"cmd":"get_current_station_dock_metadata"}';static msgGetDockDataVarVals='{"cmd":"get_current_sample_dock_data"}';static msgGetDockIsoVarVals='{"cmd":"get_current_station_dock_isosurface_data"}';static msgGetDrvdVarChoices='{"cmd":"get_derivedvar_choices"}';static msgRemoveSection='{"cmd":"execute_option","option":"remove_section","description":"Remove Section"}';static msgGetDockLbls=Msg.msgGetDockDataVarLbls+","+Msg.msgGetDockMetaVarLbls+","+Msg.msgGetDockIsoVarLbls;static msgGetDockVals=Msg.msgGetDockMetaVarVals+","+Msg.msgGetDockDataVarVals+","+Msg.msgGetDockIsoVarVals;static msgGetCurrInfo='{"cmd":"get_current_information"},'+Msg.msgGetDockVals;static msgGetCanvasCurrInfo=Msg.msgGetCanvas+","+Msg.msgGetCurrInfo;static addIsoVar(t,e,i){return'{"cmd":"execute_option","option":"add_iso_var","description":"Change Isosurface Variable(s)","display_var_id":'+t+',"surface_var_id":'+e+',"surface_value":"'+i+'"}'}static addViewFooter(t){return Msg.modifyView("<Canvas> <GraphicsObjects> <GObject type='1' clipping='F' post_data='T' dragging='F' own_coordinates='F'> <Annotation font_size='9' frame_color='-1' angle='0' text='=collectionName()  |  =viewName()  |  =date()T=time()  |  =software()' text_color='7' background_color='-1' y_coordinate='0.3' frame_width='-1' text_alignment='8' frame_type='0' x_coordinate='0.5'/> </GObject> </GraphicsObjects> </Canvas>",t,"Add Footer")}static createSection(){let e=ui.ptgCnvsX.length-1;if(e<1)return;let i=',"x_coords":['+ui.toOdvCanvasX(ui.ptgCnvsX[0]);let s=',"y_coords":['+ui.toOdvCanvasY(ui.ptgCnvsY[0]);for(let t=1;t<=e;t++){i+=","+ui.toOdvCanvasX(ui.ptgCnvsX[t]);s+=","+ui.toOdvCanvasY(ui.ptgCnvsY[t])}i+="]";s+="]";let t=view.section;let a='{"cmd":"execute_option","option":"set_section","description":"Manage Section","name":"'+t.name+'","type":'+t.type+',"km_width":'+t.width+',"bathy_type":'+t.bathyType+',"bathy_color":'+t.bathyColor+i+s+"}";return a}static doAutoZoom(t){return'{"cmd":"execute_option","option":"auto-zoom","description":"Auto-Zoom - '+Ui.windowName(ui.rclickWinId)+'","x":'+ui.rclickOdvCnvsX+',"y":'+ui.rclickOdvCnvsY+',"zoom-in":"'+t+'"}'}static exportAsGObject(t,e,i=false){return'{"cmd":"export_as_graphics_object","win_id":'+t+',"object":"'+e+'","clipboard_copy":'+i+"}"}static exportAsInterruptedMap(t,e,i,s,a,l,r,n,o,d){return'{"cmd":"export_graphics","win_id":'+t+',"fmt":"'+e+'","dpi":'+i+',"transparent_background":'+s+',"draw_as_interrupted_map":true,"title":"'+a+'","label":"'+l+'","copyright":"'+r+'","font_factor":'+n+',"draw_south_polar":'+o+',"draw_north_polar":'+d+"}"}static exportGraphics(t,e,i,s,a){return'{"cmd":"export_graphics","win_id":'+t+',"fmt":"'+e+'","dpi":'+i+',"drawing_style":"'+s+'","transparent_background":'+a+"}"}static get1DEstimates(t,e){return'{"cmd":"get_1d_estimates","win_id":'+t+',"x_coords":'+JSON.stringify(e)+"}"}static get2DEstimates(t,e,i){return'{"cmd":"get_2d_estimates","win_id":'+t+',"x_coords":'+JSON.stringify(e)+',"y_coords":'+JSON.stringify(i)+"}"}static getImage(t,e,i,s,a,l,r){let n='{"cmd":"get_image","type":"'+t+'","fmt":"'+e+'","win_id":'+i;if(s!=undefined)n+=',"output_type":"'+s+'"';if(a!=undefined)n+=',"dpi":'+a;if(l!=undefined)n+=',"drawing_style":"'+l+'"';if(r!=undefined)n+=',"transparent_background":'+r;return n+"}"}static loadView(t,e,i="",s=true,a=false){let l='{"cmd":"load_view","view":"'+t+'","view_name":"'+e+'","description":"'+i+'"},';if(s)l+=Msg.msgGetDockLbls+",";if(a)l+=Msg.addViewFooter(e)+",";return l+Msg.msgGetCanvasCurrInfo}static modifyView(t,e,i=""){if(e==undefined)e=viewHistory.currentName();return'{"cmd":"modify_view","view_snippet":"'+t+'","view_name":"'+e+'","description":"'+i+'"}'}static selectSampleByAccessionNumber(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"Accession Number","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static selectSampleByStationId(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"station_id","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static selectSampleByValidStationId(t,e){return'{"cmd":"select_current_sample","conditions":[{"name":"valid_station_id","value":"'+t+'"},{"name":"sample_id","value":"'+e+'"}]}'}static setDrvdVars(){return Msg.modifyView(view.drvdVarSet.toXml(),viewHistory.currentName(),"Change Derived Variable(s)")}static setDwFullAxisRanges(t){let e=viewInfo.isGeoMap[t]==1?"":" <Geometry x_left='-1e10' x_right='1e10' y_bottom='-1e10' y_top='1e10'/>";return" <DataWindow window_id='"+t+"'> <Window>"+e+" <ColorScale z_range_start='-1e10' z_range_end='1e10'/> </Window> </DataWindow>"}static setDwProperties(t){let e;if(t==-1){for(let t=0;t<view.dataWinArr.length;++t)e+=view.dataWinArr[t].toXmlProps(t+1)}else e=view.dataWinArr[t-1].toXmlProps(t);return Msg.modifyView(e,viewHistory.currentName(),"Change Properties - Window "+t+"")}static setDwXYZVars(t){const e=view.dataWinArr[t-1];return Msg.modifyView("<DataWindow window_id='"+t+"'>"+e.toXmlAxisVars()+e.toXmlModes()+e.toXmlContours()+e.toXmlWinGen()+" </DataWindow>",viewHistory.currentName(),"Change Axis Variables - Window "+t)}static setIsoVars(){return Msg.modifyView(view.isoVarSet.toXml(),viewHistory.currentName(),"Change Isosurface Variable(s)")}static setMapDomain(t,e,i,s){view.mapWin.setDomain(t,e,i,s);let a=Msg.modifyView("<GeographicMap>"+view.mapWin.toXmlDomain()+" </GeographicMap>",viewHistory.currentName(),"Change Map Domain");return a}static setMapProperties(){return Msg.modifyView(view.mapWin.toXmlGeogrMap()+view.mapWin.toXmlProps(),viewHistory.currentName(),"Change Properties - Map")}static setPickedStats(){return Msg.modifyView(view.toXmlPickedStatSet(),viewHistory.currentName(),"Change Pick List")}static setRanges(t,e=App.missDOUBLE,i=App.largeDOUBLE,s=App.missDOUBLE,a=App.largeDOUBLE,l=App.missDOUBLE,r=App.largeDOUBLE){return'{"cmd":"execute_option","option":"set_ranges","description":"Change Axis Ranges - Window '+t+'","win_id":'+t+',"x_min_value":'+e+',"x_max_value":'+i+',"y_min_value":'+s+',"y_max_value":'+a+',"z_min_value":'+l+',"z_max_value":'+r+',"adjust_gridding_scales":1}'}static setSmplFilter(t,e){let i=viewHistory.currentName();let s="Change Sample Filter - Window "+t;if(t==-10)return Msg.modifyView("<IsoSurfaceVariables>"+view.isoVarSet.toXmlVarSet()+e+" </IsoSurfaceVariables>",i,s);else return Msg.modifyView("<DataWindow window_id='"+t+"'>"+e+" </DataWindow>",i,s)}static setSectionProps(){let t=view.section;return'{"cmd":"execute_option","option":"set_section_properties","description":"Change Section Properties","name":"'+t.name+'","type":'+t.type+',"km_width":'+t.width+',"bathy_type":'+t.bathyType+',"bathy_color":'+t.bathyColor+"}"}static setStatFilter(){return Msg.modifyView(view.statFilter.toXml(),viewHistory.currentName(),"Change Station Filter")}static updateGeometry(t,e,i,s,a){let l="",r=t>0?view.dataWinArr[t-1]:view.mapWin;r.xBbOff=Fct.roundedVal(ui.toCmCanvasX(e),1);r.xBbLen=Fct.roundedVal(ui.toCmCanvasX(s)-r.xBbOff,1);r.yBbOff=Fct.roundedVal(ui.toCmCanvasY(a),1);r.yBbLen=Fct.roundedVal(ui.toCmCanvasY(i)-r.yBbOff,1);if(t>0)l+=r.toXmlDataWindowOpen(t);else l+="<MapWindow background_color='"+r.bckColor+"'>";l+=" <Window>"+r.toXmlGeometry()+" </Window>";l+=t>0?" </DataWindow>":" </MapWindow>";return Msg.modifyView(l,viewHistory.currentName(),"Change Geometry - "+Ui.windowName(t))}static zoom(t,e,i,s,a){return'{"cmd":"execute_option","option":"zoom","description":"Zoom - '+Ui.windowName(t)+'","win_id":'+t+',"x_min":'+e+',"y_min":'+i+',"x_max":'+s+',"y_max":'+a+"}"}static zZoom(t,e,i){return'{"cmd":"execute_option","option":"z-zoom","description":"Z-Zoom - Window '+t+'","win_id":'+t+',"z_bottom":'+e+',"z_top":'+i+"}"}}"use strict";class Fct{static autoScale(t,e){const i=3,s=6,a=12;let l,r,n,o,d,c,m=Math.abs(t-e);if(t==App.missDOUBLE){r=o=App.missDOUBLE;n=d=c=App.largeDOUBLE}if(m==0){t-=1;e+=1}c=Math.pow(10,Math.floor(Math.log10(m)-.5));l=Math.floor(m/c);if(l<i)c=c*.5;else if(l>s&&l<=a)c=c*2;else if(l>a)c=c*5;d=c*.5;if(e>t){r=Math.floor(t/d)*d;n=Math.ceil(e/d)*d;o=Math.ceil(t/c)*c}else if(e<t){r=Math.ceil(t/d)*d;n=Math.floor(e/d)*d;o=Math.floor(t/c)*c;c*=-1;d*=-1}return{adjLL:r,adjUR:n,ticStart:o,ticSpacing:d,lticSpacing:c}}static checkBoxState(t){return Fct.isChecked(t)?"T":"F"}static classListToggle(t,e){let i=$(t);if(i!==null&&i!==undefined)i.classList.toggle(e)}static closestIndexOf(t,i){let s=-1,a=1e10,l;t.map((t,e)=>{l=Math.abs(t-i);if(l<a){s=e;a=l}});return s}static colorClassFromOdvFlag(t){switch(t){case"0":return"is-darkgreen";case"1":return"is-black";case"4":return"is-darkred";case"8":return"is-red";default:return"is-black"}}static colorItemNameFromIndex(t,e=true,i=false){let s=i?"&#x2713;":"&ensp;";let a=t.toString();if(t==-2)a="(automatic)";else if(t==-1||t==App.missINT)a="(none)";if(e)a=s+a;return a}static consoleMsg(t,e=false){if(e||extPrms.isDevEnvironment&&$("showMsgCb").checked)console.log(t+"\n")}static async copyToClipboard(t){await navigator.clipboard.writeText(t);ui.dlgMsgBox("Resources copied to clipboard","Clipboard Copy")}static countInfoString(t,e,i){if(t==e)return"All "+t+" "+i;else return t+" of "+e+" "+i}static createElem(t,e,i){let s=document.createElement(t);s.id=e;s.className=i;document.body.appendChild(s);return s}static createMenu(t,e){let i=document.createElement("ul");i.id=t;i.className="dropdown-menu";if(e!=undefined)i.style.cssText="width:"+e+"px;";document.body.appendChild(i);return i}static currentDateTimeAsFileNamePart(){return(new Date).toISOString().substring(0,19).replaceAll(":","-")}static ellipsePathFromRect(t,e,i,s,a,l){const r=50;let n,o,d=2*Math.PI/(r-1);let c=.5*(t-e),m=.5*(i-s);let u=.5*(t+e),p=.5*(i+s);a.length=0;l.length=0;for(n=0;n<r;n++){o=n*d;a.push(u+Math.cos(o)*c);l.push(p+Math.sin(o)*m)}a.push(a[0]);l.push(l[0])}static escapedStr(t){return t.replace(/["']/g,"\\$&")}static formattedInt(t){let e=t.toString(),i=e.length,s;for(s=i-3;s>0;s-=3){e=e.insert(s,",")}return e}static fullVarLabel(t,e){let i=t;if(e!=undefined&&e.length>0)i+=" ["+e+"]";return i}static getSystemInfo(){if(navigator.userAgentData===undefined)Fct.sysInfo=Fct.getSystemInfoFromUserAgent();else Fct.sysInfo=Fct.getSystemInfoFromUserAgentData();return App.knownBrowsers.has(App.sysInfo.browserName)&&App.sysInfo.browserVersion<App.knownBrowsers.get(App.sysInfo.browserName)?false:true}static getSystemInfoFromUserAgent(){let t=navigator.userAgent,e,i,s,a=false;let l="unknown",r="unknown",n="unknown";if(t.indexOf("Win")>-1)l="Windows";if(t.indexOf("Mac")>-1){l="macOS";a=true}if(t.indexOf("X11")>-1)l="UNIX";if(t.indexOf("Linux")>-1)l="Linux";if((i=t.indexOf("OPR/"))!=-1){r="Opera";n=t.substring(i+4)}else if((i=t.indexOf("Opera"))!=-1){r="Opera";n=t.substring(i+6);if((i=t.indexOf("Version"))!=-1)n=t.substring(i+8)}else if((i=t.indexOf("MSIE"))!=-1){r="Internet Explorer";n=t.substring(i+5)}else if((i=t.indexOf("Edge"))!=-1){r="Edge";n=t.substring(i+5)}else if((i=t.indexOf("Chrome"))!=-1){r="Chrome";n=t.substring(i+7)}else if((i=t.indexOf("Safari"))!=-1){r="Safari";n=t.substring(i+7);if((i=t.indexOf("Version"))!=-1)n=t.substring(i+8)}else if((i=t.indexOf("Firefox"))!=-1){r="Firefox";n=t.substring(i+8)}else if((s=t.lastIndexOf(" ")+1)<(i=t.lastIndexOf("/"))){r=t.substring(s,i);n=t.substring(i+1);if(r.toLowerCase()==r.toUpperCase())r=navigator.appName}if((e=n.indexOf(";"))!=-1)n=n.substring(0,e);if((e=n.indexOf(" "))!=-1)n=n.substring(0,e);if((e=n.indexOf("."))!=-1)n=parseInt(n.substring(0,e));return{osName:l,isMacOS:a,browserName:r,browserVersion:n}}static getSystemInfoFromUserAgentData(){let t,e=navigator.userAgentData,i=e.platform,s=e.brands.length;let a="unknown",l="unknown";for(t=0;t<s;++t){if(App.knownBrowsers.has(e.brands[t].brand)){a=e.brands[t].brand;l=e.brands[t].version;break}}let r=i=="macOS"?true:false;return{osName:i,isMacOS:r,browserName:a,browserVersion:l}}static helpdocKeyCode(){return Fct.sysInfo.isMacOS?Fct.keyCode(1,0,0,"?"):"F1"}static identifyConversionIdx(t,e){let i,s=e.length,a=t.toLowerCase();if((a.indexOf("latitude")>-1||a.indexOf("longitude")>-1)&&a.indexOf("[deg min]")==-1)return-1;for(i=0;i<s;++i)if(e[i].indexOf(a)>-1)return i;return-1}static identifyTimeConversionIdx(t,e){let i,s,a=e.length,l,r=t.toLowerCase(),n,o="";if(r.length<5)return-1;if(r=="date"||r=="time")return-1;if((l=Fct.identifyConversionIdx(r,e))>-1)return l;if(r.indexOf("day")>-1)o="day";else if(r.indexOf("hour")>-1)o="hour";else if(r.indexOf("minute")>-1)o="minute";else if(r.indexOf("second")>-1)o="second";else if(r.indexOf("year")>-1)o="year";if(o.length>0&&r.indexOf("since")>-1){for(i=0;i<a;++i){n=e[i];s=n.indexOf(">>");if(s>-1)n=n.substring(0,s);if(n.indexOf(o)>-1&&n.indexOf("since")>-1)return i}}return-1}static idxFromElem(t,e){let i=$(t);if(i==undefined)return e;return parseInt(i.attributes.idx.value)}static indexOf(t,e,i){return t.findIndex(t=>t[e]==i)}static indexOf2(t,e,i,s,a){return t.findIndex(t=>t[e]==i&&t[s]==a)}static intArray(t,e){let i=[],s;for(s=0;s<e;++s)i.push(t+s);return i}static isChecked(t){return $(t).checked}static isControlBlockId(t){return t=="Identifier"||t=="Collection"||t=="InputText"}static isInsidePolygon(t,e,i,s){let a,l=0,r=i.length,n;for(a=0;a<r;++a)if(s[a]==e)s[a]+=1e-6*s[a];for(a=0;a<r-1;++a){if(s[a]!=s[a+1]){n=(e-s[a])/(s[a+1]-s[a]);if(n>=0&&n<=1&&i[a]+n*(i[a+1]-i[a])>=t)++l}}return l%2==1?true:false}static isInsideRect(t,e,i){if(t>=i.left&&t<=i.right&&e>=i.top&&e<=i.bottom)return true;else return false}static isModifyerKey(t){return t.key=="Control"||t.key=="Alt"||t.key=="Meta"||t.key=="Shift"}static isPageReload(){let e=false;const t=performance.getEntriesByType("navigation");t.forEach(t=>{if(t.type==="reload")e=true});return e}static keyCode(t,e,i,s){const a=Fct.sysInfo.isMacOS;let l="";if(t)l+=a?"&#8984;":"Ctrl";if(e)l+=a?"&#8997;":"Alt";if(i)l+=a?"&#8679;":"Shift";if(s.startsWith("Key"))s=s.substring(3);if(s.length==1)s=s.toUpperCase();if(l.length>0)l+="+";return l+s}static keyCodeFromKeyEvent(t){let e=t.altKey||t.getModifierState("AltGraph");return Fct.keyCode(t.ctrlKey||t.metaKey,e,t.shiftKey,e?t.code:t.key)}static leaveSession(){viewHistory.autoSave()}static localStorageKeys(e,t,i=true){let s=Object.keys(localStorage),a=e.length;if(a>0){s=s.filter(t=>t.startsWith(e));if(t)s.map((t,e)=>s[e]=t.slice(a));if(i)s=[...new Set(s)].sort()}return s}static mouseEventSummary(t){let e=Fct.roundedVal(t.clientX,0),i=Fct.roundedVal(t.clientY,0);let s=Fct.roundedVal(t.offsetX,0),a=Fct.roundedVal(t.offsetY,0);return"button: "+t.button+"  alt: "+t.altKey+"  ctrl: "+t.ctrlKey+"  meta: "+t.metaKey+"  detail: "+t.detail+"  type: "+t.type+"  clientX: "+e+"  clientY: "+i+"  offsetX: "+s+"  offsetY: "+a}static moveElem(t,e,i){let s=t[e];t.splice(e,1);t.splice(i,0,s)}static nonZeroCountInfos(t,e){let i=coll.basicDataVarFullLabels(),s=e,a,l;let r=t,n=[],o=[],d=[],c=[];if(r>0)s.map((t,e)=>{if(t>0){a=100*t/r;n.push(i[e]);o.push(t);d.push(Fct.formattedInt(t)),c.push(Fct.roundedVal(a,a>=10?0:a<.1?2:1))}});return{lblArr:n,countArr:o,fmtCountArr:d,percArr:c}}static noOpFct(){}static numFromElem(t,e){let i=$(t);if(i==null||typeof i=="undefined")return e;else return Fct.numFromStr(i.value,e)}static numFromRhs(t,e){let i=t.split("=");return i.length>1?Fct.numFromStr(i[1],e):e}static numFromStr(t,e){let i=parseFloat(t);if(isNaN(i))return e;else return i}static numToStr(t,e=""){if(isNaN(t)||t==App.missDOUBLE||t==App.largeDOUBLE)return e;else return t.toString()}static openBlobAsPage(t,e,i){if(navigator&&navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(t,e)}else if(App.sysInfo.browserName=="Safari"){Fct.saveBlobAs(t,e)}else{if(App.lastObjectUrl!=undefined)URL.revokeObjectURL(App.lastObjectUrl);App.lastObjectUrl=URL.createObjectURL(t);open(App.lastObjectUrl,i)}}static padZeros(t,e){let i="000000000"+t,s=i.length-e;return i.substring(s)}static rectPathFromRect(t,e,i,s,a,l){a.length=0;l.length=0;a.push(t);l.push(i);a.push(e);l.push(i);a.push(e);l.push(s);a.push(t);l.push(s);a.push(t);l.push(i)}static redoKeyCode(){return Fct.sysInfo.isMacOS?Fct.keyCode(1,0,1,"Z"):"Ctrl+Y"}static roundedVal(t,e){return parseFloat(t.toFixed(e))}static saveBlobAs(i,s){if(navigator&&navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(i,s)}else{let t=document.createElement("a");document.body.appendChild(t);t.style="display: none";let e=URL.createObjectURL(i);t.href=e;t.download=s;t.click();URL.revokeObjectURL(e)}}static selectedNum(t,e){return parseFloat(Fct.selectedStr(t,e))}static selectedNums(t){return Fct.selectedStrs(t).map(t=>parseFloat(t))}static selectedOption(t){let e=$(t);if(typeof e=="undefined")return null;let i=e.selectedIndex;if(i==-1)return null;return e.options[i]}static selectedStr(t,e){let i=Fct.selectedOption(t);return i==null?e:i.value}static selectedStrs(t){return Array.from($(t).options).filter(t=>t.selected).map(t=>t.value)}static setDisplay(t,e=false){Fct.setElemDisplay($(t),e)}static setElemDisplay(e,i=false){if(e==null)return;if(i)e.classList.remove("is-displaynone");else e.classList.add("is-displaynone");if(e.type=="checkbox"){let t=e.nextElementSibling;if(i)t.classList.remove("is-displaynone");else t.classList.add("is-displaynone")}}static setElemEnabled(t,e){Fct.setElemEnabledC($(t),e)}static setElemEnabledC(t,e){if(!t)return;if(e)t.classList.remove("disabled");else t.classList.add("disabled")}static setInputElemStr(t,e){let i=$(t);if(typeof i=="undefined")return;i.value=e}static setLastLocalStorageChangeTime(){localStorage.setItem("_settings/lastOdvOnlineChangeTime",Date.now())}static setSelected(t){t.classList.add("is-selected")}static setSiblingsValue(t){let e=$(t);e.value=e.previousSibling.selectedOptions[0].innerText}static setVisibility(t,e=false){let i=$(t);if(typeof i=="undefined")return;if(e)i.classList.remove("is-hidden");else i.classList.add("is-hidden")}static sortIndicesNum(i,t=true){let e=Array.from(i.keys()).sort((t,e)=>i[t]-i[e]);return t?e:e.reverse()}static sortIndicesStr(i,t=true){let e=Array.from(i.keys()).sort((t,e)=>i[t].localeCompare(i[e]));return t?e:e.reverse()}static strFromElem(t,e){let i=$(t);if(typeof i=="undefined")return e;else return i.value}static strippedArray(t,i){return t.filter((t,e)=>i.indexOf(e)==-1)}static toBool(t){return t=="T"?true:false}static toJsonNumericArray(t,e){return'"'+t+'":['+e.join()+"]"}static toNumericArray(t){return t.split(",").map(t=>parseFloat(t))}static touchEventSummary(e){let i=e.target,s=-1,a=-1,l=-1,r=-1;if(e.touches.length>0){let t=e.touches[0];s=Fct.roundedVal(t.clientX,0);a=Fct.roundedVal(t.clientY,0);l=Fct.roundedVal(t.clientX-i.offsetLeft,0);r=Fct.roundedVal(t.clientY-i.offsetTop,0)}return"alt: "+e.altKey+"  ctrl: "+e.ctrlKey+"  meta: "+e.metaKey+"  type: "+e.type+"  clientX: "+s+"  clientX: "+a+"  offsetX: "+l+"  offsetY: "+r}static toStrOrAutomatic(t){return t==App.largeDOUBLE?"(automatic)":t}static unselect(t){t.classList.remove("is-selected")}static xmlNum(t,e,i){if(t.hasOwnProperty(e))return parseFloat(t[e].nodeValue);else return i}static xmlStr(t,e,i){if(t.hasOwnProperty(e))return t[e].nodeValue;else return i}}"use strict";class App{static odvOnlineVersion="v29";static exploreDocsUrl="https://explore.webodv.awi.de/docs/";static odvDocsUrl="https://odv.awi.de/fileadmin/user_upload/odv/docs/";static xmlHeader="<?xml version='1.0' encoding='UTF-8' standalone='yes'?> ";static sysInfo={};static VID_NONE=-2147483646;static VID_FIRSTDRVD=32e3;static VID_SECTION_COORD=2e5;static missINT=-2147483646;static missUINT=4294967295;static missDOUBLE=-1e10;static largeDOUBLE=1e10;static blobHeaderByteSize=1024;static wrkIdx=-1;static wrkVal=0;static wrkArr=[];static wrkArr2=[];static wrkObj={};static lastObjectUrl;static smplCountWarningLimit=5e6;static maxLastViewElapsedSecs=10;static startWaitingCmds=[Msg.getCanvasWindowCmdName,"export_graphics","dock_left_click_event","create_overview_plots","create_collection_snapshot","copy_collection","sort_condense_collection","login_request","get_unique_strings"];static saveFileContentsCmds=["create_overview_plots","export_data","export_graphics","export_as_graphics_object","export_history","export_window_data","find_and_resolve_duplicate_stations","get_1d_estimates","get_2d_estimates","get_inventory_by_cruise","get_inventory_by_cruise_and_variable","get_log_file","get_image"];static knownBrowsers=new Map([["Google Chrome",57],["Firefox",52],["Safari",11],["Microsoft Edge",80],["Opera",44]]);constructor(){addEventListener("load",this.onPageLoad);this.version="";this.websocket=null}changeInfoValue(){let t=$("queryStr").value,e=ui.dlgOrigVals.get("queryStr");ui.hideDlg();let i=t.length==0||e.length==0?0:1;if(t!=e)app.sendWsMsg('{"cmd":"assign_data_info_values","items":[{"var_id":'+(ui.dockDataVarIds[ui.rclickTblItem.row]+1)+',"sample_id":'+ui.currSmplId+',"new_info_value":"'+t+'","old_info_value":"'+e+'","modify_all_instances":'+i+"}]},"+Msg.msgGetCurrInfo)}defPatchName(){if(ui.rclickWinId>0&&ui.ptgCnvsX.length>2)ui.dlgQueryStr("Save Patch","Enter patch name","patch","app.onPatchSave()","Save")}defSectionAbort(t=AppState.DefSectionStep2){appState.leave(t);let e=coll.name+"/origView",i=sessionStorage.getItem(e);app.sendWsMsg(Msg.loadView(i,viewHistory.currentName(),"",false));sessionStorage.removeItem(e)}defSectionFinish(){appState.leave(AppState.DefSectionStep2);let t=sessionStorage.getItem(coll.name+"/origView");let e=t.indexOf("<Section")-1,i=t.indexOf("</Section>")+10;if(e==-2){e=t.indexOf("</MapWindow>")+12;i=e}let s=t.slice(0,e)+view.section.toXml()+t.slice(i);app.sendWsMsg(Msg.loadView(s,viewHistory.currentName(),"Manage Section"))}defSectionProps(t){if(!t){app.defSectionAbort(AppState.DefSectionStep1);return}appState.leave(AppState.DefSectionStep1);appState.enter(AppState.DefSectionStep2);DlgSecProps.show("Msg.createSection")}defSectionStart(){let t=viewHistory.current();sessionStorage.setItem(coll.name+"/origView",t.xmlStr);view.section=new Section;view.dataWinArr=[];let e=view.mapWin;let i=Math.min((Ui.cmPageWidth-1)/e.xBbLen,(Ui.cmPageHeight-1)/e.yBbLen);e.xBbLen*=i;e.xBbOff=(Ui.cmPageWidth-e.xBbLen)*.5+.25;e.yBbLen*=i;e.yBbOff=(Ui.cmPageHeight-e.yBbLen)*.5+.25;appState.enter(AppState.DefSectionStep1);app.sendWsMsg(Msg.loadView(view.toXml(),t.name,"",false))}layoutApply(t){ui.hideDlg();let e=t.substring(2);app.sendWsMsg(Msg.loadView("$"+e+"$",viewHistory.currentName(),"Change View Template",false,false))}layoutSampleCountCheck(t,e){if(e*viewInfo.valTotalSampleCount>App.smplCountWarningLimit)ui.dlgYesNoBox("Confirm Layout Change","Drawing the selected layout may take long.<p>Really want to use the layout?</p>","app.layoutApply('"+t+"')");else app.layoutApply(t)}onClick(t){let e=t.target;if(!e||e.classList.contains("submenu-root")||e.classList.contains("main-menu-item"))return;if(Fct.isControlBlockId(e.id)){e.focus();return}if(ui.visibleMenuNames.length>0){ui.hideMenus();return}}onCollCopy(){let t=$("queryStr").value;ui.hideDlg();if(t!=coll.name)app.sendWsMsg('{"cmd":"copy_collection","new_name":"'+t+'"}')}onCollRename(){let t=$("queryStr").value;ui.hideDlg();if(t!=coll.name)app.sendWsMsg('{"cmd":"rename_collection","new_name":"'+t+'"},'+Msg.msgGetCollInfo)}onCurrStatByAccNum(){let t=parseInt($("queryStr").value);ui.hideDlg();app.sendWsMsg(Msg.selectSampleByAccessionNumber(t,ui.currSmplId)+","+Msg.msgGetCurrInfo)}onCurrSmplById(){let t=parseInt($("queryStr").value);ui.hideDlg();app.sendWsMsg(Msg.selectSampleByValidStationId(ui.currValStatId,t)+","+Msg.msgGetCurrInfo)}onCurrStatById(){let t=parseInt($("queryStr").value);ui.hideDlg();app.sendWsMsg(Msg.selectSampleByStationId(t,ui.currSmplId)+","+Msg.msgGetCurrInfo)}onCurrStatOrSmplByKeyCode(t){let e=ui.currValStatId,i=ui.currSmplId,s=false;switch(t){case"ArrowLeft":{e-=1;if(e<=0)e=viewInfo.valStationCount;s=true}break;case"ArrowRight":{e+=1;if(e>viewInfo.valStationCount)e=1;s=true}break;case"ArrowUp":{i-=1;if(i<=0)i=ui.smplCount;s=true}break;case"ArrowDown":{i+=1;if(i>ui.smplCount)i=1;s=true}break}if(s)app.sendWsMsg(Msg.selectSampleByValidStationId(e,i)+","+Msg.msgGetCurrInfo)}onDeleteCurrStat(){ui.hideDlg();app.sendWsMsg('{"cmd":"execute_option","option":"delete_stations","mode":1},'+Msg.msgGetCanvasCurrInfo)}onDeleteStatSubset(){ui.hideDlg();app.sendWsMsg('{"cmd":"execute_option","option":"delete_stations","mode":2},'+Msg.msgGetCanvasCurrInfo)}onExportFileName(){let t=$("queryStr").value;ui.hideDlg();DlgExportData.show(ui.currMiOption,t)}onFileLoad1DEst(t){Ui.onFileLoadFct=Fct.noOpFct;let e=t.target.result.split("\n");let i,s=e.length,a,l=[];for(i=0;i<s;++i){a=parseFloat(e[i]);if(isNaN(a))continue;l.push(a)}if(l.length>0)app.sendWsMsg(Msg.get1DEstimates(ui.rclickWinId,l))}onFileLoad2DEst(t){Ui.onFileLoadFct=Fct.noOpFct;let e=t.target.result.split("\n");let i,s=e.length,a,l,r,n=[],o=[];for(i=0;i<s;++i){a=e[i].split("\t");if(a.length<2)continue;l=parseFloat(a[0]);r=parseFloat(a[1]);if(isNaN(l)||isNaN(r))continue;n.push(l);o.push(r)}if(n.length>0)app.sendWsMsg(Msg.get2DEstimates(ui.rclickWinId,n,o))}onFileLoadGob(t){Ui.onFileLoadFct=Fct.noOpFct;let e=t.target.result.split("\n"),i=[];if(e.length==0)return;let s=e[0].indexOf("GOB1.")>-1;if(e[0].endsWith("\r"))e.map(t=>{i.push(t.slice(0,-1))});else i=e;let a=ui.rclickWinId,l=view.getGObjSet(a);let r=s?l.fromGob(i):l.fromXGob(i);if(r>0)app.sendUpdateGobjMsg(a,-1,l,"Add Graphics Object")}onFileSelect(t){let e=t.target.files.length==0?false:true;ui.hideDlg();if(!e)return;let i=new FileReader;i.addEventListener("load",Ui.onFileLoadFct);i.readAsText(t.target.files[0])}onGObjLoad(e){if(e.length==0)return;let i="Add Graphics Object from File";if(e.startsWith("private:")){let t=localStorage.getItem(Ui.rsrc.keys[2]+e.slice(8));view.appendGObjFromXml(ui.rclickWinId,t,i)}else{let t='{"cmd":"execute_option","option":"add_graphics_object","description":"'+i+'","file":"'+e+'","win_id":'+ui.rclickWinId+"}";app.sendWsMsg(t+","+Msg.msgGetCanvasCurrInfo)}}onGObjSave(){let t=$("queryStr").value;ui.hideDlg();let e=App.wrkObj;e.name=t;let i=new GObjectSet;i.gObjArr.push(e);localStorage.setItem(Ui.rsrc.keys[2]+t,i.toXml());Fct.setLastLocalStorageChangeTime()}onImageReady(){let t=ui.cnvsContainer.clientWidth,e=ui.cnvsContainer.clientHeight;if(e<=0||ui.imgOdvCnvsTop==-1)return;let i=ui.imgOdvCnvsRight-ui.imgOdvCnvsLeft;let s=ui.imgOdvCnvsBottom-ui.imgOdvCnvsTop;let a=i/t,l=s/e;ui.odvPixPerHtmlPix=Math.max(a,l);ui.odvPixPerCm=Math.min(i/Ui.cmPageWidth,s/Ui.cmPageHeight);t=i/ui.odvPixPerHtmlPix;e=s/ui.odvPixPerHtmlPix;ui.imgArea.style.width=ui.imgArea.width=t;ui.imgArea.style.height=ui.imgArea.height=e;ui.cnvs.style.width=ui.cnvs.width=t;ui.cnvs.style.height=ui.cnvs.height=e;ui.drawHighlighting()}onKeyDown(t){let e=appState.current(),i=false;if(Fct.isModifyerKey(t)||e==AppState.Waiting||Fct.isControlBlockId(t.srcElement.id))return;if(ui.visibleMenuNames.length>0){ui.hideMenus();return}switch(e){case AppState.Ready:i=app.processKeyEvent(t);break;case AppState.Popup:if(ui.currDlgIdx<0)break;switch(t.code){case"Enter":let t=ui.dlgFooterArr[ui.currDlgIdx].querySelector("button");if(t!=null){t.click();i=true}break;case"Escape":ui.dlgCloseBtnArr[ui.currDlgIdx].click();i=true;break}break;case AppState.PointGetter:case AppState.Zooming:case AppState.ZZoomingHor:case AppState.ZZoomingVer:switch(t.code){case"Enter":ui.finishPointGettingOrZooming(true);i=true;break;case"Escape":ui.finishPointGettingOrZooming(false);i=true;break}break}if(i)t.preventDefault()}onMouseDown(t){if(!t.target||t.button!=0)return;app.processDownEvent(t.target,t.button,t.ctrlKey,t.offsetX,t.offsetY,t.pageX,t.pageY)}onMouseDownDlgTitle(t){let e=t.target.closest(".PopupDlg");if(e==null)return;appState.enter(AppState.DlgDragging);ui.dragDlgIdx=e.attributes.level.value-1;let i=ui.dlgArr[ui.dragDlgIdx];ui.beginCnvsX=i.offsetLeft-t.clientX;ui.beginCnvsY=i.offsetTop-t.clientY;ui.dragDlgWidth=i.offsetWidth+10;ui.dragDlgHeight=i.offsetHeight+10}onMouseDownPopupBckgrd(e){let t=e.target,i=t.closest(".PopupDlg");if(t==ui.popupBckgrd)ui.hideDlg(true);else if(i!=null){let t=i.attributes.level.value-1;if(t<ui.currDlgIdx){e.preventDefault();let t=ui.dlgFooterArr[ui.currDlgIdx].querySelector("button");if(t==null)ui.hideDlg()}}}onMouseEnterCurrIsoVarList(t){ui.sbSmplFilPane.innerHTML="<div>"+ui.isoVarFilterStatusString+"</div>"}onMouseEnterMenuItem(t){let e=event.target,i=e.parentNode;if(i!=null)ui.hideMenus(ui.visibleMenuNames.indexOf(i.id));let s="";if(e.classList.contains("submenu-root"))ui.showSubMenu(t);else if(ui.menuItemDescriptions.has(t))s=ui.menuItemDescriptions.get(t);ui.updateSbInfoPane(s,false)}onMouseEnterDlgTitle(t){document.body.style.cursor="grab"}onMouseLeaveCanvas(t){if(ui.visibleMenuNames.length>0)return;ui.updateSbCurrPos(-1,-1)}onMouseLeaveCurrIsoVarList(t){ui.sbSmplFilPane.innerHTML="<div></div>"}onMouseLeaveDlgTitle(t){if(t.buttons==0)document.body.style.cursor="default"}onMouseMove(t){if(!t.target)return;app.processMoveEvent(t.target,t.clientX,t.clientY,t.pageX,t.pageY)}onMouseUp(t){if(!t.target||t.button!=0)return;app.processUpEvent(t.target,t.shiftKey,t.detail,t.clientX,t.clientY)}onMouseUpDlgTitle(t){appState.leave(AppState.DlgDragging);ui.clearCanvas()}onPageHide(){if(app.websocket.readyState==1)Fct.leaveSession()}onPageLoad(){if(!Fct.getSystemInfo()){ui.gridContainer.style.display="none";alert("Unsupported Browser! Please use a recent version of Chrome, Firefox, Edge, Safari, Opera or other modern browser.");return}ui.createDomElements();ui.createMenuItems();app.setEventListeners();ui.updateGridLayout();let t=extPrms.collectionName;Ui.rsrc={names:["View","Section","Graphics Object","Macro","Shapefile"],keys:[t+"/views/",t+"/sections/","_gobjects/","_macros/",""],exts:[".xview",".xsec",".xgob",".mac",".shp"]};if(extPrms.isDevEnvironment)ui.controlBlock.style.display="inline";app.webSocketStartup()}onPatchSave(){let t=$("queryStr").value;ui.hideDlg();let e=ui.rclickWinId,i=view.dataWinArr[e-1],s=[],a=[];ui.ptgCnvsX.push(ui.ptgCnvsX[0]);ui.ptgCnvsY.push(ui.ptgCnvsY[0]);let l,r=ui.ptgCnvsX.length;let n=',"x_coords":['+ui.toOdvCanvasX(ui.ptgCnvsX[0]);let o=',"y_coords":['+ui.toOdvCanvasY(ui.ptgCnvsY[0]);for(let t=1;t<r;t++){n+=","+ui.toOdvCanvasX(ui.ptgCnvsX[t]);o+=","+ui.toOdvCanvasY(ui.ptgCnvsY[t])}n+="]";o+="]";let d='{"cmd":"create_patch","win_id":'+e+',"name":"'+t+'","x_var_id":'+i.xvId+',"x_label":"'+i.axisFullLabel("X")+'","y_var_id":'+i.yvId+',"y_label":"'+i.axisFullLabel("Y")+'"'+n+o+"}";app.sendWsMsg(d)}onResize(t){ui.updateGridLayout()}onRightClick(n){const i=n.target;if(!i)return;ui.hideMenus();n.preventDefault();if(i.id=="CanvasArea"){if(appState.isState(AppState.GObjDragging))appState.leave();if(appState.isReady()){ui.rclickCnvsX=n.offsetX;ui.rclickCnvsY=n.offsetY;ui.rclickOdvCnvsX=ui.toOdvCanvasX(ui.rclickCnvsX);ui.rclickOdvCnvsY=ui.toOdvCanvasY(ui.rclickCnvsY);let t=ui.windowIdsAt(ui.rclickOdvCnvsX,ui.rclickOdvCnvsY);let e=t.length,i=e>0?t[e-1]:-1;if(e>1&&n.altKey)i=t[e-2];ui.rclickWinId=i;ui.rclickGObjIdx=ui.currGObjIdx;let s=ui.rclickWinId,a=ui.rclickGObjIdx>-1;let l=n.shiftKey||n.ctrlKey;let r;if(s==0&&!a&&!l)r="MapMenu";else if(s==0&&!n.shiftKey&&n.ctrlKey)r="MwLayoutMenu";else if(s==0&&n.shiftKey&&!n.ctrlKey)r="MwExtrasMenu";else if(s>0&&!a&&!l)r="DataWinMenu";else if(s>0&&n.shiftKey&&!n.ctrlKey)r="DwExtrasMenu";else if(s>0&&!n.shiftKey&&n.ctrlKey)r="DwLayoutMenu";else if(s==-1&&!a&&!l)r="CanvasMenu";else if(s==-1&&!n.shiftKey&&n.ctrlKey)r="CwLayoutMenu";else if(a)r="GObjActMenu";else return;ui.showMenu(r,n.pageX,n.pageY)}else if(appState.isState(AppState.PointGetter)){ui.ptgCnvsX.pop();ui.ptgCnvsY.pop();ui.drawPointGetterPoly();ui.updatePointGetterCoords()}else if(appState.isZooming()){ui.restoreOldState()}}else if(i.id=="CurrStatLbl"){ui.rclickWinId=-10;ui.showMenu("CurrStatTbMenu",n.pageX,n.pageY)}else if(i.id=="CurrSmplLbl"){ui.rclickWinId=-10;ui.showMenu("CurrSmplTbMenu",n.pageX,n.pageY)}else if(i.nodeName=="TD"){ui.rclickWinId=-10;ui.rclickTblItem=Ui.tableItem(i.id);let t,e=ui.rclickTblItem.tbl;if(e=="D1"){if(ui.rclickTblItem.col==0)t="MetaVarMenu";else t="MetaValMenu"}else if(e=="D2"){if(ui.rclickTblItem.col==0)t="SmplNameMenu";else if(ui.rclickTblItem.col==3)t="SmplInfoValMenu";else t="SmplValMenu"}else if(e=="D3")t="IsoVarMenu";ui.showMenu(t,n.pageX,n.pageY)}}onSecLoad(e){if(e.length==0)return;let i="Load Section",s="";if(e.startsWith("private:")){let t=localStorage.getItem(Ui.rsrc.keys[1]+e.slice(8));s=Msg.modifyView(t,viewHistory.currentName(),i)}else{s='{"cmd":"execute_option","option":"load_section","description":"'+i+'","file":"'+e+'"}'}app.sendWsMsg(s+","+Msg.msgGetDockLbls+","+Msg.msgGetCanvasCurrInfo)}onSecSave(){let t=$("queryStr").value;view.section.name=t;ui.hideDlg();localStorage.setItem(Ui.rsrc.keys[1]+t,view.section.toXml());Fct.setLastLocalStorageChangeTime()}onSelectUrl(){let t=Fct.selectedStr("selectList","");ui.hideDlg(true);open(t,"ODV-online_ancillary")}onTouchEnd(t){app.processUpEvent(t.target,t.shiftKey,1,ui.currCnvsX+ui.cnvs.offsetLeft,ui.currCnvsY+ui.cnvs.offsetTop)}onTouchMove(t){let e=t.target;if(!e||t.touches.length==0)return;let i=t.touches[0];app.processMoveEvent(e,i.clientX,i.clientY,i.pageX,i.pageY)}onTouchStart(t){ui.finishOnDbleClick=false;let e=t.target;if(!e||t.touches.length==0)return;let i=t.touches[0],s=i.clientX-e.offsetLeft,a=i.clientY-e.offsetTop;app.processDownEvent(e,0,t.ctrlKey,s,a,i.pageX,i.pageY)}onUsageAgree(){Ui.onHideDlgFct=Fct.noOpFct;localStorage.setItem(coll.name+"/lastAgreeTime",Date.now());Fct.setLastLocalStorageChangeTime();ui.showInterface()}onViewLoad(t){let e=View.retrieveView(t);app.sendWsMsg(Msg.loadView(e.spec,e.name,e.descr))}onViewSave(){let t=viewHistory.current();t.name=ViewSpec.validatedName($("queryStr").value);ui.hideDlg();let e=Ui.rsrc.keys[0]+t.name;localStorage.setItem(e,JSON.stringify(t));localStorage.removeItem(e+"~");viewHistory.reset(t,false);ui.updateSbModePane();Fct.setLastLocalStorageChangeTime();app.sendWsMsg(Msg.modifyView("",t.name))}onViewSaveQuery(){ui.dlgQueryStr("Save View","Enter view name",viewHistory.currentPureName(),"app.onViewSave()","Save")}onWebSocketClose(t){ui.hideMenus();ui.gridContainer.style.display="none";Fct.consoleMsg("DISCONNECTED",true);Fct.leaveSession();let e=appState.current();appState.clear();if(e!=AppState.Popup){ui.hideDlg(true);ui.showAlert("<b>Server connection lost</b>")}}onWebSocketError(t){Fct.consoleMsg("ERROR: "+t.data,true)}onWebSocketMessage(t){Fct.consoleMsg("received:\t"+t.data);if(t.data instanceof Blob)app.processWebSocketBlobMessage(new Blob([t.data]));else app.processWebSocketTextMessage(t.data)}onWebSocketOpen(t){Fct.consoleMsg("CONNECTED",true);app.sendLoginRequest()}processDownEvent(t,e,i,s,a,l,r){if(appState.isReady()){App.wrkArr=[];App.wrkArr.push(ui.smplLstFract);App.wrkArr.push(ui.isovLstFract);App.wrkArr.push(ui.currSmplTitleBar.offsetTop);App.wrkArr.push(ui.currIsovTitleBar.offsetTop);App.wrkArr.push(3*ui.currSmplList.offsetHeight);if(Math.abs(l-ui.currSmplList.offsetLeft)<3){appState.enter(AppState.MoveVBar);ui.lastDateTime=Date.now()}else if(l>ui.currSmplList.offsetLeft&&Math.abs(r-ui.currSmplTitleBar.offsetTop)<3){appState.enter(AppState.MoveHBarSmpl);ui.lastDateTime=Date.now()}else if(l>ui.currSmplList.offsetLeft&&Math.abs(r-ui.currIsovTitleBar.offsetTop)<3){appState.enter(AppState.MoveHBarIsov);ui.lastDateTime=Date.now()}}if(t.id!="CanvasArea"){ui.updateSbCurrPos(-1,-1);return}ui.updateSbCurrPos(s,a);if(appState.isReady()){if(i){appState.enter(AppState.QuickZooming);ui.beginCnvsX=s;ui.beginCnvsY=a;ui.zoomWinId=ui.windowIdAt(ui.toOdvCanvasX(ui.beginCnvsX),ui.toOdvCanvasY(ui.beginCnvsY));ui.rememberPenAndBrushStyles();ui.ctx.strokeStyle="red";ui.ctx.lineWidth=1}else if(e==0&&ui.currGObjIdx>-1&&viewInfo.gObjInfoArr[ui.currGObjIdx].dragging==1){appState.enter(AppState.GObjDragging);ui.beginCnvsX=s;ui.beginCnvsY=a;ui.lclickGObjIdx=ui.currGObjIdx}}else if(appState.isZooming()){if(ui.zoomSpotId==-1){ui.currCnvsX=s;ui.currCnvsY=a;ui.updateZoomSpot()}if(ui.zoomSpotId!=-1){ui.beginCnvsX=ui.currCnvsX;ui.beginCnvsY=ui.currCnvsY;appState.isZoomDragging=true}}}processGObjFromClipboard(t){if(!t.includes("<GraphicsObjects>"))return;view.appendGObjFromXml(ui.rclickWinId,t,"Add Graphics Object from Clipboard")}processKeyEvent(t){const e=Fct.keyCodeFromKeyEvent(t),i=ui.currWinId,s=ui.currGObjIdx;ui.rclickCnvsX=ui.currCnvsX;ui.rclickCnvsY=ui.currCnvsY;ui.rclickOdvCnvsX=ui.toOdvCanvasX(ui.rclickCnvsX);ui.rclickOdvCnvsY=ui.toOdvCanvasY(ui.rclickCnvsY);ui.rclickWinId=i;ui.rclickGObjIdx=s;let a=false,l="";switch(e){case Fct.keyCode(0,1,0,"P"):if(s>-1)l="miGObjProps";else if(i==0&&s==-1)l="miMapProperties";else if(i>0&&s==-1)l="miDwProperties";break;case Fct.keyCode(1,0,0,"F"):if(i==-1)l="miFullRangeAllWin";else if(i==0)l="miFullDomain";else if(i>0)l="miFullRangeXYZ";break;case Fct.redoKeyCode():if(viewHistory.currIdx<viewHistory.size()-1)l="miUndoRedo "+(viewHistory.currIdx+1);break;case Fct.keyCode(1,0,0,"Z"):if(viewHistory.currIdx>0)l="miUndoRedo "+(viewHistory.currIdx-1);break;case Fct.keyCode(1,0,0,"+"):if(i>-1)l="miAutoZoomIn";break;case Fct.keyCode(1,0,0,"-"):if(i>-1)l="miAutoZoomOut";break;case"F4":if(i==0)l="miStatisticsMw";else if(i>0)l="miStatisticsDw";break}if(l.length==0&&ui.menuOptionsByKeyName.has(e))l=ui.menuOptionsByKeyName.get(e);if(l.length>0){app.processMenuOption(l);a=true}return a}processMenuOption(s){let t=$(s);if(t!=null&&t.classList.contains("disabled")){ui.hideMenus();return}ui.hideMenus();let a=s.split(":"),l,r,n,o,d,c,m;let u=ui.rclickWinId>0?view.dataWinArr[ui.rclickWinId-1]:null;ui.currMiOption=a[0];switch(ui.currMiOption){case"miAssignQfCurrSmpl":case"miAssignQfCurrStat":case"miAssignQfValStat":case"miAssignQfAllStat":case"miAssignQfWin":c=ui.rclickTblItem.row;d=ui.dockDataVarIds[c];ui.dlgOrigVals.set("assignQfMode",a[0]);ui.dlgOrigVals.set("winId",a[1]);ui.dlgOrigVals.set("varId",d+1);ui.dlgOrigVals.set("varGroup",1);ui.dlgSelectQf(d,1,ui.dockDataFlags[c],"ui.onAssignQf()");break;case"miAutoZoomIn":app.sendWsMsg(Msg.doAutoZoom("T")+","+Msg.msgGetCanvasCurrInfo);break;case"miAutoZoomOut":app.sendWsMsg(Msg.doAutoZoom("F")+","+Msg.msgGetCanvasCurrInfo);break;case"miDataAvailCollection":app.sendWsMsg('{"cmd":"get_data_counts","context":"collection"}');break;case"miDataAvailStationSet":app.sendWsMsg('{"cmd":"get_data_counts","context":"station_set"}');break;case"miDataAvailCruise":app.sendWsMsg('{"cmd":"get_data_counts","context":"cruise"}');break;case"miDataAvailStation":app.sendWsMsg('{"cmd":"get_data_counts","context":"station"}');break;case"miBrowseHistory":app.sendWsMsg('{"cmd":"get_current_station_history"}');break;case"miCloseSession":app.sendWsMsg('{"cmd":"logout_request"}');break;case"miCollBrowseAgreement":ui.showUsageAgreement();break;case"miCollBrowseInfo":app.sendWsMsg('{"cmd":"get_info_file"}');break;case"miCollBrowseLogfile":app.sendWsMsg('{"cmd":"get_log_file"}');break;case"miCollDelete":break;case"miCollDeleteCurrStation":ui.dlgYesNoBox("Confirm Station Delete","Really want to delete current station?","app.onDeleteCurrStat()");break;case"miCollDeleteStationSubset":ui.dlgYesNoBox("Confirm Station Delete","Really want to delete "+viewInfo.valStationCount+" stations?","app.onDeleteStatSubset()");break;case"miCollectStrValsDv":case"miCollectStrValsMv":let t=ui.rclickTblItem.tbl=="D1";c=ui.rclickTblItem.row;d=t?ui.dockMetaVarIds[c]:ui.dockDataVarIds[c];app.sendWsMsg('{"cmd":"get_unique_strings","var_id":'+d+',"is_metavar":'+t+',"count_limit":5000}');break;case"miCollCopy":ui.dlgQueryStr("Copy Collection","Enter new collection name","copy_of_"+coll.name,"app.onCollCopy()","Copy");break;case"miCollInvByCruise":app.sendWsMsg('{"cmd":"get_inventory_by_cruise"}');break;case"miCollInvByCruiseAndVar":app.sendWsMsg('{"cmd":"get_inventory_by_cruise_and_variable"}');break;case"miCollPropsDataVariables":DlgVarList.show(true);break;case"miCollPropsGeneral":DlgCollPropsGeneral.show();break;case"miCollPropsMetaVariables":DlgVarList.show(false);break;case"miCollRename":ui.dlgQueryStr("Rename Collection","Enter new collection name","renamed_"+coll.name,"app.onCollRename()","Rename");break;case"miCollSortCondense":app.sendWsMsg('{"cmd":"sort_condense_collection"}');break;case"miCreateOverviewPlots":app.sendWsMsg('{"cmd":"create_overview_plots"}');break;case"miCreateSnapshot":app.sendWsMsg('{"cmd":"create_collection_snapshot"}');break;case"miCurrSmplById":ui.dlgQueryStr("Select Sample by ID","Sample ID:",ui.currSmplId,"app.onCurrSmplById()","Select","10em");break;case"miCurrStatById":ui.dlgQueryStr("Select Station by ID","Station ID:",ui.currStatId,"app.onCurrStatById()","Select","10em");break;case"miCurrStatByAccession":ui.dlgQueryStr("Select Station by Accession Number","Accession Number:",ui.currStatAccNum,"app.onCurrStatByAccNum()","Select","10em");break;case"miCurrStatByName":DlgCurrStatByName.show();break;case"miCurveFittingDw":DlgCurveFitting.show();break;case"miDataExpWindow 0":case"miDataExpWindow 1":case"miDataExpWindow 2":case"miDataExpWindow 3":case"miDataExpWindow 4":case"miDataExpWindow 5":case"miDataExpWindow 6":case"miDataExpWindow 7":case"miDataExpWindow 8":case"miDataExpWindow 9":case"miDataExpWindow 10":case"miDataExpWindow 11":case"miDataExpWindow 12":case"miDataExpWindow 13":case"miDataExpWindow 14":case"miDataExpWindow 15":case"miDataExpWindow 16":case"miDataExpWindow 17":case"miDataExpWindow 18":case"miDataExpWindow 19":case"miDataExpWindow 20":m=ui.currMiOption.split(" ");ui.rclickWinId=parseInt(m[1]);if(ui.rclickWinId<=view.dataWinArr.length)DlgWinDataExp.show(ui.rclickWinId,viewInfo.isGeoMap[ui.rclickWinId]);break;case"miDefineSection":app.defSectionStart();break;case"miDisplayOrder":DlgDispOrder.show();break;case"miDrvdVars":DlgDrvdVars.show();break;case"miDwProperties":DlgDataWin.show(ui.rclickWinId,viewInfo.isGeoMap[ui.rclickWinId]);break;case"miDvCbCopyInfo":navigator.clipboard.writeText(ui.rclickTblItem.val);break;case"miDvCbCopyVal":navigator.clipboard.writeText(ui.rclickTblItem.val);break;case"miEditData":d=ui.dockDataVarIds[ui.rclickTblItem.row]+1;app.sendWsMsg('{"cmd":"get_current_station_data","var_id":'+d+"}");break;case"miEditInfoVal":d=ui.dockDataVarIds[ui.rclickTblItem.row];ui.dlgQueryStr("Enter new info value","Info "+coll.dataVarAtSpec(d),ui.dockDataInfoValues[ui.rclickTblItem.row],"app.changeInfoValue()");break;case"miAssignQfMvCurrStat":case"miAssignQfMvValStat":case"miAssignQfMvAllStat":d=ui.dockMetaVarIds[ui.rclickTblItem.row];ui.dlgOrigVals.set("assignQfMode",ui.currMiOption);ui.dlgOrigVals.set("varId",d+1);ui.dlgOrigVals.set("varGroup",0);case"miEditMetadata":app.sendWsMsg('{"cmd":"get_current_station_metadata"}');break;case"miEditSampleData":app.sendWsMsg('{"cmd":"get_current_sample_data"}');break;case"miExpHistory":DlgExportHist.show();break;case"miExpSpreadsheet":case"miExpCollection":case"miExpNetCDF":ui.dlgQueryStr("Export Data","Specify export file name","data_from_"+coll.name,"app.onExportFileName()");break;case"miFindDuplicates":DlgFindDupStats.show();break;case"miFullDomain":app.sendWsMsg(Msg.setMapDomain(App.missDOUBLE,App.largeDOUBLE,App.missDOUBLE,App.largeDOUBLE)+","+Msg.msgGetCanvasCurrInfo);break;case"miFullRangeX":app.sendWsMsg(Msg.setRanges(ui.rclickWinId,App.missDOUBLE,App.largeDOUBLE,u.yBottom,u.yTop,u.zBottom,u.zTop)+","+Msg.msgGetCanvasCurrInfo);break;case"miFullRangeY":app.sendWsMsg(Msg.setRanges(ui.rclickWinId,u.xLeft,u.xRight,App.missDOUBLE,App.largeDOUBLE,u.zBottom,u.zTop)+","+Msg.msgGetCanvasCurrInfo);break;case"miFullRangeZ":app.sendWsMsg(Msg.setRanges(ui.rclickWinId,u.xLeft,u.xRight,u.yBottom,u.yTop)+","+Msg.msgGetCanvasCurrInfo);break;case"miFullRangeXYZ":app.sendWsMsg(Msg.setRanges(ui.rclickWinId)+","+Msg.msgGetCanvasCurrInfo);break;case"miFullRangeAllWin":n="";for(l=1;l<=viewInfo.dataWinCount;++l)n+=Msg.setDwFullAxisRanges(l);app.sendWsMsg(Msg.modifyView(n,viewHistory.currentName(),"Set Full Axis Ranges: All Windows")+","+Msg.msgGetCanvasCurrInfo);break;case"miGlobalMap":app.sendWsMsg(Msg.setMapDomain(-180,180,-90,90)+","+Msg.msgGetCanvasCurrInfo);break;case"miGObjExpCurrent":App.wrkObj=view.getGObj(ui.rclickGObjIdx);ui.dlgQueryStr("Export GObject","Enter graphics object name",App.wrkObj.getName(),"app.onGObjSave()","Save");break;case"miGObjCopy":view.copyGObj(ui.rclickGObjIdx);break;case"miGObjMoveTop":case"miGObjMoveUp":case"miGObjMoveDwn":case"miGObjMoveBot":case"miGObjDelete":case"miGObjDeleteAll":view.gObjMoveTo(a[0]);break;case"miGObjMgr":DlgGObjMgr.show(ui.rclickWinId);break;case"miGObjProps":DlgGObjProps.show(view.getGObj(ui.rclickGObjIdx),viewInfo.gObjInfoArr[ui.rclickGObjIdx].win_id);break;case"miAddAnnotation":case"miAddSymbol":ui.startPointGetting(view.createGObj,1,1);break;case"miAddSymbolSet":DlgSymbolSetCreate.show(ui.rclickWinId);break;case"miGObjFromClipboard":navigator.clipboard.readText().then(t=>app.processGObjFromClipboard(t));break;case"miGObjFromGobFile":DlgSelTreeItem.show("Load Graphics File",2,app.onGObjLoad);break;case"miGObjFromShapeFile":DlgSelTreeItem.show("Load Shapefile File",4,app.onGObjLoad);break;case"miAddLine":ui.startPointGetting(view.createGObj,2,2);break;case"miAddPolygon":case"miAddPolyline":ui.startPointGetting(view.createGObj,2,1500);break;case"miAddEllipse":case"miAddRectangle":ui.startZooming(ui.scaledCnvsRect(ui.rclickWinId,.15),AppState.Zooming,view.createGObj);ui.zoomCnvsLeftBegin-=1;break;case"miGObjExpContoursCb":case"miGObjExpContoursFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"contour_lines",s=="miGObjExpContoursCb"));break;case"miGObjExpSecBathyCb":case"miGObjExpSecBathyFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"section_bathymetry_polygon",s=="miGObjExpSecBathyCb"));break;case"miGObjExpSecStatLblsCb":case"miGObjExpSecStatLblsFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"section_station_labels",s=="miGObjExpSecStatLblsCb"));break;case"miGObjExpSmplDotsCb":case"miGObjExpSmplDotsFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"sample_dots",s=="miGObjExpSmplDotsCb"));break;case"miGObjExpStatDotsCb":case"miGObjExpStatDotsFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"station_dots",s=="miGObjExpStatDotsCb"));break;case"miGObjExpStatSelPolyCb":case"miGObjExpStatSelPolyFile":app.sendWsMsg(Msg.exportAsGObject(ui.rclickWinId,"station_filter_polygon",s=="miGObjExpStatSelPolyCb"));break;case"miGoodCoverageCriteria":DlgCoverage.show();break;case"miHelpGettingStarted":open(App.odvDocsUrl+"ODV-online_getting_started.pdf","ODV-online-help");break;case"miHelpShortcutKeys":open(App.odvDocsUrl+"ODV_shortcut_keys.pdf","ODV-online-help");break;case"miHelpHowToGuide":open(App.odvDocsUrl+"ODV-online_how-to.pdf","ODV-online-help");break;case"miHelpOdvUserGuide":open(App.odvDocsUrl+"ODV_guide.pdf","ODV-online-help");break;case"miIdentifyKeyVariables":DlgIdentKeyVars.show();break;case"miIsopynals":DlgIsopynals.show();break;case"miIsoVars":DlgIsoVars.show();break;case"miLoadSection":DlgSelTreeItem.show("Load Section",1,app.onSecLoad);break;case"miLoadView":DlgSelTreeItem.show("Load View",0,app.onViewLoad);break;case"miManageViews":DlgRsrcMgr.show(0);break;case"miManageSections":DlgRsrcMgr.show(1);break;case"miManageGObjects":DlgRsrcMgr.show(2);break;case"miMapProperties":case"miWindow 0":DlgMapWin.show();break;case"miMvCbCopyVal":navigator.clipboard.writeText(ui.rclickTblItem.val);break;case"miNextSample":app.onCurrStatOrSmplByKeyCode("ArrowDown");break;case"miNextStation":app.onCurrStatOrSmplByKeyCode("ArrowRight");break;case"miPickListAdd":view.pickedStatArr.push(new PickedStat(ui.currStatId));app.sendWsMsg(Msg.setPickedStats()+","+Msg.msgGetCanvasCurrInfo);break;case"miPickListClear":view.pickedStatArr=[];app.sendWsMsg(Msg.setPickedStats()+","+Msg.msgGetCanvasCurrInfo);break;case"miPickListEdit":DlgPickList.show();break;case"miPickListRemove":l=Fct.indexOf(view.pickedStatArr,"statId",ui.currStatId);if(l>-1)view.pickedStatArr.splice(l,1);app.sendWsMsg(Msg.setPickedStats()+","+Msg.msgGetCanvasCurrInfo);break;case"miPrevSample":app.onCurrStatOrSmplByKeyCode("ArrowUp");break;case"miPrevStation":app.onCurrStatOrSmplByKeyCode("ArrowLeft");break;case"miRefreshCanvas":app.sendWsMsg(Msg.msgGetCanvas);break;case"miRemoveSection":if(view.section.isValid())app.sendWsMsg(Msg.msgRemoveSection+","+Msg.msgGetDockDataVarLbls+","+Msg.msgGetCanvasCurrInfo);break;case"miSaveAsInterruptedMap":case"miSaveAsInterruptedMapDw":case"miSaveImageCanvas":case"miSaveImageMap":case"miSaveImageDw":DlgImgProps.show(ui.currMiOption);break;case"miSaveSectionAs":if(view.section.isValid())ui.dlgQueryStr("Save Section","Enter section name",view.section.name,"app.onSecSave()","Save");break;case"miSaveViewAs":app.onViewSaveQuery();break;case"miSectionProperties":DlgSecProps.show("Msg.setSectionProps");break;case"miSetRanges":DlgAxisRanges.show(ui.rclickWinId);break;case"miSmplFilter":DlgSmplFilter.show(ui.rclickWinId);break;case"miSmplFilterRelax":app.sendWsMsg('{"cmd":"execute_option","option":"set_sample_filter","description":"Relax Sample Filter - '+Ui.windowName(ui.rclickWinId)+'","win_id":'+ui.rclickWinId+',"type":"all_samples"}'+","+Msg.msgGetCanvasCurrInfo);break;case"miSmplFilterNoOutliers":app.sendWsMsg('{"cmd":"execute_option","option":"set_sample_filter","description":"Reject Outlier Samples - '+Ui.windowName(ui.rclickWinId)+'","win_id":'+ui.rclickWinId+',"type":"reject_outliers"}'+","+Msg.msgGetCanvasCurrInfo);break;case"miStatFilter":DlgStatFilter.show();break;case"miStatFilterRelax":view.statFilter.setDefaults();app.sendWsMsg(Msg.setStatFilter()+","+Msg.msgGetCanvasCurrInfo);break;case"miStatisticsDw":app.sendWsMsg('{"cmd":"get_statistics_summary","window_id":'+ui.rclickWinId+"}");break;case"miStatisticsMw":app.sendWsMsg('{"cmd":"get_statistics_summary","window_id":0}');break;case"miUndoRedo 0":case"miUndoRedo 1":case"miUndoRedo 2":case"miUndoRedo 3":case"miUndoRedo 4":case"miUndoRedo 5":case"miUndoRedo 6":case"miUndoRedo 7":case"miUndoRedo 8":case"miUndoRedo 9":case"miUndoRedo 10":case"miUndoRedo 11":case"miUndoRedo 12":case"miUndoRedo 13":case"miUndoRedo 14":case"miUndoRedo 15":case"miUndoRedo 16":case"miUndoRedo 17":case"miUndoRedo 18":case"miUndoRedo 19":case"miUndoRedo 20":r=parseInt(ui.currMiOption.substring(10));if(viewHistory.setCurrentIndex(r)){let t=viewHistory.current();app.sendWsMsg(Msg.loadView(t.xmlStr,t.name,""))}break;case"miUndoAll":if(viewHistory.setCurrentIndex(0)){let t=viewHistory.current();app.sendWsMsg(Msg.loadView(t.xmlStr,t.name,""))}break;case"miViewProperties":DlgViewProps.show();break;case"miWindow 1":case"miWindow 2":case"miWindow 3":case"miWindow 4":case"miWindow 5":case"miWindow 6":case"miWindow 7":case"miWindow 8":case"miWindow 9":case"miWindow 10":case"miWindow 11":case"miWindow 12":case"miWindow 13":case"miWindow 14":case"miWindow 15":case"miWindow 16":case"miWindow 17":case"miWindow 18":case"miWindow 19":case"miWindow 20":m=ui.currMiOption.split(" ");ui.rclickWinId=parseInt(m[1]);if(ui.rclickWinId<=view.dataWinArr.length)DlgDataWin.show(ui.rclickWinId,viewInfo.isGeoMap[ui.rclickWinId]);break;case"miXVariable":if(ui.rclickWinId!=-1)DlgAxisVar.show(ui.rclickWinId,"X");break;case"miYVariable":if(ui.rclickWinId!=-1)DlgAxisVar.show(ui.rclickWinId,"Y");break;case"miZVariable":if(ui.rclickWinId!=-1)DlgAxisVar.show(ui.rclickWinId,"Z");break;case"miZoom":case"miDwMoveResize":case"miMoveResize":ui.startZooming(ui.odvCnvsRects[ui.rclickWinId],AppState.Zooming);break;case"mi1DEstimation":DlgGridCoords.show(false);break;case"mi2DEstimation":DlgGridCoords.show(true);break;case"miDefPatch":ui.startPointGetting(app.defPatchName,2,20);break;case"miDwDelete":view.dataWinArr=Fct.strippedArray(view.dataWinArr,[ui.rclickWinId-1]);app.sendWsMsg(Msg.loadView(view.toXml(),viewHistory.currentName(),"Delete "+Ui.windowName(ui.rclickWinId)));break;case"miDwNewWin":case"miDwNewOverlay":let e=ui.currMiOption=="miDwNewOverlay";let i=new DataWindow(u);i.plotMode=0;if(e){i.bckColor=App.missINT;i.winType=1}else{i.xBbOff+=1;i.yBbOff+=1;i.nonLinAutoAdjust="F";i.nonLinStart=-.1;i.nonLinEnd=.1}view.dataWinArr.push(i);ui.rclickWinId=view.dataWinArr.length;if(e)DlgAxisVar.show(ui.rclickWinId,u!=null&&u.isGridding()?"Z":"X",true);else app.sendWsMsg(Msg.loadView(view.toXml(),viewHistory.currentName(),"Create Window "+ui.rclickWinId));break;case"miDwMoveTop":Fct.moveElem(view.dataWinArr,ui.rclickWinId-1,view.dataWinArr.length-1);app.sendWsMsg(Msg.loadView(view.toXml(),viewHistory.currentName(),"Move "+Ui.windowName(ui.rclickWinId)+" to Foreground"));break;case"miDwMoveBot":Fct.moveElem(view.dataWinArr,ui.rclickWinId-1,0);app.sendWsMsg(Msg.loadView(view.toXml(),viewHistory.currentName(),"Move "+Ui.windowName(ui.rclickWinId)+" to Background"));break;case"miZZoom":o=view.dataWinArr[ui.rclickWinId-1].colBarAlign;if(o==0)return;ui.startZooming(ui.colbarCnvsRects[ui.rclickWinId],o==2?AppState.ZZoomingHor:AppState.ZZoomingVer);break;case"miFullScreenMap":case"miOnePickWin":case"miTwoPickWin":case"miSixPickWin":case"miOneSectionWin":case"miTwoSectionWin":case"miThreeSectionWin":case"miFiveSectionWin":case"miSixSectionWin":case"miOneIsoSurfaceWin":case"miTwoIsoSurfaceWin":case"miThreeIsoSurfaceWin":case"miFiveIsoSurfaceWin":app.layoutApply(s);break;case"miOneScatterWin":case"miFiveMixedWin":app.layoutSampleCountCheck(s,1);break;case"miTwoScatterWin":app.layoutSampleCountCheck(s,2);break;case"miSixScatterWin":app.layoutSampleCountCheck(s,6);break;default:Fct.consoleMsg("MenuOption "+s+" selected",true)}}processMoveEvent(t,e,i,s,a){let l=appState.current();const r=Date.now(),n=100;switch(l){case AppState.Ready:if(Math.abs(s-ui.currSmplList.offsetLeft)<3)document.body.style.cursor="col-resize";else if(s>ui.currSmplList.offsetLeft&&(Math.abs(a-ui.currSmplTitleBar.offsetTop)<3||Math.abs(a-ui.currIsovTitleBar.offsetTop)<3))document.body.style.cursor="row-resize";else document.body.style.cursor="default";break;case AppState.DlgDragging:ui.drawRectOutline(e+ui.beginCnvsX-ui.cnvs.offsetLeft-5,i+ui.beginCnvsY-ui.cnvs.offsetTop-5,ui.dragDlgWidth,ui.dragDlgHeight);break;case AppState.MoveVBar:if(r-ui.lastDateTime>n){let t=s-ui.cnvsContainer.offsetLeft;ui.cnvsFract=Math.max(.5,Math.min(.9,t/ui.fullWidth));ui.updateGridLayout();ui.lastDateTime=r}break;case AppState.MoveHBarSmpl:if(r-ui.lastDateTime>n){ui.smplLstFract=App.wrkArr[0]+(App.wrkArr[2]-a)/App.wrkArr[4];ui.smplLstFract=Math.max(.25,Math.min(.8,ui.smplLstFract));ui.updateGridLayout();ui.lastDateTime=r}break;case AppState.MoveHBarIsov:if(r-ui.lastDateTime>n){ui.smplLstFract=App.wrkArr[0]-(App.wrkArr[3]-a)/App.wrkArr[4];ui.smplLstFract=Math.max(.25,Math.min(.8,ui.smplLstFract));ui.isovLstFract=App.wrkArr[0]+App.wrkArr[1]-ui.smplLstFract;ui.updateGridLayout();ui.lastDateTime=r}break}if(t.id!="CanvasArea"){ui.updateSbCurrPos(-1,-1);return}ui.updateSbCurrPos(e-t.offsetLeft,i-t.offsetTop);if(l==AppState.PointGetter){ui.drawPointGetterPoly();ui.updatePointGetterCoords()}else if(l==AppState.QuickZooming)ui.drawQuickZoomRect();else if(l==AppState.GObjDragging)ui.drawCurrGObjPolygon(ui.currCnvsX-ui.beginCnvsX,ui.currCnvsY-ui.beginCnvsY);else if(appState.isZooming()&&!appState.isZoomDragging)ui.updateZoomSpot();else if(appState.isZoomDragging){let t=ui.currCnvsX-ui.beginCnvsX,e=ui.currCnvsY-ui.beginCnvsY;ui.beginCnvsX=ui.currCnvsX;ui.beginCnvsY=ui.currCnvsY;switch(ui.zoomSpotId){case 1:ui.zoomCnvsLeft+=t;ui.zoomCnvsBottom+=e;break;case 2:ui.zoomCnvsRight+=t;ui.zoomCnvsTop+=e;break;case 3:ui.zoomCnvsRight+=t;ui.zoomCnvsBottom+=e;break;case 4:ui.zoomCnvsLeft+=t;ui.zoomCnvsTop+=e;break;case 5:ui.zoomCnvsTop+=e;break;case 6:ui.zoomCnvsLeft+=t;break;case 7:ui.zoomCnvsBottom+=e;break;case 8:ui.zoomCnvsRight+=t;break;case 9:if(l!=AppState.ZZoomingVer){ui.zoomCnvsLeft+=t;ui.zoomCnvsRight+=t}if(l!=AppState.ZZoomingHor){ui.zoomCnvsBottom+=e;ui.zoomCnvsTop+=e}break}ui.drawZoomRect();ui.updateZoomPane()}}processUpEvent(e,g,h,t,i){if(e.id=="CanvasArea"){let d=t-e.offsetLeft,c=i-e.offsetTop,m,u,p;switch(appState.current()){case AppState.Ready:let t=ui.toOdvCanvasX(d),e=ui.toOdvCanvasY(c);let i=ui.windowIdAt(t,e);if(g){if(i>-1)app.sendWsMsg('{"cmd":"canvas_shift_left_click_event","x":'+t+',"y":'+e+"}")}else{if(i>-1&&h==1)app.sendWsMsg('{"cmd":"canvas_left_click_event","x":'+t+',"y":'+e+"},"+Msg.msgGetDockVals);else if(i==0&&h==2)app.processMenuOption("miPickListAdd")}break;case AppState.PointGetter:let s=ui.ptgCnvsX.length;p=1e3;if(s){p=Math.abs(d-ui.ptgCnvsX[s-1])+Math.abs(c-ui.ptgCnvsY[s-1])}ui.updateSbCurrPos(d,c);if(h==1&&p>5){ui.ptgCnvsX.push(d);ui.ptgCnvsY.push(c);ui.drawPointGetterPoly();ui.updatePointGetterCoords()}if(ui.ptgCnvsX.length==ui.ptgMaxPtCount||h>1&&ui.finishOnDbleClick)ui.finishPointGetting(true);break;case AppState.GObjDragging:appState.leave(AppState.GObjDragging);ui.restorePenAndBrushStyles();ui.clearCanvas();m=ui.toOdvCanvasX(ui.currCnvsX)-ui.toOdvCanvasX(ui.beginCnvsX);u=ui.toOdvCanvasY(ui.currCnvsY)-ui.toOdvCanvasY(ui.beginCnvsY);if(Math.abs(m)<3&&Math.abs(u)<3)return;let a=viewInfo.gObjInfoArr[ui.lclickGObjIdx];app.sendWsMsg('{"cmd":"execute_option","option":"move_graphics_object","description":"Move Graphics Object","win_id":'+a.win_id+',"index":'+a.index+',"del_x":'+m+',"del_y":'+u+"},"+Msg.msgGetCanvasCurrInfo);break;case AppState.QuickZooming:appState.leave(AppState.QuickZooming);ui.restorePenAndBrushStyles();ui.clearCanvas();let l=ui.toOdvCanvasX(ui.beginCnvsX),r=ui.toOdvCanvasX(ui.currCnvsX);let n=ui.toOdvCanvasY(ui.beginCnvsY),o=ui.toOdvCanvasY(ui.currCnvsY);if(l==r||n==o)return;app.sendWsMsg(Msg.zoom(ui.zoomWinId,Math.min(l,r),Math.min(n,o),Math.max(l,r),Math.max(n,o))+","+Msg.msgGetCanvasCurrInfo);break;case AppState.Zooming:case AppState.ZZoomingHor:case AppState.ZZoomingVer:appState.isZoomDragging=false;ui.zoomSpotId=-1;if(h>1&&ui.finishOnDbleClick)ui.finishZooming(true);break}}else if(e.nodeName=="TD"){let t=Ui.tableItem(e.id);if(ui.isClickable(t))app.sendWsMsg('{"cmd":"dock_left_click_event","dock_id":"'+t.tbl+'","row":'+t.row+',"column":'+t.col+"}")}switch(appState.current()){case AppState.DlgDragging:document.body.style.cursor="default";ui.clearCanvas();ui.placeDlg(ui.dragDlgIdx,t+ui.beginCnvsX,i+ui.beginCnvsY);ui.dragDlgIdx=-1;appState.leave(AppState.DlgDragging);break;case AppState.MoveVBar:case AppState.MoveHBarSmpl:case AppState.MoveHBarIsov:appState.leave();break}}processWebSocketBlobMessage(e){ui.startIsAlivePolling();let t=e.slice(0,App.blobHeaderByteSize),i,s;let a=new FileReader;a.onload=function(t){if(i===undefined){i=t.target.result;i=i.substring(0,i.indexOf("\0"));i=JSON.parse(i);s=e.slice(App.blobHeaderByteSize,e.size,i.media_type);switch(i.msg_type){case"canvas_image":ui.imgOdvCnvsLeft=i.rect.left;ui.imgOdvCnvsRight=i.rect.right;ui.imgOdvCnvsTop=i.rect.top;ui.imgOdvCnvsBottom=i.rect.bottom;case"custom_image":a.readAsDataURL(s);break;case"file_contents":ui.stopWaiting(i.reply_id);if(App.saveFileContentsCmds.indexOf(i.reply_id)>-1){if(i.reply_id!="get_image")ui.hideDlg(true);{if(i.file=="_clipboard_")s.text().then(t=>Fct.copyToClipboard(t),t=>Fct.noOpFct());else Fct.saveBlobAs(s,i.file)}if(i.reply_id=="create_overview_plots")app.sendWsMsg(Msg.msgGetCollInfo);else if(i.reply_id=="find_and_resolve_duplicate_stations"){ui.updateSbModePane();app.sendWsMsg(Msg.msgGetCanvas)}}else if(i.reply_id=="dock_left_click_event"||i.reply_id=="get_info_file")Fct.openBlobAsPage(s,i.file,"ODV-online-ancillary");break}}else{switch(i.msg_type){case"canvas_image":ui.imgArea.src=t.target.result;appState.cnvsState=AppState.Ready;break;case"custom_image":DlgImg.show(s,i);$("CustomImageArea").src=t.target.result;break}}};a.readAsText(t)}processWebSocketTextMessage(t){ui.startIsAlivePolling();const c=JSON.parse(t);ui.stopWaiting(c.reply_id);if(c.success==false){ui.stopWaiting();ui.dlgMsgBox(c.msg,"Server reply");return}switch(c.reply_id){case"compile_postfix_expression":ui.dlgMsgBox(c.msg);break;case"convert_infix_to_postfix":$("PfExpr").value=c.postfix_expression;break;case"copy_collection":ui.dlgMsgBox("Collection copied to: <b>"+c.file+"</b>");break;case"create_collection_snapshot":ui.dlgMsgBox("File written: <b>"+c.file+"</b>");break;case"create_patch":localStorage.setItem(coll.name+"/patches/"+c.patch_name,c.patch_as_xml);let t=new DOMParser;coll.privPatches.set(c.patch_name,new Patch(t.parseFromString(c.patch_as_xml,"text/xml").firstChild));Fct.setLastLocalStorageChangeTime();break;case"curve_fit":DlgCurveFitting.fitX=c.x_coords;DlgCurveFitting.fitY=c.y_coords;DlgCurveFitting.enableControls();if(c.msg.length>0)ui.dlgMsgBox(c.msg,"",true);break;case"find_and_resolve_duplicate_stations":coll.stationCount=c.station_count;viewInfo.valStationCount=c.selected_station_count;break;case"get_canvas_window":case"get_canvas_rect":if(appState.isState(AppState.Waiting))appState.enter(AppState.Ready);break;case"login_request":if(c.station_count==undefined)break;coll.name=extPrms.collectionName;case"execute_option":case"load_view":case"modify_view":if(c.station_count!=undefined){coll.stationCount=c.station_count;ui.odvCnvsRects=c.rects;ui.odvCnvsPolygons=c.polygons;ui.colbarCnvsRects=c.colorbar_rects;ui.filterStatusStrings=c.filter_status_strings;ui.isoVarFilterStatusString=c.isosurface_var_filter_status_string;ui.highlightStyles=c.highlight_styles;viewInfo.setContent(c);let t=new DOMParser;let e=new ViewSpec(c.view_name,c.view_as_xml,c.description,c.elapsed_seconds);view=new View(t.parseFromString(c.view_as_xml,"text/xml"));let i=e.descr=="Load View";if(e.descr.length>0){if(i)viewHistory.reset(e);else viewHistory.push(e)}if(coll.name!=undefined)localStorage.setItem(coll.name+"/lastViewName",e.name);ui.updateSbModePane();ui.sbStatFilPane.innerHTML="<div>"+ui.filterStatusStrings[0]+"</div>"}break;case"canvas_left_click_event":case"get_current_information":case"select_current_sample":ui.currStatId=c.station_id;ui.currValStatId=c.valid_station_id;ui.currStatAccNum=c.accession_number;ui.currSmplId=c.sample_id;ui.smplCount=c.sample_count;ui.hlPolylines=c.polylines;ui.hlPoints=c.points;ui.hlDrawDataDots=c.draw_data_dots;view.pickedStatArr.map((t,e)=>{t.statLbl=c.picked_station_labels[e];t.cruiseLbl=c.picked_cruise_labels[e]});ui.drawHighlighting();if(appState.isState(AppState.DefSectionStep1))ui.startPointGetting(app.defSectionProps);else if(appState.isState(AppState.DefSectionStep2))app.defSectionFinish();break;case"canvas_shift_left_click_event":if(c.clicked_win_id==0)DlgMultiStation.show(c.nearest_points_count,c.station_ids,c.sample_counts,c.cruise_names,c.station_specs,c.dates,c.positions,c.primary_var_ranges);else DlgMultiSample.show(c.nearest_points_count,c.station_ids,c.sample_ids,c.sample_specs,c.cruise_names,c.station_specs,c.dates,c.positions,c.x_values,c.y_values,c.z_values);break;case"dock_left_click_event":if(c.urls!=undefined&&c.urls.length>0){if(c.urls.length==1)open(c.urls[0],"ODV-online_ancillary");else ui.dlgSelectItem("Select an Item",c.urls,"app.onSelectUrl()")}break;case"export_data":case"export_history":case"export_window_data":ui.showAlert('<p style="line-height:150%;"><b>Data export started...</b><br>&emsp;<br>This may take a while.<br>Do not close this browser window until you have received the export zip file.<br>&emsp;<br><b>Please wait...</b></p>',"black");break;case"get_collection_information":coll=new Collection(c);qfSets=new Map;let e,i=c.qf_schemas.length,s={};for(e=0;e<i;++e){s=c.qf_schemas[e];qfSets.set(s.schema_id,s)}if(coll.usageAgreeRequired())ui.showUsageAgreement();else ui.showInterface();break;case"get_current_sample_data":DlgEditSmplData.show(c.values,c.error_values,c.flags);break;case"get_current_sample_dock_data":ui.dockDataValues=c.values;ui.dockDataValueClickableFlags=c.values_clickable_flags;ui.dockDataFlags=c.flags;ui.dockDataOdvFlags=c.odv_flags;ui.dockDataInfoValues=c.info_values;ui.dockDataInfoValueClickableFlags=c.info_values_clickable_flags;ui.updateCurrSmplList(ui.currSmplId,ui.smplCount);break;case"get_current_station_data":DlgEditData.show(c.var_id,c.primary_var_values,c.values,c.error_values,c.flags);break;case"get_current_station_dock_metadata":ui.dockMetaValues=c.values;ui.dockMetaValueOdvFlags=c.odv_flags;ui.dockMetaValueClickableFlags=c.values_clickable_flags;ui.updateCurrStatList(ui.currStatId);break;case"get_current_station_dock_isosurface_data":ui.updateCurrStatIsoVarList(c.values);break;case"get_current_station_metadata":switch(ui.currMiOption){case"miEditMetadata":DlgEditMetaData.show(c.var_ids,c.values,c.flags);break;case"miAssignQfMvCurrStat":case"miAssignQfMvValStat":case"miAssignQfMvAllStat":let t=ui.dockMetaVarIds[ui.rclickTblItem.row];ui.dlgSelectQf(t,0,c.flags[c.var_ids.indexOf(t)],"ui.onAssignQf()");break}break;case"get_current_station_history":ui.dlgMultiLineMsgBox("Current Station History",c.history_records,800,160);break;case"get_data_counts":let a=Fct.nonZeroCountInfos(c.sample_count,c.data_counts);DlgStdTable.show("Data Availability - "+c.context_description,"<b>Total sample count</b>: "+Fct.formattedInt(c.sample_count),"",["Variable","Value Count","%"],[75,15,8],[false,true,true],[a.lblArr,a.fmtCountArr,a.percArr],580,250);break;case"get_derivedvar_choices":ui.drvdVarChoices=c.drvdVarChoices;ui.drvdVarGroups=c.drvdVarGroups;ui.varCnvIds=c.varCnvIds;ui.varCnvLbls=c.varCnvLabels;ui.varCnvFacs=c.varCnvFacs;ui.varCnvOffs=c.varCnvOffs;ui.timeVarCnvIds=c.timeVarCnvIds;ui.timeVarCnvLbls=c.timeVarCnvLabels;ui.metaTimeVarCnvIds=c.metaTimeVarCnvIds;ui.metaTimeVarCnvLbls=c.metaTimeVarCnvLabels;break;case"get_dock_datavar_labels":ui.dockDataVarLabels=c.labels;ui.dockDataVarLabelClickableFlags=c.labels_clickable_flags;ui.dockDataVarIds=c.var_ids;break;case"get_dock_isosurfacevar_labels":ui.dockIsoVarLabels=c.labels;ui.dockIsoVarIds=c.var_ids;break;case"get_dock_metavar_labels":ui.dockMetaVarLabels=c.labels;ui.dockMetaVarIds=c.var_ids;break;case"get_macro":DlgDrvdVars.dv=Object.assign({},c.macro);DlgDrvdVars.dv.fPrms=[];DlgDrvdVars.dv.iPrms=[];DlgDrvdVars.dv.inpVarIds=[];DlgDrvdVars.dv.queryStrsInpVarLabels=[...c.queryStrsInpVarLabels];DlgDrvdVars.dv.comment=c.comment;DlgDrvdVars.identifyInpVar(0);break;case"get_resource_as_xml":Fct.saveBlobAs(new Blob([c.resource_as_xml],{type:"text/plain"}),c.file);break;case"get_setup_information":ui.paletteNames=c.palette_names;ui.paletteReds=c.palette_reds;ui.paletteGreens=c.palette_greens;ui.paletteBlues=c.palette_blues;ui.disableExports=c.disable_exports;ui.dataVarTypeNames=c.datavar_type_names;ui.metaVarTypeNames=c.metavar_type_names;ui.keyVarIdChoices=c.keyVarIdChoices;ui.keyVarLblChoices=c.keyVarLblChoices;ui.macroNames=c.macro_names;ui.gobjFilesCount=c.gobj_files_count;ui.gobjFilesTree=c.gobj_files_tree;ui.shapeFilesCount=c.shape_files_count;ui.shapeFilesTree=c.shape_files_tree;app.version="ODV-online "+App.odvOnlineVersion+" | odvws "+c.odv_version+" / "+c.web_server_version+" | "+extPrms.serverVersion;$("TbIconPane").setAttribute("title",app.version);break;case"get_statistics_summary":if(c.window_id==0)DlgMwStats.show(c);else DlgDwStats.show(c);break;case"get_symbolset_nodes":let l=new GObject(30,c.x_coords,c.y_coords);l.addLgd="T";l.fColor=12;l.text=c.legend_text;DlgGObjProps.show(l,c.window_id,false,false,true);break;case"get_unique_strings":let r=c.is_metavar?coll.metaVar(c.var_id).uname:coll.dataVar(c.var_id).uname;let n="<b>"+r+"</b>: "+c.total_count+" unique string value(s) found.";if(c.total_count>c.count)n+=" "+c.count+" most used strings shown.";let o=0,d=[];c.occurence_counts.map(t=>{o+=t;d.push(Fct.formattedInt(t))});DlgStdTable.show("String Values",n,"Total count shown: "+Fct.formattedInt(o),["Values","Counts"],[85,15],[false,true],[c.strings,d],400,220);break;case"import_data_incremental":coll.stationCount=c.station_count;viewInfo.valStationCount=c.selected_station_count;if(c.imported_station_count>0){ui.updateSbModePane();app.sendWsMsg(Msg.msgGetCanvas)}break;case"logout_request":ui.closeSession("Thank you for using ODV-online.");break;case"notification":switch(c.notification_type){case"access_mode_change":ui.setAccessMode(c.access_mode);break;case"session_count_change":appState.isSingleSession=c.is_single_session;break;case"message":ui.hideMenus();ui.hideDlg(true);ui.dlgMsgBox(c.msg);break;case"time_out_event":ui.closeSession("ODV-online session closed because of inactivity.");break}break;case"sort_condense_collection":ui.dlgMsgBox("Sort and Condense successful");break}}sendLoginRequest(){let o="Login Request";if(extPrms.isDevEnvironment){extPrms.sessionId=$("Identifier").value;extPrms.collectionName=$("Collection").value;extPrms.initialView=$("InitialView").value}if(extPrms.sessionId.length==0)return;if(extPrms.sessionId.indexOf("already logged in")!==-1)ui.dlgMsgBox(extPrms.sessionId);else{let t=localStorage.getItem("_settings/lastOpenElems");if(t!=null)ui.dlgLastOpenElems=new Map(JSON.parse(t));let e=extPrms.collectionName,i=false,s,a;let l="$FullScreenMap$",r="FullScreenMap";if(e.length>0){s=localStorage.getItem(e+"/lastViewName");if(s!=null){if(localStorage.getItem(Ui.rsrc.keys[0]+s)!=null)s="private:"+s;let t=View.retrieveView(s,e);l=t.spec;r=t.name;o=t.descr;i=true}}let n=extPrms.initialView;if(n!=undefined&&n.length>0&&n!="$FullScreenMap$"){l=extPrms.initialView;r=extPrms.initialView;i=true}if(!i){l="$FullScreenMap$";r="FullScreenMap"}app.sendWsMsg('{"cmd":"login_request","view":"'+l+'","view_name":"'+r+'","description":"'+o+'"}');app.sendWsMsg('{"cmd":"get_setup_information"},'+Msg.msgGetDrvdVarChoices+","+Msg.msgGetDockLbls+","+Msg.msgGetCollInfo)}ui.controlBlock.blur()}sendUpdateGobjMsg(e,i,s,t){let a="";if(e==-1)a+="<Canvas>"+s.toXml()+" </Canvas>";else if(e==0){a+="<MapWindow background_color='"+view.mapWin.bckColor+"'> <Window>";a+=i==40?view.mapWin.legend.toXmlLegend():s.toXml();a+=" </Window> </MapWindow>"}else if(e>0){let t=view.dataWinArr[e-1];a+="<DataWindow window_id='"+e+"' background_color='"+t.bckColor+"' highlight_style='"+t.highlightStyle+"'> <Window>";if(i==40)a+=t.legend.toXmlLegend();else if(i==41)a+=t.udot.toXmlUDot();else if(i==42)a+=t.uarrow.toXmlUArrow();else a+=s.toXml();a+=" </Window> </DataWindow>"}app.sendWsMsg(Msg.modifyView(a,viewHistory.currentName(),t)+","+Msg.msgGetCanvasCurrInfo)}sendWebSocketMessage(){if(app.websocket!=null){if(extPrms.isDevEnvironment)extPrms.sessionId=$("Identifier").value;app.sendWsMsg($("InputText").value);$("InputText").value=""}ui.controlBlock.blur()}sendWsMsg(e){if(app.websocket==null)return;if(app.websocket.readyState==1){for(let t=0;t<App.startWaitingCmds.length;++t){if(e.indexOf(App.startWaitingCmds[t])>-1){ui.startWaiting(App.startWaitingCmds[t]);break}}if(e.indexOf(Msg.getCanvasWindowCmdName)>-1)appState.cnvsState=AppState.Waiting;let t='{"sender_id":"'+extPrms.sessionId+'","cmds":['+e+"]}";app.websocket.send(t);Fct.consoleMsg("\nsent:\t\t"+t)}else ui.dlgMsgBox("Server is disconnected")}setEventListeners(){addEventListener("click",app.onClick);addEventListener("contextmenu",app.onRightClick);addEventListener("keydown",app.onKeyDown);addEventListener("mousedown",app.onMouseDown);addEventListener("mousemove",app.onMouseMove);addEventListener("mouseup",app.onMouseUp);addEventListener("pagehide",app.onPageHide);addEventListener("resize",app.onResize);addEventListener("touchstart",app.onTouchStart);addEventListener("touchmove",app.onTouchMove);addEventListener("touchend",app.onTouchEnd);ui.imgArea.addEventListener("load",app.onImageReady);ui.cnvsContainer.addEventListener("mouseleave",app.onMouseLeaveCanvas);ui.currIsoVarList.addEventListener("mouseenter",app.onMouseEnterCurrIsoVarList);ui.currIsoVarList.addEventListener("mouseleave",app.onMouseLeaveCurrIsoVarList);ui.popupBckgrd.addEventListener("mousedown",app.onMouseDownPopupBckgrd);let t,e=$("DlgTitle1");for(t=1;t<4;++t){e=$("DlgTitle"+t);e.addEventListener("mousedown",app.onMouseDownDlgTitle);e.addEventListener("mouseenter",app.onMouseEnterDlgTitle);e.addEventListener("mouseleave",app.onMouseLeaveDlgTitle)}}webSocketStartup(){try{if(typeof MozWebSocket=="function")WebSocket=MozWebSocket;if(app.websocket&&app.websocket.readyState==1)app.websocket.close();app.websocket=new WebSocket(extPrms.wsUri);app.websocket.onclose=app.onWebSocketClose;app.websocket.onerror=app.onWebSocketError;app.websocket.onopen=app.onWebSocketOpen;app.websocket.onmessage=app.onWebSocketMessage}catch(t){Fct.consoleMsg("ERROR: "+t,true)}}webSocketStop(){ui.imgArea.src="";appState.clear();if(app.websocket)app.websocket.close()}}class AppState{constructor(){AppState.Waiting=0;AppState.Ready=1;AppState.Popup=6;AppState.Menu=7;AppState.GObjDragging=10;AppState.DlgDragging=11;AppState.MoveVBar=20;AppState.MoveHBarSmpl=21;AppState.MoveHBarIsov=22;AppState.DefSectionStep1=30;AppState.DefSectionStep2=31;AppState.Zooming=40;AppState.QuickZooming=41;AppState.ZZoomingHor=42;AppState.ZZoomingVer=43;AppState.PointGetter=50;this.clear()}clear(){this.statesArr=[AppState.Waiting];this.cnvsState=AppState.Waiting;this.waitingForCmd="";this.isSingleSession=true;this.isZoomDragging=false}current(){return this.statesArr[this.statesArr.length-1]}enter(t){let e=this.current();this.statesArr.push(t);return e}isCnvsReady(){return this.cnvsState==AppState.Ready}isReady(){return this.current()==AppState.Ready}isState(t){return this.current()==t}isZooming(){let t=this.current();return t==AppState.Zooming||t==AppState.ZZoomingHor||t==AppState.ZZoomingVer}leave(t){let e=t==undefined?true:this.current()==t;if(e)this.statesArr.pop();return this.current()}}"use strict";let ui=new Ui;let view;let viewInfo=new ViewInfo;let viewHistory=new ViewHistory;let coll=new Collection;let qfSets=new Map;let app=new App;let appState=new AppState;function $(t){return document.getElementById(t)}function $$(t,e){return t.getElementsByTagName(e)}String.prototype.insert=function(t,e){if(t>0)return this.substring(0,t)+e+this.substring(t,this.length);else return e+this};
